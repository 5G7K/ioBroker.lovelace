{"version":3,"sources":["webpack:///./node_modules/@polymer/paper-spinner/paper-spinner.js","webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-behavior.js","webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-shared-styles.js","webpack:///./node_modules/@polymer/paper-dialog/paper-dialog.js","webpack:///./src/components/dialog/ha-iron-focusables-helper.js","webpack:///./src/components/dialog/ha-paper-dialog.ts","webpack:///./node_modules/@polymer/paper-dialog-scrollable/paper-dialog-scrollable.js","webpack:///./node_modules/@polymer/paper-icon-button/paper-icon-button-light.js","webpack:///./src/components/device/ha-devices-picker.ts","webpack:///./src/components/device/ha-area-devices-picker.ts","webpack:///./src/common/util/patch.ts","webpack:///./src/panels/config/automation/thingtalk/ha-thingtalk-placeholders.ts","webpack:///./src/panels/config/automation/thingtalk/dialog-thingtalk.ts"],"names":["__webpack_require__","_polymer_polymer_lib_legacy_polymer_fn_js__WEBPACK_IMPORTED_MODULE_3__","_polymer_polymer_lib_utils_html_tag_js__WEBPACK_IMPORTED_MODULE_4__","_paper_spinner_behavior_js__WEBPACK_IMPORTED_MODULE_5__","template","html","setAttribute","Polymer","_template","is","behaviors","PaperSpinnerBehavior","d","__webpack_exports__","PaperDialogBehaviorImpl","PaperDialogBehavior","_polymer_iron_overlay_behavior_iron_overlay_behavior_js__WEBPACK_IMPORTED_MODULE_1__","_polymer_polymer_lib_legacy_polymer_dom_js__WEBPACK_IMPORTED_MODULE_2__","hostAttributes","role","tabindex","properties","modal","type","Boolean","value","__readied","observers","listeners","tap","ready","this","__prevNoCancelOnOutsideClick","noCancelOnOutsideClick","__prevNoCancelOnEscKey","noCancelOnEscKey","__prevWithBackdrop","withBackdrop","_modalChanged","readied","_updateClosingReasonConfirmed","confirmed","closingReason","_onDialogClick","event","path","dom","i","l","indexOf","target","hasAttribute","close","stopPropagation","IronOverlayBehavior","$_documentContainer","document","createElement","innerHTML","head","appendChild","content","_polymer_neon_animation_neon_animation_runner_behavior_js__WEBPACK_IMPORTED_MODULE_2__","_polymer_paper_dialog_behavior_paper_dialog_behavior_js__WEBPACK_IMPORTED_MODULE_3__","_polymer_polymer_lib_legacy_polymer_fn_js__WEBPACK_IMPORTED_MODULE_4__","_polymer_polymer_lib_utils_html_tag_js__WEBPACK_IMPORTED_MODULE_5__","NeonAnimationRunnerBehavior","neon-animation-finish","_renderOpened","cancelAnimation","playAnimation","_renderClosed","_onNeonAnimationFinish","opened","_finishRenderOpened","_finishRenderClosed","HaIronFocusablesHelper","getTabbableNodes","node","result","_collectTabbableNodes","IronFocusablesHelper","_sortByTabIndex","nodeType","Node","ELEMENT_NODE","_isVisible","children","element","tabIndex","_normalizedTabIndex","needsSort","push","localName","getDistributedNodes","shadowRoot","root","length","paperDialogClass","customElements","get","haTabFixBehaviorImpl","_focusableNodes","define","mixinBehaviors","dialogElement","Object","scrollTarget","$","scrollable","_ensureTarget","classList","add","attached","requestAnimationFrame","updateScrollState","bind","toggleClass","scrollTop","offsetHeight","scrollHeight","parentElement","sizingTarget","remove","_polymer_paper_behaviors_paper_ripple_behavior_js__WEBPACK_IMPORTED_MODULE_1__","_polymer_polymer_lib_legacy_polymer_fn_js__WEBPACK_IMPORTED_MODULE_2__","_polymer_polymer_lib_utils_html_tag_js__WEBPACK_IMPORTED_MODULE_3__","_polymer_polymer_lib_utils_render_status_js__WEBPACK_IMPORTED_MODULE_4__","PaperRippleBehavior","registered","afterNextRender","addEventListener","_rippleDown","_rippleUp","button","getEffectiveChildren","_rippleContainer","getRipple","uiDownAction","uiUpAction","ensureRipple","var_args","lastRipple","_ripple","apply","arguments","center","customElement","_LitElement","[object Object]","args","super","_initialize","property","Array","attribute","hass","currentDevices","_currentDevices","map","entityId","includeDomains","excludeDomains","includeDeviceClasses","pickedDeviceLabel","_deviceChanged","pickDeviceLabel","_addDevice","async","devices","fireEvent","curValue","currentTarget","newValue","detail","_updateDevices","filter","dev","toAdd","includes","LitElement","ha_area_devices_picker_decorate","_SubscribeMixin","F","kind","decorators","key","memoizeOne","areas","entities","deviceEntityLookup","entity","device_id","inputDevices","device","devEntities","id","some","computeDomain","entity_id","every","stateObj","states","attributes","device_class","_filteredDevices","areaLookup","area","area_id","devicesByArea","areaId","name","keys","sort","a","b","compare","subscribeDeviceRegistry","connection","_devices","subscribeAreaRegistry","_areas","subscribeEntityRegistry","_entities","changedProps","has","_areaPicker","filteredDeviceIds","selectedDevices","_setValue","_getDevices","_value","_owner","model","firstElementChild","querySelector","textContent","item","toString","_openedChanged","_areaPicked","undefined","label","localize","_clearValue","_opened","_switchPicker","_devicesPicked","_selectedDevices","ev","selectedItem","setTimeout","static","css","SubscribeMixin","applyPatch","data","slice","getPath","ha_thingtalk_placeholders_decorate","entries","_deviceEntityLookup","_searchNames","_search","_error","placeholders","placeholder","fields","extraInfo","_extraInfo","index","_devicePicked","device_ids","domains","device_classes","_getLabel","manualEntity","idx","_entityPicked","_getDeviceName","_placeholderValues","state","devId","field","skip","_done","_isDone","deviceId","foundDevice","find","name_by_user","forEach","foundArea","toLowerCase","requestUpdate","foundDevices","deviceName","values","entry","deviceClasses","domain","join","oldValues","oldExtraInfo","oldIndex","oldDevice","oldVal","eid","dispatchEvent","CustomEvent","haStyleDialog","query","params","_params","_placeholders","_skip","_handlePlaceholders","_handleExampleClick","_handleKeyUp","_generate","_submitting","_input","config","convertThingTalk","err","message","_config","_sendConfig","placeholderValues","automation","assign","newAutomations","newAutomation","splice","input","callback","alias","_closeDialog","keyCode","innerText","haStyle"],"mappings":"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","file":"chunk.927efb587a704a4a1d3c.js","sourcesContent":["/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/paper-styles/color.js';\nimport './paper-spinner-styles.js';\n\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\n\nimport {PaperSpinnerBehavior} from './paper-spinner-behavior.js';\n\nconst template = html`\n  <style include=\"paper-spinner-styles\"></style>\n\n  <div id=\"spinnerContainer\" class-name=\"[[__computeContainerClasses(active, __coolingDown)]]\" on-animationend=\"__reset\" on-webkit-animation-end=\"__reset\">\n    <div class=\"spinner-layer layer-1\">\n      <div class=\"circle-clipper left\">\n        <div class=\"circle\"></div>\n      </div>\n      <div class=\"circle-clipper right\">\n        <div class=\"circle\"></div>\n      </div>\n    </div>\n\n    <div class=\"spinner-layer layer-2\">\n      <div class=\"circle-clipper left\">\n        <div class=\"circle\"></div>\n      </div>\n      <div class=\"circle-clipper right\">\n        <div class=\"circle\"></div>\n      </div>\n    </div>\n\n    <div class=\"spinner-layer layer-3\">\n      <div class=\"circle-clipper left\">\n        <div class=\"circle\"></div>\n      </div>\n      <div class=\"circle-clipper right\">\n        <div class=\"circle\"></div>\n      </div>\n    </div>\n\n    <div class=\"spinner-layer layer-4\">\n      <div class=\"circle-clipper left\">\n        <div class=\"circle\"></div>\n      </div>\n      <div class=\"circle-clipper right\">\n        <div class=\"circle\"></div>\n      </div>\n    </div>\n  </div>\n`;\ntemplate.setAttribute('strip-whitespace', '');\n\n/**\nMaterial design: [Progress &\nactivity](https://www.google.com/design/spec/components/progress-activity.html)\n\nElement providing a multiple color material design circular spinner.\n\n    <paper-spinner active></paper-spinner>\n\nThe default spinner cycles between four layers of colors; by default they are\nblue, red, yellow and green. It can be customized to cycle between four\ndifferent colors. Use <paper-spinner-lite> for single color spinners.\n\n### Accessibility\n\nAlt attribute should be set to provide adequate context for accessibility. If\nnot provided, it defaults to 'loading'. Empty alt can be provided to mark the\nelement as decorative if alternative content is provided in another form (e.g. a\ntext block following the spinner).\n\n    <paper-spinner alt=\"Loading contacts list\" active></paper-spinner>\n\n### Styling\n\nThe following custom properties and mixins are available for styling:\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-spinner-layer-1-color` | Color of the first spinner rotation | `--google-blue-500`\n`--paper-spinner-layer-2-color` | Color of the second spinner rotation | `--google-red-500`\n`--paper-spinner-layer-3-color` | Color of the third spinner rotation | `--google-yellow-500`\n`--paper-spinner-layer-4-color` | Color of the fourth spinner rotation | `--google-green-500`\n`--paper-spinner-stroke-width` | The width of the spinner stroke | 3px\n\n@group Paper Elements\n@element paper-spinner\n@hero hero.svg\n@demo demo/index.html\n*/\nPolymer({\n  _template: template,\n\n  is: 'paper-spinner',\n\n  behaviors: [PaperSpinnerBehavior]\n});\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {IronOverlayBehavior} from '@polymer/iron-overlay-behavior/iron-overlay-behavior.js';\nimport {dom} from '@polymer/polymer/lib/legacy/polymer.dom.js';\n\n/**\n  Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to\n  implement a Material Design dialog.\n\n  For example, if `<paper-dialog-impl>` implements this behavior:\n\n      <paper-dialog-impl>\n          <h2>Header</h2>\n          <div>Dialog body</div>\n          <div class=\"buttons\">\n              <paper-button dialog-dismiss>Cancel</paper-button>\n              <paper-button dialog-confirm>Accept</paper-button>\n          </div>\n      </paper-dialog-impl>\n\n  `paper-dialog-shared-styles.html` provide styles for a header, content area,\n  and an action area for buttons. Use the `<h2>` tag for the header and the\n  `buttons` class for the action area. You can use the `paper-dialog-scrollable`\n  element (in its own repository) if you need a scrolling content area.\n\n  Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive\n  controls to close the dialog. If the user dismisses the dialog with\n  `dialog-confirm`, the `closingReason` will update to include `confirmed:\n  true`.\n\n  ### Accessibility\n\n  This element has `role=\"dialog\"` by default. Depending on the context, it may\n  be more appropriate to override this attribute with `role=\"alertdialog\"`.\n\n  If `modal` is set, the element will prevent the focus from exiting the\n  element. It will also ensure that focus remains in the dialog.\n\n  @hero hero.svg\n  @demo demo/index.html\n  @polymerBehavior PaperDialogBehavior\n */\nexport const PaperDialogBehaviorImpl = {\n\n  hostAttributes: {'role': 'dialog', 'tabindex': '-1'},\n\n  properties: {\n\n    /**\n     * If `modal` is true, this implies `no-cancel-on-outside-click`,\n     * `no-cancel-on-esc-key` and `with-backdrop`.\n     */\n    modal: {type: Boolean, value: false},\n\n    __readied: {type: Boolean, value: false}\n\n  },\n\n  observers: ['_modalChanged(modal, __readied)'],\n\n  listeners: {'tap': '_onDialogClick'},\n\n  /**\n   * @return {void}\n   */\n  ready: function() {\n    // Only now these properties can be read.\n    this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n    this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n    this.__prevWithBackdrop = this.withBackdrop;\n    this.__readied = true;\n  },\n\n  _modalChanged: function(modal, readied) {\n    // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.\n    // We need to wait for the element to be ready before we can read the\n    // properties values.\n    if (!readied) {\n      return;\n    }\n\n    if (modal) {\n      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n      this.__prevWithBackdrop = this.withBackdrop;\n      this.noCancelOnOutsideClick = true;\n      this.noCancelOnEscKey = true;\n      this.withBackdrop = true;\n    } else {\n      // If the value was changed to false, let it false.\n      this.noCancelOnOutsideClick =\n          this.noCancelOnOutsideClick && this.__prevNoCancelOnOutsideClick;\n      this.noCancelOnEscKey =\n          this.noCancelOnEscKey && this.__prevNoCancelOnEscKey;\n      this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;\n    }\n  },\n\n  _updateClosingReasonConfirmed: function(confirmed) {\n    this.closingReason = this.closingReason || {};\n    this.closingReason.confirmed = confirmed;\n  },\n\n  /**\n   * Will dismiss the dialog if user clicked on an element with dialog-dismiss\n   * or dialog-confirm attribute.\n   */\n  _onDialogClick: function(event) {\n    // Search for the element with dialog-confirm or dialog-dismiss,\n    // from the root target until this (excluded).\n    var path = dom(event).path;\n    for (var i = 0, l = path.indexOf(this); i < l; i++) {\n      var target = path[i];\n      if (target.hasAttribute &&\n          (target.hasAttribute('dialog-dismiss') ||\n           target.hasAttribute('dialog-confirm'))) {\n        this._updateClosingReasonConfirmed(\n            target.hasAttribute('dialog-confirm'));\n        this.close();\n        event.stopPropagation();\n        break;\n      }\n    }\n  }\n\n};\n\n/** @polymerBehavior */\nexport const PaperDialogBehavior =\n    [IronOverlayBehavior, PaperDialogBehaviorImpl];\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n/*\n### Styling\n\nThe following custom properties and mixins are available for styling.\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-dialog-background-color` | Dialog background color | `--primary-background-color`\n`--paper-dialog-color` | Dialog foreground color | `--primary-text-color`\n`--paper-dialog` | Mixin applied to the dialog | `{}`\n`--paper-dialog-title` | Mixin applied to the title (`<h2>`) element | `{}`\n`--paper-dialog-button-color` | Button area foreground color | `--default-primary-color`\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/iron-flex-layout/iron-flex-layout.js';\nimport '@polymer/paper-styles/default-theme.js';\nimport '@polymer/paper-styles/typography.js';\nimport '@polymer/paper-styles/shadow.js';\nconst $_documentContainer = document.createElement('template');\n$_documentContainer.setAttribute('style', 'display: none;');\n\n$_documentContainer.innerHTML = `<dom-module id=\"paper-dialog-shared-styles\">\n  <template>\n    <style>\n      :host {\n        display: block;\n        margin: 24px 40px;\n\n        background: var(--paper-dialog-background-color, var(--primary-background-color));\n        color: var(--paper-dialog-color, var(--primary-text-color));\n\n        @apply --paper-font-body1;\n        @apply --shadow-elevation-16dp;\n        @apply --paper-dialog;\n      }\n\n      :host > ::slotted(*) {\n        margin-top: 20px;\n        padding: 0 24px;\n      }\n\n      :host > ::slotted(.no-padding) {\n        padding: 0;\n      }\n\n      \n      :host > ::slotted(*:first-child) {\n        margin-top: 24px;\n      }\n\n      :host > ::slotted(*:last-child) {\n        margin-bottom: 24px;\n      }\n\n      /* In 1.x, this selector was \\`:host > ::content h2\\`. In 2.x <slot> allows\n      to select direct children only, which increases the weight of this\n      selector, so we have to re-define first-child/last-child margins below. */\n      :host > ::slotted(h2) {\n        position: relative;\n        margin: 0;\n\n        @apply --paper-font-title;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-top. */\n      :host > ::slotted(h2:first-child) {\n        margin-top: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-bottom. */\n      :host > ::slotted(h2:last-child) {\n        margin-bottom: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      :host > ::slotted(.paper-dialog-buttons),\n      :host > ::slotted(.buttons) {\n        position: relative;\n        padding: 8px 8px 8px 24px;\n        margin: 0;\n\n        color: var(--paper-dialog-button-color, var(--primary-color));\n\n        @apply --layout-horizontal;\n        @apply --layout-end-justified;\n      }\n    </style>\n  </template>\n</dom-module>`;\n\ndocument.head.appendChild($_documentContainer.content);\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/paper-dialog-behavior/paper-dialog-shared-styles.js';\n\nimport {NeonAnimationRunnerBehavior} from '@polymer/neon-animation/neon-animation-runner-behavior.js';\nimport {PaperDialogBehavior} from '@polymer/paper-dialog-behavior/paper-dialog-behavior.js';\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\n\n/**\nMaterial design:\n[Dialogs](https://www.google.com/design/spec/components/dialogs.html)\n\n`<paper-dialog>` is a dialog with Material Design styling and optional\nanimations when it is opened or closed. It provides styles for a header, content\narea, and an action area for buttons. You can use the\n`<paper-dialog-scrollable>` element (in its own repository) if you need a\nscrolling content area. To autofocus a specific child element after opening the\ndialog, give it the `autofocus` attribute. See `Polymer.PaperDialogBehavior` and\n`Polymer.IronOverlayBehavior` for specifics.\n\nFor example, the following code implements a dialog with a header, scrolling\ncontent area and buttons. Focus will be given to the `dialog-confirm` button\nwhen the dialog is opened.\n\n    <paper-dialog>\n      <h2>Header</h2>\n      <paper-dialog-scrollable>\n        Lorem ipsum...\n      </paper-dialog-scrollable>\n      <div class=\"buttons\">\n        <paper-button dialog-dismiss>Cancel</paper-button>\n        <paper-button dialog-confirm autofocus>Accept</paper-button>\n      </div>\n    </paper-dialog>\n\n### Styling\n\nSee the docs for `Polymer.PaperDialogBehavior` for the custom properties\navailable for styling this element.\n\n### Animations\n\nSet the `entry-animation` and/or `exit-animation` attributes to add an animation\nwhen the dialog is opened or closed. See the documentation in\n[PolymerElements/neon-animation](https://github.com/PolymerElements/neon-animation)\nfor more info.\n\nFor example:\n\n    <script type=\"module\">\n      import '@polymer/neon-animation/animations/fade-out-animation.js';\n      import '@polymer/neon-animation/animations/scale-up-animation.js';\n    </script>\n\n    <paper-dialog entry-animation=\"scale-up-animation\"\n                  exit-animation=\"fade-out-animation\">\n      <h2>Header</h2>\n      <div>Dialog body</div>\n    </paper-dialog>\n\n### Accessibility\n\nSee the docs for `Polymer.PaperDialogBehavior` for accessibility features\nimplemented by this element.\n\n@group Paper Elements\n@element paper-dialog\n@hero hero.svg\n@demo demo/index.html\n*/\nPolymer({\n  _template: html`\n    <style include=\"paper-dialog-shared-styles\"></style>\n    <slot></slot>\n`,\n\n  is: 'paper-dialog',\n  behaviors: [PaperDialogBehavior, NeonAnimationRunnerBehavior],\n  listeners: {'neon-animation-finish': '_onNeonAnimationFinish'},\n\n  _renderOpened: function() {\n    this.cancelAnimation();\n    this.playAnimation('entry');\n  },\n\n  _renderClosed: function() {\n    this.cancelAnimation();\n    this.playAnimation('exit');\n  },\n\n  _onNeonAnimationFinish: function() {\n    if (this.opened) {\n      this._finishRenderOpened();\n    } else {\n      this._finishRenderClosed();\n    }\n  }\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n/*\n  Fixes issue with not using shadow dom properly in iron-overlay-behavior/icon-focusables-helper.js\n*/\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\n\nimport { IronFocusablesHelper } from \"@polymer/iron-overlay-behavior/iron-focusables-helper.js\";\n\nexport const HaIronFocusablesHelper = {\n  /**\n   * Returns a sorted array of tabbable nodes, including the root node.\n   * It searches the tabbable nodes in the light and shadow dom of the chidren,\n   * sorting the result by tabindex.\n   * @param {!Node} node\n   * @return {!Array<!HTMLElement>}\n   */\n  getTabbableNodes: function(node) {\n    var result = [];\n    // If there is at least one element with tabindex > 0, we need to sort\n    // the final array by tabindex.\n    var needsSortByTabIndex = this._collectTabbableNodes(node, result);\n    if (needsSortByTabIndex) {\n      return IronFocusablesHelper._sortByTabIndex(result);\n    }\n    return result;\n  },\n\n  /**\n   * Searches for nodes that are tabbable and adds them to the `result` array.\n   * Returns if the `result` array needs to be sorted by tabindex.\n   * @param {!Node} node The starting point for the search; added to `result`\n   * if tabbable.\n   * @param {!Array<!HTMLElement>} result\n   * @return {boolean}\n   * @private\n   */\n  _collectTabbableNodes: function(node, result) {\n    // If not an element or not visible, no need to explore children.\n    if (\n      node.nodeType !== Node.ELEMENT_NODE ||\n      !IronFocusablesHelper._isVisible(node)\n    ) {\n      return false;\n    }\n    var element = /** @type {!HTMLElement} */ (node);\n    var tabIndex = IronFocusablesHelper._normalizedTabIndex(element);\n    var needsSort = tabIndex > 0;\n    if (tabIndex >= 0) {\n      result.push(element);\n    }\n\n    // In ShadowDOM v1, tab order is affected by the order of distrubution.\n    // E.g. getTabbableNodes(#root) in ShadowDOM v1 should return [#A, #B];\n    // in ShadowDOM v0 tab order is not affected by the distrubution order,\n    // in fact getTabbableNodes(#root) returns [#B, #A].\n    //  <div id=\"root\">\n    //   <!-- shadow -->\n    //     <slot name=\"a\">\n    //     <slot name=\"b\">\n    //   <!-- /shadow -->\n    //   <input id=\"A\" slot=\"a\">\n    //   <input id=\"B\" slot=\"b\" tabindex=\"1\">\n    //  </div>\n    // TODO(valdrin) support ShadowDOM v1 when upgrading to Polymer v2.0.\n    var children;\n    if (element.localName === \"content\" || element.localName === \"slot\") {\n      children = dom(element).getDistributedNodes();\n    } else {\n      // /////////////////////////\n      // Use shadow root if possible, will check for distributed nodes.\n      // THIS IS THE CHANGED LINE\n      children = dom(element.shadowRoot || element.root || element).children;\n      // /////////////////////////\n    }\n    for (var i = 0; i < children.length; i++) {\n      // Ensure method is always invoked to collect tabbable children.\n      needsSort = this._collectTabbableNodes(children[i], result) || needsSort;\n    }\n    return needsSort;\n  },\n};\n","import \"@polymer/paper-dialog/paper-dialog\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\nimport { HaIronFocusablesHelper } from \"./ha-iron-focusables-helper.js\";\n// tslint:disable-next-line\nimport { PaperDialogElement } from \"@polymer/paper-dialog/paper-dialog\";\n\nconst paperDialogClass = customElements.get(\"paper-dialog\");\n\n// behavior that will override existing iron-overlay-behavior and call the fixed implementation\nconst haTabFixBehaviorImpl = {\n  get _focusableNodes() {\n    return HaIronFocusablesHelper.getTabbableNodes(this);\n  },\n};\n\n// paper-dialog that uses the haTabFixBehaviorImpl behvaior\n// export class HaPaperDialog extends paperDialogClass {}\n// @ts-ignore\nexport class HaPaperDialog\n  extends mixinBehaviors([haTabFixBehaviorImpl], paperDialogClass)\n  implements PaperDialogElement {}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-paper-dialog\": HaPaperDialog;\n  }\n}\ncustomElements.define(\"ha-paper-dialog\", HaPaperDialog);\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/iron-flex-layout/iron-flex-layout.js';\nimport '@polymer/paper-styles/default-theme.js';\n\nimport {PaperDialogBehaviorImpl} from '@polymer/paper-dialog-behavior/paper-dialog-behavior.js';\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\n\n/**\nMaterial design:\n[Dialogs](https://www.google.com/design/spec/components/dialogs.html)\n\n`paper-dialog-scrollable` implements a scrolling area used in a Material Design\ndialog. It shows a divider at the top and/or bottom indicating more content,\ndepending on scroll position. Use this together with elements implementing\n`Polymer.PaperDialogBehavior`.\n\n    <paper-dialog-impl>\n      <h2>Header</h2>\n      <paper-dialog-scrollable>\n        Lorem ipsum...\n      </paper-dialog-scrollable>\n      <div class=\"buttons\">\n        <paper-button>OK</paper-button>\n      </div>\n    </paper-dialog-impl>\n\nIt shows a top divider after scrolling if it is not the first child in its\nparent container, indicating there is more content above. It shows a bottom\ndivider if it is scrollable and it is not the last child in its parent\ncontainer, indicating there is more content below. The bottom divider is hidden\nif it is scrolled to the bottom.\n\nIf `paper-dialog-scrollable` is not a direct child of the element implementing\n`Polymer.PaperDialogBehavior`, remember to set the `dialogElement`:\n\n    <paper-dialog-impl id=\"myDialog\">\n      <h2>Header</h2>\n      <div class=\"my-content-wrapper\">\n        <h4>Sub-header</h4>\n        <paper-dialog-scrollable>\n          Lorem ipsum...\n        </paper-dialog-scrollable>\n      </div>\n      <div class=\"buttons\">\n        <paper-button>OK</paper-button>\n      </div>\n    </paper-dialog-impl>\n\n    <script>\n      var scrollable =\nPolymer.dom(myDialog).querySelector('paper-dialog-scrollable');\n      scrollable.dialogElement = myDialog;\n    </script>\n\n### Styling\nThe following custom properties and mixins are available for styling:\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-dialog-scrollable` | Mixin for the scrollable content | {}\n\n@group Paper Elements\n@element paper-dialog-scrollable\n@demo demo/index.html\n@hero hero.svg\n*/\nPolymer({\n  _template: html`\n    <style>\n\n      :host {\n        display: block;\n        @apply --layout-relative;\n      }\n\n      :host(.is-scrolled:not(:first-child))::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 1px;\n        background: var(--divider-color);\n      }\n\n      :host(.can-scroll:not(.scrolled-to-bottom):not(:last-child))::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 1px;\n        background: var(--divider-color);\n      }\n\n      .scrollable {\n        padding: 0 24px;\n\n        @apply --layout-scroll;\n        @apply --paper-dialog-scrollable;\n      }\n\n      .fit {\n        @apply --layout-fit;\n      }\n    </style>\n\n    <div id=\"scrollable\" class=\"scrollable\" on-scroll=\"updateScrollState\">\n      <slot></slot>\n    </div>\n`,\n\n  is: 'paper-dialog-scrollable',\n\n  properties: {\n\n    /**\n     * The dialog element that implements `Polymer.PaperDialogBehavior`\n     * containing this element.\n     * @type {?Node}\n     */\n    dialogElement: {type: Object}\n\n  },\n\n  /**\n   * Returns the scrolling element.\n   */\n  get scrollTarget() {\n    return this.$.scrollable;\n  },\n\n  ready: function() {\n    this._ensureTarget();\n    this.classList.add('no-padding');\n  },\n\n  attached: function() {\n    this._ensureTarget();\n    requestAnimationFrame(this.updateScrollState.bind(this));\n  },\n\n  updateScrollState: function() {\n    this.toggleClass('is-scrolled', this.scrollTarget.scrollTop > 0);\n    this.toggleClass(\n        'can-scroll',\n        this.scrollTarget.offsetHeight < this.scrollTarget.scrollHeight);\n    this.toggleClass(\n        'scrolled-to-bottom',\n        this.scrollTarget.scrollTop + this.scrollTarget.offsetHeight >=\n            this.scrollTarget.scrollHeight);\n  },\n\n  _ensureTarget: function() {\n    // Read parentElement instead of parentNode in order to skip shadowRoots.\n    this.dialogElement = this.dialogElement || this.parentElement;\n    // Check if dialog implements paper-dialog-behavior. If not, fit\n    // scrollTarget to host.\n    if (this.dialogElement && this.dialogElement.behaviors &&\n        this.dialogElement.behaviors.indexOf(PaperDialogBehaviorImpl) >= 0) {\n      this.dialogElement.sizingTarget = this.scrollTarget;\n      this.scrollTarget.classList.remove('fit');\n    } else if (this.dialogElement) {\n      this.scrollTarget.classList.add('fit');\n    }\n  }\n});\n","/**\n@license\nCopyright (c) 2018 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {PaperRippleBehavior} from '@polymer/paper-behaviors/paper-ripple-behavior.js';\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\nimport {afterNextRender} from '@polymer/polymer/lib/utils/render-status.js';\n\n/**\nThis is a lighter version of `paper-icon-button`. Its goal is performance, not\ndeveloper ergonomics, so as a result it has fewer features than\n`paper-icon-button` itself. To use it, you must distribute a `button` containing\nthe `iron-icon` you want to use:\n\n<script type=\"module\">\n  import '@polymer/iron-icon/iron-icon.js';\n  import '@polymer/paper-icon-button/paper-icon-button-light.js';\n  import '@polymer/iron-icons/iron-icons.js';\n</script>\n\n<paper-icon-button-light>\n  <button title=\"heart\">\n    <iron-icon icon=\"favorite\"></iron-icon>\n  </button>\n</paper-icon-button-light>\n\nNote that this button is assumed to be distributed at the startup of\n`paper-icon-button-light`. Dynamically adding a `button` to this element is\nnot supported.\n\nThe `title`/`disabled` etc. attributes go on the distributed button, not on the\nwrapper.\n\nThe following custom properties and mixins are also available for styling:\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-icon-button-light-ripple` | Mixin applied to the paper ripple | `{}`\n\n@group Paper Elements\n@element paper-icon-button-light\n@demo demo/paper-icon-button-light.html\n*/\nPolymer({\n  is: 'paper-icon-button-light',\n\n  _template: html`\n    <style>\n      :host {\n        display: inline-block;\n        position: relative;\n        width: 24px;\n        height: 24px;\n      }\n\n      paper-ripple {\n        opacity: 0.6;\n        color: currentColor;\n        @apply --paper-icon-button-light-ripple;\n      }\n\n      :host > ::slotted(button) {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        margin: 0;\n        padding: 0;\n        background: none;\n        border: none;\n        outline: none;\n        vertical-align: middle;\n        color: inherit;\n        cursor: pointer;\n        /* NOTE: Both values are needed, since some phones require the value to be \\`transparent\\`. */\n        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n        -webkit-tap-highlight-color: transparent;\n      }\n      :host > ::slotted(button[disabled]) {\n        color: #9b9b9b;\n        pointer-events: none;\n        cursor: auto;\n      }\n    </style>\n    <slot></slot>\n  `,\n\n  behaviors: [PaperRippleBehavior],\n\n  registered: function() {\n    this._template.setAttribute('strip-whitespace', '');\n  },\n\n  ready: function() {\n    afterNextRender(this, () => {\n      // Add lazy host listeners\n      this.addEventListener('down', this._rippleDown.bind(this));\n      this.addEventListener('up', this._rippleUp.bind(this));\n\n      // Assume the button has already been distributed.\n      var button = this.getEffectiveChildren()[0];\n      this._rippleContainer = button;\n\n      // We need to set the focus/blur listeners on the distributed button,\n      // not the host, since the host isn't focusable.\n      button.addEventListener('focus', this._rippleDown.bind(this));\n      button.addEventListener('blur', this._rippleUp.bind(this));\n    });\n  },\n  _rippleDown: function() {\n    this.getRipple().uiDownAction();\n  },\n  _rippleUp: function() {\n    this.getRipple().uiUpAction();\n  },\n  /**\n   * @param {...*} var_args\n   */\n  ensureRipple: function(var_args) {\n    var lastRipple = this._ripple;\n    PaperRippleBehavior.ensureRipple.apply(this, arguments);\n    if (this._ripple && this._ripple !== lastRipple) {\n      this._ripple.center = true;\n      this._ripple.classList.add('circle');\n    }\n  }\n});\n","import {\n  LitElement,\n  TemplateResult,\n  property,\n  html,\n  customElement,\n} from \"lit-element\";\nimport \"@polymer/paper-icon-button/paper-icon-button-light\";\n\nimport { HomeAssistant } from \"../../types\";\nimport { PolymerChangedEvent } from \"../../polymer-types\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\n\nimport \"./ha-device-picker\";\n\n@customElement(\"ha-devices-picker\")\nclass HaDevicesPicker extends LitElement {\n  @property() public hass?: HomeAssistant;\n  @property() public value?: string[];\n  /**\n   * Show entities from specific domains.\n   * @type {string}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n  /**\n   * Show no entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n  @property({ attribute: \"picked-device-label\" })\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n  public pickedDeviceLabel?: string;\n  @property({ attribute: \"pick-device-label\" }) public pickDeviceLabel?: string;\n\n  protected render(): TemplateResult | void {\n    if (!this.hass) {\n      return;\n    }\n\n    const currentDevices = this._currentDevices;\n    return html`\n      ${currentDevices.map(\n        (entityId) => html`\n          <div>\n            <ha-device-picker\n              allow-custom-entity\n              .curValue=${entityId}\n              .hass=${this.hass}\n              .includeDomains=${this.includeDomains}\n              .excludeDomains=${this.excludeDomains}\n              .includeDeviceClasses=${this.includeDeviceClasses}\n              .value=${entityId}\n              .label=${this.pickedDeviceLabel}\n              @value-changed=${this._deviceChanged}\n            ></ha-device-picker>\n          </div>\n        `\n      )}\n      <div>\n        <ha-device-picker\n          .hass=${this.hass}\n          .includeDomains=${this.includeDomains}\n          .excludeDomains=${this.excludeDomains}\n          .includeDeviceClasses=${this.includeDeviceClasses}\n          .label=${this.pickDeviceLabel}\n          @value-changed=${this._addDevice}\n        ></ha-device-picker>\n      </div>\n    `;\n  }\n\n  private get _currentDevices() {\n    return this.value || [];\n  }\n\n  private async _updateDevices(devices) {\n    fireEvent(this, \"value-changed\", {\n      value: devices,\n    });\n\n    this.value = devices;\n  }\n\n  private _deviceChanged(event: PolymerChangedEvent<string>) {\n    event.stopPropagation();\n    const curValue = (event.currentTarget as any).curValue;\n    const newValue = event.detail.value;\n    if (newValue === curValue || newValue !== \"\") {\n      return;\n    }\n    if (newValue === \"\") {\n      this._updateDevices(\n        this._currentDevices.filter((dev) => dev !== curValue)\n      );\n    } else {\n      this._updateDevices(\n        this._currentDevices.map((dev) => (dev === curValue ? newValue : dev))\n      );\n    }\n  }\n\n  private async _addDevice(event: PolymerChangedEvent<string>) {\n    event.stopPropagation();\n    const toAdd = event.detail.value;\n    (event.currentTarget as any).value = \"\";\n    if (!toAdd) {\n      return;\n    }\n    const currentDevices = this._currentDevices;\n    if (currentDevices.includes(toAdd)) {\n      return;\n    }\n\n    this._updateDevices([...currentDevices, toAdd]);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-devices-picker\": HaDevicesPicker;\n  }\n}\n","import \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-item/paper-item-body\";\nimport \"@vaadin/vaadin-combo-box/theme/material/vaadin-combo-box-light\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport memoizeOne from \"memoize-one\";\nimport {\n  LitElement,\n  TemplateResult,\n  html,\n  css,\n  CSSResult,\n  customElement,\n  property,\n  PropertyValues,\n} from \"lit-element\";\nimport { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { SubscribeMixin } from \"../../mixins/subscribe-mixin\";\nimport \"./ha-devices-picker\";\n\nimport { HomeAssistant } from \"../../types\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport {\n  DeviceRegistryEntry,\n  subscribeDeviceRegistry,\n} from \"../../data/device_registry\";\nimport { compare } from \"../../common/string/compare\";\nimport { PolymerChangedEvent } from \"../../polymer-types\";\nimport {\n  AreaRegistryEntry,\n  subscribeAreaRegistry,\n} from \"../../data/area_registry\";\nimport { DeviceEntityLookup } from \"../../panels/config/devices/ha-devices-data-table\";\nimport {\n  EntityRegistryEntry,\n  subscribeEntityRegistry,\n} from \"../../data/entity_registry\";\nimport { computeDomain } from \"../../common/entity/compute_domain\";\n\ninterface DevicesByArea {\n  [areaId: string]: AreaDevices;\n}\n\ninterface AreaDevices {\n  id?: string;\n  name: string;\n  devices: string[];\n}\n\nconst rowRenderer = (\n  root: HTMLElement,\n  _owner,\n  model: { item: AreaDevices }\n) => {\n  if (!root.firstElementChild) {\n    root.innerHTML = `\n    <style>\n      paper-item {\n        width: 100%;\n        margin: -10px 0;\n        padding: 0;\n      }\n      paper-icon-button {\n        float: right;\n      }\n      .devices {\n        display: none;\n      }\n      .devices.visible {\n        display: block;\n      }\n    </style>\n    <paper-item>\n      <paper-item-body two-line=\"\">\n        <div class='name'>[[item.name]]</div>\n        <div secondary>[[item.devices.length]] devices</div>\n      </paper-item-body>\n    </paper-item>\n    `;\n  }\n  root.querySelector(\".name\")!.textContent = model.item.name!;\n  root.querySelector(\n    \"[secondary]\"\n  )!.textContent = `${model.item.devices.length.toString()} devices`;\n};\n\n@customElement(\"ha-area-devices-picker\")\nexport class HaAreaDevicesPicker extends SubscribeMixin(LitElement) {\n  @property() public hass!: HomeAssistant;\n  @property() public label?: string;\n  @property() public value?: string;\n  @property() public area?: string;\n  @property() public devices?: string[];\n  /**\n   * Show only devices with entities from specific domains.\n   * @type {Array}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n  /**\n   * Show no devices with entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n  /**\n   * Show only deviced with entities of these device classes.\n   * @type {Array}\n   * @attr include-device-classes\n   */\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n  @property({ type: Boolean })\n  private _opened?: boolean;\n  @property() private _areaPicker = true;\n  @property() private _devices?: DeviceRegistryEntry[];\n  @property() private _areas?: AreaRegistryEntry[];\n  @property() private _entities?: EntityRegistryEntry[];\n  private _selectedDevices: string[] = [];\n  private _filteredDevices: DeviceRegistryEntry[] = [];\n\n  private _getDevices = memoizeOne(\n    (\n      devices: DeviceRegistryEntry[],\n      areas: AreaRegistryEntry[],\n      entities: EntityRegistryEntry[],\n      includeDomains: this[\"includeDomains\"],\n      excludeDomains: this[\"excludeDomains\"],\n      includeDeviceClasses: this[\"includeDeviceClasses\"]\n    ): AreaDevices[] => {\n      if (!devices.length) {\n        return [];\n      }\n\n      const deviceEntityLookup: DeviceEntityLookup = {};\n      for (const entity of entities) {\n        if (!entity.device_id) {\n          continue;\n        }\n        if (!(entity.device_id in deviceEntityLookup)) {\n          deviceEntityLookup[entity.device_id] = [];\n        }\n        deviceEntityLookup[entity.device_id].push(entity);\n      }\n\n      let inputDevices = [...devices];\n\n      if (includeDomains) {\n        inputDevices = inputDevices.filter((device) => {\n          const devEntities = deviceEntityLookup[device.id];\n          if (!devEntities || !devEntities.length) {\n            return false;\n          }\n          return deviceEntityLookup[device.id].some((entity) =>\n            includeDomains.includes(computeDomain(entity.entity_id))\n          );\n        });\n      }\n\n      if (excludeDomains) {\n        inputDevices = inputDevices.filter((device) => {\n          const devEntities = deviceEntityLookup[device.id];\n          if (!devEntities || !devEntities.length) {\n            return true;\n          }\n          return entities.every(\n            (entity) =>\n              !excludeDomains.includes(computeDomain(entity.entity_id))\n          );\n        });\n      }\n\n      if (includeDeviceClasses) {\n        inputDevices = inputDevices.filter((device) => {\n          const devEntities = deviceEntityLookup[device.id];\n          if (!devEntities || !devEntities.length) {\n            return false;\n          }\n          return deviceEntityLookup[device.id].some((entity) => {\n            const stateObj = this.hass.states[entity.entity_id];\n            if (!stateObj) {\n              return false;\n            }\n            return (\n              stateObj.attributes.device_class &&\n              includeDeviceClasses.includes(stateObj.attributes.device_class)\n            );\n          });\n        });\n      }\n\n      this._filteredDevices = inputDevices;\n\n      const areaLookup: { [areaId: string]: AreaRegistryEntry } = {};\n      for (const area of areas) {\n        areaLookup[area.area_id] = area;\n      }\n\n      const devicesByArea: DevicesByArea = {};\n\n      for (const device of inputDevices) {\n        const areaId = device.area_id;\n        if (areaId) {\n          if (!(areaId in devicesByArea)) {\n            devicesByArea[areaId] = {\n              id: areaId,\n              name: areaLookup[areaId].name,\n              devices: [],\n            };\n          }\n          devicesByArea[areaId].devices.push(device.id);\n        }\n      }\n\n      const sorted = Object.keys(devicesByArea)\n        .sort((a, b) =>\n          compare(devicesByArea[a].name || \"\", devicesByArea[b].name || \"\")\n        )\n        .map((key) => devicesByArea[key]);\n\n      return sorted;\n    }\n  );\n\n  public hassSubscribe(): UnsubscribeFunc[] {\n    return [\n      subscribeDeviceRegistry(this.hass.connection!, (devices) => {\n        this._devices = devices;\n      }),\n      subscribeAreaRegistry(this.hass.connection!, (areas) => {\n        this._areas = areas;\n      }),\n      subscribeEntityRegistry(this.hass.connection!, (entities) => {\n        this._entities = entities;\n      }),\n    ];\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (changedProps.has(\"area\") && this.area) {\n      this._areaPicker = true;\n      this.value = this.area;\n    } else if (changedProps.has(\"devices\") && this.devices) {\n      this._areaPicker = false;\n      const filteredDeviceIds = this._filteredDevices.map(\n        (device) => device.id\n      );\n      const selectedDevices = this.devices.filter((device) =>\n        filteredDeviceIds.includes(device)\n      );\n      this._setValue(selectedDevices);\n    }\n  }\n\n  protected render(): TemplateResult | void {\n    if (!this._devices || !this._areas || !this._entities) {\n      return;\n    }\n    const areas = this._getDevices(\n      this._devices,\n      this._areas,\n      this._entities,\n      this.includeDomains,\n      this.excludeDomains,\n      this.includeDeviceClasses\n    );\n    if (!this._areaPicker || areas.length === 0) {\n      return html`\n        <ha-devices-picker\n          @value-changed=${this._devicesPicked}\n          .hass=${this.hass}\n          .includeDomains=${this.includeDomains}\n          .includeDeviceClasses=${this.includeDeviceClasses}\n          .value=${this._selectedDevices}\n          .pickDeviceLabel=${`Add ${this.label} device`}\n          .pickedDeviceLabel=${`${this.label} device`}\n        ></ha-devices-picker>\n        ${areas.length > 0\n          ? html`\n              <mwc-button @click=${this._switchPicker}\n                >Choose an area</mwc-button\n              >\n            `\n          : \"\"}\n      `;\n    }\n    return html`\n      <vaadin-combo-box-light\n        item-value-path=\"id\"\n        item-id-path=\"id\"\n        item-label-path=\"name\"\n        .items=${areas}\n        .value=${this._value}\n        .renderer=${rowRenderer}\n        @opened-changed=${this._openedChanged}\n        @value-changed=${this._areaPicked}\n      >\n        <paper-input\n          .label=${this.label === undefined && this.hass\n            ? this.hass.localize(\"ui.components.device-picker.device\")\n            : `${this.label} in area`}\n          class=\"input\"\n          autocapitalize=\"none\"\n          autocomplete=\"off\"\n          autocorrect=\"off\"\n          spellcheck=\"false\"\n        >\n          ${this.value\n            ? html`\n                <paper-icon-button\n                  aria-label=${this.hass.localize(\n                    \"ui.components.device-picker.clear\"\n                  )}\n                  slot=\"suffix\"\n                  class=\"clear-button\"\n                  icon=\"hass:close\"\n                  @click=${this._clearValue}\n                  no-ripple\n                >\n                  Clear\n                </paper-icon-button>\n              `\n            : \"\"}\n          ${areas.length > 0\n            ? html`\n                <paper-icon-button\n                  aria-label=${this.hass.localize(\n                    \"ui.components.device-picker.show_devices\"\n                  )}\n                  slot=\"suffix\"\n                  class=\"toggle-button\"\n                  .icon=${this._opened ? \"hass:menu-up\" : \"hass:menu-down\"}\n                >\n                  Toggle\n                </paper-icon-button>\n              `\n            : \"\"}\n        </paper-input>\n      </vaadin-combo-box-light>\n      <mwc-button @click=${this._switchPicker}\n        >Choose individual devices</mwc-button\n      >\n    `;\n  }\n\n  private _clearValue(ev: Event) {\n    ev.stopPropagation();\n    this._setValue([]);\n  }\n\n  private get _value() {\n    return this.value || [];\n  }\n\n  private _openedChanged(ev: PolymerChangedEvent<boolean>) {\n    this._opened = ev.detail.value;\n  }\n\n  private async _switchPicker() {\n    this._areaPicker = !this._areaPicker;\n  }\n\n  private async _areaPicked(ev: PolymerChangedEvent<string>) {\n    const value = ev.detail.value;\n    let selectedDevices = [];\n    const target = ev.target as any;\n    if (target.selectedItem) {\n      selectedDevices = target.selectedItem.devices;\n    }\n\n    if (value !== this._value || this._selectedDevices !== selectedDevices) {\n      this._setValue(selectedDevices, value);\n    }\n  }\n\n  private _devicesPicked(ev: CustomEvent) {\n    ev.stopPropagation();\n    const selectedDevices = ev.detail.value;\n    this._setValue(selectedDevices);\n  }\n\n  private _setValue(selectedDevices: string[], value = \"\") {\n    this.value = value;\n    this._selectedDevices = selectedDevices;\n    setTimeout(() => {\n      fireEvent(this, \"value-changed\", { value: selectedDevices });\n      fireEvent(this, \"change\");\n    }, 0);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      paper-input > paper-icon-button {\n        width: 24px;\n        height: 24px;\n        padding: 2px;\n        color: var(--secondary-text-color);\n      }\n      [hidden] {\n        display: none;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-area-devices-picker\": HaAreaDevicesPicker;\n  }\n}\n","export const applyPatch = (data, path, value) => {\n  if (path.length === 1) {\n    data[path[0]] = value;\n  } else {\n    if (!data[path[0]]) {\n      data[path[0]] = {};\n    }\n    return applyPatch(data[path[0]], path.slice(1), value);\n  }\n};\n\nexport const getPath = (data, path) => {\n  if (path.length === 1) {\n    return data[path[0]];\n  } else {\n    if (data[path[0]] === undefined) {\n      return undefined;\n    }\n    return getPath(data[path[0]], path.slice(1));\n  }\n};\n","import {\n  LitElement,\n  html,\n  TemplateResult,\n  property,\n  customElement,\n  css,\n  CSSResult,\n  PropertyValues,\n} from \"lit-element\";\n\nimport \"../../../../components/device/ha-area-devices-picker\";\n\nimport { HomeAssistant } from \"../../../../types\";\nimport { PolymerChangedEvent } from \"../../../../polymer-types\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport { haStyleDialog } from \"../../../../resources/styles\";\nimport { PlaceholderContainer, Placeholder } from \"./dialog-thingtalk\";\nimport { SubscribeMixin } from \"../../../../mixins/subscribe-mixin\";\nimport { subscribeEntityRegistry } from \"../../../../data/entity_registry\";\nimport { computeDomain } from \"../../../../common/entity/compute_domain\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { getPath, applyPatch } from \"../../../../common/util/patch\";\nimport {\n  subscribeAreaRegistry,\n  AreaRegistryEntry,\n} from \"../../../../data/area_registry\";\nimport {\n  subscribeDeviceRegistry,\n  DeviceRegistryEntry,\n} from \"../../../../data/device_registry\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"placeholders-filled\": { value: PlaceholderValues };\n  }\n}\n\nexport interface PlaceholderValues {\n  [key: string]: {\n    [index: number]: {\n      [index: number]: { device_id?: string; entity_id?: string };\n    };\n  };\n}\n\nexport interface ExtraInfo {\n  [key: string]: {\n    [index: number]: {\n      [index: number]: {\n        area_id?: string;\n        device_ids?: string[];\n        manualEntity: boolean;\n      };\n    };\n  };\n}\n\ninterface DeviceEntitiesLookup {\n  [deviceId: string]: string[];\n}\n\n@customElement(\"ha-thingtalk-placeholders\")\nexport class ThingTalkPlaceholders extends SubscribeMixin(LitElement) {\n  @property() public hass!: HomeAssistant;\n  @property() public opened!: boolean;\n  public skip!: () => void;\n  @property() public placeholders!: PlaceholderContainer;\n  @property() private _error?: string;\n  private _deviceEntityLookup: DeviceEntitiesLookup = {};\n  @property() private _extraInfo: ExtraInfo = {};\n  @property() private _placeholderValues: PlaceholderValues = {};\n  private _devices?: DeviceRegistryEntry[];\n  private _areas?: AreaRegistryEntry[];\n  private _search = false;\n\n  public hassSubscribe() {\n    return [\n      subscribeEntityRegistry(this.hass.connection, (entries) => {\n        for (const entity of entries) {\n          if (!entity.device_id) {\n            continue;\n          }\n          if (!(entity.device_id in this._deviceEntityLookup)) {\n            this._deviceEntityLookup[entity.device_id] = [];\n          }\n          if (\n            !this._deviceEntityLookup[entity.device_id].includes(\n              entity.entity_id\n            )\n          ) {\n            this._deviceEntityLookup[entity.device_id].push(entity.entity_id);\n          }\n        }\n      }),\n      subscribeDeviceRegistry(this.hass.connection!, (devices) => {\n        this._devices = devices;\n        this._searchNames();\n      }),\n      subscribeAreaRegistry(this.hass.connection!, (areas) => {\n        this._areas = areas;\n        this._searchNames();\n      }),\n    ];\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (changedProps.has(\"placeholders\")) {\n      this._search = true;\n      this._searchNames();\n    }\n  }\n\n  protected render(): TemplateResult | void {\n    return html`\n      <ha-paper-dialog\n        modal\n        with-backdrop\n        .opened=${this.opened}\n        @opened-changed=\"${this._openedChanged}\"\n      >\n        <h2>Great! Now we need to link some devices.</h2>\n        <paper-dialog-scrollable>\n          ${this._error\n            ? html`\n                <div class=\"error\">${this._error}</div>\n              `\n            : \"\"}\n          ${Object.entries(this.placeholders).map(\n            ([type, placeholders]) =>\n              html`\n                <h3>\n                  ${this.hass.localize(\n                    `ui.panel.config.automation.editor.${type}s.name`\n                  )}:\n                </h3>\n                ${placeholders.map((placeholder) => {\n                  if (placeholder.fields.includes(\"device_id\")) {\n                    const extraInfo = getPath(this._extraInfo, [\n                      type,\n                      placeholder.index,\n                    ]);\n                    return html`\n                      <ha-area-devices-picker\n                        .type=${type}\n                        .placeholder=${placeholder}\n                        @value-changed=${this._devicePicked}\n                        .hass=${this.hass}\n                        .area=${extraInfo ? extraInfo.area_id : undefined}\n                        .devices=${extraInfo && extraInfo.device_ids\n                          ? extraInfo.device_ids\n                          : undefined}\n                        .includeDomains=${placeholder.domains}\n                        .includeDeviceClasses=${placeholder.device_classes}\n                        .label=${this._getLabel(\n                          placeholder.domains,\n                          placeholder.device_classes\n                        )}\n                      ></ha-area-devices-picker>\n                      ${extraInfo && extraInfo.manualEntity\n                        ? html`\n                            <h3>\n                              One or more devices have more than one matching\n                              entity, please pick the one you want to use.\n                            </h3>\n                            ${Object.keys(extraInfo.manualEntity).map(\n                              (idx) => html`\n                                <ha-entity-picker\n                                  id=\"device-entity-picker\"\n                                  .type=${type}\n                                  .placeholder=${placeholder}\n                                  .index=${idx}\n                                  @change=${this._entityPicked}\n                                  .includeDomains=${placeholder.domains}\n                                  .includeDeviceClasses=${placeholder.device_classes}\n                                  .hass=${this.hass}\n                                  .label=${`${this._getLabel(\n                                    placeholder.domains,\n                                    placeholder.device_classes\n                                  )} of device ${this._getDeviceName(\n                                    getPath(this._placeholderValues, [\n                                      type,\n                                      placeholder.index,\n                                      idx,\n                                      \"device_id\",\n                                    ])\n                                  )}`}\n                                  .entityFilter=${(state: HassEntity) => {\n                                    const devId = this._placeholderValues[type][\n                                      placeholder.index\n                                    ][idx].device_id;\n                                    return this._deviceEntityLookup[\n                                      devId\n                                    ].includes(state.entity_id);\n                                  }}\n                                ></ha-entity-picker>\n                              `\n                            )}\n                          `\n                        : \"\"}\n                    `;\n                  } else if (placeholder.fields.includes(\"entity_id\")) {\n                    return html`\n                      <ha-entity-picker\n                        .type=${type}\n                        .placeholder=${placeholder}\n                        @change=${this._entityPicked}\n                        .includeDomains=${placeholder.domains}\n                        .includeDeviceClasses=${placeholder.device_classes}\n                        .hass=${this.hass}\n                        .label=${this._getLabel(\n                          placeholder.domains,\n                          placeholder.device_classes\n                        )}\n                      ></ha-entity-picker>\n                    `;\n                  }\n                  return html`\n                    <div class=\"error\">\n                      Unknown placeholder<br />\n                      ${placeholder.domains}<br />\n                      ${placeholder.fields.map(\n                        (field) =>\n                          html`\n                            ${field}<br />\n                          `\n                      )}\n                    </div>\n                  `;\n                })}\n              `\n          )}\n        </paper-dialog-scrollable>\n        <div class=\"paper-dialog-buttons\">\n          <mwc-button class=\"left\" @click=\"${this.skip}\">\n            Skip\n          </mwc-button>\n          <mwc-button @click=\"${this._done}\" .disabled=${!this._isDone}>\n            Create automation\n          </mwc-button>\n        </div>\n      </ha-paper-dialog>\n    `;\n  }\n\n  private _getDeviceName(deviceId: string): string {\n    if (!this._devices) {\n      return \"\";\n    }\n    const foundDevice = this._devices.find((device) => device.id === deviceId);\n    if (!foundDevice) {\n      return \"\";\n    }\n    return foundDevice.name_by_user || foundDevice.name || \"\";\n  }\n\n  private _searchNames() {\n    if (!this._search || !this._areas || !this._devices) {\n      return;\n    }\n    this._search = false;\n    Object.entries(this.placeholders).forEach(([type, placeholders]) =>\n      placeholders.forEach((placeholder) => {\n        if (!placeholder.name) {\n          return;\n        }\n        const name = placeholder.name;\n        const foundArea = this._areas!.find((area) =>\n          area.name.toLowerCase().includes(name)\n        );\n        if (foundArea) {\n          applyPatch(\n            this._extraInfo,\n            [type, placeholder.index, \"area_id\"],\n            foundArea.area_id\n          );\n          this.requestUpdate(\"_extraInfo\");\n          return;\n        }\n        const foundDevices = this._devices!.filter((device) => {\n          const deviceName = device.name_by_user || device.name;\n          if (!deviceName) {\n            return false;\n          }\n          return deviceName.toLowerCase().includes(name);\n        });\n        if (foundDevices.length) {\n          applyPatch(\n            this._extraInfo,\n            [type, placeholder.index, \"device_ids\"],\n            foundDevices.map((device) => device.id)\n          );\n          this.requestUpdate(\"_extraInfo\");\n        }\n      })\n    );\n  }\n\n  private get _isDone(): boolean {\n    return Object.entries(this.placeholders).every(([type, placeholders]) =>\n      placeholders.every((placeholder) =>\n        placeholder.fields.every((field) => {\n          const entries: {\n            [key: number]: { device_id?: string; entity_id?: string };\n          } = getPath(this._placeholderValues, [type, placeholder.index]);\n          if (!entries) {\n            return false;\n          }\n          const values = Object.values(entries);\n          return values.every(\n            (entry) => entry[field] !== undefined && entry[field] !== \"\"\n          );\n        })\n      )\n    );\n  }\n\n  private _getLabel(domains: string[], deviceClasses?: string[]) {\n    return `${domains\n      .map((domain) => this.hass.localize(`domain.${domain}`))\n      .join(\", \")}${\n      deviceClasses ? ` of type ${deviceClasses.join(\", \")}` : \"\"\n    }`;\n  }\n\n  private _devicePicked(ev: CustomEvent): void {\n    const value: string[] = ev.detail.value;\n    if (!value) {\n      return;\n    }\n    const target = ev.target as any;\n    const placeholder = target.placeholder as Placeholder;\n    const type = target.type;\n\n    let oldValues = getPath(this._placeholderValues, [type, placeholder.index]);\n    if (oldValues) {\n      oldValues = Object.values(oldValues);\n    }\n    const oldExtraInfo = getPath(this._extraInfo, [type, placeholder.index]);\n\n    if (this._placeholderValues[type]) {\n      delete this._placeholderValues[type][placeholder.index];\n    }\n\n    if (this._extraInfo[type]) {\n      delete this._extraInfo[type][placeholder.index];\n    }\n\n    if (!value.length) {\n      this.requestUpdate(\"_placeholderValues\");\n      return;\n    }\n\n    value.forEach((deviceId, index) => {\n      let oldIndex;\n      if (oldValues) {\n        const oldDevice = oldValues.find((oldVal, idx) => {\n          oldIndex = idx;\n          return oldVal.device_id === deviceId;\n        });\n\n        if (oldDevice) {\n          applyPatch(\n            this._placeholderValues,\n            [type, placeholder.index, index],\n            oldDevice\n          );\n          if (oldExtraInfo) {\n            applyPatch(\n              this._extraInfo,\n              [type, placeholder.index, index],\n              oldExtraInfo[oldIndex]\n            );\n          }\n          return;\n        }\n      }\n\n      applyPatch(\n        this._placeholderValues,\n        [type, placeholder.index, index, \"device_id\"],\n        deviceId\n      );\n\n      if (!placeholder.fields.includes(\"entity_id\")) {\n        return;\n      }\n\n      const devEntities = this._deviceEntityLookup[deviceId];\n\n      const entities = devEntities.filter((eid) => {\n        if (placeholder.device_classes) {\n          const stateObj = this.hass.states[eid];\n          if (!stateObj) {\n            return false;\n          }\n          return (\n            placeholder.domains.includes(computeDomain(eid)) &&\n            stateObj.attributes.device_class &&\n            placeholder.device_classes.includes(\n              stateObj.attributes.device_class\n            )\n          );\n        }\n        return placeholder.domains.includes(computeDomain(eid));\n      });\n      if (entities.length === 0) {\n        // Should not happen because we filter the device picker on domain\n        this._error = `No ${placeholder.domains\n          .map((domain) => this.hass.localize(`domain.${domain}`))\n          .join(\", \")} entities found in this device.`;\n      } else if (entities.length === 1) {\n        applyPatch(\n          this._placeholderValues,\n          [type, placeholder.index, index, \"entity_id\"],\n          entities[0]\n        );\n        this.requestUpdate(\"_placeholderValues\");\n      } else {\n        delete this._placeholderValues[type][placeholder.index][index]\n          .entity_id;\n        applyPatch(\n          this._extraInfo,\n          [type, placeholder.index, \"manualEntity\", index],\n          true\n        );\n        this.requestUpdate(\"_placeholderValues\");\n      }\n    });\n\n    fireEvent(\n      this.shadowRoot!.querySelector(\"ha-paper-dialog\")! as HTMLElement,\n      \"iron-resize\"\n    );\n  }\n\n  private _entityPicked(ev: Event): void {\n    const target = ev.target as any;\n    const placeholder = target.placeholder as Placeholder;\n    const value = target.value;\n    const type = target.type;\n    const index = target.index || 0;\n    applyPatch(\n      this._placeholderValues,\n      [type, placeholder.index, index, \"entity_id\"],\n      value\n    );\n    this.requestUpdate(\"_placeholderValues\");\n  }\n\n  private _done(): void {\n    fireEvent(this, \"placeholders-filled\", { value: this._placeholderValues });\n  }\n\n  private _openedChanged(ev: PolymerChangedEvent<boolean>): void {\n    // The opened-changed event doesn't leave the shadowdom so we re-dispatch it\n    this.dispatchEvent(new CustomEvent(ev.type, ev));\n  }\n\n  static get styles(): CSSResult[] {\n    return [\n      haStyleDialog,\n      css`\n        ha-paper-dialog {\n          max-width: 500px;\n        }\n        mwc-button.left {\n          margin-right: auto;\n        }\n        paper-dialog-scrollable {\n          margin-top: 10px;\n        }\n        h3 {\n          margin: 10px 0 0 0;\n          font-weight: 500;\n        }\n        .error {\n          color: var(--google-red-500);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-thingtalk-placeholders\": ThingTalkPlaceholders;\n  }\n}\n","import {\n  LitElement,\n  html,\n  css,\n  CSSResult,\n  TemplateResult,\n  property,\n  customElement,\n  query,\n} from \"lit-element\";\nimport \"@polymer/paper-dialog-scrollable/paper-dialog-scrollable\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-spinner/paper-spinner\";\nimport \"@material/mwc-button\";\n\nimport \"../../../../components/dialog/ha-paper-dialog\";\nimport \"./ha-thingtalk-placeholders\";\nimport { ThingtalkDialogParams } from \"../show-dialog-thingtalk\";\nimport { PolymerChangedEvent } from \"../../../../polymer-types\";\nimport { haStyleDialog, haStyle } from \"../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../types\";\n// tslint:disable-next-line\nimport { PaperInputElement } from \"@polymer/paper-input/paper-input\";\nimport { AutomationConfig } from \"../../../../data/automation\";\n// tslint:disable-next-line\nimport { PlaceholderValues } from \"./ha-thingtalk-placeholders\";\nimport { convertThingTalk } from \"../../../../data/cloud\";\n\nexport interface Placeholder {\n  name: string;\n  index: number;\n  fields: string[];\n  domains: string[];\n  device_classes?: string[];\n}\n\nexport interface PlaceholderContainer {\n  [key: string]: Placeholder[];\n}\n\n@customElement(\"ha-dialog-thinktalk\")\nclass DialogThingtalk extends LitElement {\n  @property() public hass!: HomeAssistant;\n  @property() private _error?: string;\n  @property() private _params?: ThingtalkDialogParams;\n  @property() private _submitting: boolean = false;\n  @property() private _opened = false;\n  @property() private _placeholders?: PlaceholderContainer;\n\n  @query(\"#input\") private _input?: PaperInputElement;\n\n  private _value!: string;\n  private _config!: Partial<AutomationConfig>;\n\n  public showDialog(params: ThingtalkDialogParams): void {\n    this._params = params;\n    this._error = undefined;\n    this._opened = true;\n  }\n\n  protected render(): TemplateResult | void {\n    if (!this._params) {\n      return html``;\n    }\n    if (this._placeholders) {\n      return html`\n        <ha-thingtalk-placeholders\n          .hass=${this.hass}\n          .placeholders=${this._placeholders}\n          .opened=${this._opened}\n          .skip=${() => this._skip()}\n          @opened-changed=${this._openedChanged}\n          @placeholders-filled=${this._handlePlaceholders}\n        >\n        </ha-thingtalk-placeholders>\n      `;\n    }\n    return html`\n      <ha-paper-dialog\n        with-backdrop\n        .opened=${this._opened}\n        @opened-changed=${this._openedChanged}\n      >\n        <h2>Create a new automation</h2>\n        <paper-dialog-scrollable>\n          ${this._error\n            ? html`\n                <div class=\"error\">${this._error}</div>\n              `\n            : \"\"}\n          Type below what this automation should do, and we will try to convert\n          it into a Home Assistant automation. (only English is supported for\n          now)<br /><br />\n          For example:\n          <ul @click=${this._handleExampleClick}>\n            <li>\n              <button class=\"link\">\n                Turn off the lights when I leave home\n              </button>\n            </li>\n            <li>\n              <button class=\"link\">\n                Turn on the lights when the sun is set\n              </button>\n            </li>\n            <li>\n              <button class=\"link\">\n                Notify me if the door opens and I am not at home\n              </button>\n            </li>\n            <li>\n              <button class=\"link\">\n                Turn the light on when motion is detected\n              </button>\n            </li>\n          </ul>\n          <paper-input\n            id=\"input\"\n            label=\"What should this automation do?\"\n            autofocus\n            @keyup=${this._handleKeyUp}\n          ></paper-input>\n          <a\n            href=\"https://almond.stanford.edu/\"\n            target=\"_blank\"\n            class=\"attribution\"\n            >Powered by Almond</a\n          >\n        </paper-dialog-scrollable>\n        <div class=\"paper-dialog-buttons\">\n          <mwc-button class=\"left\" @click=\"${this._skip}\">\n            Skip\n          </mwc-button>\n          <mwc-button @click=\"${this._generate}\" .disabled=${this._submitting}>\n            <paper-spinner\n              ?active=\"${this._submitting}\"\n              alt=\"Creating your automation...\"\n            ></paper-spinner>\n            Create automation\n          </mwc-button>\n        </div>\n      </ha-paper-dialog>\n    `;\n  }\n\n  private async _generate() {\n    this._value = this._input!.value as string;\n    if (!this._value) {\n      this._error = \"Enter a command or tap skip.\";\n      return;\n    }\n    this._submitting = true;\n    let config: Partial<AutomationConfig>;\n    let placeholders: PlaceholderContainer;\n    try {\n      const result = await convertThingTalk(this.hass, this._value);\n      config = result.config;\n      placeholders = result.placeholders;\n    } catch (err) {\n      this._error = err.message;\n      this._submitting = false;\n      return;\n    }\n\n    this._submitting = false;\n\n    if (!Object.keys(config).length) {\n      this._error = \"We couldn't create an automation for that (yet?).\";\n    } else if (Object.keys(placeholders).length) {\n      this._config = config;\n      this._placeholders = placeholders;\n    } else {\n      this._sendConfig(this._value, config);\n    }\n  }\n\n  private _handlePlaceholders(ev: CustomEvent) {\n    const placeholderValues = ev.detail.value as PlaceholderValues;\n    Object.entries(placeholderValues).forEach(([type, values]) => {\n      Object.entries(values).forEach(([index, placeholder]) => {\n        const devices = Object.values(placeholder);\n        if (devices.length === 1) {\n          Object.entries(devices[0]).forEach(([field, value]) => {\n            this._config[type][index][field] = value;\n          });\n          return;\n        }\n        const automation = { ...this._config[type][index] };\n        const newAutomations: any[] = [];\n        devices.forEach((fields) => {\n          const newAutomation = { ...automation };\n          Object.entries(fields).forEach(([field, value]) => {\n            newAutomation[field] = value;\n          });\n          newAutomations.push(newAutomation);\n        });\n        this._config[type].splice(index, 1, ...newAutomations);\n      });\n    });\n    this._sendConfig(this._value, this._config);\n  }\n\n  private _sendConfig(input, config) {\n    this._params!.callback({ alias: input, ...config });\n    this._closeDialog();\n  }\n\n  private _skip() {\n    this._params!.callback(undefined);\n    this._closeDialog();\n  }\n\n  private _closeDialog() {\n    this._placeholders = undefined;\n    if (this._input) {\n      this._input.value = null;\n    }\n    this._opened = false;\n  }\n\n  private _openedChanged(ev: PolymerChangedEvent<boolean>): void {\n    if (!ev.detail.value) {\n      this._closeDialog();\n    }\n  }\n\n  private _handleKeyUp(ev: KeyboardEvent) {\n    if (ev.keyCode === 13) {\n      this._generate();\n    }\n  }\n\n  private _handleExampleClick(ev: Event) {\n    this._input!.value = (ev.target as HTMLAnchorElement).innerText;\n  }\n\n  static get styles(): CSSResult[] {\n    return [\n      haStyle,\n      haStyleDialog,\n      css`\n        ha-paper-dialog {\n          max-width: 500px;\n        }\n        mwc-button.left {\n          margin-right: auto;\n        }\n        mwc-button paper-spinner {\n          width: 14px;\n          height: 14px;\n          margin-right: 20px;\n        }\n        paper-spinner {\n          display: none;\n        }\n        paper-spinner[active] {\n          display: block;\n        }\n        .error {\n          color: var(--google-red-500);\n        }\n        .attribution {\n          color: var(--secondary-text-color);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-dialog-thinktalk\": DialogThingtalk;\n  }\n}\n"],"sourceRoot":""}