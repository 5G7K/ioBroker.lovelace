{"version":3,"sources":["webpack:///./src/common/config/is_component_loaded.ts","webpack:///./src/common/datetime/duration_to_seconds.ts","webpack:///./src/common/datetime/format_date.ts","webpack:///./src/common/datetime/format_date_time.ts","webpack:///./src/common/datetime/format_time.ts","webpack:///./src/common/datetime/relative_time.ts","webpack:///./src/common/datetime/seconds_to_duration.ts","webpack:///./src/common/dom/stop_propagation.ts","webpack:///./src/common/entity/binary_sensor_icon.ts","webpack:///./src/common/entity/compute_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/entity/compute_state_display.ts","webpack:///./src/common/entity/compute_state_domain.ts","webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/common/entity/cover_icon.ts","webpack:///./src/common/entity/domain_icon.ts","webpack:///./src/common/entity/input_dateteime_icon.ts","webpack:///./src/common/entity/sensor_icon.ts","webpack:///./src/common/entity/state_icon.ts","webpack:///./src/common/entity/supports-feature.ts","webpack:///./src/common/entity/timer_time_remaining.ts","webpack:///./src/common/util/debounce.ts","webpack:///./src/common/util/time-cache-function-promise.ts","webpack:///./src/components/entity/ha-chart-base.js","webpack:///./src/components/entity/ha-entity-toggle.ts","webpack:///./src/components/entity/state-badge.ts","webpack:///./src/components/ha-climate-state.js","webpack:///./src/components/ha-cover-controls.js","webpack:///./src/components/ha-cover-tilt-controls.js","webpack:///./src/components/ha-icon.ts","webpack:///./src/components/ha-markdown.js","webpack:///./src/components/ha-paper-dropdown-menu.ts","webpack:///./src/components/ha-relative-time.js","webpack:///./src/components/ha-slider.js","webpack:///./src/components/paper-time-input.js","webpack:///./src/components/state-history-chart-line.js","webpack:///./src/components/state-history-chart-timeline.js","webpack:///./src/components/state-history-charts.js","webpack:///./src/data/auth.ts","webpack:///./src/data/cached-history.ts","webpack:///./src/data/camera.ts","webpack:///./src/data/entity_registry.ts","webpack:///./src/data/ha-state-history-data.js","webpack:///./src/data/history.ts","webpack:///./src/data/input-select.ts","webpack:///./src/mixins/events-mixin.js","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/util/cover-model.js","webpack:///./src/util/hass-media-player-model.js"],"names":["isComponentLoaded","hass","component","config","components","indexOf","durationToSeconds","duration","parts","split","map","Number","toLocaleDateStringSupportsOptions","Date","toLocaleDateString","e","name","dateObj","locales","year","month","day","fecha","format","toLocaleStringSupportsOptions","toLocaleString","hour","minute","toLocaleTimeStringSupportsOptions","toLocaleTimeString","tests","langKey","relativeTime","localize","options","compareTime","delta","getTime","tense","Math","abs","timeDesc","i","length","floor","undefined","includeTense","leftPad","num","secondsToDuration","d","h","m","s","stopPropagation","ev","binarySensorIcon","state","activated","attributes","device_class","computeDomain","entityId","substr","computeObjectId","stateObj","language","display","domain","computeStateDomain","unit_of_measurement","includes","date","has_time","formatDate","has_date","now","getFullYear","getMonth","getDay","formatTime","formatDateTime","query_stage","entity_id","friendly_name","replace","coverIcon","open","domainIcon","fixedIcons","alert","automation","calendar","camera","climate","configurator","conversation","device_tracker","fan","group","history_graph","homeassistant","homekit","image_processing","input_boolean","input_datetime","input_number","input_select","input_text","light","mailbox","notify","person","plant","proximity","remote","scene","script","sensor","simple_alarm","sun","switch","timer","updater","vacuum","water_heater","weblink","console","warn","DEFAULT_DOMAIN_ICON","inputDateTimeIcon","fixedDeviceClassIcons","humidity","illuminance","temperature","pressure","power","signal_strength","sensorIcon","dclass","battery","isNaN","batteryRound","round","unit","UNIT_C","UNIT_F","domainIcons","binary_sensor","cover","stateIcon","icon","supportsFeature","feature","supported_features","timerTimeRemaining","timeRemaining","remaining","madeActive","last_changed","max","debounce","func","wait","immediate","timeout","args","context","later","apply","callNow","clearTimeout","setTimeout","timeCachePromiseFunc","cacheKey","cacheTime","cache","lastResult","result","then","scriptsLoaded","HaChartBase","mixinBehaviors","IronResizableBehavior","PolymerElement","template","html","chart","_chart","properties","data","Object","identifier","String","rendered","type","Boolean","value","readOnly","metas","Array","tooltip","opacity","left","top","xPadding","yPadding","rtl","reflectToAttribute","observers","connectedCallback","_isAttached","onPropsChange","_resizeListener","_debouncer","Debouncer","timeOut","after","resizeChart","ResizeObserver","resizeObserver","entries","forEach","observe","$","chartTarget","addEventListener","ChartModule","ChartClass","default","disconnectedCallback","unobserve","removeEventListener","_resizeTimer","clearInterval","drawChart","_customTooltips","set","yAlign","title","bodyLines","body","n","lines","colors","labelColors","color","borderColor","bgColor","backgroundColor","text","join","parentWidth","clientWidth","positionX","caretX","positionY","canvas","offsetTop","caretY","offsetLeft","assign","_legendClick","event","window","target","srcElement","nodeName","parentElement","index","model","itemsIndex","meta","getDatasetMeta","hidden","datasets","isDatasetVisible","update","_drawLegend","preserveVisibility","_oldIdentifier","x","label","updateNeeded","_formatTickValue","values","ctx","chartCanvas","cnt","constructor","getColorList","loopI","rgbString","alpha","rgbaString","isTimeline","scales","yAxes","gridLines","legend","plugins","afterRender","_setRendered","responsive","maintainAspectRatio","animation","hover","animationDuration","responsiveAnimationDuration","tooltips","enabled","custom","bind","line","spanGaps","elements","font","ticks","fontFamily","Chart","helpers","merge","xAxes","callback","_colorFunc","getColorGenerator","staticColors","staticColorIndex","colorFunction","style","height","chartData","setInterval","_resizeChart","resize","areaTop","chartArea","areaBot","bottom","height1","clientHeight","_axisHeight","targetHeight","count","processL","ceil","h1","Color","hsl","startIndex","palette","getColorIndex","idx","colorDict","colorIndex","keys","c","c1","isFinite","toLowerCase","getColor","__","ret","name1","customElements","define","isOn","STATES_OFF","HaEntityToggle","property","assumed_state","_turnOff","_isOn","_turnOn","_toggleChanged","changedProps","has","newVal","checked","_callService","turnOn","forwardHaptic","stateDomain","serviceDomain","service","currentState","callService","css","LitElement","StateBadge","query","overrideIcon","iconStyle","filter","hostStyle","backgroundImage","entity_picture","hs_color","hue","sat","brightness","errorMessage","_icon","HaClimateState","LocalizeMixin","currentStatus","computed","computeCurrentStatus","current_temperature","unit_system","current_humidity","computeTarget","target_temp_low","target_temp_high","target_humidity_low","target_humidity_high","_hasKnownState","_localizeState","HaCoverControls","entityObj","computeEntityObj","CoverEntity","computeOpenDisabled","assumedState","isFullyOpen","isOpening","computeClosedDisabled","isFullyClosed","isClosing","onOpenTap","openCover","onCloseTap","closeCover","onStopTap","stopCover","HaCoverTiltControls","isFullyOpenTilt","isFullyClosedTilt","onOpenTiltTap","openCoverTilt","onCloseTiltTap","closeCoverTilt","onStopTiltTap","stopCoverTilt","ironIconClass","get","loaded","HaIcon","listen","node","eventName","methodName","_iconsetName","svgWhiteList","HaMarkdown","EventsMixin","content","observer","allowSvg","_scriptLoaded","_renderScheduled","_resize","fire","marked","filterXSS","_render","Promise","resolve","innerHTML","gfm","tables","breaks","onIgnoreTag","tag","walker","document","createTreeWalker","nextNode","currentNode","tagName","host","location","innerText","paperDropdownClass","HaPaperDropdownClass","ready","getComputedStyle","direction","textAlign","HaRelativeTime","datetime","datetimeObj","parsedDateTime","updateRelative","updateInterval","datetimeChanged","datetimeObjChanged","root","dom","PaperSliderClass","subTemplate","HaSlider","cloneNode","superStyle","querySelector","appendChild","createTextNode","_calcStep","step","parseFloat","numSteps","min","stepStr","toString","stepPointAt","precision","PaperTimeInput","autoValidate","hideLabel","disabled","amPm","validate","valid","dropdown","_computeTime","_formatMin","_shouldFormatHour","_computeHourMax","_equal","n1","n2","StateHistoryChartLine","names","isSingleDevice","endTime","dataChanged","_onRenderedChanged","animateHeight","requestAnimationFrame","scrollHeight","deviceStates","safeParseFloat","parsed","devSts","states","prevValues","pushData","timestamp","datavalues","push","y","addColumn","nameY","fill","dataFill","dataStep","steppedLine","pointRadius","unitText","hasTargetRange","some","hasHeat","hasCool","curTemp","series","targetHigh","targetLow","isStep","lastValue","lastDate","lastNullDate","dateTime","lastNullDateTime","lastDateTime","tmpValue","prototype","formatTooltipTitle","items","item","datasetIndex","chartOptions","major","fontStyle","maxTicksLimit","mode","callbacks","layout","padding","tension","borderWidth","point","hitRadius","filler","propagate","labels","StateHistoryChartTimeline","noSingle","on","off","unavailable","unknown","idle","stateHistory","startTime","reduce","minTime","stateInfo","maxTime","newLastChanged","prevState","locState","prevLastChanged","entityDisplay","dataRow","newState","timeStamp","state_localize","formatTooltipLabel","start","end","afterSetDimensions","yaxe","maxWidth","width","position","_computeRTL","computeRTL","StateHistoryCharts","historyData","isLoadingData","upToNow","_computeIsSingleLineChart","_computeIsEmpty","historyDataEmpty","timeline","_computeIsLoading","isLoading","_computeEndTime","hassUrl","protocol","getSignedPath","path","callWS","fetchAuthProviders","fetch","credentials","RECENT_THRESHOLD","RECENT_CACHE","stateHistoryCache","getRecent","created","prom","fetchRecent","computeHistory","err","getEmptyCache","getRecentWithCache","cacheConfig","setHours","getHours","hoursToShow","toFetchStartTime","appendingToCache","curCacheProm","genProm","fetchedHistory","results","all","mergeLine","mergeTimeline","pruneStartTime","historyLines","cacheLines","oldLine","find","cacheLine","entity","oldEntity","cacheEntity","concat","historyTimelines","cacheTimelines","oldTimeline","cacheTimeline","pruneArray","originalStartTime","arr","changedAfterStartTime","findIndex","updateIndex","slice","cacheData","CAMERA_SUPPORT_ON_OFF","CAMERA_SUPPORT_STREAM","computeMJPEGStreamUrl","access_token","fetchThumbnailUrlWithCache","fetchThumbnailUrl","fetchThumbnail","fetchStreamUrl","fetchCameraPrefs","updateCameraPrefs","prefs","computeEntityRegistryName","entry","computeStateName","updateEntityRegistryEntry","updates","removeEntityRegistryEntry","fetchEntityRegistry","conn","sendMessagePromise","subscribeEntityRegistryUpdates","store","subscribeEvents","entities","setState","subscribeEntityRegistry","onChange","createCollection","HaStateHistoryData","filterType","filterChangedDebouncer","_refreshTimeoutId","hassChanged","newHass","oldHass","_madeFirstCall","_debounceFilterChanged","filterChanged","fetchDate","dateHistory","getRecentWithCacheRefresh","_setIsLoading","_setData","refresh","DOMAINS_USE_LAST_UPDATED","LINE_ATTRIBUTES_TO_KEEP","skipInitialState","url","toISOString","callApi","equalState","obj1","obj2","every","attr","processTimelineEntity","computeStateDisplay","processLineChartEntities","last","processedStates","processedState","last_updated","lineChartDevices","timelineDevices","stateWithUnit","unitStates","setInputSelectOption","option","dedupingMixin","superClass","detail","fireEvent","Function","__computeLocalize","_attr","_feat","current_position","current_tilt_position","supportsOpen","supportsClose","supportsSetPosition","supportsStop","supportsOpenTilt","supportsCloseTilt","supportsStopTilt","supportsSetTiltPosition","isTiltOnly","supportsCover","supportsTilt","setCoverPosition","setCoverTiltPosition","tiltPosition","tilt_position","MediaPlayerEntity","isOff","isIdle","isMuted","is_volume_muted","isPaused","isPlaying","isMusic","media_content_type","isTVShow","hasMediaControl","volumeSliderValue","volume_level","showProgress","currentProgress","progress","media_position","media_position_updated_at","supportsPause","supportsVolumeSet","supportsVolumeMute","supportsPreviousTrack","supportsNextTrack","supportsTurnOn","supportsTurnOff","supportsPlayMedia","supportsVolumeButtons","supportsSelectSource","supportsSelectSoundMode","supportsPlay","primaryTitle","media_title","secondaryTitle","media_artist","media_series_title","media_season","media_episode","app_name","source","sourceList","source_list","soundMode","sound_mode","soundModeList","sound_mode_list","mediaPlayPause","nextTrack","playbackControl","previousTrack","setVolume","volume","togglePower","turnOff","volumeDown","volumeMute","mute","Error","volumeUp","selectSource","selectSoundMode"],"mappings":"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","file":"more-info-dialog~panel-lovelace.chunk.js","sourcesContent":["import { HomeAssistant } from \"../../types\";\n\n/** Return if a component is loaded. */\nexport default function isComponentLoaded(\n  hass: HomeAssistant,\n  component: string\n): boolean {\n  return hass && hass.config.components.indexOf(component) !== -1;\n}\n","export default function durationToSeconds(duration: string): number {\n  const parts = duration.split(\":\").map(Number);\n  return parts[0] * 3600 + parts[1] * 60 + parts[2];\n}\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleDateStringSupportsOptions() {\n  try {\n    new Date().toLocaleDateString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleDateStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleDateString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"mediumDate\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleStringSupportsOptions() {\n  try {\n    new Date().toLocaleString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"haDateTime\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleTimeStringSupportsOptions() {\n  try {\n    new Date().toLocaleTimeString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleTimeStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleTimeString(locales, {\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"shortTime\"));\n","import { LocalizeFunc } from \"../translations/localize\";\n\n/**\n * Calculate a string representing a date object as relative time from now.\n *\n * Example output: 5 minutes ago, in 3 days.\n */\nconst tests = [60, 60, 24, 7];\nconst langKey = [\"second\", \"minute\", \"hour\", \"day\"];\n\nexport default function relativeTime(\n  dateObj: Date,\n  localize: LocalizeFunc,\n  options: {\n    compareTime?: Date;\n    includeTense?: boolean;\n  } = {}\n): string {\n  const compareTime = options.compareTime || new Date();\n  let delta = (compareTime.getTime() - dateObj.getTime()) / 1000;\n  const tense = delta >= 0 ? \"past\" : \"future\";\n  delta = Math.abs(delta);\n\n  let timeDesc;\n\n  for (let i = 0; i < tests.length; i++) {\n    if (delta < tests[i]) {\n      delta = Math.floor(delta);\n      timeDesc = localize(\n        `ui.components.relative_time.duration.${langKey[i]}`,\n        \"count\",\n        delta\n      );\n      break;\n    }\n\n    delta /= tests[i];\n  }\n\n  if (timeDesc === undefined) {\n    delta = Math.floor(delta);\n    timeDesc = localize(\n      \"ui.components.relative_time.duration.week\",\n      \"count\",\n      delta\n    );\n  }\n\n  return options.includeTense === false\n    ? timeDesc\n    : localize(`ui.components.relative_time.${tense}`, \"time\", timeDesc);\n}\n","const leftPad = (num: number) => (num < 10 ? `0${num}` : num);\n\nexport default function secondsToDuration(d: number) {\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  if (h > 0) {\n    return `${h}:${leftPad(m)}:${leftPad(s)}`;\n  }\n  if (m > 0) {\n    return `${m}:${leftPad(s)}`;\n  }\n  if (s > 0) {\n    return \"\" + s;\n  }\n  return null;\n}\n","export const stopPropagation = (ev) => ev.stopPropagation();\n","import { HassEntity } from \"home-assistant-js-websocket\";\n\n/** Return an icon representing a binary sensor state. */\n\nexport default function binarySensorIcon(state: HassEntity) {\n  const activated = state.state && state.state === \"off\";\n  switch (state.attributes.device_class) {\n    case \"battery\":\n      return activated ? \"hass:battery\" : \"hass:battery-outline\";\n    case \"cold\":\n      return activated ? \"hass:thermometer\" : \"hass:snowflake\";\n    case \"connectivity\":\n      return activated ? \"hass:server-network-off\" : \"hass:server-network\";\n    case \"door\":\n      return activated ? \"hass:door-closed\" : \"hass:door-open\";\n    case \"garage_door\":\n      return activated ? \"hass:garage\" : \"hass:garage-open\";\n    case \"gas\":\n    case \"power\":\n    case \"problem\":\n    case \"safety\":\n    case \"smoke\":\n      return activated ? \"hass:shield-check\" : \"hass:alert\";\n    case \"heat\":\n      return activated ? \"hass:thermometer\" : \"hass:fire\";\n    case \"light\":\n      return activated ? \"hass:brightness-5\" : \"hass:brightness-7\";\n    case \"lock\":\n      return activated ? \"hass:lock\" : \"hass:lock-open\";\n    case \"moisture\":\n      return activated ? \"hass:water-off\" : \"hass:water\";\n    case \"motion\":\n      return activated ? \"hass:walk\" : \"hass:run\";\n    case \"occupancy\":\n      return activated ? \"hass:home-outline\" : \"hass:home\";\n    case \"opening\":\n      return activated ? \"hass:square\" : \"hass:square-outline\";\n    case \"plug\":\n      return activated ? \"hass:power-plug-off\" : \"hass:power-plug\";\n    case \"presence\":\n      return activated ? \"hass:home-outline\" : \"hass:home\";\n    case \"sound\":\n      return activated ? \"hass:music-note-off\" : \"hass:music-note\";\n    case \"vibration\":\n      return activated ? \"hass:crop-portrait\" : \"hass:vibrate\";\n    case \"window\":\n      return activated ? \"hass:window-closed\" : \"hass:window-open\";\n    default:\n      return activated ? \"hass:radiobox-blank\" : \"hass:checkbox-marked-circle\";\n  }\n}\n","export default function computeDomain(entityId: string): string {\n  return entityId.substr(0, entityId.indexOf(\".\"));\n}\n","/** Compute the object ID of a state. */\nexport default function computeObjectId(entityId: string): string {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeStateDomain from \"./compute_state_domain\";\nimport formatDateTime from \"../datetime/format_date_time\";\nimport formatDate from \"../datetime/format_date\";\nimport formatTime from \"../datetime/format_time\";\nimport { LocalizeFunc } from \"../translations/localize\";\n\nexport default (\n  localize: LocalizeFunc,\n  stateObj: HassEntity,\n  language: string\n): string => {\n  let display: string | undefined;\n  const domain = computeStateDomain(stateObj);\n\n  if (domain === \"binary_sensor\") {\n    // Try device class translation, then default binary sensor translation\n    if (stateObj.attributes.device_class) {\n      display = localize(\n        `state.${domain}.${stateObj.attributes.device_class}.${stateObj.state}`\n      );\n    }\n\n    if (!display) {\n      display = localize(`state.${domain}.default.${stateObj.state}`);\n    }\n  } else if (\n    stateObj.attributes.unit_of_measurement &&\n    ![\"unknown\", \"unavailable\"].includes(stateObj.state)\n  ) {\n    display = stateObj.state + \" \" + stateObj.attributes.unit_of_measurement;\n  } else if (domain === \"input_datetime\") {\n    let date: Date;\n    if (!stateObj.attributes.has_time) {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day\n      );\n      display = formatDate(date, language);\n    } else if (!stateObj.attributes.has_date) {\n      const now = new Date();\n      date = new Date(\n        // Due to bugs.chromium.org/p/chromium/issues/detail?id=797548\n        // don't use artificial 1970 year.\n        now.getFullYear(),\n        now.getMonth(),\n        now.getDay(),\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatTime(date, language);\n    } else {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day,\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatDateTime(date, language);\n    }\n  } else if (domain === \"zwave\") {\n    if ([\"initializing\", \"dead\"].includes(stateObj.state)) {\n      display = localize(\n        `state.zwave.query_stage.${stateObj.state}`,\n        \"query_stage\",\n        stateObj.attributes.query_stage\n      );\n    } else {\n      display = localize(`state.zwave.default.${stateObj.state}`);\n    }\n  } else {\n    display = localize(`state.${domain}.${stateObj.state}`);\n  }\n\n  // Fall back to default, component backend translation, or raw state if nothing else matches.\n  if (!display) {\n    display =\n      localize(`state.default.${stateObj.state}`) ||\n      localize(`component.${domain}.state.${stateObj.state}`) ||\n      stateObj.state;\n  }\n\n  return display;\n};\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeDomain from \"./compute_domain\";\n\nexport default function computeStateDomain(stateObj: HassEntity) {\n  return computeDomain(stateObj.entity_id);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeObjectId from \"./compute_object_id\";\n\nexport default (stateObj: HassEntity): string =>\n  stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n","/** Return an icon representing a cover state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport domainIcon from \"./domain_icon\";\n\nexport default function coverIcon(state: HassEntity): string {\n  const open = state.state !== \"closed\";\n  switch (state.attributes.device_class) {\n    case \"garage\":\n      return open ? \"hass:garage-open\" : \"hass:garage\";\n    default:\n      return domainIcon(\"cover\", state.state);\n  }\n}\n","/**\n * Return the icon to be used for a domain.\n *\n * Optionally pass in a state to influence the domain icon.\n */\nimport { DEFAULT_DOMAIN_ICON } from \"../const\";\n\nconst fixedIcons = {\n  alert: \"hass:alert\",\n  automation: \"hass:playlist-play\",\n  calendar: \"hass:calendar\",\n  camera: \"hass:video\",\n  climate: \"hass:thermostat\",\n  configurator: \"hass:settings\",\n  conversation: \"hass:text-to-speech\",\n  device_tracker: \"hass:account\",\n  fan: \"hass:fan\",\n  group: \"hass:google-circles-communities\",\n  history_graph: \"hass:chart-line\",\n  homeassistant: \"hass:home-assistant\",\n  homekit: \"hass:home-automation\",\n  image_processing: \"hass:image-filter-frames\",\n  input_boolean: \"hass:drawing\",\n  input_datetime: \"hass:calendar-clock\",\n  input_number: \"hass:ray-vertex\",\n  input_select: \"hass:format-list-bulleted\",\n  input_text: \"hass:textbox\",\n  light: \"hass:lightbulb\",\n  mailbox: \"hass:mailbox\",\n  notify: \"hass:comment-alert\",\n  person: \"hass:account\",\n  plant: \"hass:flower\",\n  proximity: \"hass:apple-safari\",\n  remote: \"hass:remote\",\n  scene: \"hass:google-pages\",\n  script: \"hass:file-document\",\n  sensor: \"hass:eye\",\n  simple_alarm: \"hass:bell\",\n  sun: \"hass:white-balance-sunny\",\n  switch: \"hass:flash\",\n  timer: \"hass:timer\",\n  updater: \"hass:cloud-upload\",\n  vacuum: \"hass:robot-vacuum\",\n  water_heater: \"hass:thermometer\",\n  weblink: \"hass:open-in-new\",\n};\n\nexport default function domainIcon(domain: string, state?: string): string {\n  if (domain in fixedIcons) {\n    return fixedIcons[domain];\n  }\n\n  switch (domain) {\n    case \"alarm_control_panel\":\n      switch (state) {\n        case \"armed_home\":\n          return \"hass:bell-plus\";\n        case \"armed_night\":\n          return \"hass:bell-sleep\";\n        case \"disarmed\":\n          return \"hass:bell-outline\";\n        case \"triggered\":\n          return \"hass:bell-ring\";\n        default:\n          return \"hass:bell\";\n      }\n\n    case \"binary_sensor\":\n      return state && state === \"off\"\n        ? \"hass:radiobox-blank\"\n        : \"hass:checkbox-marked-circle\";\n\n    case \"cover\":\n      return state === \"closed\" ? \"hass:window-closed\" : \"hass:window-open\";\n\n    case \"lock\":\n      return state && state === \"unlocked\" ? \"hass:lock-open\" : \"hass:lock\";\n\n    case \"media_player\":\n      return state && state !== \"off\" && state !== \"idle\"\n        ? \"hass:cast-connected\"\n        : \"hass:cast\";\n\n    case \"zwave\":\n      switch (state) {\n        case \"dead\":\n          return \"hass:emoticon-dead\";\n        case \"sleeping\":\n          return \"hass:sleep\";\n        case \"initializing\":\n          return \"hass:timer-sand\";\n        default:\n          return \"hass:z-wave\";\n      }\n\n    default:\n      // tslint:disable-next-line\n      console.warn(\n        \"Unable to find icon for domain \" + domain + \" (\" + state + \")\"\n      );\n      return DEFAULT_DOMAIN_ICON;\n  }\n}\n","/** Return an icon representing an input datetime state. */\nimport domainIcon from \"./domain_icon\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n\nexport default function inputDateTimeIcon(state: HassEntity): string {\n  if (!state.attributes.has_date) {\n    return \"hass:clock\";\n  }\n  if (!state.attributes.has_time) {\n    return \"hass:calendar\";\n  }\n  return domainIcon(\"input_datetime\");\n}\n","/** Return an icon representing a sensor state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { UNIT_C, UNIT_F } from \"../const\";\nimport domainIcon from \"./domain_icon\";\n\nconst fixedDeviceClassIcons = {\n  humidity: \"hass:water-percent\",\n  illuminance: \"hass:brightness-5\",\n  temperature: \"hass:thermometer\",\n  pressure: \"hass:gauge\",\n  power: \"hass:flash\",\n  signal_strength: \"hass:wifi\",\n};\n\nexport default function sensorIcon(state: HassEntity) {\n  const dclass = state.attributes.device_class;\n\n  if (dclass && dclass in fixedDeviceClassIcons) {\n    return fixedDeviceClassIcons[dclass];\n  }\n  if (dclass === \"battery\") {\n    const battery = Number(state.state);\n    if (isNaN(battery)) {\n      return \"hass:battery-unknown\";\n    }\n    const batteryRound = Math.round(battery / 10) * 10;\n    if (batteryRound >= 100) {\n      return \"hass:battery\";\n    }\n    if (batteryRound <= 0) {\n      return \"hass:battery-alert\";\n    }\n    // Will return one of the following icons: (listed so extractor picks up)\n    // hass:battery-10\n    // hass:battery-20\n    // hass:battery-30\n    // hass:battery-40\n    // hass:battery-50\n    // hass:battery-60\n    // hass:battery-70\n    // hass:battery-80\n    // hass:battery-90\n    // We obscure 'hass' in iconname so this name does not get picked up\n    return `${\"hass\"}:battery-${batteryRound}`;\n  }\n\n  const unit = state.attributes.unit_of_measurement;\n  if (unit === UNIT_C || unit === UNIT_F) {\n    return \"hass:thermometer\";\n  }\n  return domainIcon(\"sensor\");\n}\n","/** Return an icon representing a state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { DEFAULT_DOMAIN_ICON } from \"../const\";\n\nimport computeDomain from \"./compute_domain\";\nimport domainIcon from \"./domain_icon\";\n\nimport binarySensorIcon from \"./binary_sensor_icon\";\nimport coverIcon from \"./cover_icon\";\nimport sensorIcon from \"./sensor_icon\";\nimport inputDateTimeIcon from \"./input_dateteime_icon\";\n\nconst domainIcons = {\n  binary_sensor: binarySensorIcon,\n  cover: coverIcon,\n  sensor: sensorIcon,\n  input_datetime: inputDateTimeIcon,\n};\n\nexport default function stateIcon(state: HassEntity) {\n  if (!state) {\n    return DEFAULT_DOMAIN_ICON;\n  }\n  if (state.attributes.icon) {\n    return state.attributes.icon;\n  }\n\n  const domain = computeDomain(state.entity_id);\n\n  if (domain in domainIcons) {\n    return domainIcons[domain](state);\n  }\n  return domainIcon(domain, state.state);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\n\nexport const supportsFeature = (\n  stateObj: HassEntity,\n  feature: number\n): boolean => {\n  // tslint:disable-next-line:no-bitwise\n  return (stateObj.attributes.supported_features! & feature) !== 0;\n};\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport durationToSeconds from \"../datetime/duration_to_seconds\";\n\nexport default function timerTimeRemaining(stateObj: HassEntity) {\n  let timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n\n  if (stateObj.state === \"active\") {\n    const now = new Date().getTime();\n    const madeActive = new Date(stateObj.last_changed).getTime();\n    timeRemaining = Math.max(timeRemaining - (now - madeActive) / 1000, 0);\n  }\n\n  return timeRemaining;\n}\n","// From: https://davidwalsh.name/javascript-debounce-function\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\n// tslint:disable-next-line: ban-types\nexport const debounce = <T extends Function>(\n  func: T,\n  wait,\n  immediate = false\n): T => {\n  let timeout;\n  // @ts-ignore\n  return function(...args) {\n    // tslint:disable:no-this-assignment\n    // @ts-ignore\n    const context = this;\n    const later = () => {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n};\n","import { HomeAssistant } from \"../../types\";\n\ninterface ResultCache<T> {\n  [entityId: string]: Promise<T> | undefined;\n}\n\nexport const timeCachePromiseFunc = async <T>(\n  cacheKey: string,\n  cacheTime: number,\n  func: (\n    hass: HomeAssistant,\n    entityId: string,\n    ...args: unknown[]\n  ) => Promise<T>,\n  hass: HomeAssistant,\n  entityId: string,\n  ...args: unknown[]\n): Promise<T> => {\n  let cache: ResultCache<T> | undefined = (hass as any)[cacheKey];\n\n  if (!cache) {\n    cache = hass[cacheKey] = {};\n  }\n\n  const lastResult = cache[entityId];\n\n  if (lastResult) {\n    return lastResult;\n  }\n\n  const result = func(hass, entityId, ...args);\n  cache[entityId] = result;\n\n  result.then(\n    // When successful, set timer to clear cache\n    () =>\n      setTimeout(() => {\n        cache![entityId] = undefined;\n      }, cacheTime),\n    // On failure, clear cache right away\n    () => {\n      cache![entityId] = undefined;\n    }\n  );\n\n  return result;\n};\n","import { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { IronResizableBehavior } from \"@polymer/iron-resizable-behavior/iron-resizable-behavior\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\n\nimport formatTime from \"../../common/datetime/format_time\";\n// eslint-disable-next-line no-unused-vars\n/* global Chart moment Color */\n\nlet scriptsLoaded = null;\n\nclass HaChartBase extends mixinBehaviors(\n  [IronResizableBehavior],\n  PolymerElement\n) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n        }\n        .chartHeader {\n          padding: 6px 0 0 0;\n          width: 100%;\n          display: flex;\n          flex-direction: row;\n        }\n        .chartHeader > div {\n          vertical-align: top;\n          padding: 0 8px;\n        }\n        .chartHeader > div.chartTitle {\n          padding-top: 8px;\n          flex: 0 0 0;\n          max-width: 30%;\n        }\n        .chartHeader > div.chartLegend {\n          flex: 1 1;\n          min-width: 70%;\n        }\n        :root {\n          user-select: none;\n          -moz-user-select: none;\n          -webkit-user-select: none;\n          -ms-user-select: none;\n        }\n        .chartTooltip {\n          font-size: 90%;\n          opacity: 1;\n          position: absolute;\n          background: rgba(80, 80, 80, 0.9);\n          color: white;\n          border-radius: 3px;\n          pointer-events: none;\n          transform: translate(-50%, 12px);\n          z-index: 1000;\n          width: 200px;\n          transition: opacity 0.15s ease-in-out;\n        }\n        :host([rtl]) .chartTooltip {\n          direction: rtl;\n        }\n        .chartLegend ul,\n        .chartTooltip ul {\n          display: inline-block;\n          padding: 0 0px;\n          margin: 5px 0 0 0;\n          width: 100%;\n        }\n        .chartTooltip li {\n          display: block;\n          white-space: pre-line;\n        }\n        .chartTooltip .title {\n          text-align: center;\n          font-weight: 500;\n        }\n        .chartLegend li {\n          display: inline-block;\n          padding: 0 6px;\n          max-width: 49%;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          overflow: hidden;\n          box-sizing: border-box;\n        }\n        .chartLegend li:nth-child(odd):last-of-type {\n          /* Make last item take full width if it is odd-numbered. */\n          max-width: 100%;\n        }\n        .chartLegend li[data-hidden] {\n          text-decoration: line-through;\n        }\n        .chartLegend em,\n        .chartTooltip em {\n          border-radius: 5px;\n          display: inline-block;\n          height: 10px;\n          margin-right: 4px;\n          width: 10px;\n        }\n        :host([rtl]) .chartTooltip em {\n          margin-right: inherit;\n          margin-left: 4px;\n        }\n        paper-icon-button {\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template is=\"dom-if\" if=\"[[unit]]\">\n        <div class=\"chartHeader\">\n          <div class=\"chartTitle\">[[unit]]</div>\n          <div class=\"chartLegend\">\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[metas]]\">\n                <li on-click=\"_legendClick\" data-hidden$=\"[[item.hidden]]\">\n                  <em style$=\"background-color:[[item.bgColor]]\"></em>\n                  [[item.label]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </template>\n      <div id=\"chartTarget\" style=\"height:40px; width:100%\">\n        <canvas id=\"chartCanvas\"></canvas>\n        <div\n          class$=\"chartTooltip [[tooltip.yAlign]]\"\n          style$=\"opacity:[[tooltip.opacity]]; top:[[tooltip.top]]; left:[[tooltip.left]]; padding:[[tooltip.yPadding]]px [[tooltip.xPadding]]px\"\n        >\n          <div class=\"title\">[[tooltip.title]]</div>\n          <div>\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[tooltip.lines]]\">\n                <li>\n                  <em style$=\"background-color:[[item.bgColor]]\"></em\n                  >[[item.text]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  get chart() {\n    return this._chart;\n  }\n\n  static get properties() {\n    return {\n      data: Object,\n      identifier: String,\n      rendered: {\n        type: Boolean,\n        notify: true,\n        value: false,\n        readOnly: true,\n      },\n      metas: {\n        type: Array,\n        value: () => [],\n      },\n      tooltip: {\n        type: Object,\n        value: () => ({\n          opacity: \"0\",\n          left: \"0\",\n          top: \"0\",\n          xPadding: \"5\",\n          yPadding: \"3\",\n        }),\n      },\n      unit: Object,\n      rtl: {\n        type: Boolean,\n        reflectToAttribute: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"onPropsChange(data)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.onPropsChange();\n    this._resizeListener = () => {\n      this._debouncer = Debouncer.debounce(\n        this._debouncer,\n        timeOut.after(10),\n        () => {\n          if (this._isAttached) {\n            this.resizeChart();\n          }\n        }\n      );\n    };\n\n    if (typeof ResizeObserver === \"function\") {\n      this.resizeObserver = new ResizeObserver((entries) => {\n        entries.forEach(() => {\n          this._resizeListener();\n        });\n      });\n      this.resizeObserver.observe(this.$.chartTarget);\n    } else {\n      this.addEventListener(\"iron-resize\", this._resizeListener);\n    }\n\n    if (scriptsLoaded === null) {\n      scriptsLoaded = import(/* webpackChunkName: \"load_chart\" */ \"../../resources/ha-chart-scripts.js\");\n    }\n    scriptsLoaded.then((ChartModule) => {\n      this.ChartClass = ChartModule.default;\n      this.onPropsChange();\n    });\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._isAttached = false;\n    if (this.resizeObserver) {\n      this.resizeObserver.unobserve(this.$.chartTarget);\n    }\n\n    this.removeEventListener(\"iron-resize\", this._resizeListener);\n\n    if (this._resizeTimer !== undefined) {\n      clearInterval(this._resizeTimer);\n      this._resizeTimer = undefined;\n    }\n  }\n\n  onPropsChange() {\n    if (!this._isAttached || !this.ChartClass || !this.data) {\n      return;\n    }\n    this.drawChart();\n  }\n\n  _customTooltips(tooltip) {\n    // Hide if no tooltip\n    if (tooltip.opacity === 0) {\n      this.set([\"tooltip\", \"opacity\"], 0);\n      return;\n    }\n    // Set caret Position\n    if (tooltip.yAlign) {\n      this.set([\"tooltip\", \"yAlign\"], tooltip.yAlign);\n    } else {\n      this.set([\"tooltip\", \"yAlign\"], \"no-transform\");\n    }\n\n    const title = tooltip.title ? tooltip.title[0] || \"\" : \"\";\n    this.set([\"tooltip\", \"title\"], title);\n\n    const bodyLines = tooltip.body.map((n) => n.lines);\n\n    // Set Text\n    if (tooltip.body) {\n      this.set(\n        [\"tooltip\", \"lines\"],\n        bodyLines.map((body, i) => {\n          const colors = tooltip.labelColors[i];\n          return {\n            color: colors.borderColor,\n            bgColor: colors.backgroundColor,\n            text: body.join(\"\\n\"),\n          };\n        })\n      );\n    }\n    const parentWidth = this.$.chartTarget.clientWidth;\n    let positionX = tooltip.caretX;\n    const positionY = this._chart.canvas.offsetTop + tooltip.caretY;\n    if (tooltip.caretX + 100 > parentWidth) {\n      positionX = parentWidth - 100;\n    } else if (tooltip.caretX < 100) {\n      positionX = 100;\n    }\n    positionX += this._chart.canvas.offsetLeft;\n    // Display, position, and set styles for font\n    this.tooltip = Object.assign({}, this.tooltip, {\n      opacity: 1,\n      left: `${positionX}px`,\n      top: `${positionY}px`,\n    });\n  }\n\n  _legendClick(event) {\n    event = event || window.event;\n    event.stopPropagation();\n    let target = event.target || event.srcElement;\n    while (target.nodeName !== \"LI\") {\n      // user clicked child, find parent LI\n      target = target.parentElement;\n    }\n    const index = event.model.itemsIndex;\n\n    const meta = this._chart.getDatasetMeta(index);\n    meta.hidden =\n      meta.hidden === null ? !this._chart.data.datasets[index].hidden : null;\n    this.set(\n      [\"metas\", index, \"hidden\"],\n      this._chart.isDatasetVisible(index) ? null : \"hidden\"\n    );\n    this._chart.update();\n  }\n\n  _drawLegend() {\n    const chart = this._chart;\n    // New data for old graph. Keep metadata.\n    const preserveVisibility =\n      this._oldIdentifier && this.identifier === this._oldIdentifier;\n    this._oldIdentifier = this.identifier;\n    this.set(\n      \"metas\",\n      this._chart.data.datasets.map((x, i) => ({\n        label: x.label,\n        color: x.color,\n        bgColor: x.backgroundColor,\n        hidden:\n          preserveVisibility && i < this.metas.length\n            ? this.metas[i].hidden\n            : !chart.isDatasetVisible(i),\n      }))\n    );\n    let updateNeeded = false;\n    if (preserveVisibility) {\n      for (let i = 0; i < this.metas.length; i++) {\n        const meta = chart.getDatasetMeta(i);\n        if (!!meta.hidden !== !!this.metas[i].hidden) updateNeeded = true;\n        meta.hidden = this.metas[i].hidden ? true : null;\n      }\n    }\n    if (updateNeeded) {\n      chart.update();\n    }\n    this.unit = this.data.unit;\n  }\n\n  _formatTickValue(value, index, values) {\n    if (values.length === 0) {\n      return value;\n    }\n    const date = new Date(values[index].value);\n    return formatTime(date);\n  }\n\n  drawChart() {\n    const data = this.data.data;\n    const ctx = this.$.chartCanvas;\n\n    if ((!data.datasets || !data.datasets.length) && !this._chart) {\n      return;\n    }\n    if (this.data.type !== \"timeline\" && data.datasets.length > 0) {\n      const cnt = data.datasets.length;\n      const colors = this.constructor.getColorList(cnt);\n      for (let loopI = 0; loopI < cnt; loopI++) {\n        data.datasets[loopI].borderColor = colors[loopI].rgbString();\n        data.datasets[loopI].backgroundColor = colors[loopI]\n          .alpha(0.6)\n          .rgbaString();\n      }\n    }\n\n    if (this._chart) {\n      this._customTooltips({ opacity: 0 });\n      this._chart.data = data;\n      this._chart.update({ duration: 0 });\n      if (this.isTimeline) {\n        this._chart.options.scales.yAxes[0].gridLines.display = data.length > 1;\n      } else if (this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    } else {\n      if (!data.datasets) {\n        return;\n      }\n      this._customTooltips({ opacity: 0 });\n      const plugins = [{ afterRender: () => this._setRendered(true) }];\n      let options = {\n        responsive: true,\n        maintainAspectRatio: false,\n        animation: {\n          duration: 0,\n        },\n        hover: {\n          animationDuration: 0,\n        },\n        responsiveAnimationDuration: 0,\n        tooltips: {\n          enabled: false,\n          custom: this._customTooltips.bind(this),\n        },\n        legend: {\n          display: false,\n        },\n        line: {\n          spanGaps: true,\n        },\n        elements: {\n          font: \"12px 'Roboto', 'sans-serif'\",\n        },\n        ticks: {\n          fontFamily: \"'Roboto', 'sans-serif'\",\n        },\n      };\n      options = Chart.helpers.merge(options, this.data.options);\n      options.scales.xAxes[0].ticks.callback = this._formatTickValue;\n      if (this.data.type === \"timeline\") {\n        this.set(\"isTimeline\", true);\n        if (this.data.colors !== undefined) {\n          this._colorFunc = this.constructor.getColorGenerator(\n            this.data.colors.staticColors,\n            this.data.colors.staticColorIndex\n          );\n        }\n        if (this._colorFunc !== undefined) {\n          options.elements.colorFunction = this._colorFunc;\n        }\n        if (data.datasets.length === 1) {\n          if (options.scales.yAxes[0].ticks) {\n            options.scales.yAxes[0].ticks.display = false;\n          } else {\n            options.scales.yAxes[0].ticks = { display: false };\n          }\n          if (options.scales.yAxes[0].gridLines) {\n            options.scales.yAxes[0].gridLines.display = false;\n          } else {\n            options.scales.yAxes[0].gridLines = { display: false };\n          }\n        }\n        this.$.chartTarget.style.height = \"50px\";\n      } else {\n        this.$.chartTarget.style.height = \"160px\";\n      }\n      const chartData = {\n        type: this.data.type,\n        data: this.data.data,\n        options: options,\n        plugins: plugins,\n      };\n      // Async resize after dom update\n      this._chart = new this.ChartClass(ctx, chartData);\n      if (this.isTimeline !== true && this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    }\n  }\n\n  resizeChart() {\n    if (!this._chart) return;\n    // Chart not ready\n    if (this._resizeTimer === undefined) {\n      this._resizeTimer = setInterval(this.resizeChart.bind(this), 10);\n      return;\n    }\n\n    clearInterval(this._resizeTimer);\n    this._resizeTimer = undefined;\n\n    this._resizeChart();\n  }\n\n  _resizeChart() {\n    const chartTarget = this.$.chartTarget;\n\n    const options = this.data;\n    const data = options.data;\n\n    if (data.datasets.length === 0) {\n      return;\n    }\n\n    if (!this.isTimeline) {\n      this._chart.resize();\n      return;\n    }\n\n    // Recalculate chart height for Timeline chart\n    const areaTop = this._chart.chartArea.top;\n    const areaBot = this._chart.chartArea.bottom;\n    const height1 = this._chart.canvas.clientHeight;\n    if (areaBot > 0) {\n      this._axisHeight = height1 - areaBot + areaTop;\n    }\n\n    if (!this._axisHeight) {\n      chartTarget.style.height = \"50px\";\n      this._chart.resize();\n      this.resizeChart();\n      return;\n    }\n    if (this._axisHeight) {\n      const cnt = data.datasets.length;\n      const targetHeight = 30 * cnt + this._axisHeight + \"px\";\n      if (chartTarget.style.height !== targetHeight) {\n        chartTarget.style.height = targetHeight;\n      }\n      this._chart.resize();\n    }\n  }\n\n  // Get HSL distributed color list\n  static getColorList(count) {\n    let processL = false;\n    if (count > 10) {\n      processL = true;\n      count = Math.ceil(count / 2);\n    }\n    const h1 = 360 / count;\n    const result = [];\n    for (let loopI = 0; loopI < count; loopI++) {\n      result[loopI] = Color().hsl(h1 * loopI, 80, 38);\n      if (processL) {\n        result[loopI + count] = Color().hsl(h1 * loopI, 80, 62);\n      }\n    }\n    return result;\n  }\n\n  static getColorGenerator(staticColors, startIndex) {\n    // Known colors for static data,\n    // should add for very common state string manually.\n    // Palette modified from http://google.github.io/palette.js/ mpn65, Apache 2.0\n    const palette = [\n      \"ff0029\",\n      \"66a61e\",\n      \"377eb8\",\n      \"984ea3\",\n      \"00d2d5\",\n      \"ff7f00\",\n      \"af8d00\",\n      \"7f80cd\",\n      \"b3e900\",\n      \"c42e60\",\n      \"a65628\",\n      \"f781bf\",\n      \"8dd3c7\",\n      \"bebada\",\n      \"fb8072\",\n      \"80b1d3\",\n      \"fdb462\",\n      \"fccde5\",\n      \"bc80bd\",\n      \"ffed6f\",\n      \"c4eaff\",\n      \"cf8c00\",\n      \"1b9e77\",\n      \"d95f02\",\n      \"e7298a\",\n      \"e6ab02\",\n      \"a6761d\",\n      \"0097ff\",\n      \"00d067\",\n      \"f43600\",\n      \"4ba93b\",\n      \"5779bb\",\n      \"927acc\",\n      \"97ee3f\",\n      \"bf3947\",\n      \"9f5b00\",\n      \"f48758\",\n      \"8caed6\",\n      \"f2b94f\",\n      \"eff26e\",\n      \"e43872\",\n      \"d9b100\",\n      \"9d7a00\",\n      \"698cff\",\n      \"d9d9d9\",\n      \"00d27e\",\n      \"d06800\",\n      \"009f82\",\n      \"c49200\",\n      \"cbe8ff\",\n      \"fecddf\",\n      \"c27eb6\",\n      \"8cd2ce\",\n      \"c4b8d9\",\n      \"f883b0\",\n      \"a49100\",\n      \"f48800\",\n      \"27d0df\",\n      \"a04a9b\",\n    ];\n    function getColorIndex(idx) {\n      // Reuse the color if index too large.\n      return Color(\"#\" + palette[idx % palette.length]);\n    }\n    const colorDict = {};\n    let colorIndex = 0;\n    if (startIndex > 0) colorIndex = startIndex;\n    if (staticColors) {\n      Object.keys(staticColors).forEach((c) => {\n        const c1 = staticColors[c];\n        if (isFinite(c1)) {\n          colorDict[c.toLowerCase()] = getColorIndex(c1);\n        } else {\n          colorDict[c.toLowerCase()] = Color(staticColors[c]);\n        }\n      });\n    }\n    // Custom color assign\n    function getColor(__, data) {\n      let ret;\n      const name = data[3];\n      if (name === null) return Color().hsl(0, 40, 38);\n      if (name === undefined) return Color().hsl(120, 40, 38);\n      const name1 = name.toLowerCase();\n      if (ret === undefined) {\n        ret = colorDict[name1];\n      }\n      if (ret === undefined) {\n        ret = getColorIndex(colorIndex);\n        colorIndex++;\n        colorDict[name1] = ret;\n      }\n      return ret;\n    }\n    return getColor;\n  }\n}\ncustomElements.define(\"ha-chart-base\", HaChartBase);\n","import \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-toggle-button/paper-toggle-button\";\n\nimport { STATES_OFF } from \"../../common/const\";\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport {\n  LitElement,\n  TemplateResult,\n  html,\n  CSSResult,\n  css,\n  property,\n  PropertyValues,\n} from \"lit-element\";\nimport { HomeAssistant } from \"../../types\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { forwardHaptic } from \"../../data/haptics\";\n\nconst isOn = (stateObj?: HassEntity) =>\n  stateObj !== undefined && !STATES_OFF.includes(stateObj.state);\n\nclass HaEntityToggle extends LitElement {\n  // hass is not a property so that we only re-render on stateObj changes\n  public hass?: HomeAssistant;\n  @property() public stateObj?: HassEntity;\n  @property() private _isOn: boolean = false;\n\n  protected render(): TemplateResult | void {\n    if (!this.stateObj) {\n      return html`\n        <paper-toggle-button disabled></paper-toggle-button>\n      `;\n    }\n\n    if (this.stateObj.attributes.assumed_state) {\n      return html`\n        <paper-icon-button\n          icon=\"hass:flash-off\"\n          @click=${this._turnOff}\n          ?state-active=${!this._isOn}\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:flash\"\n          @click=${this._turnOn}\n          ?state-active=${this._isOn}\n        ></paper-icon-button>\n      `;\n    }\n\n    return html`\n      <paper-toggle-button\n        .checked=${this._isOn}\n        @change=${this._toggleChanged}\n      ></paper-toggle-button>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    this.addEventListener(\"click\", (ev) => ev.stopPropagation());\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    if (changedProps.has(\"stateObj\")) {\n      this._isOn = isOn(this.stateObj);\n    }\n  }\n\n  private _toggleChanged(ev) {\n    const newVal = ev.target.checked;\n\n    if (newVal !== this._isOn) {\n      this._callService(newVal);\n    }\n  }\n\n  private _turnOn() {\n    this._callService(true);\n  }\n\n  private _turnOff() {\n    this._callService(false);\n  }\n\n  // We will force a re-render after a successful call to re-sync the toggle\n  // with the state. It will be out of sync if our service call did not\n  // result in the entity to be turned on. Since the state is not changing,\n  // the resync is not called automatic.\n  private async _callService(turnOn): Promise<void> {\n    if (!this.hass || !this.stateObj) {\n      return;\n    }\n    forwardHaptic(\"light\");\n    const stateDomain = computeStateDomain(this.stateObj);\n    let serviceDomain;\n    let service;\n\n    if (stateDomain === \"lock\") {\n      serviceDomain = \"lock\";\n      service = turnOn ? \"unlock\" : \"lock\";\n    } else if (stateDomain === \"cover\") {\n      serviceDomain = \"cover\";\n      service = turnOn ? \"open_cover\" : \"close_cover\";\n    } else if (stateDomain === \"group\") {\n      serviceDomain = \"homeassistant\";\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    } else {\n      serviceDomain = stateDomain;\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    }\n\n    const currentState = this.stateObj;\n\n    // Optimistic update.\n    this._isOn = turnOn;\n\n    await this.hass.callService(serviceDomain, service, {\n      entity_id: this.stateObj.entity_id,\n    });\n\n    setTimeout(async () => {\n      // If after 2 seconds we have not received a state update\n      // reset the switch to it's original state.\n      if (this.stateObj === currentState) {\n        this._isOn = isOn(this.stateObj);\n      }\n    }, 2000);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        white-space: nowrap;\n        min-width: 38px;\n      }\n      paper-icon-button {\n        color: var(\n          --paper-icon-button-inactive-color,\n          var(--primary-text-color)\n        );\n        transition: color 0.5s;\n      }\n      paper-icon-button[state-active] {\n        color: var(--paper-icon-button-active-color, var(--primary-color));\n      }\n      paper-toggle-button {\n        cursor: pointer;\n        --paper-toggle-button-label-spacing: 0;\n        padding: 13px 5px;\n        margin: -4px -5px;\n      }\n    `;\n  }\n}\n\ncustomElements.define(\"ha-entity-toggle\", HaEntityToggle);\n","import {\n  LitElement,\n  TemplateResult,\n  css,\n  CSSResult,\n  html,\n  property,\n  PropertyValues,\n  query,\n} from \"lit-element\";\nimport \"../ha-icon\";\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport stateIcon from \"../../common/entity/state_icon\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { HaIcon } from \"../ha-icon\";\n\nclass StateBadge extends LitElement {\n  @property() public stateObj?: HassEntity;\n  @property() public overrideIcon?: string;\n  @query(\"ha-icon\") private _icon!: HaIcon;\n\n  protected render(): TemplateResult | void {\n    const stateObj = this.stateObj;\n\n    if (!stateObj) {\n      return html``;\n    }\n\n    return html`\n      <ha-icon\n        id=\"icon\"\n        data-domain=${computeStateDomain(stateObj)}\n        data-state=${stateObj.state}\n        .icon=${this.overrideIcon || stateIcon(stateObj)}\n      ></ha-icon>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (!changedProps.has(\"stateObj\") || !this.stateObj) {\n      return;\n    }\n    const stateObj = this.stateObj;\n\n    const iconStyle: Partial<CSSStyleDeclaration> = {\n      color: \"\",\n      filter: \"\",\n    };\n    const hostStyle: Partial<CSSStyleDeclaration> = {\n      backgroundImage: \"\",\n    };\n    if (stateObj) {\n      // hide icon if we have entity picture\n      if (stateObj.attributes.entity_picture && !this.overrideIcon) {\n        hostStyle.backgroundImage =\n          \"url(\" + stateObj.attributes.entity_picture + \")\";\n        iconStyle.display = \"none\";\n      } else {\n        if (stateObj.attributes.hs_color) {\n          const hue = stateObj.attributes.hs_color[0];\n          const sat = stateObj.attributes.hs_color[1];\n          if (sat > 10) {\n            iconStyle.color = `hsl(${hue}, 100%, ${100 - sat / 2}%)`;\n          }\n        }\n        if (stateObj.attributes.brightness) {\n          const brightness = stateObj.attributes.brightness;\n          if (typeof brightness !== \"number\") {\n            const errorMessage = `Type error: state-badge expected number, but type of ${\n              stateObj.entity_id\n            }.attributes.brightness is ${typeof brightness} (${brightness})`;\n            // tslint:disable-next-line\n            console.warn(errorMessage);\n          }\n          // lowest brighntess will be around 50% (that's pretty dark)\n          iconStyle.filter = `brightness(${(brightness + 245) / 5}%)`;\n        }\n      }\n    }\n    Object.assign(this._icon.style, iconStyle);\n    Object.assign(this.style, hostStyle);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        position: relative;\n        display: inline-block;\n        width: 40px;\n        color: var(--paper-item-icon-color, #44739e);\n        border-radius: 50%;\n        height: 40px;\n        text-align: center;\n        background-size: cover;\n        line-height: 40px;\n      }\n\n      ha-icon {\n        transition: color 0.3s ease-in-out, filter 0.3s ease-in-out;\n      }\n\n      /* Color the icon if light or sun is on */\n      ha-icon[data-domain=\"light\"][data-state=\"on\"],\n      ha-icon[data-domain=\"switch\"][data-state=\"on\"],\n      ha-icon[data-domain=\"binary_sensor\"][data-state=\"on\"],\n      ha-icon[data-domain=\"fan\"][data-state=\"on\"],\n      ha-icon[data-domain=\"sun\"][data-state=\"above_horizon\"] {\n        color: var(--paper-item-icon-active-color, #fdd835);\n      }\n\n      /* Color the icon if unavailable */\n      ha-icon[data-state=\"unavailable\"] {\n        color: var(--state-icon-unavailable-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"state-badge\": StateBadge;\n  }\n}\n\ncustomElements.define(\"state-badge\", StateBadge);\n","import { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaClimateState extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          white-space: nowrap;\n        }\n\n        .target {\n          color: var(--primary-text-color);\n        }\n\n        .current {\n          color: var(--secondary-text-color);\n        }\n\n        .state-label {\n          font-weight: bold;\n          text-transform: capitalize;\n        }\n\n        .unit {\n          display: inline-block;\n          direction: ltr;\n        }\n      </style>\n\n      <div class=\"target\">\n        <template is=\"dom-if\" if=\"[[_hasKnownState(stateObj.state)]]\">\n          <span class=\"state-label\"> [[_localizeState(stateObj.state)]] </span>\n        </template>\n        <div class=\"unit\">[[computeTarget(hass, stateObj)]]</div>\n      </div>\n\n      <template is=\"dom-if\" if=\"[[currentStatus]]\">\n        <div class=\"current\">\n          [[localize('ui.card.climate.currently')]]:\n          <div class=\"unit\">[[currentStatus]]</div>\n        </div>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      stateObj: Object,\n      currentStatus: {\n        type: String,\n        computed: \"computeCurrentStatus(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeCurrentStatus(hass, stateObj) {\n    if (!hass || !stateObj) return null;\n    if (stateObj.attributes.current_temperature != null) {\n      return `${stateObj.attributes.current_temperature} ${\n        hass.config.unit_system.temperature\n      }`;\n    }\n    if (stateObj.attributes.current_humidity != null) {\n      return `${stateObj.attributes.current_humidity} %`;\n    }\n    return null;\n  }\n\n  computeTarget(hass, stateObj) {\n    if (!hass || !stateObj) return null;\n    // We're using \"!= null\" on purpose so that we match both null and undefined.\n    if (\n      stateObj.attributes.target_temp_low != null &&\n      stateObj.attributes.target_temp_high != null\n    ) {\n      return `${stateObj.attributes.target_temp_low} - ${\n        stateObj.attributes.target_temp_high\n      } ${hass.config.unit_system.temperature}`;\n    }\n    if (stateObj.attributes.temperature != null) {\n      return `${stateObj.attributes.temperature} ${\n        hass.config.unit_system.temperature\n      }`;\n    }\n    if (\n      stateObj.attributes.target_humidity_low != null &&\n      stateObj.attributes.target_humidity_high != null\n    ) {\n      return `${stateObj.attributes.target_humidity_low} - ${\n        stateObj.attributes.target_humidity_high\n      } %`;\n    }\n    if (stateObj.attributes.humidity != null) {\n      return `${stateObj.attributes.humidity} %`;\n    }\n\n    return \"\";\n  }\n\n  _hasKnownState(state) {\n    return state !== \"unknown\";\n  }\n\n  _localizeState(state) {\n    return this.localize(`state.climate.${state}`) || state;\n  }\n}\ncustomElements.define(\"ha-climate-state\", HaClimateState);\n","import \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport CoverEntity from \"../util/cover-model\";\n\nclass HaCoverControls extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        .state {\n          white-space: nowrap;\n        }\n        [invisible] {\n          visibility: hidden !important;\n        }\n      </style>\n\n      <div class=\"state\">\n        <paper-icon-button\n          icon=\"hass:arrow-up\"\n          on-click=\"onOpenTap\"\n          invisible$=\"[[!entityObj.supportsOpen]]\"\n          disabled=\"[[computeOpenDisabled(stateObj, entityObj)]]\"\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:stop\"\n          on-click=\"onStopTap\"\n          invisible$=\"[[!entityObj.supportsStop]]\"\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:arrow-down\"\n          on-click=\"onCloseTap\"\n          invisible$=\"[[!entityObj.supportsClose]]\"\n          disabled=\"[[computeClosedDisabled(stateObj, entityObj)]]\"\n        ></paper-icon-button>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      stateObj: {\n        type: Object,\n      },\n      entityObj: {\n        type: Object,\n        computed: \"computeEntityObj(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeEntityObj(hass, stateObj) {\n    return new CoverEntity(hass, stateObj);\n  }\n\n  computeOpenDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return (entityObj.isFullyOpen || entityObj.isOpening) && !assumedState;\n  }\n\n  computeClosedDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return (entityObj.isFullyClosed || entityObj.isClosing) && !assumedState;\n  }\n\n  onOpenTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.openCover();\n  }\n\n  onCloseTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.closeCover();\n  }\n\n  onStopTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.stopCover();\n  }\n}\n\ncustomElements.define(\"ha-cover-controls\", HaCoverControls);\n","import \"@polymer/iron-flex-layout/iron-flex-layout-classes\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport CoverEntity from \"../util/cover-model\";\n\nclass HaCoverTiltControls extends PolymerElement {\n  static get template() {\n    return html`\n      <style include=\"iron-flex\"></style>\n      <style>\n        :host {\n          white-space: nowrap;\n        }\n        [invisible] {\n          visibility: hidden !important;\n        }\n      </style>\n      <paper-icon-button\n        icon=\"hass:arrow-top-right\"\n        on-click=\"onOpenTiltTap\"\n        title=\"Open tilt\"\n        invisible$=\"[[!entityObj.supportsOpenTilt]]\"\n        disabled=\"[[computeOpenDisabled(stateObj, entityObj)]]\"\n      ></paper-icon-button>\n      <paper-icon-button\n        icon=\"hass:stop\"\n        on-click=\"onStopTiltTap\"\n        invisible$=\"[[!entityObj.supportsStopTilt]]\"\n        title=\"Stop tilt\"\n      ></paper-icon-button>\n      <paper-icon-button\n        icon=\"hass:arrow-bottom-left\"\n        on-click=\"onCloseTiltTap\"\n        title=\"Close tilt\"\n        invisible$=\"[[!entityObj.supportsCloseTilt]]\"\n        disabled=\"[[computeClosedDisabled(stateObj, entityObj)]]\"\n      ></paper-icon-button>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      stateObj: {\n        type: Object,\n      },\n      entityObj: {\n        type: Object,\n        computed: \"computeEntityObj(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeEntityObj(hass, stateObj) {\n    return new CoverEntity(hass, stateObj);\n  }\n\n  computeOpenDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return entityObj.isFullyOpenTilt && !assumedState;\n  }\n\n  computeClosedDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return entityObj.isFullyClosedTilt && !assumedState;\n  }\n\n  onOpenTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.openCoverTilt();\n  }\n\n  onCloseTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.closeCoverTilt();\n  }\n\n  onStopTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.stopCoverTilt();\n  }\n}\n\ncustomElements.define(\"ha-cover-tilt-controls\", HaCoverTiltControls);\n","import { Constructor } from \"lit-element\";\nimport \"@polymer/iron-icon/iron-icon\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { IronIconElement } from \"@polymer/iron-icon/iron-icon\";\n\nconst ironIconClass = customElements.get(\"iron-icon\") as Constructor<\n  IronIconElement\n>;\n\nlet loaded = false;\n\nexport class HaIcon extends ironIconClass {\n  private _iconsetName?: string;\n\n  public listen(\n    node: EventTarget | null,\n    eventName: string,\n    methodName: string\n  ): void {\n    super.listen(node, eventName, methodName);\n\n    if (!loaded && this._iconsetName === \"mdi\") {\n      loaded = true;\n      import(/* webpackChunkName: \"mdi-icons\" */ \"../resources/mdi-icons\");\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n\ncustomElements.define(\"ha-icon\", HaIcon);\n","import { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { EventsMixin } from \"../mixins/events-mixin\";\n\nlet loaded = null;\n\n/**\n * White list allowed svg tag.\n * Only put in the tag used in QR code, can be extend in future.\n */\nconst svgWhiteList = [\"svg\", \"path\"];\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaMarkdown extends EventsMixin(PolymerElement) {\n  static get properties() {\n    return {\n      content: {\n        type: String,\n        observer: \"_render\",\n      },\n      allowSvg: {\n        type: Boolean,\n        value: false,\n      },\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    // 0 = not loaded, 1 = success, 2 = error\n    this._scriptLoaded = 0;\n    this._renderScheduled = false;\n    this._resize = () => this.fire(\"iron-resize\");\n\n    if (!loaded) {\n      loaded = import(/* webpackChunkName: \"load_markdown\" */ \"../resources/load_markdown\");\n    }\n    loaded\n      .then(\n        ({ marked, filterXSS }) => {\n          this.marked = marked;\n          this.filterXSS = filterXSS;\n          this._scriptLoaded = 1;\n        },\n        () => {\n          this._scriptLoaded = 2;\n        }\n      )\n      .then(() => this._render());\n  }\n\n  _render() {\n    if (this._scriptLoaded === 0 || this._renderScheduled) return;\n\n    this._renderScheduled = true;\n\n    // debounce it to next microtask.\n    Promise.resolve().then(() => {\n      this._renderScheduled = false;\n\n      if (this._scriptLoaded === 1) {\n        this.innerHTML = this.filterXSS(\n          this.marked(this.content, {\n            gfm: true,\n            tables: true,\n            breaks: true,\n          }),\n          {\n            onIgnoreTag: this.allowSvg\n              ? (tag, html) => (svgWhiteList.indexOf(tag) >= 0 ? html : null)\n              : null,\n          }\n        );\n        this._resize();\n\n        const walker = document.createTreeWalker(\n          this,\n          1 /* SHOW_ELEMENT */,\n          null,\n          false\n        );\n\n        while (walker.nextNode()) {\n          const node = walker.currentNode;\n\n          // Open external links in a new window\n          if (node.tagName === \"A\" && node.host !== document.location.host) {\n            node.target = \"_blank\";\n\n            // Fire a resize event when images loaded to notify content resized\n          } else if (node.tagName === \"IMG\") {\n            node.addEventListener(\"load\", this._resize);\n          }\n        }\n      } else if (this._scriptLoaded === 2) {\n        this.innerText = this.content;\n      }\n    });\n  }\n}\n\ncustomElements.define(\"ha-markdown\", HaMarkdown);\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport { Constructor } from \"lit-element\";\nimport { PolymerElement } from \"@polymer/polymer\";\n\nconst paperDropdownClass = customElements.get(\n  \"paper-dropdown-menu\"\n) as Constructor<PolymerElement>;\n\n// patches paper drop down to properly support RTL - https://github.com/PolymerElements/paper-dropdown-menu/issues/183\nexport class HaPaperDropdownClass extends paperDropdownClass {\n  public ready() {\n    super.ready();\n    // wait to check for direction since otherwise direction is wrong even though top level is RTL\n    setTimeout(() => {\n      if (window.getComputedStyle(this).direction === \"rtl\") {\n        this.style.textAlign = \"right\";\n      }\n    }, 100);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-paper-dropdown-menu\": HaPaperDropdownClass;\n  }\n}\n\ncustomElements.define(\"ha-paper-dropdown-menu\", HaPaperDropdownClass);\n","import { dom } from \"@polymer/polymer/lib/legacy/polymer.dom\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport relativeTime from \"../common/datetime/relative_time\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaRelativeTime extends LocalizeMixin(PolymerElement) {\n  static get properties() {\n    return {\n      hass: Object,\n      datetime: {\n        type: String,\n        observer: \"datetimeChanged\",\n      },\n\n      datetimeObj: {\n        type: Object,\n        observer: \"datetimeObjChanged\",\n      },\n\n      parsedDateTime: Object,\n    };\n  }\n\n  constructor() {\n    super();\n    this.updateRelative = this.updateRelative.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    // update every 60 seconds\n    this.updateInterval = setInterval(this.updateRelative, 60000);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    clearInterval(this.updateInterval);\n  }\n\n  datetimeChanged(newVal) {\n    this.parsedDateTime = newVal ? new Date(newVal) : null;\n\n    this.updateRelative();\n  }\n\n  datetimeObjChanged(newVal) {\n    this.parsedDateTime = newVal;\n\n    this.updateRelative();\n  }\n\n  updateRelative() {\n    const root = dom(this);\n    if (!this.parsedDateTime) {\n      root.innerHTML = this.localize(\"ui.components.relative_time.never\");\n    } else {\n      root.innerHTML = relativeTime(this.parsedDateTime, this.localize);\n    }\n  }\n}\n\ncustomElements.define(\"ha-relative-time\", HaRelativeTime);\n","import \"@polymer/paper-slider\";\n\nconst PaperSliderClass = customElements.get(\"paper-slider\");\nlet subTemplate;\n\nclass HaSlider extends PaperSliderClass {\n  static get template() {\n    if (!subTemplate) {\n      subTemplate = PaperSliderClass.template.cloneNode(true);\n\n      const superStyle = subTemplate.content.querySelector(\"style\");\n\n      // append style to add mirroring of pin in RTL\n      superStyle.appendChild(\n        document.createTextNode(`\n          :host([dir=\"rtl\"]) #sliderContainer.pin.expand > .slider-knob > .slider-knob-inner::after {\n            -webkit-transform: scale(1) translate(0, -17px) scaleX(-1) !important;\n            transform: scale(1) translate(0, -17px) scaleX(-1) !important;\n            }\n        `)\n      );\n    }\n    return subTemplate;\n  }\n\n  _calcStep(value) {\n    if (!this.step) {\n      return parseFloat(value);\n    }\n\n    const numSteps = Math.round((value - this.min) / this.step);\n    const stepStr = this.step.toString();\n    const stepPointAt = stepStr.indexOf(\".\");\n    if (stepPointAt !== -1) {\n      /**\n       * For small values of this.step, if we calculate the step using\n       * For non-integer values of this.step, if we calculate the step using\n       * `Math.round(value / step) * step` we may hit a precision point issue\n       * eg. 0.1 * 0.2 =  0.020000000000000004\n       * http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\n       *\n       * as a work around we can round with the decimal precision of `step`\n       */\n      const precision = 10 ** (stepStr.length - stepPointAt - 1);\n      return (\n        Math.round((numSteps * this.step + this.min) * precision) / precision\n      );\n    }\n\n    return numSteps * this.step + this.min;\n  }\n}\ncustomElements.define(\"ha-slider\", HaSlider);\n","/**\nAdapted from paper-time-input from\nhttps://github.com/ryanburns23/paper-time-input\nMIT Licensed. Copyright (c) 2017 Ryan Burns\n\n`<paper-time-input>` Polymer element to accept a time with paper-input & paper-dropdown-menu\nInspired by the time input in google forms\n\n### Styling\n\n`<paper-time-input>` provides the following custom properties and mixins for styling:\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-time-input-dropdown-ripple-color` | dropdown ripple color | `--primary-color`\n`--paper-time-input-cotnainer` | Mixin applied to the inputs | `{}`\n`--paper-time-dropdown-input-cotnainer` | Mixin applied to the dropdown input | `{}`\n*/\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nexport class PaperTimeInput extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          @apply --paper-font-common-base;\n        }\n\n        paper-input {\n          width: 30px;\n          text-align: center;\n          --paper-input-container-input: {\n            /* Damn you firefox\n             * Needed to hide spin num in firefox\n             * http://stackoverflow.com/questions/3790935/can-i-hide-the-html5-number-input-s-spin-box\n             */\n            -moz-appearance: textfield;\n            @apply --paper-time-input-cotnainer;\n          }\n          --paper-input-container-input-webkit-spinner: {\n            -webkit-appearance: none;\n            margin: 0;\n            display: none;\n          }\n          --paper-input-container-shared-input-style_-_-webkit-appearance: textfield;\n        }\n\n        paper-dropdown-menu {\n          width: 55px;\n          padding: 0;\n          /* Force ripple to use the whole container */\n          --paper-dropdown-menu-ripple: {\n            color: var(\n              --paper-time-input-dropdown-ripple-color,\n              var(--primary-color)\n            );\n          }\n          --paper-input-container-input: {\n            @apply --paper-font-button;\n            text-align: center;\n            padding-left: 5px;\n            @apply --paper-time-dropdown-input-cotnainer;\n          }\n          --paper-input-container-underline: {\n            border-color: transparent;\n          }\n          --paper-input-container-underline-focus: {\n            border-color: transparent;\n          }\n        }\n\n        paper-item {\n          cursor: pointer;\n          text-align: center;\n          font-size: 14px;\n        }\n\n        paper-listbox {\n          padding: 0;\n        }\n\n        label {\n          @apply --paper-font-caption;\n        }\n\n        .time-input-wrap {\n          @apply --layout-horizontal;\n          @apply --layout-no-wrap;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      </style>\n\n      <label hidden$=\"[[hideLabel]]\">[[label]]</label>\n      <div class=\"time-input-wrap\">\n        <!-- Hour Input -->\n        <paper-input\n          id=\"hour\"\n          type=\"number\"\n          value=\"{{hour}}\"\n          on-change=\"_shouldFormatHour\"\n          required=\"\"\n          auto-validate=\"[[autoValidate]]\"\n          prevent-invalid-input=\"\"\n          maxlength=\"2\"\n          max=\"[[_computeHourMax(format)]]\"\n          min=\"0\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n          <span suffix=\"\" slot=\"suffix\">:</span>\n        </paper-input>\n\n        <!-- Min Input -->\n        <paper-input\n          id=\"min\"\n          type=\"number\"\n          value=\"{{min}}\"\n          on-change=\"_formatMin\"\n          required=\"\"\n          auto-validate=\"[[autoValidate]]\"\n          prevent-invalid-input=\"\"\n          maxlength=\"2\"\n          max=\"59\"\n          min=\"0\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n        </paper-input>\n\n        <!-- Dropdown Menu -->\n        <paper-dropdown-menu\n          id=\"dropdown\"\n          required=\"\"\n          hidden$=\"[[_equal(format, 24)]]\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n          <paper-listbox\n            attr-for-selected=\"name\"\n            selected=\"{{amPm}}\"\n            slot=\"dropdown-content\"\n          >\n            <paper-item name=\"AM\">AM</paper-item>\n            <paper-item name=\"PM\">PM</paper-item>\n          </paper-listbox>\n        </paper-dropdown-menu>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      /**\n       * Label for the input\n       */\n      label: {\n        type: String,\n        value: \"Time\",\n      },\n      /**\n       * auto validate time inputs\n       */\n      autoValidate: {\n        type: Boolean,\n        value: true,\n      },\n      /**\n       * hides the label\n       */\n      hideLabel: {\n        type: Boolean,\n        value: false,\n      },\n      /**\n       * 12 or 24 hr format\n       */\n      format: {\n        type: Number,\n        value: 12,\n      },\n      /**\n       * disables the inputs\n       */\n      disabled: {\n        type: Boolean,\n        value: false,\n      },\n      /**\n       * hour\n       */\n      hour: {\n        type: String,\n        notify: true,\n      },\n      /**\n       * minute\n       */\n      min: {\n        type: String,\n        notify: true,\n      },\n      /**\n       * AM or PM\n       */\n      amPm: {\n        type: String,\n        notify: true,\n        value: \"AM\",\n      },\n      /**\n       * Formatted time string\n       */\n      value: {\n        type: String,\n        notify: true,\n        readOnly: true,\n        computed: \"_computeTime(min, hour, amPm)\",\n      },\n    };\n  }\n\n  /**\n   * Validate the inputs\n   * @return {boolean}\n   */\n  validate() {\n    var valid = true;\n    // Validate hour & min fields\n    if (!this.$.hour.validate() | !this.$.min.validate()) {\n      valid = false;\n    }\n    // Validate AM PM if 12 hour time\n    if (this.format === 12 && !this.$.dropdown.validate()) {\n      valid = false;\n    }\n    return valid;\n  }\n\n  /**\n   * Create time string\n   */\n  _computeTime(min, hour, amPm) {\n    if (hour && min) {\n      // No ampm on 24 hr time\n      if (this.format === 24) {\n        amPm = \"\";\n      }\n      return hour + \":\" + min + \" \" + amPm;\n    }\n    return undefined;\n  }\n\n  /**\n   * Format min\n   */\n  _formatMin() {\n    if (this.min.toString().length === 1) {\n      this.min = this.min < 10 ? \"0\" + this.min : this.min;\n    }\n  }\n\n  /**\n   * Hour needs a leading zero in 24hr format\n   */\n  _shouldFormatHour() {\n    if (this.format === 24 && this.hour.toString().length === 1) {\n      this.hour = this.hour < 10 ? \"0\" + this.hour : this.hour;\n    }\n  }\n\n  /**\n   * 24 hour format has a max hr of 23\n   */\n  _computeHourMax(format) {\n    if (format === 12) {\n      return format;\n    }\n    return 23;\n  }\n\n  _equal(n1, n2) {\n    return n1 === n2;\n  }\n}\n\ncustomElements.define(\"paper-time-input\", PaperTimeInput);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./entity/ha-chart-base\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\nimport formatDateTime from \"../common/datetime/format_date_time\";\n\nclass StateHistoryChartLine extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          overflow: hidden;\n          height: 0;\n          transition: height 0.3s ease-in-out;\n        }\n      </style>\n      <ha-chart-base\n        id=\"chart\"\n        data=\"[[chartData]]\"\n        identifier=\"[[identifier]]\"\n        rendered=\"{{rendered}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      chartData: Object,\n      data: Object,\n      names: Object,\n      unit: String,\n      identifier: String,\n\n      isSingleDevice: {\n        type: Boolean,\n        value: false,\n      },\n\n      endTime: Object,\n      rendered: {\n        type: Boolean,\n        value: false,\n        observer: \"_onRenderedChanged\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, isSingleDevice)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  _onRenderedChanged(rendered) {\n    if (rendered) this.animateHeight();\n  }\n\n  animateHeight() {\n    requestAnimationFrame(() =>\n      requestAnimationFrame(() => {\n        this.style.height = this.$.chart.scrollHeight + \"px\";\n      })\n    );\n  }\n\n  drawChart() {\n    const unit = this.unit;\n    const deviceStates = this.data;\n    const datasets = [];\n    let endTime;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (deviceStates.length === 0) {\n      return;\n    }\n\n    function safeParseFloat(value) {\n      const parsed = parseFloat(value);\n      return isFinite(parsed) ? parsed : null;\n    }\n\n    endTime =\n      this.endTime ||\n      // Get the highest date from the last date of each device\n      new Date(\n        Math.max.apply(\n          null,\n          deviceStates.map(\n            (devSts) =>\n              new Date(devSts.states[devSts.states.length - 1].last_changed)\n          )\n        )\n      );\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const names = this.names || {};\n    deviceStates.forEach((states) => {\n      const domain = states.domain;\n      const name = names[states.entity_id] || states.name;\n      // array containing [value1, value2, etc]\n      let prevValues;\n      const data = [];\n\n      function pushData(timestamp, datavalues) {\n        if (!datavalues) return;\n        if (timestamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is \"now\" and client time is not in sync with server time.\n          return;\n        }\n        data.forEach((d, i) => {\n          d.data.push({ x: timestamp, y: datavalues[i] });\n        });\n        prevValues = datavalues;\n      }\n\n      function addColumn(nameY, step, fill) {\n        let dataFill = false;\n        let dataStep = false;\n        if (fill) {\n          dataFill = \"origin\";\n        }\n        if (step) {\n          dataStep = \"before\";\n        }\n        data.push({\n          label: nameY,\n          fill: dataFill,\n          steppedLine: dataStep,\n          pointRadius: 0,\n          data: [],\n          unitText: unit,\n        });\n      }\n\n      if (\n        domain === \"thermostat\" ||\n        domain === \"climate\" ||\n        domain === \"water_heater\"\n      ) {\n        // We differentiate between thermostats that have a target temperature\n        // range versus ones that have just a target temperature\n\n        // Using step chart by step-before so manually interpolation not needed.\n        const hasTargetRange = states.states.some(\n          (state) =>\n            state.attributes &&\n            state.attributes.target_temp_high !==\n              state.attributes.target_temp_low\n        );\n        const hasHeat = states.states.some((state) => state.state === \"heat\");\n        const hasCool = states.states.some((state) => state.state === \"cool\");\n\n        addColumn(name + \" current temperature\", true);\n        if (hasHeat) {\n          addColumn(name + \" heating\", true, true);\n          // The \"heating\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n        if (hasCool) {\n          addColumn(name + \" cooling\", true, true);\n          // The \"cooling\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n\n        if (hasTargetRange) {\n          addColumn(name + \" target temperature high\", true);\n          addColumn(name + \" target temperature low\", true);\n        } else {\n          addColumn(name + \" target temperature\", true);\n        }\n\n        states.states.forEach((state) => {\n          if (!state.attributes) return;\n          const curTemp = safeParseFloat(state.attributes.current_temperature);\n          const series = [curTemp];\n          if (hasHeat) {\n            series.push(state.state === \"heat\" ? curTemp : null);\n          }\n          if (hasCool) {\n            series.push(state.state === \"cool\" ? curTemp : null);\n          }\n          if (hasTargetRange) {\n            const targetHigh = safeParseFloat(\n              state.attributes.target_temp_high\n            );\n            const targetLow = safeParseFloat(state.attributes.target_temp_low);\n            series.push(targetHigh, targetLow);\n            pushData(new Date(state.last_changed), series);\n          } else {\n            const target = safeParseFloat(state.attributes.temperature);\n            series.push(target);\n            pushData(new Date(state.last_changed), series);\n          }\n        });\n      } else {\n        // Only disable interpolation for sensors\n        const isStep = domain === \"sensor\";\n        addColumn(name, isStep);\n\n        let lastValue = null;\n        let lastDate = null;\n        let lastNullDate = null;\n\n        // Process chart data.\n        // When state is `unknown`, calculate the value and break the line.\n        states.states.forEach((state) => {\n          const value = safeParseFloat(state.state);\n          const date = new Date(state.last_changed);\n          if (value !== null && lastNullDate !== null) {\n            const dateTime = date.getTime();\n            const lastNullDateTime = lastNullDate.getTime();\n            const lastDateTime = lastDate.getTime();\n            const tmpValue =\n              (value - lastValue) *\n                ((lastNullDateTime - lastDateTime) /\n                  (dateTime - lastDateTime)) +\n              lastValue;\n            pushData(lastNullDate, [tmpValue]);\n            pushData(new Date(lastNullDateTime + 1), [null]);\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n            lastNullDate = null;\n          } else if (value !== null && lastNullDate === null) {\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n          } else if (\n            value === null &&\n            lastNullDate === null &&\n            lastValue !== null\n          ) {\n            lastNullDate = date;\n          }\n        });\n      }\n\n      // Add an entry for final values\n      pushData(endTime, prevValues, false);\n\n      // Concat two arrays\n      Array.prototype.push.apply(datasets, data);\n    });\n\n    const formatTooltipTitle = (items, data) => {\n      const item = items[0];\n      const date = data.datasets[item.datasetIndex].data[item.index].x;\n\n      return formatDateTime(date, this.hass.language);\n    };\n\n    const chartOptions = {\n      type: \"line\",\n      unit: unit,\n      legend: !this.isSingleDevice,\n      options: {\n        scales: {\n          xAxes: [\n            {\n              type: \"time\",\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              ticks: {\n                maxTicksLimit: 7,\n              },\n            },\n          ],\n        },\n        tooltips: {\n          mode: \"neareach\",\n          callbacks: {\n            title: formatTooltipTitle,\n          },\n        },\n        hover: {\n          mode: \"neareach\",\n        },\n        layout: {\n          padding: {\n            top: 5,\n          },\n        },\n        elements: {\n          line: {\n            tension: 0.1,\n            pointRadius: 0,\n            borderWidth: 1.5,\n          },\n          point: {\n            hitRadius: 5,\n          },\n        },\n        plugins: {\n          filler: {\n            propagate: true,\n          },\n        },\n      },\n      data: {\n        labels: [],\n        datasets: datasets,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n}\ncustomElements.define(\"state-history-chart-line\", StateHistoryChartLine);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport \"./entity/ha-chart-base\";\n\nimport formatDateTime from \"../common/datetime/format_date_time\";\nimport { computeRTL } from \"../common/util/compute_rtl\";\n\nclass StateHistoryChartTimeline extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          opacity: 0;\n          transition: opacity 0.3s ease-in-out;\n        }\n        :host([rendered]) {\n          opacity: 1;\n        }\n\n        ha-chart-base {\n          direction: ltr;\n        }\n      </style>\n      <ha-chart-base\n        data=\"[[chartData]]\"\n        rendered=\"{{rendered}}\"\n        rtl=\"{{rtl}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      chartData: Object,\n      data: {\n        type: Object,\n        observer: \"dataChanged\",\n      },\n      names: Object,\n      noSingle: Boolean,\n      endTime: Date,\n      rendered: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true,\n      },\n      rtl: {\n        reflectToAttribute: true,\n        computed: \"_computeRTL(hass)\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, localize, language)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  drawChart() {\n    const staticColors = {\n      on: 1,\n      off: 0,\n      unavailable: \"#a0a0a0\",\n      unknown: \"#606060\",\n      idle: 2,\n    };\n    let stateHistory = this.data;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (!stateHistory) {\n      stateHistory = [];\n    }\n\n    const startTime = new Date(\n      stateHistory.reduce(\n        (minTime, stateInfo) =>\n          Math.min(minTime, new Date(stateInfo.data[0].last_changed)),\n        new Date()\n      )\n    );\n\n    // end time is Math.max(startTime, last_event)\n    let endTime =\n      this.endTime ||\n      new Date(\n        stateHistory.reduce(\n          (maxTime, stateInfo) =>\n            Math.max(\n              maxTime,\n              new Date(stateInfo.data[stateInfo.data.length - 1].last_changed)\n            ),\n          startTime\n        )\n      );\n\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const labels = [];\n    const datasets = [];\n    // stateHistory is a list of lists of sorted state objects\n    const names = this.names || {};\n    stateHistory.forEach((stateInfo) => {\n      let newLastChanged;\n      let prevState = null;\n      let locState = null;\n      let prevLastChanged = startTime;\n      const entityDisplay = names[stateInfo.entity_id] || stateInfo.name;\n\n      const dataRow = [];\n      stateInfo.data.forEach((state) => {\n        let newState = state.state;\n        const timeStamp = new Date(state.last_changed);\n        if (newState === undefined || newState === \"\") {\n          newState = null;\n        }\n        if (timeStamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is 'now' and client time is not in sync with server time.\n          return;\n        }\n        if (prevState !== null && newState !== prevState) {\n          newLastChanged = new Date(state.last_changed);\n\n          dataRow.push([prevLastChanged, newLastChanged, locState, prevState]);\n\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = newLastChanged;\n        } else if (prevState === null) {\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = new Date(state.last_changed);\n        }\n      });\n\n      if (prevState !== null) {\n        dataRow.push([prevLastChanged, endTime, locState, prevState]);\n      }\n      datasets.push({ data: dataRow });\n      labels.push(entityDisplay);\n    });\n\n    const formatTooltipLabel = (item, data) => {\n      const values = data.datasets[item.datasetIndex].data[item.index];\n\n      const start = formatDateTime(values[0], this.hass.language);\n      const end = formatDateTime(values[1], this.hass.language);\n      const state = values[2];\n\n      return [state, start, end];\n    };\n\n    const chartOptions = {\n      type: \"timeline\",\n      options: {\n        tooltips: {\n          callbacks: {\n            label: formatTooltipLabel,\n          },\n        },\n        scales: {\n          xAxes: [\n            {\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              afterSetDimensions: (yaxe) => {\n                yaxe.maxWidth = yaxe.chart.width * 0.18;\n              },\n              position: this._computeRTL ? \"right\" : \"left\",\n            },\n          ],\n        },\n      },\n      data: {\n        labels: labels,\n        datasets: datasets,\n      },\n      colors: {\n        staticColors: staticColors,\n        staticColorIndex: 3,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n\n  _computeRTL(hass) {\n    return computeRTL(hass);\n  }\n}\ncustomElements.define(\n  \"state-history-chart-timeline\",\n  StateHistoryChartTimeline\n);\n","import \"@polymer/paper-spinner/paper-spinner\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./state-history-chart-line\";\nimport \"./state-history-chart-timeline\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nclass StateHistoryCharts extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          /* height of single timeline chart = 58px */\n          min-height: 58px;\n        }\n        .info {\n          text-align: center;\n          line-height: 58px;\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsLoading(isLoadingData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.loading_history')]]\n        </div>\n      </template>\n\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsEmpty(isLoadingData, historyData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.no_history_found')]]\n        </div>\n      </template>\n\n      <template is=\"dom-if\" if=\"[[historyData.timeline.length]]\">\n        <state-history-chart-timeline\n          hass=\"[[hass]]\"\n          data=\"[[historyData.timeline]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          no-single=\"[[noSingle]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-timeline>\n      </template>\n\n      <template is=\"dom-repeat\" items=\"[[historyData.line]]\">\n        <state-history-chart-line\n          hass=\"[[hass]]\"\n          unit=\"[[item.unit]]\"\n          data=\"[[item.data]]\"\n          identifier=\"[[item.identifier]]\"\n          is-single-device=\"[[_computeIsSingleLineChart(item.data, noSingle)]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-line>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      historyData: {\n        type: Object,\n        value: null,\n      },\n      names: Object,\n\n      isLoadingData: Boolean,\n\n      endTime: {\n        type: Object,\n      },\n\n      upToNow: Boolean,\n      noSingle: Boolean,\n    };\n  }\n\n  _computeIsSingleLineChart(data, noSingle) {\n    return !noSingle && data && data.length === 1;\n  }\n\n  _computeIsEmpty(isLoadingData, historyData) {\n    const historyDataEmpty =\n      !historyData ||\n      !historyData.timeline ||\n      !historyData.line ||\n      (historyData.timeline.length === 0 && historyData.line.length === 0);\n    return !isLoadingData && historyDataEmpty;\n  }\n\n  _computeIsLoading(isLoading) {\n    return isLoading && !this.historyData;\n  }\n\n  _computeEndTime(endTime, upToNow) {\n    // We don't really care about the value of historyData, but if it change we want to update\n    // endTime.\n    return upToNow ? new Date() : endTime;\n  }\n}\ncustomElements.define(\"state-history-charts\", StateHistoryCharts);\n","import { HomeAssistant } from \"../types\";\n\nexport interface AuthProvider {\n  name: string;\n  id: string;\n  type: string;\n}\n\nexport interface Credential {\n  type: string;\n}\n\nexport interface SignedPath {\n  path: string;\n}\n\nexport const hassUrl = `${location.protocol}//${location.host}`;\n\nexport const getSignedPath = (\n  hass: HomeAssistant,\n  path: string\n): Promise<SignedPath> => hass.callWS({ type: \"auth/sign_path\", path });\n\nexport const fetchAuthProviders = () =>\n  fetch(\"/auth/providers\", {\n    credentials: \"same-origin\",\n  });\n","import {\n  computeHistory,\n  fetchRecent,\n  HistoryResult,\n  TimelineEntity,\n  LineChartUnit,\n} from \"./history\";\nimport { HomeAssistant } from \"../types\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\ninterface CacheConfig {\n  refresh: number;\n  cacheKey: string;\n  hoursToShow: number;\n}\n\ninterface CachedResults {\n  prom: Promise<HistoryResult>;\n  startTime: Date;\n  endTime: Date;\n  language: string;\n  data: HistoryResult;\n}\n\n// This is a different interface, a different cache :(\ninterface RecentCacheResults {\n  created: number;\n  language: string;\n  data: Promise<HistoryResult>;\n}\n\nconst RECENT_THRESHOLD = 60000; // 1 minute\nconst RECENT_CACHE: { [cacheKey: string]: RecentCacheResults } = {};\nconst stateHistoryCache: { [cacheKey: string]: CachedResults } = {};\n\n// Cached type 1 unction. Without cache config.\nexport const getRecent = (\n  hass: HomeAssistant,\n  entityId: string,\n  startTime: Date,\n  endTime: Date,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = entityId;\n  const cache = RECENT_CACHE[cacheKey];\n\n  if (\n    cache &&\n    Date.now() - cache.created < RECENT_THRESHOLD &&\n    cache.language === language\n  ) {\n    return cache.data;\n  }\n\n  const prom = fetchRecent(hass, entityId, startTime, endTime).then(\n    (stateHistory) => computeHistory(hass, stateHistory, localize, language),\n    (err) => {\n      delete RECENT_CACHE[entityId];\n      throw err;\n    }\n  );\n\n  RECENT_CACHE[cacheKey] = {\n    created: Date.now(),\n    language,\n    data: prom,\n  };\n  return prom;\n};\n\n// Cache type 2 functionality\nfunction getEmptyCache(\n  language: string,\n  startTime: Date,\n  endTime: Date\n): CachedResults {\n  return {\n    prom: Promise.resolve({ line: [], timeline: [] }),\n    language,\n    startTime,\n    endTime,\n    data: { line: [], timeline: [] },\n  };\n}\n\nexport const getRecentWithCache = (\n  hass: HomeAssistant,\n  entityId: string,\n  cacheConfig: CacheConfig,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = cacheConfig.cacheKey;\n  const endTime = new Date();\n  const startTime = new Date(endTime);\n  startTime.setHours(startTime.getHours() - cacheConfig.hoursToShow);\n  let toFetchStartTime = startTime;\n  let appendingToCache = false;\n\n  let cache = stateHistoryCache[cacheKey];\n  if (\n    cache &&\n    toFetchStartTime >= cache.startTime &&\n    toFetchStartTime <= cache.endTime &&\n    cache.language === language\n  ) {\n    toFetchStartTime = cache.endTime;\n    appendingToCache = true;\n    // This pretty much never happens as endTime is usually set to now\n    if (endTime <= cache.endTime) {\n      return cache.prom;\n    }\n  } else {\n    cache = stateHistoryCache[cacheKey] = getEmptyCache(\n      language,\n      startTime,\n      endTime\n    );\n  }\n\n  const curCacheProm = cache.prom;\n\n  const genProm = async () => {\n    let fetchedHistory: HassEntity[][];\n\n    try {\n      const results = await Promise.all([\n        curCacheProm,\n        fetchRecent(\n          hass,\n          entityId,\n          toFetchStartTime,\n          endTime,\n          appendingToCache\n        ),\n      ]);\n      fetchedHistory = results[1];\n    } catch (err) {\n      delete stateHistoryCache[cacheKey];\n      throw err;\n    }\n    const stateHistory = computeHistory(\n      hass,\n      fetchedHistory,\n      localize,\n      language\n    );\n    if (appendingToCache) {\n      mergeLine(stateHistory.line, cache.data.line);\n      mergeTimeline(stateHistory.timeline, cache.data.timeline);\n      pruneStartTime(startTime, cache.data);\n    } else {\n      cache.data = stateHistory;\n    }\n    return cache.data;\n  };\n\n  cache.prom = genProm();\n  cache.startTime = startTime;\n  cache.endTime = endTime;\n  return cache.prom;\n};\n\nconst mergeLine = (\n  historyLines: LineChartUnit[],\n  cacheLines: LineChartUnit[]\n) => {\n  historyLines.forEach((line) => {\n    const unit = line.unit;\n    const oldLine = cacheLines.find((cacheLine) => cacheLine.unit === unit);\n    if (oldLine) {\n      line.data.forEach((entity) => {\n        const oldEntity = oldLine.data.find(\n          (cacheEntity) => entity.entity_id === cacheEntity.entity_id\n        );\n        if (oldEntity) {\n          oldEntity.states = oldEntity.states.concat(entity.states);\n        } else {\n          oldLine.data.push(entity);\n        }\n      });\n    } else {\n      cacheLines.push(line);\n    }\n  });\n};\n\nconst mergeTimeline = (\n  historyTimelines: TimelineEntity[],\n  cacheTimelines: TimelineEntity[]\n) => {\n  historyTimelines.forEach((timeline) => {\n    const oldTimeline = cacheTimelines.find(\n      (cacheTimeline) => cacheTimeline.entity_id === timeline.entity_id\n    );\n    if (oldTimeline) {\n      oldTimeline.data = oldTimeline.data.concat(timeline.data);\n    } else {\n      cacheTimelines.push(timeline);\n    }\n  });\n};\n\nconst pruneArray = (originalStartTime: Date, arr) => {\n  if (arr.length === 0) {\n    return arr;\n  }\n  const changedAfterStartTime = arr.findIndex(\n    (state) => new Date(state.last_changed) > originalStartTime\n  );\n  if (changedAfterStartTime === 0) {\n    // If all changes happened after originalStartTime then we are done.\n    return arr;\n  }\n\n  // If all changes happened at or before originalStartTime. Use last index.\n  const updateIndex =\n    changedAfterStartTime === -1 ? arr.length - 1 : changedAfterStartTime - 1;\n  arr[updateIndex].last_changed = originalStartTime;\n  return arr.slice(updateIndex);\n};\n\nconst pruneStartTime = (originalStartTime: Date, cacheData: HistoryResult) => {\n  cacheData.line.forEach((line) => {\n    line.data.forEach((entity) => {\n      entity.states = pruneArray(originalStartTime, entity.states);\n    });\n  });\n\n  cacheData.timeline.forEach((timeline) => {\n    timeline.data = pruneArray(originalStartTime, timeline.data);\n  });\n};\n","import { HomeAssistant, CameraEntity } from \"../types\";\nimport { timeCachePromiseFunc } from \"../common/util/time-cache-function-promise\";\nimport { getSignedPath } from \"./auth\";\n\nexport const CAMERA_SUPPORT_ON_OFF = 1;\nexport const CAMERA_SUPPORT_STREAM = 2;\n\nexport interface CameraPreferences {\n  preload_stream: boolean;\n}\n\nexport interface CameraThumbnail {\n  content_type: string;\n  content: string;\n}\n\nexport interface Stream {\n  url: string;\n}\n\nexport const computeMJPEGStreamUrl = (entity: CameraEntity) =>\n  `/api/camera_proxy_stream/${entity.entity_id}?token=${\n    entity.attributes.access_token\n  }`;\n\nexport const fetchThumbnailUrlWithCache = (\n  hass: HomeAssistant,\n  entityId: string\n) =>\n  timeCachePromiseFunc(\n    \"_cameraTmbUrl\",\n    9000,\n    fetchThumbnailUrl,\n    hass,\n    entityId\n  );\n\nexport const fetchThumbnailUrl = (hass: HomeAssistant, entityId: string) =>\n  getSignedPath(hass, `/api/camera_proxy/${entityId}`).then(({ path }) => path);\n\nexport const fetchThumbnail = (hass: HomeAssistant, entityId: string) => {\n  // tslint:disable-next-line: no-console\n  console.warn(\"This method has been deprecated.\");\n  return hass.callWS<CameraThumbnail>({\n    type: \"camera_thumbnail\",\n    entity_id: entityId,\n  });\n};\n\nexport const fetchStreamUrl = (\n  hass: HomeAssistant,\n  entityId: string,\n  format?: \"hls\"\n) => {\n  const data = {\n    type: \"camera/stream\",\n    entity_id: entityId,\n  };\n  if (format) {\n    // @ts-ignore\n    data.format = format;\n  }\n  return hass.callWS<Stream>(data);\n};\n\nexport const fetchCameraPrefs = (hass: HomeAssistant, entityId: string) =>\n  hass.callWS<CameraPreferences>({\n    type: \"camera/get_prefs\",\n    entity_id: entityId,\n  });\n\nexport const updateCameraPrefs = (\n  hass: HomeAssistant,\n  entityId: string,\n  prefs: {\n    preload_stream?: boolean;\n  }\n) =>\n  hass.callWS<CameraPreferences>({\n    type: \"camera/update_prefs\",\n    entity_id: entityId,\n    ...prefs,\n  });\n","import { createCollection, Connection } from \"home-assistant-js-websocket\";\nimport { HomeAssistant } from \"../types\";\nimport computeStateName from \"../common/entity/compute_state_name\";\nimport { debounce } from \"../common/util/debounce\";\n\nexport interface EntityRegistryEntry {\n  entity_id: string;\n  name: string;\n  platform: string;\n  config_entry_id?: string;\n  device_id?: string;\n  disabled_by?: string;\n}\n\nexport interface EntityRegistryEntryUpdateParams {\n  name: string | null;\n  new_entity_id: string;\n}\n\nexport const computeEntityRegistryName = (\n  hass: HomeAssistant,\n  entry: EntityRegistryEntry\n): string | null => {\n  if (entry.name) {\n    return entry.name;\n  }\n  const state = hass.states[entry.entity_id];\n  return state ? computeStateName(state) : null;\n};\n\nexport const updateEntityRegistryEntry = (\n  hass: HomeAssistant,\n  entityId: string,\n  updates: Partial<EntityRegistryEntryUpdateParams>\n): Promise<EntityRegistryEntry> =>\n  hass.callWS<EntityRegistryEntry>({\n    type: \"config/entity_registry/update\",\n    entity_id: entityId,\n    ...updates,\n  });\n\nexport const removeEntityRegistryEntry = (\n  hass: HomeAssistant,\n  entityId: string\n): Promise<void> =>\n  hass.callWS({\n    type: \"config/entity_registry/remove\",\n    entity_id: entityId,\n  });\n\nconst fetchEntityRegistry = (conn) =>\n  conn.sendMessagePromise({\n    type: \"config/entity_registry/list\",\n  });\n\nconst subscribeEntityRegistryUpdates = (conn, store) =>\n  conn.subscribeEvents(\n    debounce(\n      () =>\n        fetchEntityRegistry(conn).then((entities) =>\n          store.setState(entities, true)\n        ),\n      500,\n      true\n    ),\n    \"entity_registry_updated\"\n  );\n\nexport const subscribeEntityRegistry = (\n  conn: Connection,\n  onChange: (entities: EntityRegistryEntry[]) => void\n) =>\n  createCollection<EntityRegistryEntry[]>(\n    \"_entityRegistry\",\n    fetchEntityRegistry,\n    subscribeEntityRegistryUpdates,\n    conn,\n    onChange\n  );\n","import { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport { computeHistory, fetchDate } from \"./history\";\nimport { getRecent, getRecentWithCache } from \"./cached-history\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaStateHistoryData extends LocalizeMixin(PolymerElement) {\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"hassChanged\",\n      },\n\n      filterType: String,\n\n      cacheConfig: Object,\n\n      startTime: Date,\n      endTime: Date,\n\n      entityId: String,\n\n      isLoading: {\n        type: Boolean,\n        value: true,\n        readOnly: true,\n        notify: true,\n      },\n\n      data: {\n        type: Object,\n        value: null,\n        readOnly: true,\n        notify: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\n      \"filterChangedDebouncer(filterType, entityId, startTime, endTime, cacheConfig, localize)\",\n    ];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.filterChangedDebouncer(\n      this.filterType,\n      this.entityId,\n      this.startTime,\n      this.endTime,\n      this.cacheConfig,\n      this.localize\n    );\n  }\n\n  disconnectedCallback() {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    super.disconnectedCallback();\n  }\n\n  hassChanged(newHass, oldHass) {\n    if (!oldHass && !this._madeFirstCall) {\n      this.filterChangedDebouncer(\n        this.filterType,\n        this.entityId,\n        this.startTime,\n        this.endTime,\n        this.cacheConfig,\n        this.localize\n      );\n    }\n  }\n\n  filterChangedDebouncer(...args) {\n    this._debounceFilterChanged = Debouncer.debounce(\n      this._debounceFilterChanged,\n      timeOut.after(0),\n      () => {\n        this.filterChanged(...args);\n      }\n    );\n  }\n\n  filterChanged(\n    filterType,\n    entityId,\n    startTime,\n    endTime,\n    cacheConfig,\n    localize\n  ) {\n    if (!this.hass) {\n      return;\n    }\n    if (cacheConfig && !cacheConfig.cacheKey) {\n      return;\n    }\n    if (!localize) {\n      return;\n    }\n    this._madeFirstCall = true;\n    const language = this.hass.language;\n    let data;\n\n    if (filterType === \"date\") {\n      if (!startTime || !endTime) return;\n\n      data = fetchDate(this.hass, startTime, endTime).then((dateHistory) =>\n        computeHistory(this.hass, dateHistory, localize, language)\n      );\n    } else if (filterType === \"recent-entity\") {\n      if (!entityId) return;\n      if (cacheConfig) {\n        data = this.getRecentWithCacheRefresh(\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        );\n      } else {\n        data = getRecent(\n          this.hass,\n          entityId,\n          startTime,\n          endTime,\n          localize,\n          language\n        );\n      }\n    } else {\n      return;\n    }\n    this._setIsLoading(true);\n\n    data.then((stateHistory) => {\n      this._setData(stateHistory);\n      this._setIsLoading(false);\n    });\n  }\n\n  getRecentWithCacheRefresh(entityId, cacheConfig, localize, language) {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    if (cacheConfig.refresh) {\n      this._refreshTimeoutId = window.setInterval(() => {\n        getRecentWithCache(\n          this.hass,\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        ).then((stateHistory) => {\n          this._setData(Object.assign({}, stateHistory));\n        });\n      }, cacheConfig.refresh * 1000);\n    }\n    return getRecentWithCache(\n      this.hass,\n      entityId,\n      cacheConfig,\n      localize,\n      language\n    );\n  }\n}\ncustomElements.define(\"ha-state-history-data\", HaStateHistoryData);\n","import computeStateName from \"../common/entity/compute_state_name\";\nimport computeStateDomain from \"../common/entity/compute_state_domain\";\nimport computeStateDisplay from \"../common/entity/compute_state_display\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { HomeAssistant } from \"../types\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\nconst DOMAINS_USE_LAST_UPDATED = [\"climate\", \"water_heater\"];\nconst LINE_ATTRIBUTES_TO_KEEP = [\n  \"temperature\",\n  \"current_temperature\",\n  \"target_temp_low\",\n  \"target_temp_high\",\n];\n\nexport interface LineChartState {\n  state: string;\n  last_changed: string;\n  attributes?: { [key: string]: any };\n}\n\nexport interface LineChartEntity {\n  domain: string;\n  name: string;\n  entity_id: string;\n  states: LineChartState[];\n}\n\nexport interface LineChartUnit {\n  unit: string;\n  identifier: string;\n  data: LineChartEntity[];\n}\n\nexport interface TimelineState {\n  state_localize: string;\n  state: string;\n  last_changed: string;\n}\n\nexport interface TimelineEntity {\n  name: string;\n  entity_id: string;\n  data: TimelineState[];\n}\n\nexport interface HistoryResult {\n  line: LineChartUnit[];\n  timeline: TimelineEntity[];\n}\n\nexport const fetchRecent = (\n  hass,\n  entityId,\n  startTime,\n  endTime,\n  skipInitialState = false\n): Promise<HassEntity[][]> => {\n  let url = \"history/period\";\n  if (startTime) {\n    url += \"/\" + startTime.toISOString();\n  }\n  url += \"?filter_entity_id=\" + entityId;\n  if (endTime) {\n    url += \"&end_time=\" + endTime.toISOString();\n  }\n  if (skipInitialState) {\n    url += \"&skip_initial_state\";\n  }\n\n  return hass.callApi(\"GET\", url);\n};\n\nexport const fetchDate = (\n  hass: HomeAssistant,\n  startTime: Date,\n  endTime: Date\n): Promise<HassEntity[][]> => {\n  return hass.callApi(\n    \"GET\",\n    `history/period/${startTime.toISOString()}?end_time=${endTime.toISOString()}`\n  );\n};\n\nconst equalState = (obj1: LineChartState, obj2: LineChartState) =>\n  obj1.state === obj2.state &&\n  // They either both have an attributes object or not\n  (!obj1.attributes ||\n    LINE_ATTRIBUTES_TO_KEEP.every(\n      (attr) => obj1.attributes![attr] === obj2.attributes![attr]\n    ));\n\nconst processTimelineEntity = (\n  localize: LocalizeFunc,\n  language: string,\n  states: HassEntity[]\n): TimelineEntity => {\n  const data: TimelineState[] = [];\n\n  for (const state of states) {\n    if (data.length > 0 && state.state === data[data.length - 1].state) {\n      continue;\n    }\n\n    data.push({\n      state_localize: computeStateDisplay(localize, state, language),\n      state: state.state,\n      last_changed: state.last_changed,\n    });\n  }\n\n  return {\n    name: computeStateName(states[0]),\n    entity_id: states[0].entity_id,\n    data,\n  };\n};\n\nconst processLineChartEntities = (\n  unit,\n  entities: HassEntity[][]\n): LineChartUnit => {\n  const data: LineChartEntity[] = [];\n\n  for (const states of entities) {\n    const last: HassEntity = states[states.length - 1];\n    const domain = computeStateDomain(last);\n    const processedStates: LineChartState[] = [];\n\n    for (const state of states) {\n      let processedState: LineChartState;\n\n      if (DOMAINS_USE_LAST_UPDATED.includes(domain)) {\n        processedState = {\n          state: state.state,\n          last_changed: state.last_updated,\n          attributes: {},\n        };\n\n        for (const attr of LINE_ATTRIBUTES_TO_KEEP) {\n          if (attr in state.attributes) {\n            processedState.attributes![attr] = state.attributes[attr];\n          }\n        }\n      } else {\n        processedState = state;\n      }\n\n      if (\n        processedStates.length > 1 &&\n        equalState(\n          processedState,\n          processedStates[processedStates.length - 1]\n        ) &&\n        equalState(processedState, processedStates[processedStates.length - 2])\n      ) {\n        continue;\n      }\n\n      processedStates.push(processedState);\n    }\n\n    data.push({\n      domain,\n      name: computeStateName(last),\n      entity_id: last.entity_id,\n      states: processedStates,\n    });\n  }\n\n  return {\n    unit,\n    identifier: entities.map((states) => states[0].entity_id).join(\"\"),\n    data,\n  };\n};\n\nexport const computeHistory = (\n  hass: HomeAssistant,\n  stateHistory: HassEntity[][],\n  localize: LocalizeFunc,\n  language: string\n): HistoryResult => {\n  const lineChartDevices: { [unit: string]: HassEntity[][] } = {};\n  const timelineDevices: TimelineEntity[] = [];\n  if (!stateHistory) {\n    return { line: [], timeline: [] };\n  }\n\n  stateHistory.forEach((stateInfo) => {\n    if (stateInfo.length === 0) {\n      return;\n    }\n\n    const stateWithUnit = stateInfo.find(\n      (state) => \"unit_of_measurement\" in state.attributes\n    );\n\n    let unit: string | undefined;\n\n    if (stateWithUnit) {\n      unit = stateWithUnit.attributes.unit_of_measurement;\n    } else if (computeStateDomain(stateInfo[0]) === \"climate\") {\n      unit = hass.config.unit_system.temperature;\n    } else if (computeStateDomain(stateInfo[0]) === \"water_heater\") {\n      unit = hass.config.unit_system.temperature;\n    }\n\n    if (!unit) {\n      timelineDevices.push(\n        processTimelineEntity(localize, language, stateInfo)\n      );\n    } else if (unit in lineChartDevices) {\n      lineChartDevices[unit].push(stateInfo);\n    } else {\n      lineChartDevices[unit] = [stateInfo];\n    }\n  });\n\n  const unitStates = Object.keys(lineChartDevices).map((unit) =>\n    processLineChartEntities(unit, lineChartDevices[unit])\n  );\n\n  return { line: unitStates, timeline: timelineDevices };\n};\n","import { HomeAssistant } from \"../types\";\n\nexport const setInputSelectOption = (\n  hass: HomeAssistant,\n  entity: string,\n  option: string\n) =>\n  hass.callService(\"input_select\", \"select_option\", {\n    option,\n    entity_id: entity,\n  });\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import { supportsFeature } from \"../common/entity/supports-feature\";\n\n/* eslint-enable no-bitwise */\nexport default class CoverEntity {\n  constructor(hass, stateObj) {\n    this.hass = hass;\n    this.stateObj = stateObj;\n    this._attr = stateObj.attributes;\n    this._feat = this._attr.supported_features;\n  }\n\n  get isFullyOpen() {\n    if (this._attr.current_position !== undefined) {\n      return this._attr.current_position === 100;\n    }\n    return this.stateObj.state === \"open\";\n  }\n\n  get isFullyClosed() {\n    if (this._attr.current_position !== undefined) {\n      return this._attr.current_position === 0;\n    }\n    return this.stateObj.state === \"closed\";\n  }\n\n  get isFullyOpenTilt() {\n    return this._attr.current_tilt_position === 100;\n  }\n\n  get isFullyClosedTilt() {\n    return this._attr.current_tilt_position === 0;\n  }\n\n  get isOpening() {\n    return this.stateObj.state === \"opening\";\n  }\n\n  get isClosing() {\n    return this.stateObj.state === \"closing\";\n  }\n\n  get supportsOpen() {\n    return supportsFeature(this.stateObj, 1);\n  }\n\n  get supportsClose() {\n    return supportsFeature(this.stateObj, 2);\n  }\n\n  get supportsSetPosition() {\n    return supportsFeature(this.stateObj, 4);\n  }\n\n  get supportsStop() {\n    return supportsFeature(this.stateObj, 8);\n  }\n\n  get supportsOpenTilt() {\n    return supportsFeature(this.stateObj, 16);\n  }\n\n  get supportsCloseTilt() {\n    return supportsFeature(this.stateObj, 32);\n  }\n\n  get supportsStopTilt() {\n    return supportsFeature(this.stateObj, 64);\n  }\n\n  get supportsSetTiltPosition() {\n    return supportsFeature(this.stateObj, 128);\n  }\n\n  get isTiltOnly() {\n    const supportsCover =\n      this.supportsOpen || this.supportsClose || this.supportsStop;\n    const supportsTilt =\n      this.supportsOpenTilt || this.supportsCloseTilt || this.supportsStopTilt;\n    return supportsTilt && !supportsCover;\n  }\n\n  openCover() {\n    this.callService(\"open_cover\");\n  }\n\n  closeCover() {\n    this.callService(\"close_cover\");\n  }\n\n  stopCover() {\n    this.callService(\"stop_cover\");\n  }\n\n  openCoverTilt() {\n    this.callService(\"open_cover_tilt\");\n  }\n\n  closeCoverTilt() {\n    this.callService(\"close_cover_tilt\");\n  }\n\n  stopCoverTilt() {\n    this.callService(\"stop_cover_tilt\");\n  }\n\n  setCoverPosition(position) {\n    this.callService(\"set_cover_position\", { position });\n  }\n\n  setCoverTiltPosition(tiltPosition) {\n    this.callService(\"set_cover_tilt_position\", {\n      tilt_position: tiltPosition,\n    });\n  }\n\n  // helper method\n\n  callService(service, data = {}) {\n    data.entity_id = this.stateObj.entity_id;\n    this.hass.callService(\"cover\", service, data);\n  }\n}\n\nexport const supportsOpen = (stateObj) => supportsFeature(stateObj, 1);\n\nexport const supportsClose = (stateObj) => supportsFeature(stateObj, 2);\n\nexport const supportsSetPosition = (stateObj) => supportsFeature(stateObj, 4);\n\nexport const supportsStop = (stateObj) => supportsFeature(stateObj, 8);\n\nexport const supportsOpenTilt = (stateObj) => supportsFeature(stateObj, 16);\n\nexport const supportsCloseTilt = (stateObj) => supportsFeature(stateObj, 32);\n\nexport const supportsStopTilt = (stateObj) => supportsFeature(stateObj, 64);\n\nexport const supportsSetTiltPosition = (stateObj) =>\n  supportsFeature(stateObj, 128);\n\nexport function isTiltOnly(stateObj) {\n  const supportsCover =\n    supportsOpen(stateObj) || supportsClose(stateObj) || supportsStop(stateObj);\n  const supportsTilt =\n    supportsOpenTilt(stateObj) ||\n    supportsCloseTilt(stateObj) ||\n    supportsStopTilt(stateObj);\n  return supportsTilt && !supportsCover;\n}\n","import { supportsFeature } from \"../common/entity/supports-feature\";\n\nexport default class MediaPlayerEntity {\n  constructor(hass, stateObj) {\n    this.hass = hass;\n    this.stateObj = stateObj;\n    this._attr = stateObj.attributes;\n    this._feat = this._attr.supported_features;\n  }\n\n  get isOff() {\n    return this.stateObj.state === \"off\";\n  }\n\n  get isIdle() {\n    return this.stateObj.state === \"idle\";\n  }\n\n  get isMuted() {\n    return this._attr.is_volume_muted;\n  }\n\n  get isPaused() {\n    return this.stateObj.state === \"paused\";\n  }\n\n  get isPlaying() {\n    return this.stateObj.state === \"playing\";\n  }\n\n  get isMusic() {\n    return this._attr.media_content_type === \"music\";\n  }\n\n  get isTVShow() {\n    return this._attr.media_content_type === \"tvshow\";\n  }\n\n  get hasMediaControl() {\n    return (\n      [\"playing\", \"paused\", \"unknown\", \"on\"].indexOf(this.stateObj.state) !== -1\n    );\n  }\n\n  get volumeSliderValue() {\n    return this._attr.volume_level * 100;\n  }\n\n  get showProgress() {\n    return (\n      (this.isPlaying || this.isPaused) &&\n      \"media_duration\" in this.stateObj.attributes &&\n      \"media_position\" in this.stateObj.attributes &&\n      \"media_position_updated_at\" in this.stateObj.attributes\n    );\n  }\n\n  get currentProgress() {\n    var progress = this._attr.media_position;\n    if (this.isPlaying) {\n      progress +=\n        (Date.now() -\n          new Date(this._attr.media_position_updated_at).getTime()) /\n        1000.0;\n    }\n    return progress;\n  }\n\n  get supportsPause() {\n    return supportsFeature(this.stateObj, 1);\n  }\n\n  get supportsVolumeSet() {\n    return supportsFeature(this.stateObj, 4);\n  }\n\n  get supportsVolumeMute() {\n    return supportsFeature(this.stateObj, 8);\n  }\n\n  get supportsPreviousTrack() {\n    return supportsFeature(this.stateObj, 16);\n  }\n\n  get supportsNextTrack() {\n    return supportsFeature(this.stateObj, 32);\n  }\n\n  get supportsTurnOn() {\n    return supportsFeature(this.stateObj, 128);\n  }\n\n  get supportsTurnOff() {\n    return supportsFeature(this.stateObj, 256);\n  }\n\n  get supportsPlayMedia() {\n    return supportsFeature(this.stateObj, 512);\n  }\n\n  get supportsVolumeButtons() {\n    return supportsFeature(this.stateObj, 1024);\n  }\n\n  get supportsSelectSource() {\n    return supportsFeature(this.stateObj, 2048);\n  }\n\n  get supportsSelectSoundMode() {\n    return supportsFeature(this.stateObj, 65536);\n  }\n\n  get supportsPlay() {\n    return supportsFeature(this.stateObj, 16384);\n  }\n\n  get primaryTitle() {\n    return this._attr.media_title;\n  }\n\n  get secondaryTitle() {\n    if (this.isMusic) {\n      return this._attr.media_artist;\n    }\n    if (this.isTVShow) {\n      var text = this._attr.media_series_title;\n\n      if (this._attr.media_season) {\n        text += \" S\" + this._attr.media_season;\n\n        if (this._attr.media_episode) {\n          text += \"E\" + this._attr.media_episode;\n        }\n      }\n\n      return text;\n    }\n    if (this._attr.app_name) {\n      return this._attr.app_name;\n    }\n    return \"\";\n  }\n\n  get source() {\n    return this._attr.source;\n  }\n\n  get sourceList() {\n    return this._attr.source_list;\n  }\n\n  get soundMode() {\n    return this._attr.sound_mode;\n  }\n\n  get soundModeList() {\n    return this._attr.sound_mode_list;\n  }\n\n  mediaPlayPause() {\n    this.callService(\"media_play_pause\");\n  }\n\n  nextTrack() {\n    this.callService(\"media_next_track\");\n  }\n\n  playbackControl() {\n    this.callService(\"media_play_pause\");\n  }\n\n  previousTrack() {\n    this.callService(\"media_previous_track\");\n  }\n\n  setVolume(volume) {\n    this.callService(\"volume_set\", { volume_level: volume });\n  }\n\n  togglePower() {\n    if (this.isOff) {\n      this.turnOn();\n    } else {\n      this.turnOff();\n    }\n  }\n\n  turnOff() {\n    this.callService(\"turn_off\");\n  }\n\n  turnOn() {\n    this.callService(\"turn_on\");\n  }\n\n  volumeDown() {\n    this.callService(\"volume_down\");\n  }\n\n  volumeMute(mute) {\n    if (!this.supportsVolumeMute) {\n      throw new Error(\"Muting volume not supported\");\n    }\n    this.callService(\"volume_mute\", { is_volume_muted: mute });\n  }\n\n  volumeUp() {\n    this.callService(\"volume_up\");\n  }\n\n  selectSource(source) {\n    this.callService(\"select_source\", { source });\n  }\n\n  selectSoundMode(soundMode) {\n    this.callService(\"select_sound_mode\", { sound_mode: soundMode });\n  }\n\n  // helper method\n\n  callService(service, data = {}) {\n    data.entity_id = this.stateObj.entity_id;\n    this.hass.callService(\"media_player\", service, data);\n  }\n}\n"],"sourceRoot":""}