{"version":3,"sources":["webpack:///./src/common/datetime/format_date.ts","webpack:///./src/common/datetime/format_date_time.ts","webpack:///./src/common/datetime/format_time.ts","webpack:///./src/common/entity/compute_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/entity/compute_state_display.ts","webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/components/entity/ha-chart-base.js","webpack:///./src/components/state-history-chart-line.js","webpack:///./src/components/state-history-chart-timeline.js","webpack:///./src/components/state-history-charts.js","webpack:///./src/data/cached-history.ts","webpack:///./src/data/ha-state-history-data.js","webpack:///./src/data/history.ts","webpack:///./src/mixins/localize-mixin.js"],"names":["toLocaleDateStringSupportsOptions","Date","toLocaleDateString","e","name","dateObj","locales","year","month","day","fecha","format","toLocaleStringSupportsOptions","toLocaleString","hour","minute","toLocaleTimeStringSupportsOptions","toLocaleTimeString","computeDomain","entityId","substr","indexOf","computeObjectId","localize","stateObj","language","display","domain","computeStateDomain","attributes","device_class","state","unit_of_measurement","includes","date","has_time","formatDate","has_date","now","getFullYear","getMonth","getDay","formatTime","formatDateTime","query_stage","friendly_name","undefined","entity_id","replace","scriptsLoaded","HaChartBase","mixinBehaviors","IronResizableBehavior","PolymerElement","template","html","chart","_chart","properties","data","Object","identifier","String","rendered","type","Boolean","notify","value","readOnly","metas","Array","tooltip","opacity","left","top","xPadding","yPadding","unit","rtl","reflectToAttribute","observers","connectedCallback","_isAttached","onPropsChange","_resizeListener","_debouncer","Debouncer","debounce","timeOut","after","resizeChart","ResizeObserver","resizeObserver","entries","forEach","observe","$","chartTarget","addEventListener","then","ChartModule","ChartClass","default","disconnectedCallback","unobserve","removeEventListener","_resizeTimer","clearInterval","drawChart","_customTooltips","set","yAlign","title","bodyLines","body","map","n","lines","i","colors","labelColors","color","borderColor","bgColor","backgroundColor","text","join","parentWidth","clientWidth","positionX","caretX","positionY","canvas","offsetTop","caretY","offsetLeft","assign","_legendClick","event","window","stopPropagation","target","srcElement","nodeName","parentElement","index","model","itemsIndex","meta","getDatasetMeta","hidden","datasets","isDatasetVisible","update","_drawLegend","preserveVisibility","_oldIdentifier","x","label","length","updateNeeded","_formatTickValue","values","ctx","chartCanvas","cnt","constructor","getColorList","loopI","rgbString","alpha","rgbaString","duration","isTimeline","options","scales","yAxes","gridLines","legend","plugins","afterRender","_setRendered","responsive","maintainAspectRatio","animation","hover","animationDuration","responsiveAnimationDuration","tooltips","enabled","custom","bind","line","spanGaps","elements","font","ticks","fontFamily","Chart","helpers","merge","xAxes","callback","_colorFunc","getColorGenerator","staticColors","staticColorIndex","colorFunction","style","height","chartData","setInterval","_resizeChart","resize","areaTop","chartArea","areaBot","bottom","height1","clientHeight","_axisHeight","targetHeight","count","processL","Math","ceil","h1","result","Color","hsl","startIndex","palette","getColorIndex","idx","colorDict","colorIndex","keys","c","c1","isFinite","toLowerCase","getColor","__","ret","name1","customElements","define","StateHistoryChartLine","LocalizeMixin","names","isSingleDevice","endTime","observer","dataChanged","_onRenderedChanged","animateHeight","requestAnimationFrame","scrollHeight","deviceStates","safeParseFloat","parsed","parseFloat","max","apply","devSts","states","last_changed","prevValues","pushData","timestamp","datavalues","d","push","y","addColumn","nameY","step","fill","dataFill","dataStep","steppedLine","pointRadius","unitText","hasTargetRange","some","target_temp_high","target_temp_low","hasHeat","hasCool","curTemp","current_temperature","series","targetHigh","targetLow","temperature","isStep","lastValue","lastDate","lastNullDate","dateTime","getTime","lastNullDateTime","lastDateTime","tmpValue","prototype","formatTooltipTitle","items","item","datasetIndex","hass","chartOptions","major","fontStyle","maxTicksLimit","mode","callbacks","layout","padding","tension","borderWidth","point","hitRadius","filler","propagate","labels","StateHistoryChartTimeline","noSingle","computed","on","off","unavailable","unknown","idle","stateHistory","startTime","reduce","minTime","stateInfo","min","maxTime","newLastChanged","prevState","locState","prevLastChanged","entityDisplay","dataRow","newState","timeStamp","state_localize","formatTooltipLabel","start","end","afterSetDimensions","yaxe","maxWidth","width","position","_computeRTL","computeRTL","StateHistoryCharts","historyData","isLoadingData","upToNow","_computeIsSingleLineChart","_computeIsEmpty","historyDataEmpty","timeline","_computeIsLoading","isLoading","_computeEndTime","RECENT_THRESHOLD","RECENT_CACHE","stateHistoryCache","getRecent","cacheKey","cache","created","prom","fetchRecent","computeHistory","err","getEmptyCache","Promise","resolve","getRecentWithCache","cacheConfig","setHours","getHours","hoursToShow","toFetchStartTime","appendingToCache","curCacheProm","genProm","fetchedHistory","results","all","mergeLine","mergeTimeline","pruneStartTime","historyLines","cacheLines","oldLine","find","cacheLine","entity","oldEntity","cacheEntity","concat","historyTimelines","cacheTimelines","oldTimeline","cacheTimeline","pruneArray","originalStartTime","arr","changedAfterStartTime","findIndex","updateIndex","slice","cacheData","HaStateHistoryData","filterType","filterChangedDebouncer","_refreshTimeoutId","hassChanged","newHass","oldHass","_madeFirstCall","args","_debounceFilterChanged","filterChanged","fetchDate","dateHistory","getRecentWithCacheRefresh","_setIsLoading","_setData","refresh","DOMAINS_USE_LAST_UPDATED","LINE_ATTRIBUTES_TO_KEEP","skipInitialState","url","toISOString","callApi","equalState","obj1","obj2","every","attr","processTimelineEntity","computeStateDisplay","computeStateName","processLineChartEntities","entities","last","processedStates","processedState","last_updated","lineChartDevices","timelineDevices","stateWithUnit","config","unit_system","unitStates","dedupingMixin","superClass","Function","__computeLocalize"],"mappings":"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","file":"more-info-dialog~panel-history~panel-kiosk~panel-lovelace~panel-states.chunk.js","sourcesContent":["import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleDateStringSupportsOptions() {\n  try {\n    new Date().toLocaleDateString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleDateStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleDateString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"mediumDate\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleStringSupportsOptions() {\n  try {\n    new Date().toLocaleString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"haDateTime\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleTimeStringSupportsOptions() {\n  try {\n    new Date().toLocaleTimeString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleTimeStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleTimeString(locales, {\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"shortTime\"));\n","export default function computeDomain(entityId: string): string {\n  return entityId.substr(0, entityId.indexOf(\".\"));\n}\n","/** Compute the object ID of a state. */\nexport default function computeObjectId(entityId: string): string {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeStateDomain from \"./compute_state_domain\";\nimport formatDateTime from \"../datetime/format_date_time\";\nimport formatDate from \"../datetime/format_date\";\nimport formatTime from \"../datetime/format_time\";\nimport { LocalizeFunc } from \"../translations/localize\";\n\nexport default (\n  localize: LocalizeFunc,\n  stateObj: HassEntity,\n  language: string\n): string => {\n  let display: string | undefined;\n  const domain = computeStateDomain(stateObj);\n\n  if (domain === \"binary_sensor\") {\n    // Try device class translation, then default binary sensor translation\n    if (stateObj.attributes.device_class) {\n      display = localize(\n        `state.${domain}.${stateObj.attributes.device_class}.${stateObj.state}`\n      );\n    }\n\n    if (!display) {\n      display = localize(`state.${domain}.default.${stateObj.state}`);\n    }\n  } else if (\n    stateObj.attributes.unit_of_measurement &&\n    ![\"unknown\", \"unavailable\"].includes(stateObj.state)\n  ) {\n    display = stateObj.state + \" \" + stateObj.attributes.unit_of_measurement;\n  } else if (domain === \"input_datetime\") {\n    let date: Date;\n    if (!stateObj.attributes.has_time) {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day\n      );\n      display = formatDate(date, language);\n    } else if (!stateObj.attributes.has_date) {\n      const now = new Date();\n      date = new Date(\n        // Due to bugs.chromium.org/p/chromium/issues/detail?id=797548\n        // don't use artificial 1970 year.\n        now.getFullYear(),\n        now.getMonth(),\n        now.getDay(),\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatTime(date, language);\n    } else {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day,\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatDateTime(date, language);\n    }\n  } else if (domain === \"zwave\") {\n    if ([\"initializing\", \"dead\"].includes(stateObj.state)) {\n      display = localize(\n        `state.zwave.query_stage.${stateObj.state}`,\n        \"query_stage\",\n        stateObj.attributes.query_stage\n      );\n    } else {\n      display = localize(`state.zwave.default.${stateObj.state}`);\n    }\n  } else {\n    display = localize(`state.${domain}.${stateObj.state}`);\n  }\n\n  // Fall back to default, component backend translation, or raw state if nothing else matches.\n  if (!display) {\n    display =\n      localize(`state.default.${stateObj.state}`) ||\n      localize(`component.${domain}.state.${stateObj.state}`) ||\n      stateObj.state;\n  }\n\n  return display;\n};\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeObjectId from \"./compute_object_id\";\n\nexport default (stateObj: HassEntity): string =>\n  stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n","import { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { IronResizableBehavior } from \"@polymer/iron-resizable-behavior/iron-resizable-behavior\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\n\nimport formatTime from \"../../common/datetime/format_time\";\n// eslint-disable-next-line no-unused-vars\n/* global Chart moment Color */\n\nlet scriptsLoaded = null;\n\nclass HaChartBase extends mixinBehaviors(\n  [IronResizableBehavior],\n  PolymerElement\n) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n        }\n        .chartHeader {\n          padding: 6px 0 0 0;\n          width: 100%;\n          display: flex;\n          flex-direction: row;\n        }\n        .chartHeader > div {\n          vertical-align: top;\n          padding: 0 8px;\n        }\n        .chartHeader > div.chartTitle {\n          padding-top: 8px;\n          flex: 0 0 0;\n          max-width: 30%;\n        }\n        .chartHeader > div.chartLegend {\n          flex: 1 1;\n          min-width: 70%;\n        }\n        :root {\n          user-select: none;\n          -moz-user-select: none;\n          -webkit-user-select: none;\n          -ms-user-select: none;\n        }\n        .chartTooltip {\n          font-size: 90%;\n          opacity: 1;\n          position: absolute;\n          background: rgba(80, 80, 80, 0.9);\n          color: white;\n          border-radius: 3px;\n          pointer-events: none;\n          transform: translate(-50%, 12px);\n          z-index: 1000;\n          width: 200px;\n          transition: opacity 0.15s ease-in-out;\n        }\n        :host([rtl]) .chartTooltip {\n          direction: rtl;\n        }\n        .chartLegend ul,\n        .chartTooltip ul {\n          display: inline-block;\n          padding: 0 0px;\n          margin: 5px 0 0 0;\n          width: 100%;\n        }\n        .chartTooltip li {\n          display: block;\n          white-space: pre-line;\n        }\n        .chartTooltip .title {\n          text-align: center;\n          font-weight: 500;\n        }\n        .chartLegend li {\n          display: inline-block;\n          padding: 0 6px;\n          max-width: 49%;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          overflow: hidden;\n          box-sizing: border-box;\n        }\n        .chartLegend li:nth-child(odd):last-of-type {\n          /* Make last item take full width if it is odd-numbered. */\n          max-width: 100%;\n        }\n        .chartLegend li[data-hidden] {\n          text-decoration: line-through;\n        }\n        .chartLegend em,\n        .chartTooltip em {\n          border-radius: 5px;\n          display: inline-block;\n          height: 10px;\n          margin-right: 4px;\n          width: 10px;\n        }\n        :host([rtl]) .chartTooltip em {\n          margin-right: inherit;\n          margin-left: 4px;\n        }\n        paper-icon-button {\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template is=\"dom-if\" if=\"[[unit]]\">\n        <div class=\"chartHeader\">\n          <div class=\"chartTitle\">[[unit]]</div>\n          <div class=\"chartLegend\">\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[metas]]\">\n                <li on-click=\"_legendClick\" data-hidden$=\"[[item.hidden]]\">\n                  <em style$=\"background-color:[[item.bgColor]]\"></em>\n                  [[item.label]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </template>\n      <div id=\"chartTarget\" style=\"height:40px; width:100%\">\n        <canvas id=\"chartCanvas\"></canvas>\n        <div\n          class$=\"chartTooltip [[tooltip.yAlign]]\"\n          style$=\"opacity:[[tooltip.opacity]]; top:[[tooltip.top]]; left:[[tooltip.left]]; padding:[[tooltip.yPadding]]px [[tooltip.xPadding]]px\"\n        >\n          <div class=\"title\">[[tooltip.title]]</div>\n          <div>\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[tooltip.lines]]\">\n                <li>\n                  <em style$=\"background-color:[[item.bgColor]]\"></em\n                  >[[item.text]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  get chart() {\n    return this._chart;\n  }\n\n  static get properties() {\n    return {\n      data: Object,\n      identifier: String,\n      rendered: {\n        type: Boolean,\n        notify: true,\n        value: false,\n        readOnly: true,\n      },\n      metas: {\n        type: Array,\n        value: () => [],\n      },\n      tooltip: {\n        type: Object,\n        value: () => ({\n          opacity: \"0\",\n          left: \"0\",\n          top: \"0\",\n          xPadding: \"5\",\n          yPadding: \"3\",\n        }),\n      },\n      unit: Object,\n      rtl: {\n        type: Boolean,\n        reflectToAttribute: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"onPropsChange(data)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.onPropsChange();\n    this._resizeListener = () => {\n      this._debouncer = Debouncer.debounce(\n        this._debouncer,\n        timeOut.after(10),\n        () => {\n          if (this._isAttached) {\n            this.resizeChart();\n          }\n        }\n      );\n    };\n\n    if (typeof ResizeObserver === \"function\") {\n      this.resizeObserver = new ResizeObserver((entries) => {\n        entries.forEach(() => {\n          this._resizeListener();\n        });\n      });\n      this.resizeObserver.observe(this.$.chartTarget);\n    } else {\n      this.addEventListener(\"iron-resize\", this._resizeListener);\n    }\n\n    if (scriptsLoaded === null) {\n      scriptsLoaded = import(/* webpackChunkName: \"load_chart\" */ \"../../resources/ha-chart-scripts.js\");\n    }\n    scriptsLoaded.then((ChartModule) => {\n      this.ChartClass = ChartModule.default;\n      this.onPropsChange();\n    });\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._isAttached = false;\n    if (this.resizeObserver) {\n      this.resizeObserver.unobserve(this.$.chartTarget);\n    }\n\n    this.removeEventListener(\"iron-resize\", this._resizeListener);\n\n    if (this._resizeTimer !== undefined) {\n      clearInterval(this._resizeTimer);\n      this._resizeTimer = undefined;\n    }\n  }\n\n  onPropsChange() {\n    if (!this._isAttached || !this.ChartClass || !this.data) {\n      return;\n    }\n    this.drawChart();\n  }\n\n  _customTooltips(tooltip) {\n    // Hide if no tooltip\n    if (tooltip.opacity === 0) {\n      this.set([\"tooltip\", \"opacity\"], 0);\n      return;\n    }\n    // Set caret Position\n    if (tooltip.yAlign) {\n      this.set([\"tooltip\", \"yAlign\"], tooltip.yAlign);\n    } else {\n      this.set([\"tooltip\", \"yAlign\"], \"no-transform\");\n    }\n\n    const title = tooltip.title ? tooltip.title[0] || \"\" : \"\";\n    this.set([\"tooltip\", \"title\"], title);\n\n    const bodyLines = tooltip.body.map((n) => n.lines);\n\n    // Set Text\n    if (tooltip.body) {\n      this.set(\n        [\"tooltip\", \"lines\"],\n        bodyLines.map((body, i) => {\n          const colors = tooltip.labelColors[i];\n          return {\n            color: colors.borderColor,\n            bgColor: colors.backgroundColor,\n            text: body.join(\"\\n\"),\n          };\n        })\n      );\n    }\n    const parentWidth = this.$.chartTarget.clientWidth;\n    let positionX = tooltip.caretX;\n    const positionY = this._chart.canvas.offsetTop + tooltip.caretY;\n    if (tooltip.caretX + 100 > parentWidth) {\n      positionX = parentWidth - 100;\n    } else if (tooltip.caretX < 100) {\n      positionX = 100;\n    }\n    positionX += this._chart.canvas.offsetLeft;\n    // Display, position, and set styles for font\n    this.tooltip = Object.assign({}, this.tooltip, {\n      opacity: 1,\n      left: `${positionX}px`,\n      top: `${positionY}px`,\n    });\n  }\n\n  _legendClick(event) {\n    event = event || window.event;\n    event.stopPropagation();\n    let target = event.target || event.srcElement;\n    while (target.nodeName !== \"LI\") {\n      // user clicked child, find parent LI\n      target = target.parentElement;\n    }\n    const index = event.model.itemsIndex;\n\n    const meta = this._chart.getDatasetMeta(index);\n    meta.hidden =\n      meta.hidden === null ? !this._chart.data.datasets[index].hidden : null;\n    this.set(\n      [\"metas\", index, \"hidden\"],\n      this._chart.isDatasetVisible(index) ? null : \"hidden\"\n    );\n    this._chart.update();\n  }\n\n  _drawLegend() {\n    const chart = this._chart;\n    // New data for old graph. Keep metadata.\n    const preserveVisibility =\n      this._oldIdentifier && this.identifier === this._oldIdentifier;\n    this._oldIdentifier = this.identifier;\n    this.set(\n      \"metas\",\n      this._chart.data.datasets.map((x, i) => ({\n        label: x.label,\n        color: x.color,\n        bgColor: x.backgroundColor,\n        hidden:\n          preserveVisibility && i < this.metas.length\n            ? this.metas[i].hidden\n            : !chart.isDatasetVisible(i),\n      }))\n    );\n    let updateNeeded = false;\n    if (preserveVisibility) {\n      for (let i = 0; i < this.metas.length; i++) {\n        const meta = chart.getDatasetMeta(i);\n        if (!!meta.hidden !== !!this.metas[i].hidden) updateNeeded = true;\n        meta.hidden = this.metas[i].hidden ? true : null;\n      }\n    }\n    if (updateNeeded) {\n      chart.update();\n    }\n    this.unit = this.data.unit;\n  }\n\n  _formatTickValue(value, index, values) {\n    if (values.length === 0) {\n      return value;\n    }\n    const date = new Date(values[index].value);\n    return formatTime(date);\n  }\n\n  drawChart() {\n    const data = this.data.data;\n    const ctx = this.$.chartCanvas;\n\n    if ((!data.datasets || !data.datasets.length) && !this._chart) {\n      return;\n    }\n    if (this.data.type !== \"timeline\" && data.datasets.length > 0) {\n      const cnt = data.datasets.length;\n      const colors = this.constructor.getColorList(cnt);\n      for (let loopI = 0; loopI < cnt; loopI++) {\n        data.datasets[loopI].borderColor = colors[loopI].rgbString();\n        data.datasets[loopI].backgroundColor = colors[loopI]\n          .alpha(0.6)\n          .rgbaString();\n      }\n    }\n\n    if (this._chart) {\n      this._customTooltips({ opacity: 0 });\n      this._chart.data = data;\n      this._chart.update({ duration: 0 });\n      if (this.isTimeline) {\n        this._chart.options.scales.yAxes[0].gridLines.display = data.length > 1;\n      } else if (this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    } else {\n      if (!data.datasets) {\n        return;\n      }\n      this._customTooltips({ opacity: 0 });\n      const plugins = [{ afterRender: () => this._setRendered(true) }];\n      let options = {\n        responsive: true,\n        maintainAspectRatio: false,\n        animation: {\n          duration: 0,\n        },\n        hover: {\n          animationDuration: 0,\n        },\n        responsiveAnimationDuration: 0,\n        tooltips: {\n          enabled: false,\n          custom: this._customTooltips.bind(this),\n        },\n        legend: {\n          display: false,\n        },\n        line: {\n          spanGaps: true,\n        },\n        elements: {\n          font: \"12px 'Roboto', 'sans-serif'\",\n        },\n        ticks: {\n          fontFamily: \"'Roboto', 'sans-serif'\",\n        },\n      };\n      options = Chart.helpers.merge(options, this.data.options);\n      options.scales.xAxes[0].ticks.callback = this._formatTickValue;\n      if (this.data.type === \"timeline\") {\n        this.set(\"isTimeline\", true);\n        if (this.data.colors !== undefined) {\n          this._colorFunc = this.constructor.getColorGenerator(\n            this.data.colors.staticColors,\n            this.data.colors.staticColorIndex\n          );\n        }\n        if (this._colorFunc !== undefined) {\n          options.elements.colorFunction = this._colorFunc;\n        }\n        if (data.datasets.length === 1) {\n          if (options.scales.yAxes[0].ticks) {\n            options.scales.yAxes[0].ticks.display = false;\n          } else {\n            options.scales.yAxes[0].ticks = { display: false };\n          }\n          if (options.scales.yAxes[0].gridLines) {\n            options.scales.yAxes[0].gridLines.display = false;\n          } else {\n            options.scales.yAxes[0].gridLines = { display: false };\n          }\n        }\n        this.$.chartTarget.style.height = \"50px\";\n      } else {\n        this.$.chartTarget.style.height = \"160px\";\n      }\n      const chartData = {\n        type: this.data.type,\n        data: this.data.data,\n        options: options,\n        plugins: plugins,\n      };\n      // Async resize after dom update\n      this._chart = new this.ChartClass(ctx, chartData);\n      if (this.isTimeline !== true && this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    }\n  }\n\n  resizeChart() {\n    if (!this._chart) return;\n    // Chart not ready\n    if (this._resizeTimer === undefined) {\n      this._resizeTimer = setInterval(this.resizeChart.bind(this), 10);\n      return;\n    }\n\n    clearInterval(this._resizeTimer);\n    this._resizeTimer = undefined;\n\n    this._resizeChart();\n  }\n\n  _resizeChart() {\n    const chartTarget = this.$.chartTarget;\n\n    const options = this.data;\n    const data = options.data;\n\n    if (data.datasets.length === 0) {\n      return;\n    }\n\n    if (!this.isTimeline) {\n      this._chart.resize();\n      return;\n    }\n\n    // Recalculate chart height for Timeline chart\n    const areaTop = this._chart.chartArea.top;\n    const areaBot = this._chart.chartArea.bottom;\n    const height1 = this._chart.canvas.clientHeight;\n    if (areaBot > 0) {\n      this._axisHeight = height1 - areaBot + areaTop;\n    }\n\n    if (!this._axisHeight) {\n      chartTarget.style.height = \"50px\";\n      this._chart.resize();\n      this.resizeChart();\n      return;\n    }\n    if (this._axisHeight) {\n      const cnt = data.datasets.length;\n      const targetHeight = 30 * cnt + this._axisHeight + \"px\";\n      if (chartTarget.style.height !== targetHeight) {\n        chartTarget.style.height = targetHeight;\n      }\n      this._chart.resize();\n    }\n  }\n\n  // Get HSL distributed color list\n  static getColorList(count) {\n    let processL = false;\n    if (count > 10) {\n      processL = true;\n      count = Math.ceil(count / 2);\n    }\n    const h1 = 360 / count;\n    const result = [];\n    for (let loopI = 0; loopI < count; loopI++) {\n      result[loopI] = Color().hsl(h1 * loopI, 80, 38);\n      if (processL) {\n        result[loopI + count] = Color().hsl(h1 * loopI, 80, 62);\n      }\n    }\n    return result;\n  }\n\n  static getColorGenerator(staticColors, startIndex) {\n    // Known colors for static data,\n    // should add for very common state string manually.\n    // Palette modified from http://google.github.io/palette.js/ mpn65, Apache 2.0\n    const palette = [\n      \"ff0029\",\n      \"66a61e\",\n      \"377eb8\",\n      \"984ea3\",\n      \"00d2d5\",\n      \"ff7f00\",\n      \"af8d00\",\n      \"7f80cd\",\n      \"b3e900\",\n      \"c42e60\",\n      \"a65628\",\n      \"f781bf\",\n      \"8dd3c7\",\n      \"bebada\",\n      \"fb8072\",\n      \"80b1d3\",\n      \"fdb462\",\n      \"fccde5\",\n      \"bc80bd\",\n      \"ffed6f\",\n      \"c4eaff\",\n      \"cf8c00\",\n      \"1b9e77\",\n      \"d95f02\",\n      \"e7298a\",\n      \"e6ab02\",\n      \"a6761d\",\n      \"0097ff\",\n      \"00d067\",\n      \"f43600\",\n      \"4ba93b\",\n      \"5779bb\",\n      \"927acc\",\n      \"97ee3f\",\n      \"bf3947\",\n      \"9f5b00\",\n      \"f48758\",\n      \"8caed6\",\n      \"f2b94f\",\n      \"eff26e\",\n      \"e43872\",\n      \"d9b100\",\n      \"9d7a00\",\n      \"698cff\",\n      \"d9d9d9\",\n      \"00d27e\",\n      \"d06800\",\n      \"009f82\",\n      \"c49200\",\n      \"cbe8ff\",\n      \"fecddf\",\n      \"c27eb6\",\n      \"8cd2ce\",\n      \"c4b8d9\",\n      \"f883b0\",\n      \"a49100\",\n      \"f48800\",\n      \"27d0df\",\n      \"a04a9b\",\n    ];\n    function getColorIndex(idx) {\n      // Reuse the color if index too large.\n      return Color(\"#\" + palette[idx % palette.length]);\n    }\n    const colorDict = {};\n    let colorIndex = 0;\n    if (startIndex > 0) colorIndex = startIndex;\n    if (staticColors) {\n      Object.keys(staticColors).forEach((c) => {\n        const c1 = staticColors[c];\n        if (isFinite(c1)) {\n          colorDict[c.toLowerCase()] = getColorIndex(c1);\n        } else {\n          colorDict[c.toLowerCase()] = Color(staticColors[c]);\n        }\n      });\n    }\n    // Custom color assign\n    function getColor(__, data) {\n      let ret;\n      const name = data[3];\n      if (name === null) return Color().hsl(0, 40, 38);\n      if (name === undefined) return Color().hsl(120, 40, 38);\n      const name1 = name.toLowerCase();\n      if (ret === undefined) {\n        ret = colorDict[name1];\n      }\n      if (ret === undefined) {\n        ret = getColorIndex(colorIndex);\n        colorIndex++;\n        colorDict[name1] = ret;\n      }\n      return ret;\n    }\n    return getColor;\n  }\n}\ncustomElements.define(\"ha-chart-base\", HaChartBase);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./entity/ha-chart-base\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\nimport formatDateTime from \"../common/datetime/format_date_time\";\n\nclass StateHistoryChartLine extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          overflow: hidden;\n          height: 0;\n          transition: height 0.3s ease-in-out;\n        }\n      </style>\n      <ha-chart-base\n        id=\"chart\"\n        data=\"[[chartData]]\"\n        identifier=\"[[identifier]]\"\n        rendered=\"{{rendered}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      chartData: Object,\n      data: Object,\n      names: Object,\n      unit: String,\n      identifier: String,\n\n      isSingleDevice: {\n        type: Boolean,\n        value: false,\n      },\n\n      endTime: Object,\n      rendered: {\n        type: Boolean,\n        value: false,\n        observer: \"_onRenderedChanged\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, isSingleDevice)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  _onRenderedChanged(rendered) {\n    if (rendered) this.animateHeight();\n  }\n\n  animateHeight() {\n    requestAnimationFrame(() =>\n      requestAnimationFrame(() => {\n        this.style.height = this.$.chart.scrollHeight + \"px\";\n      })\n    );\n  }\n\n  drawChart() {\n    const unit = this.unit;\n    const deviceStates = this.data;\n    const datasets = [];\n    let endTime;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (deviceStates.length === 0) {\n      return;\n    }\n\n    function safeParseFloat(value) {\n      const parsed = parseFloat(value);\n      return isFinite(parsed) ? parsed : null;\n    }\n\n    endTime =\n      this.endTime ||\n      // Get the highest date from the last date of each device\n      new Date(\n        Math.max.apply(\n          null,\n          deviceStates.map(\n            (devSts) =>\n              new Date(devSts.states[devSts.states.length - 1].last_changed)\n          )\n        )\n      );\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const names = this.names || {};\n    deviceStates.forEach((states) => {\n      const domain = states.domain;\n      const name = names[states.entity_id] || states.name;\n      // array containing [value1, value2, etc]\n      let prevValues;\n      const data = [];\n\n      function pushData(timestamp, datavalues) {\n        if (!datavalues) return;\n        if (timestamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is \"now\" and client time is not in sync with server time.\n          return;\n        }\n        data.forEach((d, i) => {\n          d.data.push({ x: timestamp, y: datavalues[i] });\n        });\n        prevValues = datavalues;\n      }\n\n      function addColumn(nameY, step, fill) {\n        let dataFill = false;\n        let dataStep = false;\n        if (fill) {\n          dataFill = \"origin\";\n        }\n        if (step) {\n          dataStep = \"before\";\n        }\n        data.push({\n          label: nameY,\n          fill: dataFill,\n          steppedLine: dataStep,\n          pointRadius: 0,\n          data: [],\n          unitText: unit,\n        });\n      }\n\n      if (\n        domain === \"thermostat\" ||\n        domain === \"climate\" ||\n        domain === \"water_heater\"\n      ) {\n        // We differentiate between thermostats that have a target temperature\n        // range versus ones that have just a target temperature\n\n        // Using step chart by step-before so manually interpolation not needed.\n        const hasTargetRange = states.states.some(\n          (state) =>\n            state.attributes &&\n            state.attributes.target_temp_high !==\n              state.attributes.target_temp_low\n        );\n        const hasHeat = states.states.some((state) => state.state === \"heat\");\n        const hasCool = states.states.some((state) => state.state === \"cool\");\n\n        addColumn(name + \" current temperature\", true);\n        if (hasHeat) {\n          addColumn(name + \" heating\", true, true);\n          // The \"heating\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n        if (hasCool) {\n          addColumn(name + \" cooling\", true, true);\n          // The \"cooling\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n\n        if (hasTargetRange) {\n          addColumn(name + \" target temperature high\", true);\n          addColumn(name + \" target temperature low\", true);\n        } else {\n          addColumn(name + \" target temperature\", true);\n        }\n\n        states.states.forEach((state) => {\n          if (!state.attributes) return;\n          const curTemp = safeParseFloat(state.attributes.current_temperature);\n          const series = [curTemp];\n          if (hasHeat) {\n            series.push(state.state === \"heat\" ? curTemp : null);\n          }\n          if (hasCool) {\n            series.push(state.state === \"cool\" ? curTemp : null);\n          }\n          if (hasTargetRange) {\n            const targetHigh = safeParseFloat(\n              state.attributes.target_temp_high\n            );\n            const targetLow = safeParseFloat(state.attributes.target_temp_low);\n            series.push(targetHigh, targetLow);\n            pushData(new Date(state.last_changed), series);\n          } else {\n            const target = safeParseFloat(state.attributes.temperature);\n            series.push(target);\n            pushData(new Date(state.last_changed), series);\n          }\n        });\n      } else {\n        // Only disable interpolation for sensors\n        const isStep = domain === \"sensor\";\n        addColumn(name, isStep);\n\n        let lastValue = null;\n        let lastDate = null;\n        let lastNullDate = null;\n\n        // Process chart data.\n        // When state is `unknown`, calculate the value and break the line.\n        states.states.forEach((state) => {\n          const value = safeParseFloat(state.state);\n          const date = new Date(state.last_changed);\n          if (value !== null && lastNullDate !== null) {\n            const dateTime = date.getTime();\n            const lastNullDateTime = lastNullDate.getTime();\n            const lastDateTime = lastDate.getTime();\n            const tmpValue =\n              (value - lastValue) *\n                ((lastNullDateTime - lastDateTime) /\n                  (dateTime - lastDateTime)) +\n              lastValue;\n            pushData(lastNullDate, [tmpValue]);\n            pushData(new Date(lastNullDateTime + 1), [null]);\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n            lastNullDate = null;\n          } else if (value !== null && lastNullDate === null) {\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n          } else if (\n            value === null &&\n            lastNullDate === null &&\n            lastValue !== null\n          ) {\n            lastNullDate = date;\n          }\n        });\n      }\n\n      // Add an entry for final values\n      pushData(endTime, prevValues, false);\n\n      // Concat two arrays\n      Array.prototype.push.apply(datasets, data);\n    });\n\n    const formatTooltipTitle = (items, data) => {\n      const item = items[0];\n      const date = data.datasets[item.datasetIndex].data[item.index].x;\n\n      return formatDateTime(date, this.hass.language);\n    };\n\n    const chartOptions = {\n      type: \"line\",\n      unit: unit,\n      legend: !this.isSingleDevice,\n      options: {\n        scales: {\n          xAxes: [\n            {\n              type: \"time\",\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              ticks: {\n                maxTicksLimit: 7,\n              },\n            },\n          ],\n        },\n        tooltips: {\n          mode: \"neareach\",\n          callbacks: {\n            title: formatTooltipTitle,\n          },\n        },\n        hover: {\n          mode: \"neareach\",\n        },\n        layout: {\n          padding: {\n            top: 5,\n          },\n        },\n        elements: {\n          line: {\n            tension: 0.1,\n            pointRadius: 0,\n            borderWidth: 1.5,\n          },\n          point: {\n            hitRadius: 5,\n          },\n        },\n        plugins: {\n          filler: {\n            propagate: true,\n          },\n        },\n      },\n      data: {\n        labels: [],\n        datasets: datasets,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n}\ncustomElements.define(\"state-history-chart-line\", StateHistoryChartLine);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport \"./entity/ha-chart-base\";\n\nimport formatDateTime from \"../common/datetime/format_date_time\";\nimport { computeRTL } from \"../common/util/compute_rtl\";\n\nclass StateHistoryChartTimeline extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          opacity: 0;\n          transition: opacity 0.3s ease-in-out;\n        }\n        :host([rendered]) {\n          opacity: 1;\n        }\n\n        ha-chart-base {\n          direction: ltr;\n        }\n      </style>\n      <ha-chart-base\n        data=\"[[chartData]]\"\n        rendered=\"{{rendered}}\"\n        rtl=\"{{rtl}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      chartData: Object,\n      data: {\n        type: Object,\n        observer: \"dataChanged\",\n      },\n      names: Object,\n      noSingle: Boolean,\n      endTime: Date,\n      rendered: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true,\n      },\n      rtl: {\n        reflectToAttribute: true,\n        computed: \"_computeRTL(hass)\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, localize, language)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  drawChart() {\n    const staticColors = {\n      on: 1,\n      off: 0,\n      unavailable: \"#a0a0a0\",\n      unknown: \"#606060\",\n      idle: 2,\n    };\n    let stateHistory = this.data;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (!stateHistory) {\n      stateHistory = [];\n    }\n\n    const startTime = new Date(\n      stateHistory.reduce(\n        (minTime, stateInfo) =>\n          Math.min(minTime, new Date(stateInfo.data[0].last_changed)),\n        new Date()\n      )\n    );\n\n    // end time is Math.max(startTime, last_event)\n    let endTime =\n      this.endTime ||\n      new Date(\n        stateHistory.reduce(\n          (maxTime, stateInfo) =>\n            Math.max(\n              maxTime,\n              new Date(stateInfo.data[stateInfo.data.length - 1].last_changed)\n            ),\n          startTime\n        )\n      );\n\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const labels = [];\n    const datasets = [];\n    // stateHistory is a list of lists of sorted state objects\n    const names = this.names || {};\n    stateHistory.forEach((stateInfo) => {\n      let newLastChanged;\n      let prevState = null;\n      let locState = null;\n      let prevLastChanged = startTime;\n      const entityDisplay = names[stateInfo.entity_id] || stateInfo.name;\n\n      const dataRow = [];\n      stateInfo.data.forEach((state) => {\n        let newState = state.state;\n        const timeStamp = new Date(state.last_changed);\n        if (newState === undefined || newState === \"\") {\n          newState = null;\n        }\n        if (timeStamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is 'now' and client time is not in sync with server time.\n          return;\n        }\n        if (prevState !== null && newState !== prevState) {\n          newLastChanged = new Date(state.last_changed);\n\n          dataRow.push([prevLastChanged, newLastChanged, locState, prevState]);\n\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = newLastChanged;\n        } else if (prevState === null) {\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = new Date(state.last_changed);\n        }\n      });\n\n      if (prevState !== null) {\n        dataRow.push([prevLastChanged, endTime, locState, prevState]);\n      }\n      datasets.push({ data: dataRow });\n      labels.push(entityDisplay);\n    });\n\n    const formatTooltipLabel = (item, data) => {\n      const values = data.datasets[item.datasetIndex].data[item.index];\n\n      const start = formatDateTime(values[0], this.hass.language);\n      const end = formatDateTime(values[1], this.hass.language);\n      const state = values[2];\n\n      return [state, start, end];\n    };\n\n    const chartOptions = {\n      type: \"timeline\",\n      options: {\n        tooltips: {\n          callbacks: {\n            label: formatTooltipLabel,\n          },\n        },\n        scales: {\n          xAxes: [\n            {\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              afterSetDimensions: (yaxe) => {\n                yaxe.maxWidth = yaxe.chart.width * 0.18;\n              },\n              position: this._computeRTL ? \"right\" : \"left\",\n            },\n          ],\n        },\n      },\n      data: {\n        labels: labels,\n        datasets: datasets,\n      },\n      colors: {\n        staticColors: staticColors,\n        staticColorIndex: 3,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n\n  _computeRTL(hass) {\n    return computeRTL(hass);\n  }\n}\ncustomElements.define(\n  \"state-history-chart-timeline\",\n  StateHistoryChartTimeline\n);\n","import \"@polymer/paper-spinner/paper-spinner\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./state-history-chart-line\";\nimport \"./state-history-chart-timeline\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nclass StateHistoryCharts extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          /* height of single timeline chart = 58px */\n          min-height: 58px;\n        }\n        .info {\n          text-align: center;\n          line-height: 58px;\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsLoading(isLoadingData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.loading_history')]]\n        </div>\n      </template>\n\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsEmpty(isLoadingData, historyData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.no_history_found')]]\n        </div>\n      </template>\n\n      <template is=\"dom-if\" if=\"[[historyData.timeline.length]]\">\n        <state-history-chart-timeline\n          hass=\"[[hass]]\"\n          data=\"[[historyData.timeline]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          no-single=\"[[noSingle]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-timeline>\n      </template>\n\n      <template is=\"dom-repeat\" items=\"[[historyData.line]]\">\n        <state-history-chart-line\n          hass=\"[[hass]]\"\n          unit=\"[[item.unit]]\"\n          data=\"[[item.data]]\"\n          identifier=\"[[item.identifier]]\"\n          is-single-device=\"[[_computeIsSingleLineChart(item.data, noSingle)]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-line>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      historyData: {\n        type: Object,\n        value: null,\n      },\n      names: Object,\n\n      isLoadingData: Boolean,\n\n      endTime: {\n        type: Object,\n      },\n\n      upToNow: Boolean,\n      noSingle: Boolean,\n    };\n  }\n\n  _computeIsSingleLineChart(data, noSingle) {\n    return !noSingle && data && data.length === 1;\n  }\n\n  _computeIsEmpty(isLoadingData, historyData) {\n    const historyDataEmpty =\n      !historyData ||\n      !historyData.timeline ||\n      !historyData.line ||\n      (historyData.timeline.length === 0 && historyData.line.length === 0);\n    return !isLoadingData && historyDataEmpty;\n  }\n\n  _computeIsLoading(isLoading) {\n    return isLoading && !this.historyData;\n  }\n\n  _computeEndTime(endTime, upToNow) {\n    // We don't really care about the value of historyData, but if it change we want to update\n    // endTime.\n    return upToNow ? new Date() : endTime;\n  }\n}\ncustomElements.define(\"state-history-charts\", StateHistoryCharts);\n","import {\n  computeHistory,\n  fetchRecent,\n  HistoryResult,\n  TimelineEntity,\n  LineChartUnit,\n} from \"./history\";\nimport { HomeAssistant } from \"../types\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\ninterface CacheConfig {\n  refresh: number;\n  cacheKey: string;\n  hoursToShow: number;\n}\n\ninterface CachedResults {\n  prom: Promise<HistoryResult>;\n  startTime: Date;\n  endTime: Date;\n  language: string;\n  data: HistoryResult;\n}\n\n// This is a different interface, a different cache :(\ninterface RecentCacheResults {\n  created: number;\n  language: string;\n  data: Promise<HistoryResult>;\n}\n\nconst RECENT_THRESHOLD = 60000; // 1 minute\nconst RECENT_CACHE: { [cacheKey: string]: RecentCacheResults } = {};\nconst stateHistoryCache: { [cacheKey: string]: CachedResults } = {};\n\n// Cached type 1 unction. Without cache config.\nexport const getRecent = (\n  hass: HomeAssistant,\n  entityId: string,\n  startTime: Date,\n  endTime: Date,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = entityId;\n  const cache = RECENT_CACHE[cacheKey];\n\n  if (\n    cache &&\n    Date.now() - cache.created < RECENT_THRESHOLD &&\n    cache.language === language\n  ) {\n    return cache.data;\n  }\n\n  const prom = fetchRecent(hass, entityId, startTime, endTime).then(\n    (stateHistory) => computeHistory(hass, stateHistory, localize, language),\n    (err) => {\n      delete RECENT_CACHE[entityId];\n      throw err;\n    }\n  );\n\n  RECENT_CACHE[cacheKey] = {\n    created: Date.now(),\n    language,\n    data: prom,\n  };\n  return prom;\n};\n\n// Cache type 2 functionality\nfunction getEmptyCache(\n  language: string,\n  startTime: Date,\n  endTime: Date\n): CachedResults {\n  return {\n    prom: Promise.resolve({ line: [], timeline: [] }),\n    language,\n    startTime,\n    endTime,\n    data: { line: [], timeline: [] },\n  };\n}\n\nexport const getRecentWithCache = (\n  hass: HomeAssistant,\n  entityId: string,\n  cacheConfig: CacheConfig,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = cacheConfig.cacheKey;\n  const endTime = new Date();\n  const startTime = new Date(endTime);\n  startTime.setHours(startTime.getHours() - cacheConfig.hoursToShow);\n  let toFetchStartTime = startTime;\n  let appendingToCache = false;\n\n  let cache = stateHistoryCache[cacheKey];\n  if (\n    cache &&\n    toFetchStartTime >= cache.startTime &&\n    toFetchStartTime <= cache.endTime &&\n    cache.language === language\n  ) {\n    toFetchStartTime = cache.endTime;\n    appendingToCache = true;\n    // This pretty much never happens as endTime is usually set to now\n    if (endTime <= cache.endTime) {\n      return cache.prom;\n    }\n  } else {\n    cache = stateHistoryCache[cacheKey] = getEmptyCache(\n      language,\n      startTime,\n      endTime\n    );\n  }\n\n  const curCacheProm = cache.prom;\n\n  const genProm = async () => {\n    let fetchedHistory: HassEntity[][];\n\n    try {\n      const results = await Promise.all([\n        curCacheProm,\n        fetchRecent(\n          hass,\n          entityId,\n          toFetchStartTime,\n          endTime,\n          appendingToCache\n        ),\n      ]);\n      fetchedHistory = results[1];\n    } catch (err) {\n      delete stateHistoryCache[cacheKey];\n      throw err;\n    }\n    const stateHistory = computeHistory(\n      hass,\n      fetchedHistory,\n      localize,\n      language\n    );\n    if (appendingToCache) {\n      mergeLine(stateHistory.line, cache.data.line);\n      mergeTimeline(stateHistory.timeline, cache.data.timeline);\n      pruneStartTime(startTime, cache.data);\n    } else {\n      cache.data = stateHistory;\n    }\n    return cache.data;\n  };\n\n  cache.prom = genProm();\n  cache.startTime = startTime;\n  cache.endTime = endTime;\n  return cache.prom;\n};\n\nconst mergeLine = (\n  historyLines: LineChartUnit[],\n  cacheLines: LineChartUnit[]\n) => {\n  historyLines.forEach((line) => {\n    const unit = line.unit;\n    const oldLine = cacheLines.find((cacheLine) => cacheLine.unit === unit);\n    if (oldLine) {\n      line.data.forEach((entity) => {\n        const oldEntity = oldLine.data.find(\n          (cacheEntity) => entity.entity_id === cacheEntity.entity_id\n        );\n        if (oldEntity) {\n          oldEntity.states = oldEntity.states.concat(entity.states);\n        } else {\n          oldLine.data.push(entity);\n        }\n      });\n    } else {\n      cacheLines.push(line);\n    }\n  });\n};\n\nconst mergeTimeline = (\n  historyTimelines: TimelineEntity[],\n  cacheTimelines: TimelineEntity[]\n) => {\n  historyTimelines.forEach((timeline) => {\n    const oldTimeline = cacheTimelines.find(\n      (cacheTimeline) => cacheTimeline.entity_id === timeline.entity_id\n    );\n    if (oldTimeline) {\n      oldTimeline.data = oldTimeline.data.concat(timeline.data);\n    } else {\n      cacheTimelines.push(timeline);\n    }\n  });\n};\n\nconst pruneArray = (originalStartTime: Date, arr) => {\n  if (arr.length === 0) {\n    return arr;\n  }\n  const changedAfterStartTime = arr.findIndex(\n    (state) => new Date(state.last_changed) > originalStartTime\n  );\n  if (changedAfterStartTime === 0) {\n    // If all changes happened after originalStartTime then we are done.\n    return arr;\n  }\n\n  // If all changes happened at or before originalStartTime. Use last index.\n  const updateIndex =\n    changedAfterStartTime === -1 ? arr.length - 1 : changedAfterStartTime - 1;\n  arr[updateIndex].last_changed = originalStartTime;\n  return arr.slice(updateIndex);\n};\n\nconst pruneStartTime = (originalStartTime: Date, cacheData: HistoryResult) => {\n  cacheData.line.forEach((line) => {\n    line.data.forEach((entity) => {\n      entity.states = pruneArray(originalStartTime, entity.states);\n    });\n  });\n\n  cacheData.timeline.forEach((timeline) => {\n    timeline.data = pruneArray(originalStartTime, timeline.data);\n  });\n};\n","import { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport { computeHistory, fetchDate } from \"./history\";\nimport { getRecent, getRecentWithCache } from \"./cached-history\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaStateHistoryData extends LocalizeMixin(PolymerElement) {\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"hassChanged\",\n      },\n\n      filterType: String,\n\n      cacheConfig: Object,\n\n      startTime: Date,\n      endTime: Date,\n\n      entityId: String,\n\n      isLoading: {\n        type: Boolean,\n        value: true,\n        readOnly: true,\n        notify: true,\n      },\n\n      data: {\n        type: Object,\n        value: null,\n        readOnly: true,\n        notify: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\n      \"filterChangedDebouncer(filterType, entityId, startTime, endTime, cacheConfig, localize)\",\n    ];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.filterChangedDebouncer(\n      this.filterType,\n      this.entityId,\n      this.startTime,\n      this.endTime,\n      this.cacheConfig,\n      this.localize\n    );\n  }\n\n  disconnectedCallback() {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    super.disconnectedCallback();\n  }\n\n  hassChanged(newHass, oldHass) {\n    if (!oldHass && !this._madeFirstCall) {\n      this.filterChangedDebouncer(\n        this.filterType,\n        this.entityId,\n        this.startTime,\n        this.endTime,\n        this.cacheConfig,\n        this.localize\n      );\n    }\n  }\n\n  filterChangedDebouncer(...args) {\n    this._debounceFilterChanged = Debouncer.debounce(\n      this._debounceFilterChanged,\n      timeOut.after(0),\n      () => {\n        this.filterChanged(...args);\n      }\n    );\n  }\n\n  filterChanged(\n    filterType,\n    entityId,\n    startTime,\n    endTime,\n    cacheConfig,\n    localize\n  ) {\n    if (!this.hass) {\n      return;\n    }\n    if (cacheConfig && !cacheConfig.cacheKey) {\n      return;\n    }\n    if (!localize) {\n      return;\n    }\n    this._madeFirstCall = true;\n    const language = this.hass.language;\n    let data;\n\n    if (filterType === \"date\") {\n      if (!startTime || !endTime) return;\n\n      data = fetchDate(this.hass, startTime, endTime).then((dateHistory) =>\n        computeHistory(this.hass, dateHistory, localize, language)\n      );\n    } else if (filterType === \"recent-entity\") {\n      if (!entityId) return;\n      if (cacheConfig) {\n        data = this.getRecentWithCacheRefresh(\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        );\n      } else {\n        data = getRecent(\n          this.hass,\n          entityId,\n          startTime,\n          endTime,\n          localize,\n          language\n        );\n      }\n    } else {\n      return;\n    }\n    this._setIsLoading(true);\n\n    data.then((stateHistory) => {\n      this._setData(stateHistory);\n      this._setIsLoading(false);\n    });\n  }\n\n  getRecentWithCacheRefresh(entityId, cacheConfig, localize, language) {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    if (cacheConfig.refresh) {\n      this._refreshTimeoutId = window.setInterval(() => {\n        getRecentWithCache(\n          this.hass,\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        ).then((stateHistory) => {\n          this._setData(Object.assign({}, stateHistory));\n        });\n      }, cacheConfig.refresh * 1000);\n    }\n    return getRecentWithCache(\n      this.hass,\n      entityId,\n      cacheConfig,\n      localize,\n      language\n    );\n  }\n}\ncustomElements.define(\"ha-state-history-data\", HaStateHistoryData);\n","import computeStateName from \"../common/entity/compute_state_name\";\nimport computeStateDomain from \"../common/entity/compute_state_domain\";\nimport computeStateDisplay from \"../common/entity/compute_state_display\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { HomeAssistant } from \"../types\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\nconst DOMAINS_USE_LAST_UPDATED = [\"climate\", \"water_heater\"];\nconst LINE_ATTRIBUTES_TO_KEEP = [\n  \"temperature\",\n  \"current_temperature\",\n  \"target_temp_low\",\n  \"target_temp_high\",\n];\n\nexport interface LineChartState {\n  state: string;\n  last_changed: string;\n  attributes?: { [key: string]: any };\n}\n\nexport interface LineChartEntity {\n  domain: string;\n  name: string;\n  entity_id: string;\n  states: LineChartState[];\n}\n\nexport interface LineChartUnit {\n  unit: string;\n  identifier: string;\n  data: LineChartEntity[];\n}\n\nexport interface TimelineState {\n  state_localize: string;\n  state: string;\n  last_changed: string;\n}\n\nexport interface TimelineEntity {\n  name: string;\n  entity_id: string;\n  data: TimelineState[];\n}\n\nexport interface HistoryResult {\n  line: LineChartUnit[];\n  timeline: TimelineEntity[];\n}\n\nexport const fetchRecent = (\n  hass,\n  entityId,\n  startTime,\n  endTime,\n  skipInitialState = false\n): Promise<HassEntity[][]> => {\n  let url = \"history/period\";\n  if (startTime) {\n    url += \"/\" + startTime.toISOString();\n  }\n  url += \"?filter_entity_id=\" + entityId;\n  if (endTime) {\n    url += \"&end_time=\" + endTime.toISOString();\n  }\n  if (skipInitialState) {\n    url += \"&skip_initial_state\";\n  }\n\n  return hass.callApi(\"GET\", url);\n};\n\nexport const fetchDate = (\n  hass: HomeAssistant,\n  startTime: Date,\n  endTime: Date\n): Promise<HassEntity[][]> => {\n  return hass.callApi(\n    \"GET\",\n    `history/period/${startTime.toISOString()}?end_time=${endTime.toISOString()}`\n  );\n};\n\nconst equalState = (obj1: LineChartState, obj2: LineChartState) =>\n  obj1.state === obj2.state &&\n  // They either both have an attributes object or not\n  (!obj1.attributes ||\n    LINE_ATTRIBUTES_TO_KEEP.every(\n      (attr) => obj1.attributes![attr] === obj2.attributes![attr]\n    ));\n\nconst processTimelineEntity = (\n  localize: LocalizeFunc,\n  language: string,\n  states: HassEntity[]\n): TimelineEntity => {\n  const data: TimelineState[] = [];\n\n  for (const state of states) {\n    if (data.length > 0 && state.state === data[data.length - 1].state) {\n      continue;\n    }\n\n    data.push({\n      state_localize: computeStateDisplay(localize, state, language),\n      state: state.state,\n      last_changed: state.last_changed,\n    });\n  }\n\n  return {\n    name: computeStateName(states[0]),\n    entity_id: states[0].entity_id,\n    data,\n  };\n};\n\nconst processLineChartEntities = (\n  unit,\n  entities: HassEntity[][]\n): LineChartUnit => {\n  const data: LineChartEntity[] = [];\n\n  for (const states of entities) {\n    const last: HassEntity = states[states.length - 1];\n    const domain = computeStateDomain(last);\n    const processedStates: LineChartState[] = [];\n\n    for (const state of states) {\n      let processedState: LineChartState;\n\n      if (DOMAINS_USE_LAST_UPDATED.includes(domain)) {\n        processedState = {\n          state: state.state,\n          last_changed: state.last_updated,\n          attributes: {},\n        };\n\n        for (const attr of LINE_ATTRIBUTES_TO_KEEP) {\n          if (attr in state.attributes) {\n            processedState.attributes![attr] = state.attributes[attr];\n          }\n        }\n      } else {\n        processedState = state;\n      }\n\n      if (\n        processedStates.length > 1 &&\n        equalState(\n          processedState,\n          processedStates[processedStates.length - 1]\n        ) &&\n        equalState(processedState, processedStates[processedStates.length - 2])\n      ) {\n        continue;\n      }\n\n      processedStates.push(processedState);\n    }\n\n    data.push({\n      domain,\n      name: computeStateName(last),\n      entity_id: last.entity_id,\n      states: processedStates,\n    });\n  }\n\n  return {\n    unit,\n    identifier: entities.map((states) => states[0].entity_id).join(\"\"),\n    data,\n  };\n};\n\nexport const computeHistory = (\n  hass: HomeAssistant,\n  stateHistory: HassEntity[][],\n  localize: LocalizeFunc,\n  language: string\n): HistoryResult => {\n  const lineChartDevices: { [unit: string]: HassEntity[][] } = {};\n  const timelineDevices: TimelineEntity[] = [];\n  if (!stateHistory) {\n    return { line: [], timeline: [] };\n  }\n\n  stateHistory.forEach((stateInfo) => {\n    if (stateInfo.length === 0) {\n      return;\n    }\n\n    const stateWithUnit = stateInfo.find(\n      (state) => \"unit_of_measurement\" in state.attributes\n    );\n\n    let unit: string | undefined;\n\n    if (stateWithUnit) {\n      unit = stateWithUnit.attributes.unit_of_measurement;\n    } else if (computeStateDomain(stateInfo[0]) === \"climate\") {\n      unit = hass.config.unit_system.temperature;\n    } else if (computeStateDomain(stateInfo[0]) === \"water_heater\") {\n      unit = hass.config.unit_system.temperature;\n    }\n\n    if (!unit) {\n      timelineDevices.push(\n        processTimelineEntity(localize, language, stateInfo)\n      );\n    } else if (unit in lineChartDevices) {\n      lineChartDevices[unit].push(stateInfo);\n    } else {\n      lineChartDevices[unit] = [stateInfo];\n    }\n  });\n\n  const unitStates = Object.keys(lineChartDevices).map((unit) =>\n    processLineChartEntities(unit, lineChartDevices[unit])\n  );\n\n  return { line: unitStates, timeline: timelineDevices };\n};\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n"],"sourceRoot":""}