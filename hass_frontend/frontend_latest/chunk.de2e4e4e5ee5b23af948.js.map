{"version":3,"sources":["webpack:///./src/panels/lovelace/common/compute-unused-entities.ts","webpack:///./src/panels/lovelace/hui-unused-entities.ts"],"names":["EXCLUDED_DOMAINS","addFromAction","entities","actionConfig","action","service_data","entity_id","entityIds","Array","isArray","entityId","add","addEntityId","entity","camera_image","tap_action","hold_action","addEntities","obj","forEach","card","cards","elements","badges","badge","computeUnusedEntities","hass","config","usedEntities","Set","views","view","computeUsedEntities","Object","keys","states","filter","has","includes","split","sort","HuiUnusedEntities","_decorate","_initialize","_LitElement","F","[object Object]","args","super","this","d","kind","key","value","decorators","property","static","_hass","_config","_elements","element","_createElements","html","renderStyle","domains","domain","computeDomain","push","map","el","createCardElement","type","title","localize","secondary_info","show_header_toggle","LitElement","customElements","define"],"mappings":"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","file":"chunk.de2e4e4e5ee5b23af948.js","sourcesContent":["import { LovelaceConfig, ActionConfig } from \"../../../data/lovelace\";\nimport { HomeAssistant } from \"../../../types\";\n\nconst EXCLUDED_DOMAINS = [\"zone\"];\n\nconst addFromAction = (entities: Set<string>, actionConfig: ActionConfig) => {\n  if (\n    actionConfig.action !== \"call-service\" ||\n    !actionConfig.service_data ||\n    !actionConfig.service_data.entity_id\n  ) {\n    return;\n  }\n  let entityIds = actionConfig.service_data.entity_id;\n  if (!Array.isArray(entityIds)) {\n    entityIds = [entityIds];\n  }\n  for (const entityId of entityIds) {\n    entities.add(entityId);\n  }\n};\n\nconst addEntityId = (entities: Set<string>, entity) => {\n  if (typeof entity === \"string\") {\n    entities.add(entity);\n    return;\n  }\n\n  if (entity.entity) {\n    entities.add(entity.entity);\n  }\n  if (entity.camera_image) {\n    entities.add(entity.camera_image);\n  }\n  if (entity.tap_action) {\n    addFromAction(entities, entity.tap_action);\n  }\n  if (entity.hold_action) {\n    addFromAction(entities, entity.hold_action);\n  }\n};\n\nconst addEntities = (entities: Set<string>, obj) => {\n  if (obj.entity) {\n    addEntityId(entities, obj.entity);\n  }\n  if (obj.entities) {\n    obj.entities.forEach((entity) => addEntityId(entities, entity));\n  }\n  if (obj.card) {\n    addEntities(entities, obj.card);\n  }\n  if (obj.cards) {\n    obj.cards.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.elements) {\n    obj.elements.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.badges) {\n    obj.badges.forEach((badge) => addEntityId(entities, badge));\n  }\n};\n\nconst computeUsedEntities = (config) => {\n  const entities = new Set<string>();\n  config.views.forEach((view) => addEntities(entities, view));\n  return entities;\n};\n\nexport const computeUnusedEntities = (\n  hass: HomeAssistant,\n  config: LovelaceConfig\n): string[] => {\n  const usedEntities = computeUsedEntities(config);\n  return Object.keys(hass.states)\n    .filter(\n      (entity) =>\n        !usedEntities.has(entity) &&\n        !EXCLUDED_DOMAINS.includes(entity.split(\".\", 1)[0])\n    )\n    .sort();\n};\n","import {\n  html,\n  LitElement,\n  PropertyDeclarations,\n  property,\n  TemplateResult,\n} from \"lit-element\";\n\nimport \"./cards/hui-entities-card\";\n\nimport { computeUnusedEntities } from \"./common/compute-unused-entities\";\nimport { createCardElement } from \"./common/create-card-element\";\nimport { HomeAssistant } from \"../../types\";\nimport { LovelaceCard } from \"./types\";\nimport { LovelaceConfig } from \"../../data/lovelace\";\nimport computeDomain from \"../../common/entity/compute_domain\";\n\nexport class HuiUnusedEntities extends LitElement {\n  private _hass?: HomeAssistant;\n  \n  @property() private _config?: LovelaceConfig;\n  \n  private _elements?: LovelaceCard[];\n\n  static get properties(): PropertyDeclarations {\n    return {\n      _hass: {},\n      _config: {},\n    };\n  }\n\n  set hass(hass: HomeAssistant) {\n    this._hass = hass;\n    if (!this._elements) {\n      this._createElements();\n      return;\n    }\n    for (const element of this._elements) {\n      element.hass = this._hass;\n    }\n  }\n\n  public setConfig(config: LovelaceConfig): void {\n    this._config = config;\n    this._createElements();\n  }\n\n  protected render(): TemplateResult | void {\n    if (!this._config || !this._hass) {\n      return html``;\n    }\n\n    return html`\n      ${this.renderStyle()}\n      <div id=\"root\">${this._elements}</div>\n    `;\n  }\n\n  private renderStyle(): TemplateResult {\n    return html`\n      <style>\n        #root {\n          padding: 4px;\n          display: flex;\n          flex-wrap: wrap;\n        }\n        hui-entities-card {\n          max-width: 400px;\n          padding: 4px;\n          flex: 1 auto;\n        }\n      </style>\n    `;\n  }\n\n  private _createElements(): void {\n    if (!this._hass) {\n      return;\n    }\n    const domains: { [domain: string]: string[] } = {};\n    computeUnusedEntities(this._hass, this._config!).forEach((entity) => {\n      const domain = computeDomain(entity);\n\n      if (!(domain in domains)) {\n        domains[domain] = [];\n      }\n      domains[domain].push(entity);\n    });\n    this._elements = Object.keys(domains)\n      .sort()\n      .map((domain) => {\n        const el = createCardElement({\n          type: \"entities\",\n          title: this._hass!.localize(`domain.${domain}`) || domain,\n          entities: domains[domain].map((entity) => ({\n            entity,\n            secondary_info: \"entity-id\",\n          })),\n          show_header_toggle: false,\n        });\n        el.hass = this._hass;\n        return el;\n      });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-unused-entities\": HuiUnusedEntities;\n  }\n}\ncustomElements.define(\"hui-unused-entities\", HuiUnusedEntities);\n"],"sourceRoot":""}