{"version":3,"sources":["webpack:///./src/common/dom/setup-leaflet-map.ts","webpack:///./src/common/entity/compute_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/entity/compute_state_domain.ts","webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/components/ha-icon.ts","webpack:///./src/mixins/events-mixin.js","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/panels/map/ha-entity-marker.js","webpack:///./src/panels/map/ha-panel-map.js"],"names":["setupLeafletMap","mapElement","parentNode","Error","Leaflet","Icon","Default","imagePath","map","style","document","createElement","setAttribute","appendChild","setView","tileLayer","Browser","retina","attribution","subdomains","minZoom","maxZoom","addTo","computeDomain","entityId","substr","indexOf","computeObjectId","computeStateDomain","stateObj","entity_id","attributes","friendly_name","undefined","replace","ironIconClass","customElements","get","loaded","HaIcon","listen","node","eventName","methodName","_iconsetName","define","EventsMixin","dedupingMixin","superClass","fire","type","detail","options","fireEvent","properties","hass","Object","localize","Function","computed","__computeLocalize","HaEntityMarker","PolymerElement","template","html","String","value","entityName","entityPicture","ready","addEventListener","ev","badgeTap","stopPropagation","HaPanelMap","LocalizeMixin","observer","connectedCallback","loadMap","_map","$","drawEntities","invalidateSize","fitMap","disconnectedCallback","remove","bounds","_mapItems","length","LatLng","config","latitude","longitude","latLngBounds","item","getLatLng","fitBounds","pad","forEach","marker","mapItems","keys","states","entity","title","computeStateName","hidden","state","icon","passive","iconHTML","el","outerHTML","divIcon","iconSize","className","push","interactive","circle","color","radius","entity_picture","split","part","join","gps_accuracy"],"mappings":"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","file":"panel-map.chunk.js","sourcesContent":["import { Map } from \"leaflet\";\n\n// Sets up a Leaflet map on the provided DOM element\nexport type LeafletModuleType = typeof import(\"leaflet\");\n\nexport const setupLeafletMap = async (\n  mapElement: HTMLElement\n): Promise<[Map, LeafletModuleType]> => {\n  if (!mapElement.parentNode) {\n    throw new Error(\"Cannot setup Leaflet map on disconnected element\");\n  }\n  // tslint:disable-next-line\n  const Leaflet = (await import(/* webpackChunkName: \"leaflet\" */ \"leaflet\")) as LeafletModuleType;\n  Leaflet.Icon.Default.imagePath = \"/static/images/leaflet/images/\";\n\n  const map = Leaflet.map(mapElement);\n  const style = document.createElement(\"link\");\n  style.setAttribute(\"href\", \"/static/images/leaflet/leaflet.css\");\n  style.setAttribute(\"rel\", \"stylesheet\");\n  mapElement.parentNode.appendChild(style);\n  map.setView([52.3731339, 4.8903147], 13);\n  Leaflet.tileLayer(\n    `https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}${\n      Leaflet.Browser.retina ? \"@2x.png\" : \".png\"\n    }`,\n    {\n      attribution:\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>, &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n      subdomains: \"abcd\",\n      minZoom: 0,\n      maxZoom: 20,\n    }\n  ).addTo(map);\n\n  return [map, Leaflet];\n};\n","export default function computeDomain(entityId: string): string {\n  return entityId.substr(0, entityId.indexOf(\".\"));\n}\n","/** Compute the object ID of a state. */\nexport default function computeObjectId(entityId: string): string {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeDomain from \"./compute_domain\";\n\nexport default function computeStateDomain(stateObj: HassEntity) {\n  return computeDomain(stateObj.entity_id);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeObjectId from \"./compute_object_id\";\n\nexport default (stateObj: HassEntity): string =>\n  stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n","import { Constructor } from \"lit-element\";\nimport \"@polymer/iron-icon/iron-icon\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { IronIconElement } from \"@polymer/iron-icon/iron-icon\";\n\nconst ironIconClass = customElements.get(\"iron-icon\") as Constructor<\n  IronIconElement\n>;\n\nlet loaded = false;\n\nexport class HaIcon extends ironIconClass {\n  private _iconsetName?: string;\n\n  public listen(\n    node: EventTarget | null,\n    eventName: string,\n    methodName: string\n  ): void {\n    super.listen(node, eventName, methodName);\n\n    if (!loaded && this._iconsetName === \"mdi\") {\n      loaded = true;\n      import(/* webpackChunkName: \"mdi-icons\" */ \"../resources/mdi-icons\");\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n\ncustomElements.define(\"ha-icon\", HaIcon);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import \"@polymer/iron-image/iron-image\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport { EventsMixin } from \"../../mixins/events-mixin\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaEntityMarker extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-positioning\"></style>\n      <style>\n        .marker {\n          vertical-align: top;\n          position: relative;\n          display: block;\n          margin: 0 auto;\n          width: 2.5em;\n          text-align: center;\n          height: 2.5em;\n          line-height: 2.5em;\n          font-size: 1.5em;\n          border-radius: 50%;\n          border: 0.1em solid\n            var(--ha-marker-color, var(--default-primary-color));\n          color: rgb(76, 76, 76);\n          background-color: white;\n        }\n        iron-image {\n          border-radius: 50%;\n        }\n      </style>\n\n      <div class=\"marker\">\n        <template is=\"dom-if\" if=\"[[entityName]]\"\n          >[[entityName]]</template\n        >\n        <template is=\"dom-if\" if=\"[[entityPicture]]\">\n          <iron-image\n            sizing=\"cover\"\n            class=\"fit\"\n            src=\"[[entityPicture]]\"\n          ></iron-image>\n        </template>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      entityId: {\n        type: String,\n        value: \"\",\n      },\n\n      entityName: {\n        type: String,\n        value: null,\n      },\n\n      entityPicture: {\n        type: String,\n        value: null,\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"click\", (ev) => this.badgeTap(ev));\n  }\n\n  badgeTap(ev) {\n    ev.stopPropagation();\n    if (this.entityId) {\n      this.fire(\"hass-more-info\", { entityId: this.entityId });\n    }\n  }\n}\n\ncustomElements.define(\"ha-entity-marker\", HaEntityMarker);\n","import \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"../../components/ha-menu-button\";\nimport \"../../components/ha-icon\";\n\nimport \"./ha-entity-marker\";\n\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport computeStateName from \"../../common/entity/compute_state_name\";\nimport LocalizeMixin from \"../../mixins/localize-mixin\";\nimport { setupLeafletMap } from \"../../common/dom/setup-leaflet-map\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaPanelMap extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"ha-style\">\n        #map {\n          height: calc(100% - 64px);\n          width: 100%;\n          z-index: 0;\n        }\n      </style>\n\n      <app-toolbar>\n        <ha-menu-button></ha-menu-button>\n        <div main-title>[[localize('panel.map')]]</div>\n      </app-toolbar>\n\n      <div id=\"map\"></div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"drawEntities\",\n      },\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.loadMap();\n  }\n\n  async loadMap() {\n    [this._map, this.Leaflet] = await setupLeafletMap(this.$.map);\n    this.drawEntities(this.hass);\n    this._map.invalidateSize();\n    this.fitMap();\n  }\n\n  disconnectedCallback() {\n    if (this._map) {\n      this._map.remove();\n    }\n  }\n\n  fitMap() {\n    var bounds;\n\n    if (this._mapItems.length === 0) {\n      this._map.setView(\n        new this.Leaflet.LatLng(\n          this.hass.config.latitude,\n          this.hass.config.longitude\n        ),\n        14\n      );\n    } else {\n      bounds = new this.Leaflet.latLngBounds(\n        this._mapItems.map((item) => item.getLatLng())\n      );\n      this._map.fitBounds(bounds.pad(0.5));\n    }\n  }\n\n  drawEntities(hass) {\n    /* eslint-disable vars-on-top */\n    var map = this._map;\n    if (!map) return;\n\n    if (this._mapItems) {\n      this._mapItems.forEach(function(marker) {\n        marker.remove();\n      });\n    }\n    var mapItems = (this._mapItems = []);\n\n    Object.keys(hass.states).forEach((entityId) => {\n      var entity = hass.states[entityId];\n      var title = computeStateName(entity);\n\n      if (\n        (entity.attributes.hidden && computeStateDomain(entity) !== \"zone\") ||\n        entity.state === \"home\" ||\n        !(\"latitude\" in entity.attributes) ||\n        !(\"longitude\" in entity.attributes)\n      ) {\n        return;\n      }\n\n      var icon;\n\n      if (computeStateDomain(entity) === \"zone\") {\n        // DRAW ZONE\n        if (entity.attributes.passive) return;\n\n        // create icon\n        var iconHTML = \"\";\n        if (entity.attributes.icon) {\n          const el = document.createElement(\"ha-icon\");\n          el.setAttribute(\"icon\", entity.attributes.icon);\n          iconHTML = el.outerHTML;\n        } else {\n          iconHTML = title;\n        }\n\n        icon = this.Leaflet.divIcon({\n          html: iconHTML,\n          iconSize: [24, 24],\n          className: \"\",\n        });\n\n        // create market with the icon\n        mapItems.push(\n          this.Leaflet.marker(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              icon: icon,\n              interactive: false,\n              title: title,\n            }\n          ).addTo(map)\n        );\n\n        // create circle around it\n        mapItems.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: \"#FF9800\",\n              radius: entity.attributes.radius,\n            }\n          ).addTo(map)\n        );\n\n        return;\n      }\n\n      // DRAW ENTITY\n      // create icon\n      var entityPicture = entity.attributes.entity_picture || \"\";\n      var entityName = title\n        .split(\" \")\n        .map(function(part) {\n          return part.substr(0, 1);\n        })\n        .join(\"\");\n      /* Leaflet clones this element before adding it to the map. This messes up\n         our Polymer object and we can't pass data through. Thus we hack like this. */\n      icon = this.Leaflet.divIcon({\n        html:\n          \"<ha-entity-marker entity-id='\" +\n          entity.entity_id +\n          \"' entity-name='\" +\n          entityName +\n          \"' entity-picture='\" +\n          entityPicture +\n          \"'></ha-entity-marker>\",\n        iconSize: [45, 45],\n        className: \"\",\n      });\n\n      // create market with the icon\n      mapItems.push(\n        this.Leaflet.marker(\n          [entity.attributes.latitude, entity.attributes.longitude],\n          {\n            icon: icon,\n            title: computeStateName(entity),\n          }\n        ).addTo(map)\n      );\n\n      // create circle around if entity has accuracy\n      if (entity.attributes.gps_accuracy) {\n        mapItems.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: \"#0288D1\",\n              radius: entity.attributes.gps_accuracy,\n            }\n          ).addTo(map)\n        );\n      }\n    });\n  }\n}\n\ncustomElements.define(\"ha-panel-map\", HaPanelMap);\n"],"sourceRoot":""}