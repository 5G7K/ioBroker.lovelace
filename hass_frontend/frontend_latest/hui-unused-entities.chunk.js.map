{"version":3,"sources":["webpack:///./src/panels/lovelace/common/compute-unused-entities.ts","webpack:///./src/panels/lovelace/hui-unused-entities.ts"],"names":["EXCLUDED_DOMAINS","addFromAction","entities","actionConfig","action","service_data","entity_id","entityIds","Array","isArray","entityId","add","addEntityId","entity","camera_image","tap_action","hold_action","addEntities","obj","forEach","card","cards","elements","badges","badge","computeUsedEntities","config","Set","views","view","computeUnusedEntities","hass","usedEntities","Object","keys","states","filter","has","includes","split","sort","HuiUnusedEntities","property","_hass","_config","_elements","_createElements","element","html","renderStyle","domains","domain","computeDomain","push","map","el","createCardElement","type","title","localize","secondary_info","show_header_toggle","LitElement","customElements","define"],"mappings":"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","file":"hui-unused-entities.chunk.js","sourcesContent":["import { LovelaceConfig, ActionConfig } from \"../../../data/lovelace\";\nimport { HomeAssistant } from \"../../../types\";\n\nconst EXCLUDED_DOMAINS = [\"zone\"];\n\nconst addFromAction = (entities: Set<string>, actionConfig: ActionConfig) => {\n  if (\n    actionConfig.action !== \"call-service\" ||\n    !actionConfig.service_data ||\n    !actionConfig.service_data.entity_id\n  ) {\n    return;\n  }\n  let entityIds = actionConfig.service_data.entity_id;\n  if (!Array.isArray(entityIds)) {\n    entityIds = [entityIds];\n  }\n  for (const entityId of entityIds) {\n    entities.add(entityId);\n  }\n};\n\nconst addEntityId = (entities: Set<string>, entity) => {\n  if (typeof entity === \"string\") {\n    entities.add(entity);\n    return;\n  }\n\n  if (entity.entity) {\n    entities.add(entity.entity);\n  }\n  if (entity.camera_image) {\n    entities.add(entity.camera_image);\n  }\n  if (entity.tap_action) {\n    addFromAction(entities, entity.tap_action);\n  }\n  if (entity.hold_action) {\n    addFromAction(entities, entity.hold_action);\n  }\n};\n\nconst addEntities = (entities: Set<string>, obj) => {\n  if (obj.entity) {\n    addEntityId(entities, obj.entity);\n  }\n  if (obj.entities) {\n    obj.entities.forEach((entity) => addEntityId(entities, entity));\n  }\n  if (obj.card) {\n    addEntities(entities, obj.card);\n  }\n  if (obj.cards) {\n    obj.cards.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.elements) {\n    obj.elements.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.badges) {\n    obj.badges.forEach((badge) => addEntityId(entities, badge));\n  }\n};\n\nconst computeUsedEntities = (config) => {\n  const entities = new Set();\n  config.views.forEach((view) => addEntities(entities, view));\n  return entities;\n};\n\nexport const computeUnusedEntities = (\n  hass: HomeAssistant,\n  config: LovelaceConfig\n): string[] => {\n  const usedEntities = computeUsedEntities(config);\n  return Object.keys(hass.states)\n    .filter(\n      (entity) =>\n        !usedEntities.has(entity) &&\n        !EXCLUDED_DOMAINS.includes(entity.split(\".\", 1)[0])\n    )\n    .sort();\n};\n","import {\n  html,\n  LitElement,\n  PropertyDeclarations,\n  property,\n  TemplateResult,\n} from \"lit-element\";\n\nimport \"./cards/hui-entities-card\";\n\nimport { computeUnusedEntities } from \"./common/compute-unused-entities\";\nimport { createCardElement } from \"./common/create-card-element\";\nimport { HomeAssistant } from \"../../types\";\nimport { LovelaceCard } from \"./types\";\nimport { LovelaceConfig } from \"../../data/lovelace\";\nimport computeDomain from \"../../common/entity/compute_domain\";\n\nexport class HuiUnusedEntities extends LitElement {\n  private _hass?: HomeAssistant;\n  @property() private _config?: LovelaceConfig;\n  private _elements?: LovelaceCard[];\n\n  static get properties(): PropertyDeclarations {\n    return {\n      _hass: {},\n      _config: {},\n    };\n  }\n\n  set hass(hass: HomeAssistant) {\n    this._hass = hass;\n    if (!this._elements) {\n      this._createElements();\n      return;\n    }\n    for (const element of this._elements) {\n      element.hass = this._hass;\n    }\n  }\n\n  public setConfig(config: LovelaceConfig): void {\n    this._config = config;\n    this._createElements();\n  }\n\n  protected render(): TemplateResult | void {\n    if (!this._config || !this._hass) {\n      return html``;\n    }\n\n    return html`\n      ${this.renderStyle()}\n      <div id=\"root\">${this._elements}</div>\n    `;\n  }\n\n  private renderStyle(): TemplateResult {\n    return html`\n      <style>\n        #root {\n          padding: 4px;\n          display: flex;\n          flex-wrap: wrap;\n        }\n        hui-entities-card {\n          max-width: 400px;\n          padding: 4px;\n          flex: 1 auto;\n        }\n      </style>\n    `;\n  }\n\n  private _createElements(): void {\n    if (!this._hass) {\n      return;\n    }\n    const domains: { [domain: string]: string[] } = {};\n    computeUnusedEntities(this._hass, this._config!).forEach((entity) => {\n      const domain = computeDomain(entity);\n\n      if (!(domain in domains)) {\n        domains[domain] = [];\n      }\n      domains[domain].push(entity);\n    });\n    this._elements = Object.keys(domains)\n      .sort()\n      .map((domain) => {\n        const el = createCardElement({\n          type: \"entities\",\n          title: this._hass!.localize(`domain.${domain}`) || domain,\n          entities: domains[domain].map((entity) => ({\n            entity,\n            secondary_info: \"entity-id\",\n          })),\n          show_header_toggle: false,\n        });\n        el.hass = this._hass;\n        return el;\n      });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-unused-entities\": HuiUnusedEntities;\n  }\n}\ncustomElements.define(\"hui-unused-entities\", HuiUnusedEntities);\n"],"sourceRoot":""}