{"version":3,"sources":["webpack:///./src/onboarding/onboarding-core-config.ts"],"names":["amsterdam","OnboardingCoreConfig","customElement","property","html","onboardingLocalize","hass","user","name","_working","_nameValue","_handleChange","_detect","_locationValue","_locationChanged","localize","_timeZoneValue","_elevationValue","_unitSystemValue","_unitSystemChanged","_save","changedProps","setTimeout","shadowRoot","querySelector","focus","addEventListener","ev","keyCode","input","inputElement","appendChild","createTimezoneListEl","_name","undefined","_location","_elevation","_timeZone","_unitSystem","target","currentTarget","value","location","detail","detectCoreConfig","values","latitude","longitude","Number","elevation","String","unit_system","time_zone","alert","message","preventDefault","saveCoreConfig","location_name","onboardCoreConfigStep","result","fireEvent","type","css","LitElement"],"mappings":"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","file":"onboarding-core-config.chunk.js","sourcesContent":["import {\n  LitElement,\n  customElement,\n  property,\n  TemplateResult,\n  html,\n  CSSResult,\n  css,\n} from \"lit-element\";\nimport \"@material/mwc-button/mwc-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-radio-group/paper-radio-group\";\nimport \"@polymer/paper-radio-button/paper-radio-button\";\n// tslint:disable-next-line: no-duplicate-imports\nimport { PaperInputElement } from \"@polymer/paper-input/paper-input\";\nimport { HomeAssistant } from \"../types\";\nimport {\n  ConfigUpdateValues,\n  detectCoreConfig,\n  saveCoreConfig,\n} from \"../data/core\";\nimport { PolymerChangedEvent } from \"../polymer-types\";\nimport { onboardCoreConfigStep } from \"../data/onboarding\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\nimport { createTimezoneListEl } from \"../components/timezone-datalist\";\nimport \"../components/map/ha-location-editor\";\n\nconst amsterdam = [52.3731339, 4.8903147];\n\n@customElement(\"onboarding-core-config\")\nclass OnboardingCoreConfig extends LitElement {\n  @property() public hass!: HomeAssistant;\n  @property() public onboardingLocalize!: LocalizeFunc;\n\n  @property() private _working = false;\n\n  @property() private _name!: ConfigUpdateValues[\"location_name\"];\n  @property() private _location!: [number, number];\n  @property() private _elevation!: string;\n  @property() private _unitSystem!: ConfigUpdateValues[\"unit_system\"];\n  @property() private _timeZone!: string;\n\n  protected render(): TemplateResult | void {\n    return html`\n      <p>\n        ${this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.intro\",\n          \"name\",\n          this.hass.user!.name\n        )}\n      </p>\n\n      <paper-input\n        .label=${this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.location_name\"\n        )}\n        name=\"name\"\n        .disabled=${this._working}\n        .value=${this._nameValue}\n        @value-changed=${this._handleChange}\n      ></paper-input>\n\n      <div class=\"middle-text\">\n        <p>\n          ${this.onboardingLocalize(\n            \"ui.panel.page-onboarding.core-config.intro_location\"\n          )}\n        </p>\n\n        <div class=\"row\">\n          <div>\n            ${this.onboardingLocalize(\n              \"ui.panel.page-onboarding.core-config.intro_location_detect\"\n            )}\n          </div>\n          <mwc-button @click=${this._detect}>\n            ${this.onboardingLocalize(\n              \"ui.panel.page-onboarding.core-config.button_detect\"\n            )}\n          </mwc-button>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <ha-location-editor\n          class=\"flex\"\n          .location=${this._locationValue}\n          .fitZoom=${14}\n          @change=${this._locationChanged}\n        ></ha-location-editor>\n      </div>\n\n      <div class=\"row\">\n        <paper-input\n          class=\"flex\"\n          .label=${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.time_zone\"\n          )}\n          name=\"timeZone\"\n          list=\"timezones\"\n          .disabled=${this._working}\n          .value=${this._timeZoneValue}\n          @value-changed=${this._handleChange}\n        ></paper-input>\n\n        <paper-input\n          class=\"flex\"\n          .label=${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.elevation\"\n          )}\n          name=\"elevation\"\n          type=\"number\"\n          .disabled=${this._working}\n          .value=${this._elevationValue}\n          @value-changed=${this._handleChange}\n        >\n          <span slot=\"suffix\">\n            ${this.hass.localize(\n              \"ui.panel.config.core.section.core.core_config.elevation_meters\"\n            )}\n          </span>\n        </paper-input>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"flex\">\n          ${this.hass.localize(\n            \"ui.panel.config.core.section.core.core_config.unit_system\"\n          )}\n        </div>\n        <paper-radio-group\n          class=\"flex\"\n          .selected=${this._unitSystemValue}\n          @selected-changed=${this._unitSystemChanged}\n        >\n          <paper-radio-button name=\"metric\" .disabled=${this._working}>\n            ${this.hass.localize(\n              \"ui.panel.config.core.section.core.core_config.unit_system_metric\"\n            )}\n            <div class=\"secondary\">\n              ${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.metric_example\"\n              )}\n            </div>\n          </paper-radio-button>\n          <paper-radio-button name=\"imperial\" .disabled=${this._working}>\n            ${this.hass.localize(\n              \"ui.panel.config.core.section.core.core_config.unit_system_imperial\"\n            )}\n            <div class=\"secondary\">\n              ${this.hass.localize(\n                \"ui.panel.config.core.section.core.core_config.imperial_example\"\n              )}\n            </div>\n          </paper-radio-button>\n        </paper-radio-group>\n      </div>\n\n      <div class=\"footer\">\n        <mwc-button @click=${this._save} .disabled=${this._working}>\n          ${this.onboardingLocalize(\n            \"ui.panel.page-onboarding.core-config.finish\"\n          )}\n        </mwc-button>\n      </div>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    setTimeout(\n      () => this.shadowRoot!.querySelector(\"paper-input\")!.focus(),\n      100\n    );\n    this.addEventListener(\"keypress\", (ev) => {\n      if (ev.keyCode === 13) {\n        this._save(ev);\n      }\n    });\n    const input = this.shadowRoot!.querySelector(\n      \"[name=timeZone]\"\n    ) as PaperInputElement;\n    input.inputElement.appendChild(createTimezoneListEl());\n  }\n\n  private get _nameValue() {\n    return this._name !== undefined\n      ? this._name\n      : this.onboardingLocalize(\n          \"ui.panel.page-onboarding.core-config.location_name_default\"\n        );\n  }\n\n  private get _locationValue() {\n    return this._location || amsterdam;\n  }\n\n  private get _elevationValue() {\n    return this._elevation !== undefined ? this._elevation : 0;\n  }\n\n  private get _timeZoneValue() {\n    return this._timeZone;\n  }\n\n  private get _unitSystemValue() {\n    return this._unitSystem !== undefined ? this._unitSystem : \"metric\";\n  }\n\n  private _handleChange(ev: PolymerChangedEvent<string>) {\n    const target = ev.currentTarget as PaperInputElement;\n    this[`_${target.name}`] = target.value;\n  }\n\n  private _locationChanged(ev) {\n    this._location = ev.currentTarget.location;\n  }\n\n  private _unitSystemChanged(\n    ev: PolymerChangedEvent<ConfigUpdateValues[\"unit_system\"]>\n  ) {\n    this._unitSystem = ev.detail.value;\n  }\n\n  private async _detect() {\n    this._working = true;\n    try {\n      const values = await detectCoreConfig(this.hass);\n      if (values.latitude && values.longitude) {\n        this._location = [Number(values.latitude), Number(values.longitude)];\n      }\n      if (values.elevation) {\n        this._elevation = String(values.elevation);\n      }\n      if (values.unit_system) {\n        this._unitSystem = values.unit_system;\n      }\n      if (values.time_zone) {\n        this._timeZone = values.time_zone;\n      }\n    } catch (err) {\n      alert(`Failed to detect location information: ${err.message}`);\n    } finally {\n      this._working = false;\n    }\n  }\n\n  private async _save(ev) {\n    ev.preventDefault();\n    this._working = true;\n    try {\n      const location = this._locationValue;\n      await saveCoreConfig(this.hass, {\n        location_name: this._nameValue,\n        latitude: location[0],\n        longitude: location[1],\n        elevation: Number(this._elevationValue),\n        unit_system: this._unitSystemValue,\n        time_zone: this._timeZoneValue || \"UTC\",\n      });\n      const result = await onboardCoreConfigStep(this.hass);\n      fireEvent(this, \"onboarding-step\", {\n        type: \"core_config\",\n        result,\n      });\n    } catch (err) {\n      this._working = false;\n      alert(\"FAIL\");\n    }\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      .row {\n        display: flex;\n        flex-direction: row;\n        margin: 0 -8px;\n        align-items: center;\n      }\n\n      .secondary {\n        color: var(--secondary-text-color);\n      }\n\n      .flex {\n        flex: 1;\n      }\n\n      .middle-text {\n        margin: 24px 0;\n      }\n\n      .row > * {\n        margin: 0 8px;\n      }\n      .footer {\n        margin-top: 16px;\n        text-align: right;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"onboarding-core-config\": OnboardingCoreConfig;\n  }\n}\n"],"sourceRoot":""}