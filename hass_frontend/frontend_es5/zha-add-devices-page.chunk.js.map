{"version":3,"sources":["webpack:///./src/components/ha-textarea.js","webpack:///./src/panels/config/zha/zha-add-devices-page.ts"],"names":["HaTextarea","html","label","String","value","type","notify","PolymerElement","customElements","define","ZHAAddDevicesPage","customElement","property","undefined","route","path","_ieeeAddress","substring","_subscribe","_unsubscribe","_error","_discoveredDevices","_formattedEvents","hass","localize","_active","_onHelpTap","_showHelp","length","map","device","isWide","message","log_entry","shadowRoot","textArea","querySelector","scrollTop","scrollHeight","push","device_info","_addDevicesTimeoutHandle","clearTimeout","_subscribed","then","unsub","ieeeAddress","data","ieee","connection","subscribeMessage","_handleMessage","setTimeout","haStyle","css","LitElement"],"mappings":"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","file":"zha-add-devices-page.chunk.js","sourcesContent":["/*\nWrapper for paper-textarea.\n\npaper-textarea crashes on iOS when created programmatically. This only impacts\nour automation and script editors as they are using Preact. Polymer is using\ntemplate elements and does not have this issue.\n\npaper-textarea issue: https://github.com/PolymerElements/paper-input/issues/556\nWebKit issue: https://bugs.webkit.org/show_bug.cgi?id=174629\n*/\n\nimport \"@polymer/paper-input/paper-textarea\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nclass HaTextarea extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n        }\n      </style>\n      <paper-textarea label=\"[[label]]\" value=\"{{value}}\"></paper-textarea>\n    `;\n  }\n\n  static get properties() {\n    return {\n      label: String,\n      value: {\n        type: String,\n        notify: true,\n      },\n    };\n  }\n}\n\ncustomElements.define(\"ha-textarea\", HaTextarea);\n","import \"../../../components/ha-service-description\";\nimport \"../../../components/ha-textarea\";\nimport \"../../../layouts/hass-subpage\";\nimport \"./zha-device-card\";\nimport \"@material/mwc-button\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-spinner/paper-spinner\";\n\nimport {\n  css,\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from \"lit-element\";\n\nimport { ZHADevice } from \"../../../data/zha\";\nimport { haStyle } from \"../../../resources/styles\";\nimport { HomeAssistant, Route } from \"../../../types\";\n\n@customElement(\"zha-add-devices-page\")\nclass ZHAAddDevicesPage extends LitElement {\n  @property() public hass!: HomeAssistant;\n  @property() public isWide?: boolean;\n  @property() public route?: Route;\n  @property() private _error?: string;\n  @property() private _discoveredDevices: ZHADevice[] = [];\n  @property() private _formattedEvents: string = \"\";\n  @property() private _active: boolean = false;\n  @property() private _showHelp: boolean = false;\n  private _ieeeAddress?: string;\n  private _addDevicesTimeoutHandle: any = undefined;\n  private _subscribed?: Promise<() => Promise<void>>;\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this.route && this.route.path && this.route.path !== \"\") {\n      this._ieeeAddress = this.route.path.substring(1);\n    }\n    this._subscribe(this._ieeeAddress);\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._unsubscribe();\n    this._error = undefined;\n    this._discoveredDevices = [];\n    this._formattedEvents = \"\";\n  }\n\n  protected render(): TemplateResult | void {\n    return html`\n      <hass-subpage\n        header=\"${this.hass!.localize(\n          \"ui.panel.config.zha.add_device_page.header\"\n        )}\"\n      >\n        ${this._active\n          ? html`\n              <h2>\n                <paper-spinner\n                  ?active=\"${this._active}\"\n                  alt=\"Searching\"\n                ></paper-spinner>\n                ${this.hass!.localize(\n                  \"ui.panel.config.zha.add_device_page.spinner\"\n                )}\n              </h2>\n            `\n          : html`\n              <div class=\"card-actions\">\n                <mwc-button @click=${this._subscribe} class=\"search-button\">\n                  Search again\n                </mwc-button>\n                <paper-icon-button\n                  class=\"toggle-help-icon\"\n                  @click=\"${this._onHelpTap}\"\n                  icon=\"hass:help-circle\"\n                ></paper-icon-button>\n                ${this._showHelp\n                  ? html`\n                      <ha-service-description\n                        .hass=\"${this.hass}\"\n                        domain=\"zha\"\n                        service=\"permit\"\n                        class=\"help-text\"\n                      />\n                    `\n                  : \"\"}\n              </div>\n            `}\n        ${this._error\n          ? html`\n              <div class=\"error\">${this._error}</div>\n            `\n          : \"\"}\n        <div class=\"content-header\"></div>\n        <div class=\"content\">\n          ${this._discoveredDevices.length < 1\n            ? html`\n                <div class=\"discovery-text\">\n                  <h4>\n                    ${this.hass!.localize(\n                      \"ui.panel.config.zha.add_device_page.discovery_text\"\n                    )}\n                  </h4>\n                </div>\n              `\n            : html`\n                ${this._discoveredDevices.map(\n                  (device) => html`\n                    <zha-device-card\n                      class=\"card\"\n                      .hass=\"${this.hass}\"\n                      .device=\"${device}\"\n                      .narrow=\"${!this.isWide}\"\n                      .showHelp=\"${this._showHelp}\"\n                      .showActions=\"${!this._active}\"\n                      .isJoinPage=\"${true}\"\n                    ></zha-device-card>\n                  `\n                )}\n              `}\n        </div>\n        <ha-textarea class=\"events\" value=\"${this._formattedEvents}\">\n        </ha-textarea>\n      </hass-subpage>\n    `;\n  }\n\n  private _handleMessage(message: any): void {\n    if (message.type === \"log_output\") {\n      this._formattedEvents += message.log_entry.message + \"\\n\";\n      if (this.shadowRoot) {\n        const textArea = this.shadowRoot.querySelector(\"ha-textarea\");\n        if (textArea) {\n          textArea.scrollTop = textArea.scrollHeight;\n        }\n      }\n    }\n    if (message.type && message.type === \"device_fully_initialized\") {\n      this._discoveredDevices.push(message.device_info);\n    }\n  }\n\n  private _unsubscribe(): void {\n    this._active = false;\n    if (this._addDevicesTimeoutHandle) {\n      clearTimeout(this._addDevicesTimeoutHandle);\n    }\n    if (this._subscribed) {\n      this._subscribed.then((unsub) => unsub());\n      this._subscribed = undefined;\n    }\n  }\n\n  private _subscribe(ieeeAddress: string | undefined): void {\n    const data: any = { type: \"zha/devices/permit\" };\n    if (ieeeAddress) {\n      data.ieee = ieeeAddress;\n    }\n    this._subscribed = this.hass!.connection.subscribeMessage(\n      (message) => this._handleMessage(message),\n      data\n    );\n    this._active = true;\n    this._addDevicesTimeoutHandle = setTimeout(\n      () => this._unsubscribe(),\n      75000\n    );\n  }\n\n  private _onHelpTap(): void {\n    this._showHelp = !this._showHelp;\n  }\n\n  static get styles(): CSSResult[] {\n    return [\n      haStyle,\n      css`\n        .discovery-text,\n        .content-header {\n          margin: 16px;\n        }\n        .content {\n          border-top: 1px solid var(--light-primary-color);\n          min-height: 500px;\n          display: flex;\n          flex-wrap: wrap;\n          padding: 4px;\n          justify-content: left;\n          overflow: scroll;\n        }\n        .error {\n          color: var(--google-red-500);\n        }\n        paper-spinner {\n          display: none;\n          margin-right: 20px;\n          margin-left: 16px;\n        }\n        paper-spinner[active] {\n          display: block;\n          float: left;\n          margin-right: 20px;\n          margin-left: 16px;\n        }\n        .card {\n          margin-left: 16px;\n          margin-right: 16px;\n          margin-bottom: 0px;\n          margin-top: 10px;\n        }\n        .events {\n          margin: 16px;\n          border-top: 1px solid var(--light-primary-color);\n          padding-top: 16px;\n          min-height: 200px;\n          max-height: 200px;\n          overflow: scroll;\n        }\n        .toggle-help-icon {\n          position: absolute;\n          margin-top: 16px;\n          margin-right: 16px;\n          top: -6px;\n          right: 0;\n          color: var(--primary-color);\n        }\n        ha-service-description {\n          margin-top: 16px;\n          margin-left: 16px;\n          display: block;\n          color: grey;\n        }\n        .search-button {\n          margin-top: 16px;\n          margin-left: 16px;\n        }\n        .help-text {\n          color: grey;\n          padding-left: 16px;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"zha-add-devices-page\": ZHAAddDevicesPage;\n  }\n}\n"],"sourceRoot":""}