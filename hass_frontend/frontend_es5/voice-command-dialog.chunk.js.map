{"version":3,"sources":["webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-behavior.js","webpack:///./node_modules/@polymer/paper-dialog-behavior/paper-dialog-shared-styles.js","webpack:///./src/dialogs/ha-voice-command-dialog.js","webpack:///./src/mixins/dialog-mixin.js"],"names":["PaperDialogBehaviorImpl","hostAttributes","properties","modal","type","Boolean","value","__readied","observers","listeners","ready","__prevNoCancelOnOutsideClick","noCancelOnOutsideClick","__prevNoCancelOnEscKey","noCancelOnEscKey","__prevWithBackdrop","withBackdrop","_modalChanged","readied","_updateClosingReasonConfirmed","confirmed","closingReason","_onDialogClick","event","path","dom","i","l","indexOf","target","hasAttribute","close","stopPropagation","PaperDialogBehavior","IronOverlayBehavior","$_documentContainer","document","createElement","setAttribute","innerHTML","head","appendChild","content","HaVoiceCommandDialog","opened","recognition","webkitSpeechRecognition","onstart","results","interim","bind","onerror","abort","text","push","who","error","onend","hass","callApi","then","response","speech","plain","set","_conversation","length","onresult","oldResults","finalTranscript","interimTranscript","ind","resultIndex","isFinal","transcript","initRecognition","start","setTimeout","$","messages","scrollTop","scrollHeight","dialog","fire","newVal","startListening","message","html","Object","observer","Array","DialogMixin","PolymerElement","customElements","define","dedupingMixin","superClass","mixinBehaviors","EventsMixin"],"mappings":"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","file":"voice-command-dialog.chunk.js","sourcesContent":["/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {IronOverlayBehavior} from '@polymer/iron-overlay-behavior/iron-overlay-behavior.js';\nimport {dom} from '@polymer/polymer/lib/legacy/polymer.dom.js';\n\n/**\n  Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to\n  implement a Material Design dialog.\n\n  For example, if `<paper-dialog-impl>` implements this behavior:\n\n      <paper-dialog-impl>\n          <h2>Header</h2>\n          <div>Dialog body</div>\n          <div class=\"buttons\">\n              <paper-button dialog-dismiss>Cancel</paper-button>\n              <paper-button dialog-confirm>Accept</paper-button>\n          </div>\n      </paper-dialog-impl>\n\n  `paper-dialog-shared-styles.html` provide styles for a header, content area,\n  and an action area for buttons. Use the `<h2>` tag for the header and the\n  `buttons` class for the action area. You can use the `paper-dialog-scrollable`\n  element (in its own repository) if you need a scrolling content area.\n\n  Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive\n  controls to close the dialog. If the user dismisses the dialog with\n  `dialog-confirm`, the `closingReason` will update to include `confirmed:\n  true`.\n\n  ### Accessibility\n\n  This element has `role=\"dialog\"` by default. Depending on the context, it may\n  be more appropriate to override this attribute with `role=\"alertdialog\"`.\n\n  If `modal` is set, the element will prevent the focus from exiting the\n  element. It will also ensure that focus remains in the dialog.\n\n  @hero hero.svg\n  @demo demo/index.html\n  @polymerBehavior PaperDialogBehavior\n */\nexport const PaperDialogBehaviorImpl = {\n\n  hostAttributes: {'role': 'dialog', 'tabindex': '-1'},\n\n  properties: {\n\n    /**\n     * If `modal` is true, this implies `no-cancel-on-outside-click`,\n     * `no-cancel-on-esc-key` and `with-backdrop`.\n     */\n    modal: {type: Boolean, value: false},\n\n    __readied: {type: Boolean, value: false}\n\n  },\n\n  observers: ['_modalChanged(modal, __readied)'],\n\n  listeners: {'tap': '_onDialogClick'},\n\n  /**\n   * @return {void}\n   */\n  ready: function() {\n    // Only now these properties can be read.\n    this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n    this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n    this.__prevWithBackdrop = this.withBackdrop;\n    this.__readied = true;\n  },\n\n  _modalChanged: function(modal, readied) {\n    // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.\n    // We need to wait for the element to be ready before we can read the\n    // properties values.\n    if (!readied) {\n      return;\n    }\n\n    if (modal) {\n      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;\n      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;\n      this.__prevWithBackdrop = this.withBackdrop;\n      this.noCancelOnOutsideClick = true;\n      this.noCancelOnEscKey = true;\n      this.withBackdrop = true;\n    } else {\n      // If the value was changed to false, let it false.\n      this.noCancelOnOutsideClick =\n          this.noCancelOnOutsideClick && this.__prevNoCancelOnOutsideClick;\n      this.noCancelOnEscKey =\n          this.noCancelOnEscKey && this.__prevNoCancelOnEscKey;\n      this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;\n    }\n  },\n\n  _updateClosingReasonConfirmed: function(confirmed) {\n    this.closingReason = this.closingReason || {};\n    this.closingReason.confirmed = confirmed;\n  },\n\n  /**\n   * Will dismiss the dialog if user clicked on an element with dialog-dismiss\n   * or dialog-confirm attribute.\n   */\n  _onDialogClick: function(event) {\n    // Search for the element with dialog-confirm or dialog-dismiss,\n    // from the root target until this (excluded).\n    var path = dom(event).path;\n    for (var i = 0, l = path.indexOf(this); i < l; i++) {\n      var target = path[i];\n      if (target.hasAttribute &&\n          (target.hasAttribute('dialog-dismiss') ||\n           target.hasAttribute('dialog-confirm'))) {\n        this._updateClosingReasonConfirmed(\n            target.hasAttribute('dialog-confirm'));\n        this.close();\n        event.stopPropagation();\n        break;\n      }\n    }\n  }\n\n};\n\n/** @polymerBehavior */\nexport const PaperDialogBehavior =\n    [IronOverlayBehavior, PaperDialogBehaviorImpl];\n","/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n/*\n### Styling\n\nThe following custom properties and mixins are available for styling.\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-dialog-background-color` | Dialog background color | `--primary-background-color`\n`--paper-dialog-color` | Dialog foreground color | `--primary-text-color`\n`--paper-dialog` | Mixin applied to the dialog | `{}`\n`--paper-dialog-title` | Mixin applied to the title (`<h2>`) element | `{}`\n`--paper-dialog-button-color` | Button area foreground color | `--default-primary-color`\n*/\nimport '@polymer/polymer/polymer-legacy.js';\nimport '@polymer/iron-flex-layout/iron-flex-layout.js';\nimport '@polymer/paper-styles/default-theme.js';\nimport '@polymer/paper-styles/typography.js';\nimport '@polymer/paper-styles/shadow.js';\nconst $_documentContainer = document.createElement('template');\n$_documentContainer.setAttribute('style', 'display: none;');\n\n$_documentContainer.innerHTML = `<dom-module id=\"paper-dialog-shared-styles\">\n  <template>\n    <style>\n      :host {\n        display: block;\n        margin: 24px 40px;\n\n        background: var(--paper-dialog-background-color, var(--primary-background-color));\n        color: var(--paper-dialog-color, var(--primary-text-color));\n\n        @apply --paper-font-body1;\n        @apply --shadow-elevation-16dp;\n        @apply --paper-dialog;\n      }\n\n      :host > ::slotted(*) {\n        margin-top: 20px;\n        padding: 0 24px;\n      }\n\n      :host > ::slotted(.no-padding) {\n        padding: 0;\n      }\n\n      \n      :host > ::slotted(*:first-child) {\n        margin-top: 24px;\n      }\n\n      :host > ::slotted(*:last-child) {\n        margin-bottom: 24px;\n      }\n\n      /* In 1.x, this selector was \\`:host > ::content h2\\`. In 2.x <slot> allows\n      to select direct children only, which increases the weight of this\n      selector, so we have to re-define first-child/last-child margins below. */\n      :host > ::slotted(h2) {\n        position: relative;\n        margin: 0;\n\n        @apply --paper-font-title;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-top. */\n      :host > ::slotted(h2:first-child) {\n        margin-top: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      /* Apply mixin again, in case it sets margin-bottom. */\n      :host > ::slotted(h2:last-child) {\n        margin-bottom: 24px;\n        @apply --paper-dialog-title;\n      }\n\n      :host > ::slotted(.paper-dialog-buttons),\n      :host > ::slotted(.buttons) {\n        position: relative;\n        padding: 8px 8px 8px 24px;\n        margin: 0;\n\n        color: var(--paper-dialog-button-color, var(--primary-color));\n\n        @apply --layout-horizontal;\n        @apply --layout-end-justified;\n      }\n    </style>\n  </template>\n</dom-module>`;\n\ndocument.head.appendChild($_documentContainer.content);\n","import \"@polymer/iron-icon/iron-icon\";\nimport \"@polymer/paper-dialog-behavior/paper-dialog-shared-styles\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport DialogMixin from \"../mixins/dialog-mixin\";\n\n/*\n * @appliesMixin DialogMixin\n */\nclass HaVoiceCommandDialog extends DialogMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"paper-dialog-shared-styles\">\n        iron-icon {\n          margin-right: 8px;\n        }\n\n        .content {\n          width: 450px;\n          min-height: 80px;\n          font-size: 18px;\n          padding: 16px;\n        }\n\n        .messages {\n          max-height: 50vh;\n          overflow: auto;\n        }\n\n        .messages::after {\n          content: \"\";\n          clear: both;\n          display: block;\n        }\n\n        .message {\n          clear: both;\n          margin: 8px 0;\n          padding: 8px;\n          border-radius: 15px;\n        }\n\n        .message.user {\n          margin-left: 24px;\n          float: right;\n          text-align: right;\n          border-bottom-right-radius: 0px;\n          background-color: var(--light-primary-color);\n          color: var(--primary-text-color);\n        }\n\n        .message.hass {\n          margin-right: 24px;\n          float: left;\n          border-bottom-left-radius: 0px;\n          background-color: var(--primary-color);\n          color: var(--text-primary-color);\n        }\n\n        .message.error {\n          background-color: var(--google-red-500);\n          color: var(--text-primary-color);\n        }\n\n        .icon {\n          text-align: center;\n        }\n\n        .icon paper-icon-button {\n          height: 52px;\n          width: 52px;\n        }\n\n        .interimTranscript {\n          color: darkgrey;\n        }\n\n        [hidden] {\n          display: none;\n        }\n\n        :host {\n          border-radius: 2px;\n        }\n\n        @media all and (max-width: 450px) {\n          :host {\n            margin: 0;\n            width: 100%;\n            max-height: calc(100% - 64px);\n\n            position: fixed !important;\n            bottom: 0px;\n            left: 0px;\n            right: 0px;\n            overflow: scroll;\n            border-bottom-left-radius: 0px;\n            border-bottom-right-radius: 0px;\n          }\n\n          .content {\n            width: auto;\n          }\n\n          .messages {\n            max-height: 68vh;\n          }\n        }\n      </style>\n\n      <div class=\"content\">\n        <div class=\"messages\" id=\"messages\">\n          <template is=\"dom-repeat\" items=\"[[_conversation]]\" as=\"message\">\n            <div class$=\"[[_computeMessageClasses(message)]]\">\n              [[message.text]]\n            </div>\n          </template>\n        </div>\n        <template is=\"dom-if\" if=\"[[results]]\">\n          <div class=\"messages\">\n            <div class=\"message user\">\n              <span>{{results.final}}</span>\n              <span class=\"interimTranscript\">[[results.interim]]</span> …\n            </div>\n          </div>\n        </template>\n        <div class=\"icon\" hidden$=\"[[results]]\">\n          <paper-icon-button\n            icon=\"hass:text-to-speech\"\n            on-click=\"startListening\"\n          ></paper-icon-button>\n        </div>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      results: {\n        type: Object,\n        value: null,\n        observer: \"_scrollMessagesBottom\",\n      },\n\n      _conversation: {\n        type: Array,\n        value: function() {\n          return [{ who: \"hass\", text: \"How can I help?\" }];\n        },\n        observer: \"_scrollMessagesBottom\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dialogOpenChanged(opened)\"];\n  }\n\n  showDialog() {\n    this.opened = true;\n  }\n\n  initRecognition() {\n    /* eslint-disable new-cap */\n    this.recognition = new webkitSpeechRecognition();\n    /* eslint-enable new-cap */\n\n    this.recognition.onstart = function() {\n      this.results = {\n        final: \"\",\n        interim: \"\",\n      };\n    }.bind(this);\n    this.recognition.onerror = function() {\n      this.recognition.abort();\n      var text = this.results.final || this.results.interim;\n      this.results = null;\n      if (text === \"\") {\n        text = \"<Home Assistant did not hear anything>\";\n      }\n      this.push(\"_conversation\", { who: \"user\", text: text, error: true });\n    }.bind(this);\n    this.recognition.onend = function() {\n      // Already handled by onerror\n      if (this.results == null) {\n        return;\n      }\n      var text = this.results.final || this.results.interim;\n      this.results = null;\n      this.push(\"_conversation\", { who: \"user\", text: text });\n\n      this.hass.callApi(\"post\", \"conversation/process\", { text: text }).then(\n        function(response) {\n          this.push(\"_conversation\", {\n            who: \"hass\",\n            text: response.speech.plain.speech,\n          });\n        }.bind(this),\n        function() {\n          this.set(\n            [\"_conversation\", this._conversation.length - 1, \"error\"],\n            true\n          );\n        }.bind(this)\n      );\n    }.bind(this);\n\n    this.recognition.onresult = function(event) {\n      var oldResults = this.results;\n      var finalTranscript = \"\";\n      var interimTranscript = \"\";\n\n      for (var ind = event.resultIndex; ind < event.results.length; ind++) {\n        if (event.results[ind].isFinal) {\n          finalTranscript += event.results[ind][0].transcript;\n        } else {\n          interimTranscript += event.results[ind][0].transcript;\n        }\n      }\n\n      this.results = {\n        interim: interimTranscript,\n        final: oldResults.final + finalTranscript,\n      };\n    }.bind(this);\n  }\n\n  startListening() {\n    if (!this.recognition) {\n      this.initRecognition();\n    }\n\n    this.results = {\n      interim: \"\",\n      final: \"\",\n    };\n    this.recognition.start();\n  }\n\n  _scrollMessagesBottom() {\n    setTimeout(() => {\n      this.$.messages.scrollTop = this.$.messages.scrollHeight;\n\n      if (this.$.messages.scrollTop !== 0) {\n        this.$.dialog.fire(\"iron-resize\");\n      }\n    }, 10);\n  }\n\n  dialogOpenChanged(newVal) {\n    if (newVal) {\n      this.startListening();\n    } else if (!newVal && this.results) {\n      this.recognition.abort();\n    }\n  }\n\n  _computeMessageClasses(message) {\n    return \"message \" + message.who + (message.error ? \" error\" : \"\");\n  }\n}\n\ncustomElements.define(\"ha-voice-command-dialog\", HaVoiceCommandDialog);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\nimport { PaperDialogBehavior } from \"@polymer/paper-dialog-behavior/paper-dialog-behavior\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\nimport { EventsMixin } from \"./events-mixin\";\n/**\n * @polymerMixin\n * @appliesMixin EventsMixin\n * @appliesMixin PaperDialogBehavior\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends mixinBehaviors(\n      [EventsMixin, PaperDialogBehavior],\n      superClass\n    ) {\n      static get properties() {\n        return {\n          withBackdrop: {\n            type: Boolean,\n            value: true,\n          },\n        };\n      }\n    }\n);\n"],"sourceRoot":""}