{"version":3,"sources":["webpack:///./src/data/script.ts","webpack:///./src/mixins/navigate-mixin.js","webpack:///./src/panels/config/js/script.js","webpack:///./src/panels/config/script/ha-config-script.js","webpack:///./src/panels/config/script/ha-script-editor.js","webpack:///./src/panels/config/script/ha-script-picker.ts"],"names":["triggerScript","hass","entityId","variables","callService","computeObjectId","deleteScript","objectId","callApi","dedupingMixin","superClass","args","navigate","ScriptEditor","onChange","bind","sequenceChanged","ev","props","Object","assign","script","target","name","value","sequence","isWide","localize","alias","Component","HaConfigScript","scripts","edittingAddon","routeData","i","length","entity_id","keys","states","forEach","key","entity","computeStateDomain","push","sort","entitySortBy","entityA","entityB","nameA","computeStateName","nameB","_edittingScript","_creatingNew","html","route","Boolean","_routeData","_routeMatches","type","Array","computed","showEditor","PolymerElement","customElements","define","mountEl","mergeEl","render","h","Script","HaScriptEditor","configChanged","_rendered","unmountPreact","config","errors","dirty","_updateComponent","newVal","oldVal","setTimeout","scriptChanged","then","isArray","alert","history","back","service","data","confirm","_renderScheduled","Promise","resolve","$","root","id","creatingNew","Date","now","body","message","computeRTL","observer","rtl","reflectToAttribute","LocalizeMixin","NavigateMixin","HaScriptPicker","customElement","property","repeat","_runScript","currentTarget","showToast","haStyle","css","LitElement"],"mappings":"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","file":"panel-config-script.chunk.js","sourcesContent":["import { HomeAssistant } from \"../types\";\nimport computeObjectId from \"../common/entity/compute_object_id\";\n\nexport interface EventAction {\n  event: string;\n  event_data?: { [key: string]: any };\n  event_data_template?: { [key: string]: any };\n}\n\nexport const triggerScript = (\n  hass: HomeAssistant,\n  entityId: string,\n  variables?: {}\n) => hass.callService(\"script\", computeObjectId(entityId), variables);\n\nexport const deleteScript = (hass: HomeAssistant, objectId: string) =>\n  hass.callApi(\"DELETE\", `config/script/config/${objectId}`);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\nimport { navigate } from \"../common/navigate\";\n\n/*\n * @polymerMixin\n * @appliesMixin EventsMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      navigate(...args) {\n        navigate(this, ...args);\n      }\n    }\n);\n","import { h, Component } from \"preact\";\n\nimport \"@polymer/paper-input/paper-input\";\nimport \"../ha-config-section\";\nimport \"../../../components/ha-card\";\n\nimport Script from \"./script/index\";\n\nexport default class ScriptEditor extends Component {\n  constructor() {\n    super();\n\n    this.onChange = this.onChange.bind(this);\n    this.sequenceChanged = this.sequenceChanged.bind(this);\n  }\n\n  onChange(ev) {\n    this.props.onChange(\n      Object.assign({}, this.props.script, {\n        [ev.target.name]: ev.target.value,\n      })\n    );\n  }\n\n  sequenceChanged(sequence) {\n    this.props.onChange(Object.assign({}, this.props.script, { sequence }));\n  }\n\n  render({ script, isWide, hass, localize }) {\n    const { alias, sequence } = script;\n\n    return (\n      <div>\n        <ha-config-section is-wide={isWide}>\n          <span slot=\"header\">{alias}</span>\n          <span slot=\"introduction\">\n            Use scripts to execute a sequence of actions.\n          </span>\n          <ha-card>\n            <div class=\"card-content\">\n              <paper-input\n                label=\"Name\"\n                name=\"alias\"\n                value={alias}\n                onvalue-changed={this.onChange}\n              />\n            </div>\n          </ha-card>\n        </ha-config-section>\n\n        <ha-config-section is-wide={isWide}>\n          <span slot=\"header\">Sequence</span>\n          <span slot=\"introduction\">\n            The sequence of actions of this script.\n            <p>\n              <a href=\"https://home-assistant.io/docs/scripts/\" target=\"_blank\">\n                Learn more about available actions.\n              </a>\n            </p>\n          </span>\n          <Script\n            script={sequence}\n            onChange={this.sequenceChanged}\n            hass={hass}\n            localize={localize}\n          />\n        </ha-config-section>\n      </div>\n    );\n  }\n}\n","import \"@polymer/app-route/app-route\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./ha-script-editor\";\nimport \"./ha-script-picker\";\n\nimport computeStateName from \"../../../common/entity/compute_state_name\";\nimport computeStateDomain from \"../../../common/entity/compute_state_domain\";\n\nclass HaConfigScript extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        ha-script-picker,\n        ha-script-editor {\n          height: 100%;\n        }\n      </style>\n      <app-route\n        route=\"[[route]]\"\n        pattern=\"/edit/:script\"\n        data=\"{{_routeData}}\"\n        active=\"{{_edittingScript}}\"\n      ></app-route>\n      <app-route\n        route=\"[[route]]\"\n        pattern=\"/new\"\n        active=\"{{_creatingNew}}\"\n      ></app-route>\n\n      <template is=\"dom-if\" if=\"[[!showEditor]]\">\n        <ha-script-picker\n          hass=\"[[hass]]\"\n          scripts=\"[[scripts]]\"\n          is-wide=\"[[isWide]]\"\n        ></ha-script-picker>\n      </template>\n\n      <template is=\"dom-if\" if=\"[[showEditor]]\" restamp=\"\">\n        <ha-script-editor\n          hass=\"[[hass]]\"\n          script=\"[[script]]\"\n          is-wide=\"[[isWide]]\"\n          creating-new=\"[[_creatingNew]]\"\n        ></ha-script-editor>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      route: Object,\n      isWide: Boolean,\n      _routeData: Object,\n      _routeMatches: Boolean,\n      _creatingNew: Boolean,\n      _edittingScript: Boolean,\n\n      scripts: {\n        type: Array,\n        computed: \"computeScripts(hass)\",\n      },\n\n      script: {\n        type: Object,\n        computed: \"computeScript(scripts, _edittingScript, _routeData)\",\n      },\n\n      showEditor: {\n        type: Boolean,\n        computed: \"computeShowEditor(_edittingScript, _creatingNew)\",\n      },\n    };\n  }\n\n  computeScript(scripts, edittingAddon, routeData) {\n    if (!scripts || !edittingAddon) {\n      return null;\n    }\n    for (var i = 0; i < scripts.length; i++) {\n      if (scripts[i].entity_id === routeData.script) {\n        return scripts[i];\n      }\n    }\n    return null;\n  }\n\n  computeScripts(hass) {\n    var scripts = [];\n\n    Object.keys(hass.states).forEach(function(key) {\n      var entity = hass.states[key];\n\n      if (computeStateDomain(entity) === \"script\") {\n        scripts.push(entity);\n      }\n    });\n\n    return scripts.sort(function entitySortBy(entityA, entityB) {\n      var nameA = computeStateName(entityA);\n      var nameB = computeStateName(entityB);\n\n      if (nameA < nameB) {\n        return -1;\n      }\n      if (nameA > nameB) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  computeShowEditor(_edittingScript, _creatingNew) {\n    return _creatingNew || _edittingScript;\n  }\n}\n\ncustomElements.define(\"ha-config-script\", HaConfigScript);\n","import \"@polymer/app-layout/app-header/app-header\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-fab/paper-fab\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { h, render } from \"preact\";\n\nimport \"../../../layouts/ha-app-layout\";\nimport \"../../../components/ha-paper-icon-button-arrow-prev\";\n\nimport Script from \"../js/script\";\nimport unmountPreact from \"../../../common/preact/unmount\";\n\nimport computeObjectId from \"../../../common/entity/compute_object_id\";\nimport computeStateName from \"../../../common/entity/compute_state_name\";\nimport NavigateMixin from \"../../../mixins/navigate-mixin\";\nimport LocalizeMixin from \"../../../mixins/localize-mixin\";\n\nimport { computeRTL } from \"../../../common/util/compute_rtl\";\nimport { deleteScript } from \"../../../data/script\";\n\nfunction ScriptEditor(mountEl, props, mergeEl) {\n  return render(h(Script, props), mountEl, mergeEl);\n}\n\n/*\n * @appliesMixin LocalizeMixin\n * @appliesMixin NavigateMixin\n */\nclass HaScriptEditor extends LocalizeMixin(NavigateMixin(PolymerElement)) {\n  static get template() {\n    return html`\n      <style include=\"ha-style\">\n        .errors {\n          padding: 20px;\n          font-weight: bold;\n          color: var(--google-red-500);\n        }\n        .content {\n          padding-bottom: 20px;\n        }\n        .triggers,\n        .script {\n          margin-top: -16px;\n        }\n        .triggers ha-card,\n        .script ha-card {\n          margin-top: 16px;\n        }\n        .add-card mwc-button {\n          display: block;\n          text-align: center;\n        }\n        .card-menu {\n          position: absolute;\n          top: 0;\n          right: 0;\n          z-index: 1;\n          color: var(--primary-text-color);\n        }\n        .card-menu paper-item {\n          cursor: pointer;\n        }\n        span[slot=\"introduction\"] a {\n          color: var(--primary-color);\n        }\n        paper-fab {\n          position: fixed;\n          bottom: 16px;\n          right: 16px;\n          z-index: 1;\n          margin-bottom: -80px;\n          transition: margin-bottom 0.3s;\n        }\n\n        paper-fab[is-wide] {\n          bottom: 24px;\n          right: 24px;\n        }\n\n        paper-fab[dirty] {\n          margin-bottom: 0;\n        }\n\n        paper-fab[rtl] {\n          right: auto;\n          left: 16px;\n        }\n\n        paper-fab[rtl][is-wide] {\n          bottom: 24px;\n          right: auto;\n          left: 24px;\n        }\n      </style>\n      <ha-app-layout has-scrolling-region=\"\">\n        <app-header slot=\"header\" fixed=\"\">\n          <app-toolbar>\n            <ha-paper-icon-button-arrow-prev\n              on-click=\"backTapped\"\n            ></ha-paper-icon-button-arrow-prev>\n            <div main-title>Script [[computeName(script)]]</div>\n            <template is=\"dom-if\" if=\"[[!creatingNew]]\">\n              <paper-icon-button\n                icon=\"hass:delete\"\n                on-click=\"_delete\"\n              ></paper-icon-button>\n            </template>\n          </app-toolbar>\n        </app-header>\n        <div class=\"content\">\n          <template is=\"dom-if\" if=\"[[errors]]\">\n            <div class=\"errors\">[[errors]]</div>\n          </template>\n          <div id=\"root\"></div>\n        </div>\n        <paper-fab\n          slot=\"fab\"\n          is-wide$=\"[[isWide]]\"\n          dirty$=\"[[dirty]]\"\n          icon=\"hass:content-save\"\n          title=\"Save\"\n          on-click=\"saveScript\"\n          rtl$=\"[[rtl]]\"\n        ></paper-fab>\n      </ha-app-layout>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      errors: {\n        type: Object,\n        value: null,\n      },\n\n      dirty: {\n        type: Boolean,\n        value: false,\n      },\n\n      config: {\n        type: Object,\n        value: null,\n      },\n\n      script: {\n        type: Object,\n        observer: \"scriptChanged\",\n      },\n\n      creatingNew: {\n        type: Boolean,\n        observer: \"creatingNewChanged\",\n      },\n\n      isWide: {\n        type: Boolean,\n        observer: \"_updateComponent\",\n      },\n\n      _rendered: {\n        type: Object,\n        value: null,\n      },\n\n      _renderScheduled: {\n        type: Boolean,\n        value: false,\n      },\n\n      rtl: {\n        type: Boolean,\n        reflectToAttribute: true,\n        computed: \"_computeRTL(hass)\",\n      },\n    };\n  }\n\n  ready() {\n    this.configChanged = this.configChanged.bind(this);\n    super.ready(); // This call will initialize preact.\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._rendered) {\n      unmountPreact(this._rendered);\n      this._rendered = null;\n    }\n  }\n\n  configChanged(config) {\n    // onChange gets called a lot during initial rendering causing recursing calls.\n    if (this._rendered === null) return;\n    this.config = config;\n    this.errors = null;\n    this.dirty = true;\n    this._updateComponent();\n  }\n\n  scriptChanged(newVal, oldVal) {\n    if (!newVal) return;\n    if (!this.hass) {\n      setTimeout(() => this.scriptChanged(newVal, oldVal), 0);\n      return;\n    }\n    if (oldVal && oldVal.entity_id === newVal.entity_id) {\n      return;\n    }\n    this.hass\n      .callApi(\n        \"get\",\n        \"config/script/config/\" + computeObjectId(newVal.entity_id)\n      )\n      .then(\n        (config) => {\n          // Normalize data: ensure sequence is a list\n          // Happens when people copy paste their scripts into the config\n          var value = config.sequence;\n          if (value && !Array.isArray(value)) {\n            config.sequence = [value];\n          }\n\n          this.dirty = false;\n          this.config = config;\n          this._updateComponent();\n        },\n        () => {\n          alert(\"Only scripts inside scripts.yaml are editable.\");\n          history.back();\n        }\n      );\n  }\n\n  creatingNewChanged(newVal) {\n    if (!newVal) {\n      return;\n    }\n    this.dirty = false;\n    this.config = {\n      alias: \"New Script\",\n      sequence: [{ service: \"\", data: {} }],\n    };\n    this._updateComponent();\n  }\n\n  backTapped() {\n    if (\n      this.dirty &&\n      // eslint-disable-next-line\n      !confirm(\"You have unsaved changes. Are you sure you want to leave?\")\n    ) {\n      return;\n    }\n    history.back();\n  }\n\n  _updateComponent() {\n    if (this._renderScheduled || !this.hass || !this.config) return;\n    this._renderScheduled = true;\n    Promise.resolve().then(() => {\n      this._rendered = ScriptEditor(\n        this.$.root,\n        {\n          script: this.config,\n          onChange: this.configChanged,\n          isWide: this.isWide,\n          hass: this.hass,\n          localize: this.localize,\n        },\n        this._rendered\n      );\n      this._renderScheduled = false;\n    });\n  }\n\n  async _delete() {\n    if (!confirm(\"Are you sure you want to delete this script?\")) {\n      return;\n    }\n    await deleteScript(this.hass, computeObjectId(this.script.entity_id));\n    history.back();\n  }\n\n  saveScript() {\n    var id = this.creatingNew\n      ? \"\" + Date.now()\n      : computeObjectId(this.script.entity_id);\n    this.hass.callApi(\"post\", \"config/script/config/\" + id, this.config).then(\n      () => {\n        this.dirty = false;\n\n        if (this.creatingNew) {\n          this.navigate(`/config/script/edit/${id}`, true);\n        }\n      },\n      (errors) => {\n        this.errors = errors.body.message;\n        throw errors;\n      }\n    );\n  }\n\n  computeName(script) {\n    return script && computeStateName(script);\n  }\n\n  _computeRTL(hass) {\n    return computeRTL(hass);\n  }\n}\n\ncustomElements.define(\"ha-script-editor\", HaScriptEditor);\n","import {\n  LitElement,\n  html,\n  CSSResultArray,\n  css,\n  TemplateResult,\n  property,\n  customElement,\n} from \"lit-element\";\nimport \"@polymer/paper-fab/paper-fab\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-item/paper-item-body\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n\nimport \"../../../layouts/hass-subpage\";\n\nimport { computeRTL } from \"../../../common/util/compute_rtl\";\n\nimport \"../../../components/ha-card\";\n\nimport \"../ha-config-section\";\n\nimport computeStateName from \"../../../common/entity/compute_state_name\";\nimport { haStyle } from \"../../../resources/styles\";\nimport { HomeAssistant } from \"../../../types\";\nimport { triggerScript } from \"../../../data/script\";\nimport { showToast } from \"../../../util/toast\";\nimport { repeat } from \"lit-html/directives/repeat\";\n\n@customElement(\"ha-script-picker\")\nclass HaScriptPicker extends LitElement {\n  @property() public hass!: HomeAssistant;\n  @property() public scripts!: HassEntity[];\n  @property() public isWide!: boolean;\n\n  protected render(): TemplateResult | void {\n    return html`\n      <hass-subpage\n        .header=${this.hass.localize(\"ui.panel.config.script.caption\")}\n      >\n        <ha-config-section .isWide=${this.isWide}>\n          <div slot=\"header\">Script Editor</div>\n          <div slot=\"introduction\">\n            The script editor allows you to create and edit scripts. Please read\n            <a\n              href=\"https://home-assistant.io/docs/scripts/editor/\"\n              target=\"_blank\"\n              >the instructions</a\n            >\n            to make sure that you have configured Home Assistant correctly.\n          </div>\n\n          <ha-card header=\"Pick script to edit\">\n            ${this.scripts.length === 0\n              ? html`\n                  <div class=\"card-content\">\n                    <p>We couldn't find any scripts.</p>\n                  </div>\n                `\n              : repeat(\n                  this.scripts,\n                  (script) => script.entity_id,\n                  (script) => html`\n                    <div class=\"script\">\n                      <paper-icon-button\n                        .script=${script}\n                        icon=\"hass:play\"\n                        @click=${this._runScript}\n                      ></paper-icon-button>\n                      <paper-item-body>\n                        <div>${computeStateName(script)}</div>\n                      </paper-item-body>\n                      <div class=\"actions\">\n                        <a href=${`/config/script/edit/${script.entity_id}`}>\n                          <paper-icon-button\n                            icon=\"hass:pencil\"\n                          ></paper-icon-button>\n                        </a>\n                      </div>\n                    </div>\n                  `\n                )}\n          </ha-card>\n        </ha-config-section>\n\n        <a href=\"/config/script/new\">\n          <paper-fab\n            slot=\"fab\"\n            ?is-wide=${this.isWide}\n            icon=\"hass:plus\"\n            title=\"Add Script\"\n            ?rtl=${computeRTL(this.hass)}\n          ></paper-fab>\n        </a>\n      </hass-subpage>\n    `;\n  }\n\n  private async _runScript(ev) {\n    const script = ev.currentTarget.script as HassEntity;\n    await triggerScript(this.hass, script.entity_id);\n    showToast(this, {\n      message: `Triggered ${computeStateName(script)}`,\n    });\n  }\n\n  static get styles(): CSSResultArray {\n    return [\n      haStyle,\n      css`\n        :host {\n          display: block;\n        }\n\n        ha-card {\n          padding-bottom: 8px;\n          margin-bottom: 56px;\n        }\n\n        .script {\n          display: flex;\n          flex-direction: horizontal;\n          align-items: center;\n          padding: 0 8px;\n          margin: 4px 0;\n        }\n\n        .script > *:first-child {\n          margin-right: 8px;\n        }\n\n        .script a[href],\n        paper-icon-button {\n          color: var(--primary-text-color);\n        }\n\n        .actions {\n          display: flex;\n        }\n\n        paper-fab {\n          position: fixed;\n          bottom: 16px;\n          right: 16px;\n          z-index: 1;\n        }\n\n        paper-fab[is-wide] {\n          bottom: 24px;\n          right: 24px;\n        }\n\n        paper-fab[rtl] {\n          right: auto;\n          left: 16px;\n        }\n\n        paper-fab[rtl][is-wide] {\n          bottom: 24px;\n          right: auto;\n          left: 24px;\n        }\n\n        a {\n          color: var(--primary-color);\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-script-picker\": HaScriptPicker;\n  }\n}\n"],"sourceRoot":""}