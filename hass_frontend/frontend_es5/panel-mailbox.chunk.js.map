{"version":3,"sources":["webpack:///./src/common/datetime/format_date_time.ts","webpack:///./src/mixins/events-mixin.js","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/panels/mailbox/ha-panel-mailbox.js"],"names":["toLocaleStringSupportsOptions","Date","toLocaleString","e","name","dateObj","locales","year","month","day","hour","minute","fecha","format","EventsMixin","dedupingMixin","superClass","type","detail","options","fireEvent","node","localize","hass","Object","Function","computed","registeredDialog","HaPanelMailbox","fire","dialogShowEvent","dialogTag","dialogImport","hassChanged","bind","connection","subscribeEvents","then","unsub","_unsubEvents","computePlatforms","platforms","_messages","getMessages","items","event","message","model","item","platform","_currentPlatform","callApi","values","platformItems","arrayLength","length","i","datetime","formatDateTime","info","origtime","language","push","timestamp","caller","callerid","text","sha","duration","sort","a","b","ev","newPlatform","selected","entity","stateObj","states","toLowerCase","attributes","friendly_name","html","Array","Number","value","LocalizeMixin","PolymerElement","customElements","define"],"mappings":"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","file":"panel-mailbox.chunk.js","sourcesContent":["import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleStringSupportsOptions() {\n  try {\n    new Date().toLocaleString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"haDateTime\"));\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import \"@polymer/app-layout/app-header-layout/app-header-layout\";\nimport \"@polymer/app-layout/app-header/app-header\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport \"@material/mwc-button\";\nimport \"@polymer/paper-input/paper-textarea\";\nimport \"@polymer/paper-item/paper-item-body\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-tabs/paper-tab\";\nimport \"@polymer/paper-tabs/paper-tabs\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"../../components/ha-menu-button\";\nimport \"../../components/ha-card\";\nimport \"../../resources/ha-style\";\n\nimport formatDateTime from \"../../common/datetime/format_date_time\";\nimport LocalizeMixin from \"../../mixins/localize-mixin\";\nimport { EventsMixin } from \"../../mixins/events-mixin\";\n\nlet registeredDialog = false;\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaPanelMailbox extends EventsMixin(LocalizeMixin(PolymerElement)) {\n  static get template() {\n    return html`\n      <style include=\"ha-style\">\n        :host {\n          -ms-user-select: initial;\n          -webkit-user-select: initial;\n          -moz-user-select: initial;\n        }\n\n        .content {\n          padding: 16px;\n          max-width: 600px;\n          margin: 0 auto;\n        }\n\n        ha-card {\n          overflow: hidden;\n        }\n\n        paper-item {\n          cursor: pointer;\n        }\n\n        .empty {\n          text-align: center;\n          color: var(--secondary-text-color);\n        }\n\n        .header {\n          @apply --paper-font-title;\n        }\n\n        .row {\n          display: flex;\n          justify-content: space-between;\n        }\n\n        @media all and (max-width: 450px) {\n          .content {\n            width: auto;\n            padding: 0;\n          }\n        }\n\n        .tip {\n          color: var(--secondary-text-color);\n          font-size: 14px;\n        }\n        .date {\n          color: var(--primary-text-color);\n        }\n      </style>\n\n      <app-header-layout has-scrolling-region>\n        <app-header slot=\"header\" fixed>\n          <app-toolbar>\n            <ha-menu-button></ha-menu-button>\n            <div main-title>[[localize('panel.mailbox')]]</div>\n          </app-toolbar>\n          <div sticky hidden$=\"[[areTabsHidden(platforms)]]\">\n            <paper-tabs\n              scrollable\n              selected=\"[[_currentPlatform]]\"\n              on-iron-activate=\"handlePlatformSelected\"\n            >\n              <template is=\"dom-repeat\" items=\"[[platforms]]\">\n                <paper-tab data-entity=\"[[item]]\">\n                  [[getPlatformName(item)]]\n                </paper-tab>\n              </template>\n            </paper-tabs>\n          </div>\n        </app-header>\n        <div class=\"content\">\n          <ha-card>\n            <template is=\"dom-if\" if=\"[[!_messages.length]]\">\n              <div class=\"card-content empty\">\n                [[localize('ui.panel.mailbox.empty')]]\n              </div>\n            </template>\n            <template is=\"dom-repeat\" items=\"[[_messages]]\">\n              <paper-item on-click=\"openMP3Dialog\">\n                <paper-item-body style=\"width:100%\" two-line>\n                  <div class=\"row\">\n                    <div>[[item.caller]]</div>\n                    <div class=\"tip\">\n                      [[localize('ui.duration.second', 'count', item.duration)]]\n                    </div>\n                  </div>\n                  <div secondary>\n                    <span class=\"date\">[[item.timestamp]]</span> -\n                    [[item.message]]\n                  </div>\n                </paper-item-body>\n              </paper-item>\n            </template>\n          </ha-card>\n        </div>\n      </app-header-layout>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      platforms: {\n        type: Array,\n      },\n\n      _messages: {\n        type: Array,\n      },\n\n      _currentPlatform: {\n        type: Number,\n        value: 0,\n      },\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    if (!registeredDialog) {\n      registeredDialog = true;\n      this.fire(\"register-dialog\", {\n        dialogShowEvent: \"show-audio-message-dialog\",\n        dialogTag: \"ha-dialog-show-audio-message\",\n        dialogImport: () =>\n          import(/* webpackChunkName: \"ha-dialog-show-audio-message\" */ \"./ha-dialog-show-audio-message\"),\n      });\n    }\n    this.hassChanged = this.hassChanged.bind(this);\n    this.hass.connection\n      .subscribeEvents(this.hassChanged, \"mailbox_updated\")\n      .then(\n        function(unsub) {\n          this._unsubEvents = unsub;\n        }.bind(this)\n      );\n    this.computePlatforms().then(\n      function(platforms) {\n        this.platforms = platforms;\n        this.hassChanged();\n      }.bind(this)\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._unsubEvents) this._unsubEvents();\n  }\n\n  hassChanged() {\n    if (!this._messages) {\n      this._messages = [];\n    }\n    this.getMessages().then(\n      function(items) {\n        this._messages = items;\n      }.bind(this)\n    );\n  }\n\n  openMP3Dialog(event) {\n    this.fire(\"show-audio-message-dialog\", {\n      hass: this.hass,\n      message: event.model.item,\n    });\n  }\n\n  getMessages() {\n    const platform = this.platforms[this._currentPlatform];\n    return this.hass\n      .callApi(\"GET\", `mailbox/messages/${platform.name}`)\n      .then((values) => {\n        const platformItems = [];\n        const arrayLength = values.length;\n        for (let i = 0; i < arrayLength; i++) {\n          const datetime = formatDateTime(\n            new Date(values[i].info.origtime * 1000),\n            this.hass.language\n          );\n          platformItems.push({\n            timestamp: datetime,\n            caller: values[i].info.callerid,\n            message: values[i].text,\n            sha: values[i].sha,\n            duration: values[i].info.duration,\n            platform: platform,\n          });\n        }\n        return platformItems.sort(function(a, b) {\n          return new Date(b.timestamp) - new Date(a.timestamp);\n        });\n      });\n  }\n\n  computePlatforms() {\n    return this.hass.callApi(\"GET\", \"mailbox/platforms\");\n  }\n\n  handlePlatformSelected(ev) {\n    const newPlatform = ev.detail.selected;\n    if (newPlatform !== this._currentPlatform) {\n      this._currentPlatform = newPlatform;\n      this.hassChanged();\n    }\n  }\n\n  areTabsHidden(platforms) {\n    return !platforms || platforms.length < 2;\n  }\n\n  getPlatformName(item) {\n    const entity = `mailbox.${item.name}`;\n    const stateObj = this.hass.states[entity.toLowerCase()];\n    return stateObj.attributes.friendly_name;\n  }\n}\n\ncustomElements.define(\"ha-panel-mailbox\", HaPanelMailbox);\n"],"sourceRoot":""}