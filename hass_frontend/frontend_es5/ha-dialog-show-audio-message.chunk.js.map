{"version":3,"sources":["webpack:///./src/components/dialog/ha-iron-focusables-helper.js","webpack:///./src/components/dialog/ha-paper-dialog.ts","webpack:///./src/panels/mailbox/ha-dialog-show-audio-message.js"],"names":["HaIronFocusablesHelper","getTabbableNodes","node","result","needsSortByTabIndex","_collectTabbableNodes","IronFocusablesHelper","_sortByTabIndex","nodeType","Node","ELEMENT_NODE","_isVisible","element","tabIndex","_normalizedTabIndex","needsSort","push","children","localName","dom","getDistributedNodes","shadowRoot","root","i","length","paperDialogClass","customElements","get","haTabFixBehaviorImpl","_focusableNodes","HaPaperDialog","mixinBehaviors","define","HaDialogShowAudioMessage","hass","message","_errorMsg","_currentMessage","_opened","$","transcribe","innerText","platform","mp3","has_media","style","display","_showLoading","src","url","name","sha","fetchWithAuth","then","response","ok","blob","Promise","reject","status","statusText","window","URL","createObjectURL","play","err","confirm","localize","deleteSelected","msg","callApi","_dialogDone","pause","setProperties","_loading","ev","detail","value","displayed","delicon","can_delete","html","Object","String","type","Boolean","LocalizeMixin","PolymerElement"],"mappings":"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","file":"ha-dialog-show-audio-message.chunk.js","sourcesContent":["/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n/*\n  Fixes issue with not using shadow dom properly in iron-overlay-behavior/icon-focusables-helper.js\n*/\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\n\nimport { IronFocusablesHelper } from \"@polymer/iron-overlay-behavior/iron-focusables-helper.js\";\n\nexport const HaIronFocusablesHelper = {\n  /**\n   * Returns a sorted array of tabbable nodes, including the root node.\n   * It searches the tabbable nodes in the light and shadow dom of the chidren,\n   * sorting the result by tabindex.\n   * @param {!Node} node\n   * @return {!Array<!HTMLElement>}\n   */\n  getTabbableNodes: function(node) {\n    var result = [];\n    // If there is at least one element with tabindex > 0, we need to sort\n    // the final array by tabindex.\n    var needsSortByTabIndex = this._collectTabbableNodes(node, result);\n    if (needsSortByTabIndex) {\n      return IronFocusablesHelper._sortByTabIndex(result);\n    }\n    return result;\n  },\n\n  /**\n   * Searches for nodes that are tabbable and adds them to the `result` array.\n   * Returns if the `result` array needs to be sorted by tabindex.\n   * @param {!Node} node The starting point for the search; added to `result`\n   * if tabbable.\n   * @param {!Array<!HTMLElement>} result\n   * @return {boolean}\n   * @private\n   */\n  _collectTabbableNodes: function(node, result) {\n    // If not an element or not visible, no need to explore children.\n    if (\n      node.nodeType !== Node.ELEMENT_NODE ||\n      !IronFocusablesHelper._isVisible(node)\n    ) {\n      return false;\n    }\n    var element = /** @type {!HTMLElement} */ (node);\n    var tabIndex = IronFocusablesHelper._normalizedTabIndex(element);\n    var needsSort = tabIndex > 0;\n    if (tabIndex >= 0) {\n      result.push(element);\n    }\n\n    // In ShadowDOM v1, tab order is affected by the order of distrubution.\n    // E.g. getTabbableNodes(#root) in ShadowDOM v1 should return [#A, #B];\n    // in ShadowDOM v0 tab order is not affected by the distrubution order,\n    // in fact getTabbableNodes(#root) returns [#B, #A].\n    //  <div id=\"root\">\n    //   <!-- shadow -->\n    //     <slot name=\"a\">\n    //     <slot name=\"b\">\n    //   <!-- /shadow -->\n    //   <input id=\"A\" slot=\"a\">\n    //   <input id=\"B\" slot=\"b\" tabindex=\"1\">\n    //  </div>\n    // TODO(valdrin) support ShadowDOM v1 when upgrading to Polymer v2.0.\n    var children;\n    if (element.localName === \"content\" || element.localName === \"slot\") {\n      children = dom(element).getDistributedNodes();\n    } else {\n      // /////////////////////////\n      // Use shadow root if possible, will check for distributed nodes.\n      // THIS IS THE CHANGED LINE\n      children = dom(element.shadowRoot || element.root || element).children;\n      // /////////////////////////\n    }\n    for (var i = 0; i < children.length; i++) {\n      // Ensure method is always invoked to collect tabbable children.\n      needsSort = this._collectTabbableNodes(children[i], result) || needsSort;\n    }\n    return needsSort;\n  },\n};\n","import \"@polymer/paper-dialog/paper-dialog\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\nimport { HaIronFocusablesHelper } from \"./ha-iron-focusables-helper.js\";\n// tslint:disable-next-line\nimport { PaperDialogElement } from \"@polymer/paper-dialog/paper-dialog\";\n\nconst paperDialogClass = customElements.get(\"paper-dialog\");\n\n// behavior that will override existing iron-overlay-behavior and call the fixed implementation\nconst haTabFixBehaviorImpl = {\n  get _focusableNodes() {\n    return HaIronFocusablesHelper.getTabbableNodes(this);\n  },\n};\n\n// paper-dialog that uses the haTabFixBehaviorImpl behvaior\n// export class HaPaperDialog extends paperDialogClass {}\n// @ts-ignore\nexport class HaPaperDialog\n  extends mixinBehaviors([haTabFixBehaviorImpl], paperDialogClass)\n  implements PaperDialogElement {}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-paper-dialog\": HaPaperDialog;\n  }\n}\ncustomElements.define(\"ha-paper-dialog\", HaPaperDialog);\n","import \"@material/mwc-button\";\nimport \"@polymer/paper-spinner/paper-spinner\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"../../resources/ha-style\";\nimport \"../../components/dialog/ha-paper-dialog\";\n\nimport LocalizeMixin from \"../../mixins/localize-mixin\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaDialogShowAudioMessage extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"ha-style-dialog\">\n        .error {\n          color: red;\n        }\n        @media all and (max-width: 500px) {\n          ha-paper-dialog {\n            margin: 0;\n            width: 100%;\n            max-height: calc(100% - 64px);\n\n            position: fixed !important;\n            bottom: 0px;\n            left: 0px;\n            right: 0px;\n            overflow: scroll;\n            border-bottom-left-radius: 0px;\n            border-bottom-right-radius: 0px;\n          }\n        }\n\n        ha-paper-dialog {\n          border-radius: 2px;\n        }\n        ha-paper-dialog p {\n          color: var(--secondary-text-color);\n        }\n\n        .icon {\n          float: right;\n        }\n      </style>\n      <ha-paper-dialog\n        id=\"mp3dialog\"\n        with-backdrop\n        opened=\"{{_opened}}\"\n        on-opened-changed=\"_openedChanged\"\n      >\n        <h2>\n          [[localize('ui.panel.mailbox.playback_title')]]\n          <div class=\"icon\">\n            <template is=\"dom-if\" if=\"[[_loading]]\">\n              <paper-spinner active></paper-spinner>\n            </template>\n            <paper-icon-button\n              id=\"delicon\"\n              on-click=\"openDeleteDialog\"\n              icon=\"hass:delete\"\n            ></paper-icon-button>\n          </div>\n        </h2>\n        <div id=\"transcribe\"></div>\n        <div>\n          <template is=\"dom-if\" if=\"[[_errorMsg]]\">\n            <div class=\"error\">[[_errorMsg]]</div>\n          </template>\n          <audio id=\"mp3\" preload=\"none\" controls>\n            <source id=\"mp3src\" src=\"\" type=\"audio/mpeg\" />\n          </audio>\n        </div>\n      </ha-paper-dialog>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      _currentMessage: Object,\n\n      // Error message when can't talk to server etc\n      _errorMsg: String,\n\n      _loading: {\n        type: Boolean,\n        value: false,\n      },\n\n      _opened: {\n        type: Boolean,\n        value: false,\n      },\n    };\n  }\n\n  showDialog({ hass, message }) {\n    this.hass = hass;\n    this._errorMsg = null;\n    this._currentMessage = message;\n    this._opened = true;\n    this.$.transcribe.innerText = message.message;\n    const platform = message.platform;\n    const mp3 = this.$.mp3;\n    if (platform.has_media) {\n      mp3.style.display = \"\";\n      this._showLoading(true);\n      mp3.src = null;\n      const url = `/api/mailbox/media/${platform.name}/${message.sha}`;\n      this.hass\n        .fetchWithAuth(url)\n        .then((response) => {\n          if (response.ok) {\n            return response.blob();\n          }\n          return Promise.reject({\n            status: response.status,\n            statusText: response.statusText,\n          });\n        })\n        .then((blob) => {\n          this._showLoading(false);\n          mp3.src = window.URL.createObjectURL(blob);\n          mp3.play();\n        })\n        .catch((err) => {\n          this._showLoading(false);\n          this._errorMsg = `Error loading audio: ${err.statusText}`;\n        });\n    } else {\n      mp3.style.display = \"none\";\n      this._showLoading(false);\n    }\n  }\n\n  openDeleteDialog() {\n    if (confirm(this.localize(\"ui.panel.mailbox.delete_prompt\"))) {\n      this.deleteSelected();\n    }\n  }\n\n  deleteSelected() {\n    const msg = this._currentMessage;\n    this.hass.callApi(\n      \"DELETE\",\n      `mailbox/delete/${msg.platform.name}/${msg.sha}`\n    );\n    this._dialogDone();\n  }\n\n  _dialogDone() {\n    this.$.mp3.pause();\n    this.setProperties({\n      _currentMessage: null,\n      _errorMsg: null,\n      _loading: false,\n      _opened: false,\n    });\n  }\n\n  _openedChanged(ev) {\n    // Closed dialog by clicking on the overlay\n    // Check against dialogClosedCallback to make sure we didn't change\n    // programmatically\n    if (!ev.detail.value) {\n      this._dialogDone();\n    }\n  }\n\n  _showLoading(displayed) {\n    const delicon = this.$.delicon;\n    if (displayed) {\n      this._loading = true;\n      delicon.style.display = \"none\";\n    } else {\n      const platform = this._currentMessage.platform;\n      this._loading = false;\n      delicon.style.display = platform.can_delete ? \"\" : \"none\";\n    }\n  }\n}\ncustomElements.define(\"ha-dialog-show-audio-message\", HaDialogShowAudioMessage);\n"],"sourceRoot":""}