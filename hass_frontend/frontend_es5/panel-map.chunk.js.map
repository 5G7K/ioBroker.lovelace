{"version":3,"sources":["webpack:///./src/common/dom/setup-leaflet-map.ts","webpack:///./src/common/entity/compute_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/entity/compute_state_domain.ts","webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/components/ha-icon.ts","webpack:///./src/mixins/events-mixin.js","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/panels/map/ha-entity-marker.js","webpack:///./src/panels/map/ha-panel-map.js"],"names":["setupLeafletMap","mapElement","parentNode","Error","Leaflet","Icon","Default","imagePath","map","style","document","createElement","setAttribute","appendChild","setView","tileLayer","Browser","retina","attribution","subdomains","minZoom","maxZoom","addTo","computeDomain","entityId","substr","indexOf","computeObjectId","computeStateDomain","stateObj","entity_id","attributes","friendly_name","undefined","replace","ironIconClass","customElements","get","loaded","HaIcon","node","eventName","methodName","_iconsetName","define","EventsMixin","dedupingMixin","superClass","type","detail","options","fireEvent","localize","hass","Object","Function","computed","HaEntityMarker","addEventListener","ev","badgeTap","stopPropagation","fire","html","String","value","entityName","entityPicture","PolymerElement","HaPanelMap","loadMap","$","_map","drawEntities","invalidateSize","fitMap","remove","bounds","_mapItems","length","LatLng","config","latitude","longitude","latLngBounds","item","getLatLng","fitBounds","pad","forEach","marker","mapItems","keys","states","entity","title","computeStateName","hidden","state","icon","passive","iconHTML","el","outerHTML","divIcon","iconSize","className","push","interactive","circle","color","radius","entity_picture","split","part","join","gps_accuracy","observer","LocalizeMixin"],"mappings":"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","file":"panel-map.chunk.js","sourcesContent":["import { Map } from \"leaflet\";\n\n// Sets up a Leaflet map on the provided DOM element\nexport type LeafletModuleType = typeof import(\"leaflet\");\n\nexport const setupLeafletMap = async (\n  mapElement: HTMLElement\n): Promise<[Map, LeafletModuleType]> => {\n  if (!mapElement.parentNode) {\n    throw new Error(\"Cannot setup Leaflet map on disconnected element\");\n  }\n  // tslint:disable-next-line\n  const Leaflet = (await import(/* webpackChunkName: \"leaflet\" */ \"leaflet\")) as LeafletModuleType;\n  Leaflet.Icon.Default.imagePath = \"/static/images/leaflet/images/\";\n\n  const map = Leaflet.map(mapElement);\n  const style = document.createElement(\"link\");\n  style.setAttribute(\"href\", \"/static/images/leaflet/leaflet.css\");\n  style.setAttribute(\"rel\", \"stylesheet\");\n  mapElement.parentNode.appendChild(style);\n  map.setView([52.3731339, 4.8903147], 13);\n  Leaflet.tileLayer(\n    `https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}${\n      Leaflet.Browser.retina ? \"@2x.png\" : \".png\"\n    }`,\n    {\n      attribution:\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>, &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n      subdomains: \"abcd\",\n      minZoom: 0,\n      maxZoom: 20,\n    }\n  ).addTo(map);\n\n  return [map, Leaflet];\n};\n","export default function computeDomain(entityId: string): string {\n  return entityId.substr(0, entityId.indexOf(\".\"));\n}\n","/** Compute the object ID of a state. */\nexport default function computeObjectId(entityId: string): string {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeDomain from \"./compute_domain\";\n\nexport default function computeStateDomain(stateObj: HassEntity) {\n  return computeDomain(stateObj.entity_id);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeObjectId from \"./compute_object_id\";\n\nexport default (stateObj: HassEntity): string =>\n  stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n","import { Constructor } from \"lit-element\";\nimport \"@polymer/iron-icon/iron-icon\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { IronIconElement } from \"@polymer/iron-icon/iron-icon\";\n\nconst ironIconClass = customElements.get(\"iron-icon\") as Constructor<\n  IronIconElement\n>;\n\nlet loaded = false;\n\nexport class HaIcon extends ironIconClass {\n  private _iconsetName?: string;\n\n  public listen(\n    node: EventTarget | null,\n    eventName: string,\n    methodName: string\n  ): void {\n    super.listen(node, eventName, methodName);\n\n    if (!loaded && this._iconsetName === \"mdi\") {\n      loaded = true;\n      import(/* webpackChunkName: \"mdi-icons\" */ \"../resources/mdi-icons\");\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n\ncustomElements.define(\"ha-icon\", HaIcon);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import \"@polymer/iron-image/iron-image\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport { EventsMixin } from \"../../mixins/events-mixin\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaEntityMarker extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-positioning\"></style>\n      <style>\n        .marker {\n          vertical-align: top;\n          position: relative;\n          display: block;\n          margin: 0 auto;\n          width: 2.5em;\n          text-align: center;\n          height: 2.5em;\n          line-height: 2.5em;\n          font-size: 1.5em;\n          border-radius: 50%;\n          border: 0.1em solid\n            var(--ha-marker-color, var(--default-primary-color));\n          color: rgb(76, 76, 76);\n          background-color: white;\n        }\n        iron-image {\n          border-radius: 50%;\n        }\n      </style>\n\n      <div class=\"marker\">\n        <template is=\"dom-if\" if=\"[[entityName]]\"\n          >[[entityName]]</template\n        >\n        <template is=\"dom-if\" if=\"[[entityPicture]]\">\n          <iron-image\n            sizing=\"cover\"\n            class=\"fit\"\n            src=\"[[entityPicture]]\"\n          ></iron-image>\n        </template>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      entityId: {\n        type: String,\n        value: \"\",\n      },\n\n      entityName: {\n        type: String,\n        value: null,\n      },\n\n      entityPicture: {\n        type: String,\n        value: null,\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"click\", (ev) => this.badgeTap(ev));\n  }\n\n  badgeTap(ev) {\n    ev.stopPropagation();\n    if (this.entityId) {\n      this.fire(\"hass-more-info\", { entityId: this.entityId });\n    }\n  }\n}\n\ncustomElements.define(\"ha-entity-marker\", HaEntityMarker);\n","import \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"../../components/ha-menu-button\";\nimport \"../../components/ha-icon\";\n\nimport \"./ha-entity-marker\";\n\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport computeStateName from \"../../common/entity/compute_state_name\";\nimport LocalizeMixin from \"../../mixins/localize-mixin\";\nimport { setupLeafletMap } from \"../../common/dom/setup-leaflet-map\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaPanelMap extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"ha-style\">\n        #map {\n          height: calc(100% - 64px);\n          width: 100%;\n          z-index: 0;\n        }\n      </style>\n\n      <app-toolbar>\n        <ha-menu-button></ha-menu-button>\n        <div main-title>[[localize('panel.map')]]</div>\n      </app-toolbar>\n\n      <div id=\"map\"></div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"drawEntities\",\n      },\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.loadMap();\n  }\n\n  async loadMap() {\n    [this._map, this.Leaflet] = await setupLeafletMap(this.$.map);\n    this.drawEntities(this.hass);\n    this._map.invalidateSize();\n    this.fitMap();\n  }\n\n  disconnectedCallback() {\n    if (this._map) {\n      this._map.remove();\n    }\n  }\n\n  fitMap() {\n    var bounds;\n\n    if (this._mapItems.length === 0) {\n      this._map.setView(\n        new this.Leaflet.LatLng(\n          this.hass.config.latitude,\n          this.hass.config.longitude\n        ),\n        14\n      );\n    } else {\n      bounds = new this.Leaflet.latLngBounds(\n        this._mapItems.map((item) => item.getLatLng())\n      );\n      this._map.fitBounds(bounds.pad(0.5));\n    }\n  }\n\n  drawEntities(hass) {\n    /* eslint-disable vars-on-top */\n    var map = this._map;\n    if (!map) return;\n\n    if (this._mapItems) {\n      this._mapItems.forEach(function(marker) {\n        marker.remove();\n      });\n    }\n    var mapItems = (this._mapItems = []);\n\n    Object.keys(hass.states).forEach((entityId) => {\n      var entity = hass.states[entityId];\n      var title = computeStateName(entity);\n\n      if (\n        (entity.attributes.hidden && computeStateDomain(entity) !== \"zone\") ||\n        entity.state === \"home\" ||\n        !(\"latitude\" in entity.attributes) ||\n        !(\"longitude\" in entity.attributes)\n      ) {\n        return;\n      }\n\n      var icon;\n\n      if (computeStateDomain(entity) === \"zone\") {\n        // DRAW ZONE\n        if (entity.attributes.passive) return;\n\n        // create icon\n        var iconHTML = \"\";\n        if (entity.attributes.icon) {\n          const el = document.createElement(\"ha-icon\");\n          el.setAttribute(\"icon\", entity.attributes.icon);\n          iconHTML = el.outerHTML;\n        } else {\n          iconHTML = title;\n        }\n\n        icon = this.Leaflet.divIcon({\n          html: iconHTML,\n          iconSize: [24, 24],\n          className: \"\",\n        });\n\n        // create market with the icon\n        mapItems.push(\n          this.Leaflet.marker(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              icon: icon,\n              interactive: false,\n              title: title,\n            }\n          ).addTo(map)\n        );\n\n        // create circle around it\n        mapItems.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: \"#FF9800\",\n              radius: entity.attributes.radius,\n            }\n          ).addTo(map)\n        );\n\n        return;\n      }\n\n      // DRAW ENTITY\n      // create icon\n      var entityPicture = entity.attributes.entity_picture || \"\";\n      var entityName = title\n        .split(\" \")\n        .map(function(part) {\n          return part.substr(0, 1);\n        })\n        .join(\"\");\n      /* Leaflet clones this element before adding it to the map. This messes up\n         our Polymer object and we can't pass data through. Thus we hack like this. */\n      icon = this.Leaflet.divIcon({\n        html:\n          \"<ha-entity-marker entity-id='\" +\n          entity.entity_id +\n          \"' entity-name='\" +\n          entityName +\n          \"' entity-picture='\" +\n          entityPicture +\n          \"'></ha-entity-marker>\",\n        iconSize: [45, 45],\n        className: \"\",\n      });\n\n      // create market with the icon\n      mapItems.push(\n        this.Leaflet.marker(\n          [entity.attributes.latitude, entity.attributes.longitude],\n          {\n            icon: icon,\n            title: computeStateName(entity),\n          }\n        ).addTo(map)\n      );\n\n      // create circle around if entity has accuracy\n      if (entity.attributes.gps_accuracy) {\n        mapItems.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: \"#0288D1\",\n              radius: entity.attributes.gps_accuracy,\n            }\n          ).addTo(map)\n        );\n      }\n    });\n  }\n}\n\ncustomElements.define(\"ha-panel-map\", HaPanelMap);\n"],"sourceRoot":""}