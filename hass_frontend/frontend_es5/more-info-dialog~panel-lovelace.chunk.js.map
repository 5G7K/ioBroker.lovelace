{"version":3,"sources":["webpack:///./src/common/config/is_component_loaded.ts","webpack:///./src/common/datetime/duration_to_seconds.ts","webpack:///./src/common/datetime/format_date.ts","webpack:///./src/common/datetime/format_date_time.ts","webpack:///./src/common/datetime/format_time.ts","webpack:///./src/common/datetime/relative_time.ts","webpack:///./src/common/datetime/seconds_to_duration.ts","webpack:///./src/common/dom/stop_propagation.ts","webpack:///./src/common/entity/binary_sensor_icon.ts","webpack:///./src/common/entity/compute_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/entity/compute_state_display.ts","webpack:///./src/common/entity/compute_state_domain.ts","webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/common/entity/cover_icon.ts","webpack:///./src/common/entity/domain_icon.ts","webpack:///./src/common/entity/input_dateteime_icon.ts","webpack:///./src/common/entity/sensor_icon.ts","webpack:///./src/common/entity/state_icon.ts","webpack:///./src/common/entity/supports-feature.ts","webpack:///./src/common/entity/timer_time_remaining.ts","webpack:///./src/common/util/debounce.ts","webpack:///./src/common/util/time-cache-function-promise.ts","webpack:///./src/components/entity/ha-chart-base.js","webpack:///./src/components/entity/ha-entity-toggle.ts","webpack:///./src/components/entity/state-badge.ts","webpack:///./src/components/ha-climate-state.js","webpack:///./src/components/ha-cover-controls.js","webpack:///./src/components/ha-cover-tilt-controls.js","webpack:///./src/components/ha-icon.ts","webpack:///./src/components/ha-paper-dropdown-menu.ts","webpack:///./src/components/ha-relative-time.js","webpack:///./src/components/ha-slider.js","webpack:///./src/components/paper-time-input.js","webpack:///./src/components/state-history-chart-line.js","webpack:///./src/components/state-history-chart-timeline.js","webpack:///./src/components/state-history-charts.js","webpack:///./src/data/auth.ts","webpack:///./src/data/cached-history.ts","webpack:///./src/data/camera.ts","webpack:///./src/data/entity_registry.ts","webpack:///./src/data/ha-state-history-data.js","webpack:///./src/data/history.ts","webpack:///./src/data/input-select.ts","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/util/cover-model.js","webpack:///./src/util/hass-media-player-model.js"],"names":["isComponentLoaded","hass","component","config","components","indexOf","durationToSeconds","duration","parts","split","map","Number","toLocaleDateStringSupportsOptions","Date","toLocaleDateString","e","name","dateObj","locales","year","month","day","fecha","format","toLocaleStringSupportsOptions","toLocaleString","hour","minute","toLocaleTimeStringSupportsOptions","toLocaleTimeString","tests","langKey","relativeTime","localize","options","compareTime","delta","getTime","tense","Math","abs","timeDesc","i","length","floor","undefined","includeTense","leftPad","num","secondsToDuration","d","h","m","s","stopPropagation","ev","binarySensorIcon","state","activated","attributes","device_class","computeDomain","entityId","substr","computeObjectId","stateObj","language","display","domain","computeStateDomain","unit_of_measurement","includes","date","has_time","formatDate","has_date","now","getFullYear","getMonth","getDay","formatTime","formatDateTime","query_stage","entity_id","friendly_name","replace","coverIcon","open","domainIcon","fixedIcons","alert","automation","calendar","camera","climate","configurator","conversation","device_tracker","fan","group","history_graph","homeassistant","homekit","image_processing","input_boolean","input_datetime","input_number","input_select","input_text","light","mailbox","notify","person","plant","proximity","remote","scene","script","sensor","simple_alarm","sun","timer","updater","vacuum","water_heater","weblink","console","warn","DEFAULT_DOMAIN_ICON","inputDateTimeIcon","fixedDeviceClassIcons","humidity","illuminance","temperature","pressure","power","signal_strength","sensorIcon","dclass","battery","isNaN","batteryRound","round","unit","UNIT_C","UNIT_F","domainIcons","binary_sensor","cover","stateIcon","icon","supportsFeature","feature","supported_features","timerTimeRemaining","timeRemaining","remaining","madeActive","last_changed","max","debounce","func","wait","immediate","timeout","args","context","later","apply","callNow","clearTimeout","setTimeout","timeCachePromiseFunc","cacheKey","cacheTime","cache","lastResult","result","then","scriptsLoaded","HaChartBase","_isAttached","onPropsChange","_resizeListener","_debouncer","Debouncer","timeOut","after","resizeChart","ResizeObserver","resizeObserver","entries","forEach","observe","$","chartTarget","addEventListener","ChartModule","ChartClass","unobserve","removeEventListener","_resizeTimer","clearInterval","data","drawChart","tooltip","opacity","set","yAlign","title","bodyLines","body","n","lines","colors","labelColors","color","borderColor","bgColor","backgroundColor","text","join","parentWidth","clientWidth","positionX","caretX","positionY","_chart","canvas","offsetTop","caretY","offsetLeft","Object","assign","left","top","event","window","target","srcElement","nodeName","parentElement","index","model","itemsIndex","meta","getDatasetMeta","hidden","datasets","isDatasetVisible","update","chart","preserveVisibility","_oldIdentifier","identifier","x","label","metas","updateNeeded","value","values","ctx","chartCanvas","type","cnt","constructor","getColorList","loopI","rgbString","alpha","rgbaString","_customTooltips","isTimeline","scales","yAxes","gridLines","legend","_drawLegend","plugins","afterRender","_setRendered","responsive","maintainAspectRatio","animation","hover","animationDuration","responsiveAnimationDuration","tooltips","enabled","custom","bind","line","spanGaps","elements","font","ticks","fontFamily","Chart","helpers","merge","xAxes","callback","_formatTickValue","_colorFunc","getColorGenerator","staticColors","staticColorIndex","colorFunction","style","height","chartData","setInterval","_resizeChart","resize","areaTop","chartArea","areaBot","bottom","height1","clientHeight","_axisHeight","targetHeight","count","processL","ceil","h1","Color","hsl","startIndex","palette","getColorIndex","idx","colorDict","colorIndex","keys","c","c1","isFinite","toLowerCase","getColor","__","ret","name1","html","String","rendered","Boolean","readOnly","Array","xPadding","yPadding","rtl","reflectToAttribute","mixinBehaviors","IronResizableBehavior","PolymerElement","customElements","define","isOn","STATES_OFF","HaEntityToggle","property","assumed_state","_turnOff","_isOn","_turnOn","_toggleChanged","changedProps","has","newVal","checked","_callService","turnOn","forwardHaptic","stateDomain","serviceDomain","service","currentState","callService","css","LitElement","StateBadge","query","overrideIcon","iconStyle","filter","hostStyle","backgroundImage","entity_picture","hs_color","hue","sat","brightness","errorMessage","_icon","HaClimateState","current_temperature","unit_system","current_humidity","target_temp_low","target_temp_high","target_humidity_low","target_humidity_high","currentStatus","computed","LocalizeMixin","HaCoverControls","CoverEntity","entityObj","assumedState","isFullyOpen","isOpening","isFullyClosed","isClosing","openCover","closeCover","stopCover","HaCoverTiltControls","isFullyOpenTilt","isFullyClosedTilt","openCoverTilt","closeCoverTilt","stopCoverTilt","ironIconClass","get","loaded","HaIcon","node","eventName","methodName","_iconsetName","paperDropdownClass","HaPaperDropdownClass","getComputedStyle","direction","textAlign","HaRelativeTime","datetime","observer","datetimeObj","parsedDateTime","updateRelative","updateInterval","root","dom","innerHTML","PaperSliderClass","subTemplate","HaSlider","step","parseFloat","numSteps","min","stepStr","toString","stepPointAt","precision","template","cloneNode","superStyle","content","querySelector","appendChild","document","createTextNode","PaperTimeInput","valid","validate","dropdown","amPm","n1","n2","autoValidate","hideLabel","disabled","StateHistoryChartLine","animateHeight","requestAnimationFrame","scrollHeight","deviceStates","endTime","safeParseFloat","parsed","devSts","states","names","prevValues","pushData","timestamp","datavalues","push","y","addColumn","nameY","fill","dataFill","dataStep","steppedLine","pointRadius","unitText","hasTargetRange","some","hasHeat","hasCool","curTemp","series","targetHigh","targetLow","isStep","lastValue","lastDate","lastNullDate","dateTime","lastNullDateTime","lastDateTime","tmpValue","prototype","formatTooltipTitle","items","item","datasetIndex","chartOptions","isSingleDevice","major","fontStyle","maxTicksLimit","mode","callbacks","layout","padding","tension","borderWidth","point","hitRadius","filler","propagate","labels","StateHistoryChartTimeline","on","off","unavailable","unknown","idle","stateHistory","startTime","reduce","minTime","stateInfo","maxTime","newLastChanged","prevState","locState","prevLastChanged","entityDisplay","dataRow","newState","timeStamp","state_localize","formatTooltipLabel","start","end","afterSetDimensions","yaxe","maxWidth","width","position","_computeRTL","computeRTL","noSingle","StateHistoryCharts","isLoadingData","historyData","historyDataEmpty","timeline","isLoading","upToNow","hassUrl","location","protocol","host","getSignedPath","path","callWS","fetchAuthProviders","fetch","credentials","RECENT_THRESHOLD","RECENT_CACHE","stateHistoryCache","getRecent","created","prom","fetchRecent","computeHistory","err","getEmptyCache","Promise","resolve","getRecentWithCache","cacheConfig","setHours","getHours","hoursToShow","toFetchStartTime","appendingToCache","curCacheProm","genProm","all","results","fetchedHistory","mergeLine","mergeTimeline","pruneStartTime","historyLines","cacheLines","oldLine","find","cacheLine","entity","oldEntity","cacheEntity","concat","historyTimelines","cacheTimelines","oldTimeline","cacheTimeline","pruneArray","originalStartTime","arr","changedAfterStartTime","findIndex","updateIndex","slice","cacheData","CAMERA_SUPPORT_ON_OFF","CAMERA_SUPPORT_STREAM","computeMJPEGStreamUrl","access_token","fetchThumbnailUrlWithCache","fetchThumbnailUrl","fetchThumbnail","fetchStreamUrl","fetchCameraPrefs","updateCameraPrefs","prefs","computeEntityRegistryName","entry","computeStateName","updateEntityRegistryEntry","updates","removeEntityRegistryEntry","fetchEntityRegistry","conn","sendMessagePromise","subscribeEntityRegistryUpdates","store","subscribeEvents","entities","setState","subscribeEntityRegistry","onChange","createCollection","HaStateHistoryData","filterChangedDebouncer","filterType","_refreshTimeoutId","newHass","oldHass","_madeFirstCall","_debounceFilterChanged","filterChanged","fetchDate","dateHistory","getRecentWithCacheRefresh","_setIsLoading","_setData","refresh","DOMAINS_USE_LAST_UPDATED","LINE_ATTRIBUTES_TO_KEEP","skipInitialState","url","toISOString","callApi","equalState","obj1","obj2","every","attr","processTimelineEntity","computeStateDisplay","processLineChartEntities","last","processedStates","processedState","last_updated","lineChartDevices","timelineDevices","stateWithUnit","unitStates","setInputSelectOption","option","dedupingMixin","superClass","Function","_attr","_feat","tiltPosition","tilt_position","current_position","current_tilt_position","supportsCover","supportsOpen","supportsClose","supportsStop","supportsTilt","supportsOpenTilt","supportsCloseTilt","supportsStopTilt","supportsSetPosition","supportsSetTiltPosition","isTiltOnly","MediaPlayerEntity","volume","volume_level","isOff","turnOff","mute","supportsVolumeMute","Error","is_volume_muted","source","soundMode","sound_mode","media_content_type","isPlaying","isPaused","progress","media_position","media_position_updated_at","media_title","isMusic","media_artist","isTVShow","media_series_title","media_season","media_episode","app_name","source_list","sound_mode_list"],"mappings":"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","file":"more-info-dialog~panel-lovelace.chunk.js","sourcesContent":["import { HomeAssistant } from \"../../types\";\n\n/** Return if a component is loaded. */\nexport default function isComponentLoaded(\n  hass: HomeAssistant,\n  component: string\n): boolean {\n  return hass && hass.config.components.indexOf(component) !== -1;\n}\n","export default function durationToSeconds(duration: string): number {\n  const parts = duration.split(\":\").map(Number);\n  return parts[0] * 3600 + parts[1] * 60 + parts[2];\n}\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleDateStringSupportsOptions() {\n  try {\n    new Date().toLocaleDateString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleDateStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleDateString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"mediumDate\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleStringSupportsOptions() {\n  try {\n    new Date().toLocaleString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleString(locales, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"haDateTime\"));\n","import fecha from \"fecha\";\n\n// Check for support of native locale string options\nfunction toLocaleTimeStringSupportsOptions() {\n  try {\n    new Date().toLocaleTimeString(\"i\");\n  } catch (e) {\n    return e.name === \"RangeError\";\n  }\n  return false;\n}\n\nexport default (toLocaleTimeStringSupportsOptions()\n  ? (dateObj: Date, locales: string) =>\n      dateObj.toLocaleTimeString(locales, {\n        hour: \"numeric\",\n        minute: \"2-digit\",\n      })\n  : (dateObj: Date) => fecha.format(dateObj, \"shortTime\"));\n","import { LocalizeFunc } from \"../translations/localize\";\n\n/**\n * Calculate a string representing a date object as relative time from now.\n *\n * Example output: 5 minutes ago, in 3 days.\n */\nconst tests = [60, 60, 24, 7];\nconst langKey = [\"second\", \"minute\", \"hour\", \"day\"];\n\nexport default function relativeTime(\n  dateObj: Date,\n  localize: LocalizeFunc,\n  options: {\n    compareTime?: Date;\n    includeTense?: boolean;\n  } = {}\n): string {\n  const compareTime = options.compareTime || new Date();\n  let delta = (compareTime.getTime() - dateObj.getTime()) / 1000;\n  const tense = delta >= 0 ? \"past\" : \"future\";\n  delta = Math.abs(delta);\n\n  let timeDesc;\n\n  for (let i = 0; i < tests.length; i++) {\n    if (delta < tests[i]) {\n      delta = Math.floor(delta);\n      timeDesc = localize(\n        `ui.components.relative_time.duration.${langKey[i]}`,\n        \"count\",\n        delta\n      );\n      break;\n    }\n\n    delta /= tests[i];\n  }\n\n  if (timeDesc === undefined) {\n    delta = Math.floor(delta);\n    timeDesc = localize(\n      \"ui.components.relative_time.duration.week\",\n      \"count\",\n      delta\n    );\n  }\n\n  return options.includeTense === false\n    ? timeDesc\n    : localize(`ui.components.relative_time.${tense}`, \"time\", timeDesc);\n}\n","const leftPad = (num: number) => (num < 10 ? `0${num}` : num);\n\nexport default function secondsToDuration(d: number) {\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  if (h > 0) {\n    return `${h}:${leftPad(m)}:${leftPad(s)}`;\n  }\n  if (m > 0) {\n    return `${m}:${leftPad(s)}`;\n  }\n  if (s > 0) {\n    return \"\" + s;\n  }\n  return null;\n}\n","export const stopPropagation = (ev) => ev.stopPropagation();\n","import { HassEntity } from \"home-assistant-js-websocket\";\n\n/** Return an icon representing a binary sensor state. */\n\nexport default function binarySensorIcon(state: HassEntity) {\n  const activated = state.state && state.state === \"off\";\n  switch (state.attributes.device_class) {\n    case \"battery\":\n      return activated ? \"hass:battery\" : \"hass:battery-outline\";\n    case \"cold\":\n      return activated ? \"hass:thermometer\" : \"hass:snowflake\";\n    case \"connectivity\":\n      return activated ? \"hass:server-network-off\" : \"hass:server-network\";\n    case \"door\":\n      return activated ? \"hass:door-closed\" : \"hass:door-open\";\n    case \"garage_door\":\n      return activated ? \"hass:garage\" : \"hass:garage-open\";\n    case \"gas\":\n    case \"power\":\n    case \"problem\":\n    case \"safety\":\n    case \"smoke\":\n      return activated ? \"hass:shield-check\" : \"hass:alert\";\n    case \"heat\":\n      return activated ? \"hass:thermometer\" : \"hass:fire\";\n    case \"light\":\n      return activated ? \"hass:brightness-5\" : \"hass:brightness-7\";\n    case \"lock\":\n      return activated ? \"hass:lock\" : \"hass:lock-open\";\n    case \"moisture\":\n      return activated ? \"hass:water-off\" : \"hass:water\";\n    case \"motion\":\n      return activated ? \"hass:walk\" : \"hass:run\";\n    case \"occupancy\":\n      return activated ? \"hass:home-outline\" : \"hass:home\";\n    case \"opening\":\n      return activated ? \"hass:square\" : \"hass:square-outline\";\n    case \"plug\":\n      return activated ? \"hass:power-plug-off\" : \"hass:power-plug\";\n    case \"presence\":\n      return activated ? \"hass:home-outline\" : \"hass:home\";\n    case \"sound\":\n      return activated ? \"hass:music-note-off\" : \"hass:music-note\";\n    case \"vibration\":\n      return activated ? \"hass:crop-portrait\" : \"hass:vibrate\";\n    case \"window\":\n      return activated ? \"hass:window-closed\" : \"hass:window-open\";\n    default:\n      return activated ? \"hass:radiobox-blank\" : \"hass:checkbox-marked-circle\";\n  }\n}\n","export default function computeDomain(entityId: string): string {\n  return entityId.substr(0, entityId.indexOf(\".\"));\n}\n","/** Compute the object ID of a state. */\nexport default function computeObjectId(entityId: string): string {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeStateDomain from \"./compute_state_domain\";\nimport formatDateTime from \"../datetime/format_date_time\";\nimport formatDate from \"../datetime/format_date\";\nimport formatTime from \"../datetime/format_time\";\nimport { LocalizeFunc } from \"../translations/localize\";\n\nexport default (\n  localize: LocalizeFunc,\n  stateObj: HassEntity,\n  language: string\n): string => {\n  let display: string | undefined;\n  const domain = computeStateDomain(stateObj);\n\n  if (domain === \"binary_sensor\") {\n    // Try device class translation, then default binary sensor translation\n    if (stateObj.attributes.device_class) {\n      display = localize(\n        `state.${domain}.${stateObj.attributes.device_class}.${stateObj.state}`\n      );\n    }\n\n    if (!display) {\n      display = localize(`state.${domain}.default.${stateObj.state}`);\n    }\n  } else if (\n    stateObj.attributes.unit_of_measurement &&\n    ![\"unknown\", \"unavailable\"].includes(stateObj.state)\n  ) {\n    display = stateObj.state + \" \" + stateObj.attributes.unit_of_measurement;\n  } else if (domain === \"input_datetime\") {\n    let date: Date;\n    if (!stateObj.attributes.has_time) {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day\n      );\n      display = formatDate(date, language);\n    } else if (!stateObj.attributes.has_date) {\n      const now = new Date();\n      date = new Date(\n        // Due to bugs.chromium.org/p/chromium/issues/detail?id=797548\n        // don't use artificial 1970 year.\n        now.getFullYear(),\n        now.getMonth(),\n        now.getDay(),\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatTime(date, language);\n    } else {\n      date = new Date(\n        stateObj.attributes.year,\n        stateObj.attributes.month - 1,\n        stateObj.attributes.day,\n        stateObj.attributes.hour,\n        stateObj.attributes.minute\n      );\n      display = formatDateTime(date, language);\n    }\n  } else if (domain === \"zwave\") {\n    if ([\"initializing\", \"dead\"].includes(stateObj.state)) {\n      display = localize(\n        `state.zwave.query_stage.${stateObj.state}`,\n        \"query_stage\",\n        stateObj.attributes.query_stage\n      );\n    } else {\n      display = localize(`state.zwave.default.${stateObj.state}`);\n    }\n  } else {\n    display = localize(`state.${domain}.${stateObj.state}`);\n  }\n\n  // Fall back to default, component backend translation, or raw state if nothing else matches.\n  if (!display) {\n    display =\n      localize(`state.default.${stateObj.state}`) ||\n      localize(`component.${domain}.state.${stateObj.state}`) ||\n      stateObj.state;\n  }\n\n  return display;\n};\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeDomain from \"./compute_domain\";\n\nexport default function computeStateDomain(stateObj: HassEntity) {\n  return computeDomain(stateObj.entity_id);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport computeObjectId from \"./compute_object_id\";\n\nexport default (stateObj: HassEntity): string =>\n  stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n","/** Return an icon representing a cover state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport domainIcon from \"./domain_icon\";\n\nexport default function coverIcon(state: HassEntity): string {\n  const open = state.state !== \"closed\";\n  switch (state.attributes.device_class) {\n    case \"garage\":\n      return open ? \"hass:garage-open\" : \"hass:garage\";\n    default:\n      return domainIcon(\"cover\", state.state);\n  }\n}\n","/**\n * Return the icon to be used for a domain.\n *\n * Optionally pass in a state to influence the domain icon.\n */\nimport { DEFAULT_DOMAIN_ICON } from \"../const\";\n\nconst fixedIcons = {\n  alert: \"hass:alert\",\n  automation: \"hass:playlist-play\",\n  calendar: \"hass:calendar\",\n  camera: \"hass:video\",\n  climate: \"hass:thermostat\",\n  configurator: \"hass:settings\",\n  conversation: \"hass:text-to-speech\",\n  device_tracker: \"hass:account\",\n  fan: \"hass:fan\",\n  group: \"hass:google-circles-communities\",\n  history_graph: \"hass:chart-line\",\n  homeassistant: \"hass:home-assistant\",\n  homekit: \"hass:home-automation\",\n  image_processing: \"hass:image-filter-frames\",\n  input_boolean: \"hass:drawing\",\n  input_datetime: \"hass:calendar-clock\",\n  input_number: \"hass:ray-vertex\",\n  input_select: \"hass:format-list-bulleted\",\n  input_text: \"hass:textbox\",\n  light: \"hass:lightbulb\",\n  mailbox: \"hass:mailbox\",\n  notify: \"hass:comment-alert\",\n  person: \"hass:account\",\n  plant: \"hass:flower\",\n  proximity: \"hass:apple-safari\",\n  remote: \"hass:remote\",\n  scene: \"hass:google-pages\",\n  script: \"hass:file-document\",\n  sensor: \"hass:eye\",\n  simple_alarm: \"hass:bell\",\n  sun: \"hass:white-balance-sunny\",\n  switch: \"hass:flash\",\n  timer: \"hass:timer\",\n  updater: \"hass:cloud-upload\",\n  vacuum: \"hass:robot-vacuum\",\n  water_heater: \"hass:thermometer\",\n  weblink: \"hass:open-in-new\",\n};\n\nexport default function domainIcon(domain: string, state?: string): string {\n  if (domain in fixedIcons) {\n    return fixedIcons[domain];\n  }\n\n  switch (domain) {\n    case \"alarm_control_panel\":\n      switch (state) {\n        case \"armed_home\":\n          return \"hass:bell-plus\";\n        case \"armed_night\":\n          return \"hass:bell-sleep\";\n        case \"disarmed\":\n          return \"hass:bell-outline\";\n        case \"triggered\":\n          return \"hass:bell-ring\";\n        default:\n          return \"hass:bell\";\n      }\n\n    case \"binary_sensor\":\n      return state && state === \"off\"\n        ? \"hass:radiobox-blank\"\n        : \"hass:checkbox-marked-circle\";\n\n    case \"cover\":\n      return state === \"closed\" ? \"hass:window-closed\" : \"hass:window-open\";\n\n    case \"lock\":\n      return state && state === \"unlocked\" ? \"hass:lock-open\" : \"hass:lock\";\n\n    case \"media_player\":\n      return state && state !== \"off\" && state !== \"idle\"\n        ? \"hass:cast-connected\"\n        : \"hass:cast\";\n\n    case \"zwave\":\n      switch (state) {\n        case \"dead\":\n          return \"hass:emoticon-dead\";\n        case \"sleeping\":\n          return \"hass:sleep\";\n        case \"initializing\":\n          return \"hass:timer-sand\";\n        default:\n          return \"hass:z-wave\";\n      }\n\n    default:\n      // tslint:disable-next-line\n      console.warn(\n        \"Unable to find icon for domain \" + domain + \" (\" + state + \")\"\n      );\n      return DEFAULT_DOMAIN_ICON;\n  }\n}\n","/** Return an icon representing an input datetime state. */\nimport domainIcon from \"./domain_icon\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n\nexport default function inputDateTimeIcon(state: HassEntity): string {\n  if (!state.attributes.has_date) {\n    return \"hass:clock\";\n  }\n  if (!state.attributes.has_time) {\n    return \"hass:calendar\";\n  }\n  return domainIcon(\"input_datetime\");\n}\n","/** Return an icon representing a sensor state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { UNIT_C, UNIT_F } from \"../const\";\nimport domainIcon from \"./domain_icon\";\n\nconst fixedDeviceClassIcons = {\n  humidity: \"hass:water-percent\",\n  illuminance: \"hass:brightness-5\",\n  temperature: \"hass:thermometer\",\n  pressure: \"hass:gauge\",\n  power: \"hass:flash\",\n  signal_strength: \"hass:wifi\",\n};\n\nexport default function sensorIcon(state: HassEntity) {\n  const dclass = state.attributes.device_class;\n\n  if (dclass && dclass in fixedDeviceClassIcons) {\n    return fixedDeviceClassIcons[dclass];\n  }\n  if (dclass === \"battery\") {\n    const battery = Number(state.state);\n    if (isNaN(battery)) {\n      return \"hass:battery-unknown\";\n    }\n    const batteryRound = Math.round(battery / 10) * 10;\n    if (batteryRound >= 100) {\n      return \"hass:battery\";\n    }\n    if (batteryRound <= 0) {\n      return \"hass:battery-alert\";\n    }\n    // Will return one of the following icons: (listed so extractor picks up)\n    // hass:battery-10\n    // hass:battery-20\n    // hass:battery-30\n    // hass:battery-40\n    // hass:battery-50\n    // hass:battery-60\n    // hass:battery-70\n    // hass:battery-80\n    // hass:battery-90\n    // We obscure 'hass' in iconname so this name does not get picked up\n    return `${\"hass\"}:battery-${batteryRound}`;\n  }\n\n  const unit = state.attributes.unit_of_measurement;\n  if (unit === UNIT_C || unit === UNIT_F) {\n    return \"hass:thermometer\";\n  }\n  return domainIcon(\"sensor\");\n}\n","/** Return an icon representing a state. */\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { DEFAULT_DOMAIN_ICON } from \"../const\";\n\nimport computeDomain from \"./compute_domain\";\nimport domainIcon from \"./domain_icon\";\n\nimport binarySensorIcon from \"./binary_sensor_icon\";\nimport coverIcon from \"./cover_icon\";\nimport sensorIcon from \"./sensor_icon\";\nimport inputDateTimeIcon from \"./input_dateteime_icon\";\n\nconst domainIcons = {\n  binary_sensor: binarySensorIcon,\n  cover: coverIcon,\n  sensor: sensorIcon,\n  input_datetime: inputDateTimeIcon,\n};\n\nexport default function stateIcon(state: HassEntity) {\n  if (!state) {\n    return DEFAULT_DOMAIN_ICON;\n  }\n  if (state.attributes.icon) {\n    return state.attributes.icon;\n  }\n\n  const domain = computeDomain(state.entity_id);\n\n  if (domain in domainIcons) {\n    return domainIcons[domain](state);\n  }\n  return domainIcon(domain, state.state);\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\n\nexport const supportsFeature = (\n  stateObj: HassEntity,\n  feature: number\n): boolean => {\n  // tslint:disable-next-line:no-bitwise\n  return (stateObj.attributes.supported_features! & feature) !== 0;\n};\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport durationToSeconds from \"../datetime/duration_to_seconds\";\n\nexport default function timerTimeRemaining(stateObj: HassEntity) {\n  let timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n\n  if (stateObj.state === \"active\") {\n    const now = new Date().getTime();\n    const madeActive = new Date(stateObj.last_changed).getTime();\n    timeRemaining = Math.max(timeRemaining - (now - madeActive) / 1000, 0);\n  }\n\n  return timeRemaining;\n}\n","// From: https://davidwalsh.name/javascript-debounce-function\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\n// tslint:disable-next-line: ban-types\nexport const debounce = <T extends Function>(\n  func: T,\n  wait,\n  immediate = false\n): T => {\n  let timeout;\n  // @ts-ignore\n  return function(...args) {\n    // tslint:disable:no-this-assignment\n    // @ts-ignore\n    const context = this;\n    const later = () => {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n};\n","import { HomeAssistant } from \"../../types\";\n\ninterface ResultCache<T> {\n  [entityId: string]: Promise<T> | undefined;\n}\n\nexport const timeCachePromiseFunc = async <T>(\n  cacheKey: string,\n  cacheTime: number,\n  func: (\n    hass: HomeAssistant,\n    entityId: string,\n    ...args: unknown[]\n  ) => Promise<T>,\n  hass: HomeAssistant,\n  entityId: string,\n  ...args: unknown[]\n): Promise<T> => {\n  let cache: ResultCache<T> | undefined = (hass as any)[cacheKey];\n\n  if (!cache) {\n    cache = hass[cacheKey] = {};\n  }\n\n  const lastResult = cache[entityId];\n\n  if (lastResult) {\n    return lastResult;\n  }\n\n  const result = func(hass, entityId, ...args);\n  cache[entityId] = result;\n\n  result.then(\n    // When successful, set timer to clear cache\n    () =>\n      setTimeout(() => {\n        cache![entityId] = undefined;\n      }, cacheTime),\n    // On failure, clear cache right away\n    () => {\n      cache![entityId] = undefined;\n    }\n  );\n\n  return result;\n};\n","import { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { IronResizableBehavior } from \"@polymer/iron-resizable-behavior/iron-resizable-behavior\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { mixinBehaviors } from \"@polymer/polymer/lib/legacy/class\";\n\nimport formatTime from \"../../common/datetime/format_time\";\n// eslint-disable-next-line no-unused-vars\n/* global Chart moment Color */\n\nlet scriptsLoaded = null;\n\nclass HaChartBase extends mixinBehaviors(\n  [IronResizableBehavior],\n  PolymerElement\n) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n        }\n        .chartHeader {\n          padding: 6px 0 0 0;\n          width: 100%;\n          display: flex;\n          flex-direction: row;\n        }\n        .chartHeader > div {\n          vertical-align: top;\n          padding: 0 8px;\n        }\n        .chartHeader > div.chartTitle {\n          padding-top: 8px;\n          flex: 0 0 0;\n          max-width: 30%;\n        }\n        .chartHeader > div.chartLegend {\n          flex: 1 1;\n          min-width: 70%;\n        }\n        :root {\n          user-select: none;\n          -moz-user-select: none;\n          -webkit-user-select: none;\n          -ms-user-select: none;\n        }\n        .chartTooltip {\n          font-size: 90%;\n          opacity: 1;\n          position: absolute;\n          background: rgba(80, 80, 80, 0.9);\n          color: white;\n          border-radius: 3px;\n          pointer-events: none;\n          transform: translate(-50%, 12px);\n          z-index: 1000;\n          width: 200px;\n          transition: opacity 0.15s ease-in-out;\n        }\n        :host([rtl]) .chartTooltip {\n          direction: rtl;\n        }\n        .chartLegend ul,\n        .chartTooltip ul {\n          display: inline-block;\n          padding: 0 0px;\n          margin: 5px 0 0 0;\n          width: 100%;\n        }\n        .chartTooltip li {\n          display: block;\n          white-space: pre-line;\n        }\n        .chartTooltip .title {\n          text-align: center;\n          font-weight: 500;\n        }\n        .chartLegend li {\n          display: inline-block;\n          padding: 0 6px;\n          max-width: 49%;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          overflow: hidden;\n          box-sizing: border-box;\n        }\n        .chartLegend li:nth-child(odd):last-of-type {\n          /* Make last item take full width if it is odd-numbered. */\n          max-width: 100%;\n        }\n        .chartLegend li[data-hidden] {\n          text-decoration: line-through;\n        }\n        .chartLegend em,\n        .chartTooltip em {\n          border-radius: 5px;\n          display: inline-block;\n          height: 10px;\n          margin-right: 4px;\n          width: 10px;\n        }\n        :host([rtl]) .chartTooltip em {\n          margin-right: inherit;\n          margin-left: 4px;\n        }\n        paper-icon-button {\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template is=\"dom-if\" if=\"[[unit]]\">\n        <div class=\"chartHeader\">\n          <div class=\"chartTitle\">[[unit]]</div>\n          <div class=\"chartLegend\">\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[metas]]\">\n                <li on-click=\"_legendClick\" data-hidden$=\"[[item.hidden]]\">\n                  <em style$=\"background-color:[[item.bgColor]]\"></em>\n                  [[item.label]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </template>\n      <div id=\"chartTarget\" style=\"height:40px; width:100%\">\n        <canvas id=\"chartCanvas\"></canvas>\n        <div\n          class$=\"chartTooltip [[tooltip.yAlign]]\"\n          style$=\"opacity:[[tooltip.opacity]]; top:[[tooltip.top]]; left:[[tooltip.left]]; padding:[[tooltip.yPadding]]px [[tooltip.xPadding]]px\"\n        >\n          <div class=\"title\">[[tooltip.title]]</div>\n          <div>\n            <ul>\n              <template is=\"dom-repeat\" items=\"[[tooltip.lines]]\">\n                <li>\n                  <em style$=\"background-color:[[item.bgColor]]\"></em\n                  >[[item.text]]\n                </li>\n              </template>\n            </ul>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  get chart() {\n    return this._chart;\n  }\n\n  static get properties() {\n    return {\n      data: Object,\n      identifier: String,\n      rendered: {\n        type: Boolean,\n        notify: true,\n        value: false,\n        readOnly: true,\n      },\n      metas: {\n        type: Array,\n        value: () => [],\n      },\n      tooltip: {\n        type: Object,\n        value: () => ({\n          opacity: \"0\",\n          left: \"0\",\n          top: \"0\",\n          xPadding: \"5\",\n          yPadding: \"3\",\n        }),\n      },\n      unit: Object,\n      rtl: {\n        type: Boolean,\n        reflectToAttribute: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"onPropsChange(data)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.onPropsChange();\n    this._resizeListener = () => {\n      this._debouncer = Debouncer.debounce(\n        this._debouncer,\n        timeOut.after(10),\n        () => {\n          if (this._isAttached) {\n            this.resizeChart();\n          }\n        }\n      );\n    };\n\n    if (typeof ResizeObserver === \"function\") {\n      this.resizeObserver = new ResizeObserver((entries) => {\n        entries.forEach(() => {\n          this._resizeListener();\n        });\n      });\n      this.resizeObserver.observe(this.$.chartTarget);\n    } else {\n      this.addEventListener(\"iron-resize\", this._resizeListener);\n    }\n\n    if (scriptsLoaded === null) {\n      scriptsLoaded = import(/* webpackChunkName: \"load_chart\" */ \"../../resources/ha-chart-scripts.js\");\n    }\n    scriptsLoaded.then((ChartModule) => {\n      this.ChartClass = ChartModule.default;\n      this.onPropsChange();\n    });\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._isAttached = false;\n    if (this.resizeObserver) {\n      this.resizeObserver.unobserve(this.$.chartTarget);\n    }\n\n    this.removeEventListener(\"iron-resize\", this._resizeListener);\n\n    if (this._resizeTimer !== undefined) {\n      clearInterval(this._resizeTimer);\n      this._resizeTimer = undefined;\n    }\n  }\n\n  onPropsChange() {\n    if (!this._isAttached || !this.ChartClass || !this.data) {\n      return;\n    }\n    this.drawChart();\n  }\n\n  _customTooltips(tooltip) {\n    // Hide if no tooltip\n    if (tooltip.opacity === 0) {\n      this.set([\"tooltip\", \"opacity\"], 0);\n      return;\n    }\n    // Set caret Position\n    if (tooltip.yAlign) {\n      this.set([\"tooltip\", \"yAlign\"], tooltip.yAlign);\n    } else {\n      this.set([\"tooltip\", \"yAlign\"], \"no-transform\");\n    }\n\n    const title = tooltip.title ? tooltip.title[0] || \"\" : \"\";\n    this.set([\"tooltip\", \"title\"], title);\n\n    const bodyLines = tooltip.body.map((n) => n.lines);\n\n    // Set Text\n    if (tooltip.body) {\n      this.set(\n        [\"tooltip\", \"lines\"],\n        bodyLines.map((body, i) => {\n          const colors = tooltip.labelColors[i];\n          return {\n            color: colors.borderColor,\n            bgColor: colors.backgroundColor,\n            text: body.join(\"\\n\"),\n          };\n        })\n      );\n    }\n    const parentWidth = this.$.chartTarget.clientWidth;\n    let positionX = tooltip.caretX;\n    const positionY = this._chart.canvas.offsetTop + tooltip.caretY;\n    if (tooltip.caretX + 100 > parentWidth) {\n      positionX = parentWidth - 100;\n    } else if (tooltip.caretX < 100) {\n      positionX = 100;\n    }\n    positionX += this._chart.canvas.offsetLeft;\n    // Display, position, and set styles for font\n    this.tooltip = Object.assign({}, this.tooltip, {\n      opacity: 1,\n      left: `${positionX}px`,\n      top: `${positionY}px`,\n    });\n  }\n\n  _legendClick(event) {\n    event = event || window.event;\n    event.stopPropagation();\n    let target = event.target || event.srcElement;\n    while (target.nodeName !== \"LI\") {\n      // user clicked child, find parent LI\n      target = target.parentElement;\n    }\n    const index = event.model.itemsIndex;\n\n    const meta = this._chart.getDatasetMeta(index);\n    meta.hidden =\n      meta.hidden === null ? !this._chart.data.datasets[index].hidden : null;\n    this.set(\n      [\"metas\", index, \"hidden\"],\n      this._chart.isDatasetVisible(index) ? null : \"hidden\"\n    );\n    this._chart.update();\n  }\n\n  _drawLegend() {\n    const chart = this._chart;\n    // New data for old graph. Keep metadata.\n    const preserveVisibility =\n      this._oldIdentifier && this.identifier === this._oldIdentifier;\n    this._oldIdentifier = this.identifier;\n    this.set(\n      \"metas\",\n      this._chart.data.datasets.map((x, i) => ({\n        label: x.label,\n        color: x.color,\n        bgColor: x.backgroundColor,\n        hidden:\n          preserveVisibility && i < this.metas.length\n            ? this.metas[i].hidden\n            : !chart.isDatasetVisible(i),\n      }))\n    );\n    let updateNeeded = false;\n    if (preserveVisibility) {\n      for (let i = 0; i < this.metas.length; i++) {\n        const meta = chart.getDatasetMeta(i);\n        if (!!meta.hidden !== !!this.metas[i].hidden) updateNeeded = true;\n        meta.hidden = this.metas[i].hidden ? true : null;\n      }\n    }\n    if (updateNeeded) {\n      chart.update();\n    }\n    this.unit = this.data.unit;\n  }\n\n  _formatTickValue(value, index, values) {\n    if (values.length === 0) {\n      return value;\n    }\n    const date = new Date(values[index].value);\n    return formatTime(date);\n  }\n\n  drawChart() {\n    const data = this.data.data;\n    const ctx = this.$.chartCanvas;\n\n    if ((!data.datasets || !data.datasets.length) && !this._chart) {\n      return;\n    }\n    if (this.data.type !== \"timeline\" && data.datasets.length > 0) {\n      const cnt = data.datasets.length;\n      const colors = this.constructor.getColorList(cnt);\n      for (let loopI = 0; loopI < cnt; loopI++) {\n        data.datasets[loopI].borderColor = colors[loopI].rgbString();\n        data.datasets[loopI].backgroundColor = colors[loopI]\n          .alpha(0.6)\n          .rgbaString();\n      }\n    }\n\n    if (this._chart) {\n      this._customTooltips({ opacity: 0 });\n      this._chart.data = data;\n      this._chart.update({ duration: 0 });\n      if (this.isTimeline) {\n        this._chart.options.scales.yAxes[0].gridLines.display = data.length > 1;\n      } else if (this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    } else {\n      if (!data.datasets) {\n        return;\n      }\n      this._customTooltips({ opacity: 0 });\n      const plugins = [{ afterRender: () => this._setRendered(true) }];\n      let options = {\n        responsive: true,\n        maintainAspectRatio: false,\n        animation: {\n          duration: 0,\n        },\n        hover: {\n          animationDuration: 0,\n        },\n        responsiveAnimationDuration: 0,\n        tooltips: {\n          enabled: false,\n          custom: this._customTooltips.bind(this),\n        },\n        legend: {\n          display: false,\n        },\n        line: {\n          spanGaps: true,\n        },\n        elements: {\n          font: \"12px 'Roboto', 'sans-serif'\",\n        },\n        ticks: {\n          fontFamily: \"'Roboto', 'sans-serif'\",\n        },\n      };\n      options = Chart.helpers.merge(options, this.data.options);\n      options.scales.xAxes[0].ticks.callback = this._formatTickValue;\n      if (this.data.type === \"timeline\") {\n        this.set(\"isTimeline\", true);\n        if (this.data.colors !== undefined) {\n          this._colorFunc = this.constructor.getColorGenerator(\n            this.data.colors.staticColors,\n            this.data.colors.staticColorIndex\n          );\n        }\n        if (this._colorFunc !== undefined) {\n          options.elements.colorFunction = this._colorFunc;\n        }\n        if (data.datasets.length === 1) {\n          if (options.scales.yAxes[0].ticks) {\n            options.scales.yAxes[0].ticks.display = false;\n          } else {\n            options.scales.yAxes[0].ticks = { display: false };\n          }\n          if (options.scales.yAxes[0].gridLines) {\n            options.scales.yAxes[0].gridLines.display = false;\n          } else {\n            options.scales.yAxes[0].gridLines = { display: false };\n          }\n        }\n        this.$.chartTarget.style.height = \"50px\";\n      } else {\n        this.$.chartTarget.style.height = \"160px\";\n      }\n      const chartData = {\n        type: this.data.type,\n        data: this.data.data,\n        options: options,\n        plugins: plugins,\n      };\n      // Async resize after dom update\n      this._chart = new this.ChartClass(ctx, chartData);\n      if (this.isTimeline !== true && this.data.legend === true) {\n        this._drawLegend();\n      }\n      this.resizeChart();\n    }\n  }\n\n  resizeChart() {\n    if (!this._chart) return;\n    // Chart not ready\n    if (this._resizeTimer === undefined) {\n      this._resizeTimer = setInterval(this.resizeChart.bind(this), 10);\n      return;\n    }\n\n    clearInterval(this._resizeTimer);\n    this._resizeTimer = undefined;\n\n    this._resizeChart();\n  }\n\n  _resizeChart() {\n    const chartTarget = this.$.chartTarget;\n\n    const options = this.data;\n    const data = options.data;\n\n    if (data.datasets.length === 0) {\n      return;\n    }\n\n    if (!this.isTimeline) {\n      this._chart.resize();\n      return;\n    }\n\n    // Recalculate chart height for Timeline chart\n    const areaTop = this._chart.chartArea.top;\n    const areaBot = this._chart.chartArea.bottom;\n    const height1 = this._chart.canvas.clientHeight;\n    if (areaBot > 0) {\n      this._axisHeight = height1 - areaBot + areaTop;\n    }\n\n    if (!this._axisHeight) {\n      chartTarget.style.height = \"50px\";\n      this._chart.resize();\n      this.resizeChart();\n      return;\n    }\n    if (this._axisHeight) {\n      const cnt = data.datasets.length;\n      const targetHeight = 30 * cnt + this._axisHeight + \"px\";\n      if (chartTarget.style.height !== targetHeight) {\n        chartTarget.style.height = targetHeight;\n      }\n      this._chart.resize();\n    }\n  }\n\n  // Get HSL distributed color list\n  static getColorList(count) {\n    let processL = false;\n    if (count > 10) {\n      processL = true;\n      count = Math.ceil(count / 2);\n    }\n    const h1 = 360 / count;\n    const result = [];\n    for (let loopI = 0; loopI < count; loopI++) {\n      result[loopI] = Color().hsl(h1 * loopI, 80, 38);\n      if (processL) {\n        result[loopI + count] = Color().hsl(h1 * loopI, 80, 62);\n      }\n    }\n    return result;\n  }\n\n  static getColorGenerator(staticColors, startIndex) {\n    // Known colors for static data,\n    // should add for very common state string manually.\n    // Palette modified from http://google.github.io/palette.js/ mpn65, Apache 2.0\n    const palette = [\n      \"ff0029\",\n      \"66a61e\",\n      \"377eb8\",\n      \"984ea3\",\n      \"00d2d5\",\n      \"ff7f00\",\n      \"af8d00\",\n      \"7f80cd\",\n      \"b3e900\",\n      \"c42e60\",\n      \"a65628\",\n      \"f781bf\",\n      \"8dd3c7\",\n      \"bebada\",\n      \"fb8072\",\n      \"80b1d3\",\n      \"fdb462\",\n      \"fccde5\",\n      \"bc80bd\",\n      \"ffed6f\",\n      \"c4eaff\",\n      \"cf8c00\",\n      \"1b9e77\",\n      \"d95f02\",\n      \"e7298a\",\n      \"e6ab02\",\n      \"a6761d\",\n      \"0097ff\",\n      \"00d067\",\n      \"f43600\",\n      \"4ba93b\",\n      \"5779bb\",\n      \"927acc\",\n      \"97ee3f\",\n      \"bf3947\",\n      \"9f5b00\",\n      \"f48758\",\n      \"8caed6\",\n      \"f2b94f\",\n      \"eff26e\",\n      \"e43872\",\n      \"d9b100\",\n      \"9d7a00\",\n      \"698cff\",\n      \"d9d9d9\",\n      \"00d27e\",\n      \"d06800\",\n      \"009f82\",\n      \"c49200\",\n      \"cbe8ff\",\n      \"fecddf\",\n      \"c27eb6\",\n      \"8cd2ce\",\n      \"c4b8d9\",\n      \"f883b0\",\n      \"a49100\",\n      \"f48800\",\n      \"27d0df\",\n      \"a04a9b\",\n    ];\n    function getColorIndex(idx) {\n      // Reuse the color if index too large.\n      return Color(\"#\" + palette[idx % palette.length]);\n    }\n    const colorDict = {};\n    let colorIndex = 0;\n    if (startIndex > 0) colorIndex = startIndex;\n    if (staticColors) {\n      Object.keys(staticColors).forEach((c) => {\n        const c1 = staticColors[c];\n        if (isFinite(c1)) {\n          colorDict[c.toLowerCase()] = getColorIndex(c1);\n        } else {\n          colorDict[c.toLowerCase()] = Color(staticColors[c]);\n        }\n      });\n    }\n    // Custom color assign\n    function getColor(__, data) {\n      let ret;\n      const name = data[3];\n      if (name === null) return Color().hsl(0, 40, 38);\n      if (name === undefined) return Color().hsl(120, 40, 38);\n      const name1 = name.toLowerCase();\n      if (ret === undefined) {\n        ret = colorDict[name1];\n      }\n      if (ret === undefined) {\n        ret = getColorIndex(colorIndex);\n        colorIndex++;\n        colorDict[name1] = ret;\n      }\n      return ret;\n    }\n    return getColor;\n  }\n}\ncustomElements.define(\"ha-chart-base\", HaChartBase);\n","import \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-toggle-button/paper-toggle-button\";\n\nimport { STATES_OFF } from \"../../common/const\";\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport {\n  LitElement,\n  TemplateResult,\n  html,\n  CSSResult,\n  css,\n  property,\n  PropertyValues,\n} from \"lit-element\";\nimport { HomeAssistant } from \"../../types\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { forwardHaptic } from \"../../data/haptics\";\n\nconst isOn = (stateObj?: HassEntity) =>\n  stateObj !== undefined && !STATES_OFF.includes(stateObj.state);\n\nclass HaEntityToggle extends LitElement {\n  // hass is not a property so that we only re-render on stateObj changes\n  public hass?: HomeAssistant;\n  @property() public stateObj?: HassEntity;\n  @property() private _isOn: boolean = false;\n\n  protected render(): TemplateResult | void {\n    if (!this.stateObj) {\n      return html`\n        <paper-toggle-button disabled></paper-toggle-button>\n      `;\n    }\n\n    if (this.stateObj.attributes.assumed_state) {\n      return html`\n        <paper-icon-button\n          icon=\"hass:flash-off\"\n          @click=${this._turnOff}\n          ?state-active=${!this._isOn}\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:flash\"\n          @click=${this._turnOn}\n          ?state-active=${this._isOn}\n        ></paper-icon-button>\n      `;\n    }\n\n    return html`\n      <paper-toggle-button\n        .checked=${this._isOn}\n        @change=${this._toggleChanged}\n      ></paper-toggle-button>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    this.addEventListener(\"click\", (ev) => ev.stopPropagation());\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    if (changedProps.has(\"stateObj\")) {\n      this._isOn = isOn(this.stateObj);\n    }\n  }\n\n  private _toggleChanged(ev) {\n    const newVal = ev.target.checked;\n\n    if (newVal !== this._isOn) {\n      this._callService(newVal);\n    }\n  }\n\n  private _turnOn() {\n    this._callService(true);\n  }\n\n  private _turnOff() {\n    this._callService(false);\n  }\n\n  // We will force a re-render after a successful call to re-sync the toggle\n  // with the state. It will be out of sync if our service call did not\n  // result in the entity to be turned on. Since the state is not changing,\n  // the resync is not called automatic.\n  private async _callService(turnOn): Promise<void> {\n    if (!this.hass || !this.stateObj) {\n      return;\n    }\n    forwardHaptic(\"light\");\n    const stateDomain = computeStateDomain(this.stateObj);\n    let serviceDomain;\n    let service;\n\n    if (stateDomain === \"lock\") {\n      serviceDomain = \"lock\";\n      service = turnOn ? \"unlock\" : \"lock\";\n    } else if (stateDomain === \"cover\") {\n      serviceDomain = \"cover\";\n      service = turnOn ? \"open_cover\" : \"close_cover\";\n    } else if (stateDomain === \"group\") {\n      serviceDomain = \"homeassistant\";\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    } else {\n      serviceDomain = stateDomain;\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    }\n\n    const currentState = this.stateObj;\n\n    // Optimistic update.\n    this._isOn = turnOn;\n\n    await this.hass.callService(serviceDomain, service, {\n      entity_id: this.stateObj.entity_id,\n    });\n\n    setTimeout(async () => {\n      // If after 2 seconds we have not received a state update\n      // reset the switch to it's original state.\n      if (this.stateObj === currentState) {\n        this._isOn = isOn(this.stateObj);\n      }\n    }, 2000);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        white-space: nowrap;\n        min-width: 38px;\n      }\n      paper-icon-button {\n        color: var(\n          --paper-icon-button-inactive-color,\n          var(--primary-text-color)\n        );\n        transition: color 0.5s;\n      }\n      paper-icon-button[state-active] {\n        color: var(--paper-icon-button-active-color, var(--primary-color));\n      }\n      paper-toggle-button {\n        cursor: pointer;\n        --paper-toggle-button-label-spacing: 0;\n        padding: 13px 5px;\n        margin: -4px -5px;\n      }\n    `;\n  }\n}\n\ncustomElements.define(\"ha-entity-toggle\", HaEntityToggle);\n","import {\n  LitElement,\n  TemplateResult,\n  css,\n  CSSResult,\n  html,\n  property,\n  PropertyValues,\n  query,\n} from \"lit-element\";\nimport \"../ha-icon\";\nimport computeStateDomain from \"../../common/entity/compute_state_domain\";\nimport stateIcon from \"../../common/entity/state_icon\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { HaIcon } from \"../ha-icon\";\n\nclass StateBadge extends LitElement {\n  @property() public stateObj?: HassEntity;\n  @property() public overrideIcon?: string;\n  @query(\"ha-icon\") private _icon!: HaIcon;\n\n  protected render(): TemplateResult | void {\n    const stateObj = this.stateObj;\n\n    if (!stateObj) {\n      return html``;\n    }\n\n    return html`\n      <ha-icon\n        id=\"icon\"\n        data-domain=${computeStateDomain(stateObj)}\n        data-state=${stateObj.state}\n        .icon=${this.overrideIcon || stateIcon(stateObj)}\n      ></ha-icon>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (!changedProps.has(\"stateObj\") || !this.stateObj) {\n      return;\n    }\n    const stateObj = this.stateObj;\n\n    const iconStyle: Partial<CSSStyleDeclaration> = {\n      color: \"\",\n      filter: \"\",\n    };\n    const hostStyle: Partial<CSSStyleDeclaration> = {\n      backgroundImage: \"\",\n    };\n    if (stateObj) {\n      // hide icon if we have entity picture\n      if (stateObj.attributes.entity_picture && !this.overrideIcon) {\n        hostStyle.backgroundImage =\n          \"url(\" + stateObj.attributes.entity_picture + \")\";\n        iconStyle.display = \"none\";\n      } else {\n        if (stateObj.attributes.hs_color) {\n          const hue = stateObj.attributes.hs_color[0];\n          const sat = stateObj.attributes.hs_color[1];\n          if (sat > 10) {\n            iconStyle.color = `hsl(${hue}, 100%, ${100 - sat / 2}%)`;\n          }\n        }\n        if (stateObj.attributes.brightness) {\n          const brightness = stateObj.attributes.brightness;\n          if (typeof brightness !== \"number\") {\n            const errorMessage = `Type error: state-badge expected number, but type of ${\n              stateObj.entity_id\n            }.attributes.brightness is ${typeof brightness} (${brightness})`;\n            // tslint:disable-next-line\n            console.warn(errorMessage);\n          }\n          // lowest brighntess will be around 50% (that's pretty dark)\n          iconStyle.filter = `brightness(${(brightness + 245) / 5}%)`;\n        }\n      }\n    }\n    Object.assign(this._icon.style, iconStyle);\n    Object.assign(this.style, hostStyle);\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host {\n        position: relative;\n        display: inline-block;\n        width: 40px;\n        color: var(--paper-item-icon-color, #44739e);\n        border-radius: 50%;\n        height: 40px;\n        text-align: center;\n        background-size: cover;\n        line-height: 40px;\n      }\n\n      ha-icon {\n        transition: color 0.3s ease-in-out, filter 0.3s ease-in-out;\n      }\n\n      /* Color the icon if light or sun is on */\n      ha-icon[data-domain=\"light\"][data-state=\"on\"],\n      ha-icon[data-domain=\"switch\"][data-state=\"on\"],\n      ha-icon[data-domain=\"binary_sensor\"][data-state=\"on\"],\n      ha-icon[data-domain=\"fan\"][data-state=\"on\"],\n      ha-icon[data-domain=\"sun\"][data-state=\"above_horizon\"] {\n        color: var(--paper-item-icon-active-color, #fdd835);\n      }\n\n      /* Color the icon if unavailable */\n      ha-icon[data-state=\"unavailable\"] {\n        color: var(--state-icon-unavailable-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"state-badge\": StateBadge;\n  }\n}\n\ncustomElements.define(\"state-badge\", StateBadge);\n","import { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaClimateState extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          white-space: nowrap;\n        }\n\n        .target {\n          color: var(--primary-text-color);\n        }\n\n        .current {\n          color: var(--secondary-text-color);\n        }\n\n        .state-label {\n          font-weight: bold;\n          text-transform: capitalize;\n        }\n\n        .unit {\n          display: inline-block;\n          direction: ltr;\n        }\n      </style>\n\n      <div class=\"target\">\n        <template is=\"dom-if\" if=\"[[_hasKnownState(stateObj.state)]]\">\n          <span class=\"state-label\"> [[_localizeState(stateObj.state)]] </span>\n        </template>\n        <div class=\"unit\">[[computeTarget(hass, stateObj)]]</div>\n      </div>\n\n      <template is=\"dom-if\" if=\"[[currentStatus]]\">\n        <div class=\"current\">\n          [[localize('ui.card.climate.currently')]]:\n          <div class=\"unit\">[[currentStatus]]</div>\n        </div>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      stateObj: Object,\n      currentStatus: {\n        type: String,\n        computed: \"computeCurrentStatus(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeCurrentStatus(hass, stateObj) {\n    if (!hass || !stateObj) return null;\n    if (stateObj.attributes.current_temperature != null) {\n      return `${stateObj.attributes.current_temperature} ${\n        hass.config.unit_system.temperature\n      }`;\n    }\n    if (stateObj.attributes.current_humidity != null) {\n      return `${stateObj.attributes.current_humidity} %`;\n    }\n    return null;\n  }\n\n  computeTarget(hass, stateObj) {\n    if (!hass || !stateObj) return null;\n    // We're using \"!= null\" on purpose so that we match both null and undefined.\n    if (\n      stateObj.attributes.target_temp_low != null &&\n      stateObj.attributes.target_temp_high != null\n    ) {\n      return `${stateObj.attributes.target_temp_low} - ${\n        stateObj.attributes.target_temp_high\n      } ${hass.config.unit_system.temperature}`;\n    }\n    if (stateObj.attributes.temperature != null) {\n      return `${stateObj.attributes.temperature} ${\n        hass.config.unit_system.temperature\n      }`;\n    }\n    if (\n      stateObj.attributes.target_humidity_low != null &&\n      stateObj.attributes.target_humidity_high != null\n    ) {\n      return `${stateObj.attributes.target_humidity_low} - ${\n        stateObj.attributes.target_humidity_high\n      } %`;\n    }\n    if (stateObj.attributes.humidity != null) {\n      return `${stateObj.attributes.humidity} %`;\n    }\n\n    return \"\";\n  }\n\n  _hasKnownState(state) {\n    return state !== \"unknown\";\n  }\n\n  _localizeState(state) {\n    return this.localize(`state.climate.${state}`) || state;\n  }\n}\ncustomElements.define(\"ha-climate-state\", HaClimateState);\n","import \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport CoverEntity from \"../util/cover-model\";\n\nclass HaCoverControls extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        .state {\n          white-space: nowrap;\n        }\n        [invisible] {\n          visibility: hidden !important;\n        }\n      </style>\n\n      <div class=\"state\">\n        <paper-icon-button\n          icon=\"hass:arrow-up\"\n          on-click=\"onOpenTap\"\n          invisible$=\"[[!entityObj.supportsOpen]]\"\n          disabled=\"[[computeOpenDisabled(stateObj, entityObj)]]\"\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:stop\"\n          on-click=\"onStopTap\"\n          invisible$=\"[[!entityObj.supportsStop]]\"\n        ></paper-icon-button>\n        <paper-icon-button\n          icon=\"hass:arrow-down\"\n          on-click=\"onCloseTap\"\n          invisible$=\"[[!entityObj.supportsClose]]\"\n          disabled=\"[[computeClosedDisabled(stateObj, entityObj)]]\"\n        ></paper-icon-button>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      stateObj: {\n        type: Object,\n      },\n      entityObj: {\n        type: Object,\n        computed: \"computeEntityObj(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeEntityObj(hass, stateObj) {\n    return new CoverEntity(hass, stateObj);\n  }\n\n  computeOpenDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return (entityObj.isFullyOpen || entityObj.isOpening) && !assumedState;\n  }\n\n  computeClosedDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return (entityObj.isFullyClosed || entityObj.isClosing) && !assumedState;\n  }\n\n  onOpenTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.openCover();\n  }\n\n  onCloseTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.closeCover();\n  }\n\n  onStopTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.stopCover();\n  }\n}\n\ncustomElements.define(\"ha-cover-controls\", HaCoverControls);\n","import \"@polymer/iron-flex-layout/iron-flex-layout-classes\";\nimport \"@polymer/paper-icon-button/paper-icon-button\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport CoverEntity from \"../util/cover-model\";\n\nclass HaCoverTiltControls extends PolymerElement {\n  static get template() {\n    return html`\n      <style include=\"iron-flex\"></style>\n      <style>\n        :host {\n          white-space: nowrap;\n        }\n        [invisible] {\n          visibility: hidden !important;\n        }\n      </style>\n      <paper-icon-button\n        icon=\"hass:arrow-top-right\"\n        on-click=\"onOpenTiltTap\"\n        title=\"Open tilt\"\n        invisible$=\"[[!entityObj.supportsOpenTilt]]\"\n        disabled=\"[[computeOpenDisabled(stateObj, entityObj)]]\"\n      ></paper-icon-button>\n      <paper-icon-button\n        icon=\"hass:stop\"\n        on-click=\"onStopTiltTap\"\n        invisible$=\"[[!entityObj.supportsStopTilt]]\"\n        title=\"Stop tilt\"\n      ></paper-icon-button>\n      <paper-icon-button\n        icon=\"hass:arrow-bottom-left\"\n        on-click=\"onCloseTiltTap\"\n        title=\"Close tilt\"\n        invisible$=\"[[!entityObj.supportsCloseTilt]]\"\n        disabled=\"[[computeClosedDisabled(stateObj, entityObj)]]\"\n      ></paper-icon-button>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      stateObj: {\n        type: Object,\n      },\n      entityObj: {\n        type: Object,\n        computed: \"computeEntityObj(hass, stateObj)\",\n      },\n    };\n  }\n\n  computeEntityObj(hass, stateObj) {\n    return new CoverEntity(hass, stateObj);\n  }\n\n  computeOpenDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return entityObj.isFullyOpenTilt && !assumedState;\n  }\n\n  computeClosedDisabled(stateObj, entityObj) {\n    var assumedState = stateObj.attributes.assumed_state === true;\n    return entityObj.isFullyClosedTilt && !assumedState;\n  }\n\n  onOpenTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.openCoverTilt();\n  }\n\n  onCloseTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.closeCoverTilt();\n  }\n\n  onStopTiltTap(ev) {\n    ev.stopPropagation();\n    this.entityObj.stopCoverTilt();\n  }\n}\n\ncustomElements.define(\"ha-cover-tilt-controls\", HaCoverTiltControls);\n","import { Constructor } from \"lit-element\";\nimport \"@polymer/iron-icon/iron-icon\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { IronIconElement } from \"@polymer/iron-icon/iron-icon\";\n\nconst ironIconClass = customElements.get(\"iron-icon\") as Constructor<\n  IronIconElement\n>;\n\nlet loaded = false;\n\nexport class HaIcon extends ironIconClass {\n  private _iconsetName?: string;\n\n  public listen(\n    node: EventTarget | null,\n    eventName: string,\n    methodName: string\n  ): void {\n    super.listen(node, eventName, methodName);\n\n    if (!loaded && this._iconsetName === \"mdi\") {\n      loaded = true;\n      import(/* webpackChunkName: \"mdi-icons\" */ \"../resources/mdi-icons\");\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n\ncustomElements.define(\"ha-icon\", HaIcon);\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport { Constructor } from \"lit-element\";\nimport { PolymerElement } from \"@polymer/polymer\";\n\nconst paperDropdownClass = customElements.get(\n  \"paper-dropdown-menu\"\n) as Constructor<PolymerElement>;\n\n// patches paper drop down to properly support RTL - https://github.com/PolymerElements/paper-dropdown-menu/issues/183\nexport class HaPaperDropdownClass extends paperDropdownClass {\n  public ready() {\n    super.ready();\n    // wait to check for direction since otherwise direction is wrong even though top level is RTL\n    setTimeout(() => {\n      if (window.getComputedStyle(this).direction === \"rtl\") {\n        this.style.textAlign = \"right\";\n      }\n    }, 100);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-paper-dropdown-menu\": HaPaperDropdownClass;\n  }\n}\n\ncustomElements.define(\"ha-paper-dropdown-menu\", HaPaperDropdownClass);\n","import { dom } from \"@polymer/polymer/lib/legacy/polymer.dom\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport relativeTime from \"../common/datetime/relative_time\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaRelativeTime extends LocalizeMixin(PolymerElement) {\n  static get properties() {\n    return {\n      hass: Object,\n      datetime: {\n        type: String,\n        observer: \"datetimeChanged\",\n      },\n\n      datetimeObj: {\n        type: Object,\n        observer: \"datetimeObjChanged\",\n      },\n\n      parsedDateTime: Object,\n    };\n  }\n\n  constructor() {\n    super();\n    this.updateRelative = this.updateRelative.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    // update every 60 seconds\n    this.updateInterval = setInterval(this.updateRelative, 60000);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    clearInterval(this.updateInterval);\n  }\n\n  datetimeChanged(newVal) {\n    this.parsedDateTime = newVal ? new Date(newVal) : null;\n\n    this.updateRelative();\n  }\n\n  datetimeObjChanged(newVal) {\n    this.parsedDateTime = newVal;\n\n    this.updateRelative();\n  }\n\n  updateRelative() {\n    const root = dom(this);\n    if (!this.parsedDateTime) {\n      root.innerHTML = this.localize(\"ui.components.relative_time.never\");\n    } else {\n      root.innerHTML = relativeTime(this.parsedDateTime, this.localize);\n    }\n  }\n}\n\ncustomElements.define(\"ha-relative-time\", HaRelativeTime);\n","import \"@polymer/paper-slider\";\n\nconst PaperSliderClass = customElements.get(\"paper-slider\");\nlet subTemplate;\n\nclass HaSlider extends PaperSliderClass {\n  static get template() {\n    if (!subTemplate) {\n      subTemplate = PaperSliderClass.template.cloneNode(true);\n\n      const superStyle = subTemplate.content.querySelector(\"style\");\n\n      // append style to add mirroring of pin in RTL\n      superStyle.appendChild(\n        document.createTextNode(`\n          :host([dir=\"rtl\"]) #sliderContainer.pin.expand > .slider-knob > .slider-knob-inner::after {\n            -webkit-transform: scale(1) translate(0, -17px) scaleX(-1) !important;\n            transform: scale(1) translate(0, -17px) scaleX(-1) !important;\n            }\n        `)\n      );\n    }\n    return subTemplate;\n  }\n\n  _calcStep(value) {\n    if (!this.step) {\n      return parseFloat(value);\n    }\n\n    const numSteps = Math.round((value - this.min) / this.step);\n    const stepStr = this.step.toString();\n    const stepPointAt = stepStr.indexOf(\".\");\n    if (stepPointAt !== -1) {\n      /**\n       * For small values of this.step, if we calculate the step using\n       * For non-integer values of this.step, if we calculate the step using\n       * `Math.round(value / step) * step` we may hit a precision point issue\n       * eg. 0.1 * 0.2 =  0.020000000000000004\n       * http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\n       *\n       * as a work around we can round with the decimal precision of `step`\n       */\n      const precision = 10 ** (stepStr.length - stepPointAt - 1);\n      return (\n        Math.round((numSteps * this.step + this.min) * precision) / precision\n      );\n    }\n\n    return numSteps * this.step + this.min;\n  }\n}\ncustomElements.define(\"ha-slider\", HaSlider);\n","/**\nAdapted from paper-time-input from\nhttps://github.com/ryanburns23/paper-time-input\nMIT Licensed. Copyright (c) 2017 Ryan Burns\n\n`<paper-time-input>` Polymer element to accept a time with paper-input & paper-dropdown-menu\nInspired by the time input in google forms\n\n### Styling\n\n`<paper-time-input>` provides the following custom properties and mixins for styling:\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--paper-time-input-dropdown-ripple-color` | dropdown ripple color | `--primary-color`\n`--paper-time-input-cotnainer` | Mixin applied to the inputs | `{}`\n`--paper-time-dropdown-input-cotnainer` | Mixin applied to the dropdown input | `{}`\n*/\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nexport class PaperTimeInput extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          @apply --paper-font-common-base;\n        }\n\n        paper-input {\n          width: 30px;\n          text-align: center;\n          --paper-input-container-input: {\n            /* Damn you firefox\n             * Needed to hide spin num in firefox\n             * http://stackoverflow.com/questions/3790935/can-i-hide-the-html5-number-input-s-spin-box\n             */\n            -moz-appearance: textfield;\n            @apply --paper-time-input-cotnainer;\n          }\n          --paper-input-container-input-webkit-spinner: {\n            -webkit-appearance: none;\n            margin: 0;\n            display: none;\n          }\n          --paper-input-container-shared-input-style_-_-webkit-appearance: textfield;\n        }\n\n        paper-dropdown-menu {\n          width: 55px;\n          padding: 0;\n          /* Force ripple to use the whole container */\n          --paper-dropdown-menu-ripple: {\n            color: var(\n              --paper-time-input-dropdown-ripple-color,\n              var(--primary-color)\n            );\n          }\n          --paper-input-container-input: {\n            @apply --paper-font-button;\n            text-align: center;\n            padding-left: 5px;\n            @apply --paper-time-dropdown-input-cotnainer;\n          }\n          --paper-input-container-underline: {\n            border-color: transparent;\n          }\n          --paper-input-container-underline-focus: {\n            border-color: transparent;\n          }\n        }\n\n        paper-item {\n          cursor: pointer;\n          text-align: center;\n          font-size: 14px;\n        }\n\n        paper-listbox {\n          padding: 0;\n        }\n\n        label {\n          @apply --paper-font-caption;\n        }\n\n        .time-input-wrap {\n          @apply --layout-horizontal;\n          @apply --layout-no-wrap;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      </style>\n\n      <label hidden$=\"[[hideLabel]]\">[[label]]</label>\n      <div class=\"time-input-wrap\">\n        <!-- Hour Input -->\n        <paper-input\n          id=\"hour\"\n          type=\"number\"\n          value=\"{{hour}}\"\n          on-change=\"_shouldFormatHour\"\n          required=\"\"\n          auto-validate=\"[[autoValidate]]\"\n          prevent-invalid-input=\"\"\n          maxlength=\"2\"\n          max=\"[[_computeHourMax(format)]]\"\n          min=\"0\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n          <span suffix=\"\" slot=\"suffix\">:</span>\n        </paper-input>\n\n        <!-- Min Input -->\n        <paper-input\n          id=\"min\"\n          type=\"number\"\n          value=\"{{min}}\"\n          on-change=\"_formatMin\"\n          required=\"\"\n          auto-validate=\"[[autoValidate]]\"\n          prevent-invalid-input=\"\"\n          maxlength=\"2\"\n          max=\"59\"\n          min=\"0\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n        </paper-input>\n\n        <!-- Dropdown Menu -->\n        <paper-dropdown-menu\n          id=\"dropdown\"\n          required=\"\"\n          hidden$=\"[[_equal(format, 24)]]\"\n          no-label-float=\"\"\n          disabled=\"[[disabled]]\"\n        >\n          <paper-listbox\n            attr-for-selected=\"name\"\n            selected=\"{{amPm}}\"\n            slot=\"dropdown-content\"\n          >\n            <paper-item name=\"AM\">AM</paper-item>\n            <paper-item name=\"PM\">PM</paper-item>\n          </paper-listbox>\n        </paper-dropdown-menu>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      /**\n       * Label for the input\n       */\n      label: {\n        type: String,\n        value: \"Time\",\n      },\n      /**\n       * auto validate time inputs\n       */\n      autoValidate: {\n        type: Boolean,\n        value: true,\n      },\n      /**\n       * hides the label\n       */\n      hideLabel: {\n        type: Boolean,\n        value: false,\n      },\n      /**\n       * 12 or 24 hr format\n       */\n      format: {\n        type: Number,\n        value: 12,\n      },\n      /**\n       * disables the inputs\n       */\n      disabled: {\n        type: Boolean,\n        value: false,\n      },\n      /**\n       * hour\n       */\n      hour: {\n        type: String,\n        notify: true,\n      },\n      /**\n       * minute\n       */\n      min: {\n        type: String,\n        notify: true,\n      },\n      /**\n       * AM or PM\n       */\n      amPm: {\n        type: String,\n        notify: true,\n        value: \"AM\",\n      },\n      /**\n       * Formatted time string\n       */\n      value: {\n        type: String,\n        notify: true,\n        readOnly: true,\n        computed: \"_computeTime(min, hour, amPm)\",\n      },\n    };\n  }\n\n  /**\n   * Validate the inputs\n   * @return {boolean}\n   */\n  validate() {\n    var valid = true;\n    // Validate hour & min fields\n    if (!this.$.hour.validate() | !this.$.min.validate()) {\n      valid = false;\n    }\n    // Validate AM PM if 12 hour time\n    if (this.format === 12 && !this.$.dropdown.validate()) {\n      valid = false;\n    }\n    return valid;\n  }\n\n  /**\n   * Create time string\n   */\n  _computeTime(min, hour, amPm) {\n    if (hour && min) {\n      // No ampm on 24 hr time\n      if (this.format === 24) {\n        amPm = \"\";\n      }\n      return hour + \":\" + min + \" \" + amPm;\n    }\n    return undefined;\n  }\n\n  /**\n   * Format min\n   */\n  _formatMin() {\n    if (this.min.toString().length === 1) {\n      this.min = this.min < 10 ? \"0\" + this.min : this.min;\n    }\n  }\n\n  /**\n   * Hour needs a leading zero in 24hr format\n   */\n  _shouldFormatHour() {\n    if (this.format === 24 && this.hour.toString().length === 1) {\n      this.hour = this.hour < 10 ? \"0\" + this.hour : this.hour;\n    }\n  }\n\n  /**\n   * 24 hour format has a max hr of 23\n   */\n  _computeHourMax(format) {\n    if (format === 12) {\n      return format;\n    }\n    return 23;\n  }\n\n  _equal(n1, n2) {\n    return n1 === n2;\n  }\n}\n\ncustomElements.define(\"paper-time-input\", PaperTimeInput);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./entity/ha-chart-base\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\nimport formatDateTime from \"../common/datetime/format_date_time\";\n\nclass StateHistoryChartLine extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          overflow: hidden;\n          height: 0;\n          transition: height 0.3s ease-in-out;\n        }\n      </style>\n      <ha-chart-base\n        id=\"chart\"\n        data=\"[[chartData]]\"\n        identifier=\"[[identifier]]\"\n        rendered=\"{{rendered}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      chartData: Object,\n      data: Object,\n      names: Object,\n      unit: String,\n      identifier: String,\n\n      isSingleDevice: {\n        type: Boolean,\n        value: false,\n      },\n\n      endTime: Object,\n      rendered: {\n        type: Boolean,\n        value: false,\n        observer: \"_onRenderedChanged\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, isSingleDevice)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  _onRenderedChanged(rendered) {\n    if (rendered) this.animateHeight();\n  }\n\n  animateHeight() {\n    requestAnimationFrame(() =>\n      requestAnimationFrame(() => {\n        this.style.height = this.$.chart.scrollHeight + \"px\";\n      })\n    );\n  }\n\n  drawChart() {\n    const unit = this.unit;\n    const deviceStates = this.data;\n    const datasets = [];\n    let endTime;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (deviceStates.length === 0) {\n      return;\n    }\n\n    function safeParseFloat(value) {\n      const parsed = parseFloat(value);\n      return isFinite(parsed) ? parsed : null;\n    }\n\n    endTime =\n      this.endTime ||\n      // Get the highest date from the last date of each device\n      new Date(\n        Math.max.apply(\n          null,\n          deviceStates.map(\n            (devSts) =>\n              new Date(devSts.states[devSts.states.length - 1].last_changed)\n          )\n        )\n      );\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const names = this.names || {};\n    deviceStates.forEach((states) => {\n      const domain = states.domain;\n      const name = names[states.entity_id] || states.name;\n      // array containing [value1, value2, etc]\n      let prevValues;\n      const data = [];\n\n      function pushData(timestamp, datavalues) {\n        if (!datavalues) return;\n        if (timestamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is \"now\" and client time is not in sync with server time.\n          return;\n        }\n        data.forEach((d, i) => {\n          d.data.push({ x: timestamp, y: datavalues[i] });\n        });\n        prevValues = datavalues;\n      }\n\n      function addColumn(nameY, step, fill) {\n        let dataFill = false;\n        let dataStep = false;\n        if (fill) {\n          dataFill = \"origin\";\n        }\n        if (step) {\n          dataStep = \"before\";\n        }\n        data.push({\n          label: nameY,\n          fill: dataFill,\n          steppedLine: dataStep,\n          pointRadius: 0,\n          data: [],\n          unitText: unit,\n        });\n      }\n\n      if (\n        domain === \"thermostat\" ||\n        domain === \"climate\" ||\n        domain === \"water_heater\"\n      ) {\n        // We differentiate between thermostats that have a target temperature\n        // range versus ones that have just a target temperature\n\n        // Using step chart by step-before so manually interpolation not needed.\n        const hasTargetRange = states.states.some(\n          (state) =>\n            state.attributes &&\n            state.attributes.target_temp_high !==\n              state.attributes.target_temp_low\n        );\n        const hasHeat = states.states.some((state) => state.state === \"heat\");\n        const hasCool = states.states.some((state) => state.state === \"cool\");\n\n        addColumn(name + \" current temperature\", true);\n        if (hasHeat) {\n          addColumn(name + \" heating\", true, true);\n          // The \"heating\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n        if (hasCool) {\n          addColumn(name + \" cooling\", true, true);\n          // The \"cooling\" series uses steppedArea to shade the area below the current\n          // temperature when the thermostat is calling for heat.\n        }\n\n        if (hasTargetRange) {\n          addColumn(name + \" target temperature high\", true);\n          addColumn(name + \" target temperature low\", true);\n        } else {\n          addColumn(name + \" target temperature\", true);\n        }\n\n        states.states.forEach((state) => {\n          if (!state.attributes) return;\n          const curTemp = safeParseFloat(state.attributes.current_temperature);\n          const series = [curTemp];\n          if (hasHeat) {\n            series.push(state.state === \"heat\" ? curTemp : null);\n          }\n          if (hasCool) {\n            series.push(state.state === \"cool\" ? curTemp : null);\n          }\n          if (hasTargetRange) {\n            const targetHigh = safeParseFloat(\n              state.attributes.target_temp_high\n            );\n            const targetLow = safeParseFloat(state.attributes.target_temp_low);\n            series.push(targetHigh, targetLow);\n            pushData(new Date(state.last_changed), series);\n          } else {\n            const target = safeParseFloat(state.attributes.temperature);\n            series.push(target);\n            pushData(new Date(state.last_changed), series);\n          }\n        });\n      } else {\n        // Only disable interpolation for sensors\n        const isStep = domain === \"sensor\";\n        addColumn(name, isStep);\n\n        let lastValue = null;\n        let lastDate = null;\n        let lastNullDate = null;\n\n        // Process chart data.\n        // When state is `unknown`, calculate the value and break the line.\n        states.states.forEach((state) => {\n          const value = safeParseFloat(state.state);\n          const date = new Date(state.last_changed);\n          if (value !== null && lastNullDate !== null) {\n            const dateTime = date.getTime();\n            const lastNullDateTime = lastNullDate.getTime();\n            const lastDateTime = lastDate.getTime();\n            const tmpValue =\n              (value - lastValue) *\n                ((lastNullDateTime - lastDateTime) /\n                  (dateTime - lastDateTime)) +\n              lastValue;\n            pushData(lastNullDate, [tmpValue]);\n            pushData(new Date(lastNullDateTime + 1), [null]);\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n            lastNullDate = null;\n          } else if (value !== null && lastNullDate === null) {\n            pushData(date, [value]);\n            lastDate = date;\n            lastValue = value;\n          } else if (\n            value === null &&\n            lastNullDate === null &&\n            lastValue !== null\n          ) {\n            lastNullDate = date;\n          }\n        });\n      }\n\n      // Add an entry for final values\n      pushData(endTime, prevValues, false);\n\n      // Concat two arrays\n      Array.prototype.push.apply(datasets, data);\n    });\n\n    const formatTooltipTitle = (items, data) => {\n      const item = items[0];\n      const date = data.datasets[item.datasetIndex].data[item.index].x;\n\n      return formatDateTime(date, this.hass.language);\n    };\n\n    const chartOptions = {\n      type: \"line\",\n      unit: unit,\n      legend: !this.isSingleDevice,\n      options: {\n        scales: {\n          xAxes: [\n            {\n              type: \"time\",\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              ticks: {\n                maxTicksLimit: 7,\n              },\n            },\n          ],\n        },\n        tooltips: {\n          mode: \"neareach\",\n          callbacks: {\n            title: formatTooltipTitle,\n          },\n        },\n        hover: {\n          mode: \"neareach\",\n        },\n        layout: {\n          padding: {\n            top: 5,\n          },\n        },\n        elements: {\n          line: {\n            tension: 0.1,\n            pointRadius: 0,\n            borderWidth: 1.5,\n          },\n          point: {\n            hitRadius: 5,\n          },\n        },\n        plugins: {\n          filler: {\n            propagate: true,\n          },\n        },\n      },\n      data: {\n        labels: [],\n        datasets: datasets,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n}\ncustomElements.define(\"state-history-chart-line\", StateHistoryChartLine);\n","import \"@polymer/polymer/lib/utils/debounce\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport \"./entity/ha-chart-base\";\n\nimport formatDateTime from \"../common/datetime/format_date_time\";\nimport { computeRTL } from \"../common/util/compute_rtl\";\n\nclass StateHistoryChartTimeline extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          opacity: 0;\n          transition: opacity 0.3s ease-in-out;\n        }\n        :host([rendered]) {\n          opacity: 1;\n        }\n\n        ha-chart-base {\n          direction: ltr;\n        }\n      </style>\n      <ha-chart-base\n        data=\"[[chartData]]\"\n        rendered=\"{{rendered}}\"\n        rtl=\"{{rtl}}\"\n      ></ha-chart-base>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n      chartData: Object,\n      data: {\n        type: Object,\n        observer: \"dataChanged\",\n      },\n      names: Object,\n      noSingle: Boolean,\n      endTime: Date,\n      rendered: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true,\n      },\n      rtl: {\n        reflectToAttribute: true,\n        computed: \"_computeRTL(hass)\",\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"dataChanged(data, endTime, localize, language)\"];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._isAttached = true;\n    this.drawChart();\n  }\n\n  dataChanged() {\n    this.drawChart();\n  }\n\n  drawChart() {\n    const staticColors = {\n      on: 1,\n      off: 0,\n      unavailable: \"#a0a0a0\",\n      unknown: \"#606060\",\n      idle: 2,\n    };\n    let stateHistory = this.data;\n\n    if (!this._isAttached) {\n      return;\n    }\n\n    if (!stateHistory) {\n      stateHistory = [];\n    }\n\n    const startTime = new Date(\n      stateHistory.reduce(\n        (minTime, stateInfo) =>\n          Math.min(minTime, new Date(stateInfo.data[0].last_changed)),\n        new Date()\n      )\n    );\n\n    // end time is Math.max(startTime, last_event)\n    let endTime =\n      this.endTime ||\n      new Date(\n        stateHistory.reduce(\n          (maxTime, stateInfo) =>\n            Math.max(\n              maxTime,\n              new Date(stateInfo.data[stateInfo.data.length - 1].last_changed)\n            ),\n          startTime\n        )\n      );\n\n    if (endTime > new Date()) {\n      endTime = new Date();\n    }\n\n    const labels = [];\n    const datasets = [];\n    // stateHistory is a list of lists of sorted state objects\n    const names = this.names || {};\n    stateHistory.forEach((stateInfo) => {\n      let newLastChanged;\n      let prevState = null;\n      let locState = null;\n      let prevLastChanged = startTime;\n      const entityDisplay = names[stateInfo.entity_id] || stateInfo.name;\n\n      const dataRow = [];\n      stateInfo.data.forEach((state) => {\n        let newState = state.state;\n        const timeStamp = new Date(state.last_changed);\n        if (newState === undefined || newState === \"\") {\n          newState = null;\n        }\n        if (timeStamp > endTime) {\n          // Drop datapoints that are after the requested endTime. This could happen if\n          // endTime is 'now' and client time is not in sync with server time.\n          return;\n        }\n        if (prevState !== null && newState !== prevState) {\n          newLastChanged = new Date(state.last_changed);\n\n          dataRow.push([prevLastChanged, newLastChanged, locState, prevState]);\n\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = newLastChanged;\n        } else if (prevState === null) {\n          prevState = newState;\n          locState = state.state_localize;\n          prevLastChanged = new Date(state.last_changed);\n        }\n      });\n\n      if (prevState !== null) {\n        dataRow.push([prevLastChanged, endTime, locState, prevState]);\n      }\n      datasets.push({ data: dataRow });\n      labels.push(entityDisplay);\n    });\n\n    const formatTooltipLabel = (item, data) => {\n      const values = data.datasets[item.datasetIndex].data[item.index];\n\n      const start = formatDateTime(values[0], this.hass.language);\n      const end = formatDateTime(values[1], this.hass.language);\n      const state = values[2];\n\n      return [state, start, end];\n    };\n\n    const chartOptions = {\n      type: \"timeline\",\n      options: {\n        tooltips: {\n          callbacks: {\n            label: formatTooltipLabel,\n          },\n        },\n        scales: {\n          xAxes: [\n            {\n              ticks: {\n                major: {\n                  fontStyle: \"bold\",\n                },\n              },\n            },\n          ],\n          yAxes: [\n            {\n              afterSetDimensions: (yaxe) => {\n                yaxe.maxWidth = yaxe.chart.width * 0.18;\n              },\n              position: this._computeRTL ? \"right\" : \"left\",\n            },\n          ],\n        },\n      },\n      data: {\n        labels: labels,\n        datasets: datasets,\n      },\n      colors: {\n        staticColors: staticColors,\n        staticColorIndex: 3,\n      },\n    };\n    this.chartData = chartOptions;\n  }\n\n  _computeRTL(hass) {\n    return computeRTL(hass);\n  }\n}\ncustomElements.define(\n  \"state-history-chart-timeline\",\n  StateHistoryChartTimeline\n);\n","import \"@polymer/paper-spinner/paper-spinner\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"./state-history-chart-line\";\nimport \"./state-history-chart-timeline\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nclass StateHistoryCharts extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          /* height of single timeline chart = 58px */\n          min-height: 58px;\n        }\n        .info {\n          text-align: center;\n          line-height: 58px;\n          color: var(--secondary-text-color);\n        }\n      </style>\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsLoading(isLoadingData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.loading_history')]]\n        </div>\n      </template>\n\n      <template\n        is=\"dom-if\"\n        class=\"info\"\n        if=\"[[_computeIsEmpty(isLoadingData, historyData)]]\"\n      >\n        <div class=\"info\">\n          [[localize('ui.components.history_charts.no_history_found')]]\n        </div>\n      </template>\n\n      <template is=\"dom-if\" if=\"[[historyData.timeline.length]]\">\n        <state-history-chart-timeline\n          hass=\"[[hass]]\"\n          data=\"[[historyData.timeline]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          no-single=\"[[noSingle]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-timeline>\n      </template>\n\n      <template is=\"dom-repeat\" items=\"[[historyData.line]]\">\n        <state-history-chart-line\n          hass=\"[[hass]]\"\n          unit=\"[[item.unit]]\"\n          data=\"[[item.data]]\"\n          identifier=\"[[item.identifier]]\"\n          is-single-device=\"[[_computeIsSingleLineChart(item.data, noSingle)]]\"\n          end-time=\"[[_computeEndTime(endTime, upToNow, historyData)]]\"\n          names=\"[[names]]\"\n        ></state-history-chart-line>\n      </template>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n      historyData: {\n        type: Object,\n        value: null,\n      },\n      names: Object,\n\n      isLoadingData: Boolean,\n\n      endTime: {\n        type: Object,\n      },\n\n      upToNow: Boolean,\n      noSingle: Boolean,\n    };\n  }\n\n  _computeIsSingleLineChart(data, noSingle) {\n    return !noSingle && data && data.length === 1;\n  }\n\n  _computeIsEmpty(isLoadingData, historyData) {\n    const historyDataEmpty =\n      !historyData ||\n      !historyData.timeline ||\n      !historyData.line ||\n      (historyData.timeline.length === 0 && historyData.line.length === 0);\n    return !isLoadingData && historyDataEmpty;\n  }\n\n  _computeIsLoading(isLoading) {\n    return isLoading && !this.historyData;\n  }\n\n  _computeEndTime(endTime, upToNow) {\n    // We don't really care about the value of historyData, but if it change we want to update\n    // endTime.\n    return upToNow ? new Date() : endTime;\n  }\n}\ncustomElements.define(\"state-history-charts\", StateHistoryCharts);\n","import { HomeAssistant } from \"../types\";\n\nexport interface AuthProvider {\n  name: string;\n  id: string;\n  type: string;\n}\n\nexport interface Credential {\n  type: string;\n}\n\nexport interface SignedPath {\n  path: string;\n}\n\nexport const hassUrl = `${location.protocol}//${location.host}`;\n\nexport const getSignedPath = (\n  hass: HomeAssistant,\n  path: string\n): Promise<SignedPath> => hass.callWS({ type: \"auth/sign_path\", path });\n\nexport const fetchAuthProviders = () =>\n  fetch(\"/auth/providers\", {\n    credentials: \"same-origin\",\n  });\n","import {\n  computeHistory,\n  fetchRecent,\n  HistoryResult,\n  TimelineEntity,\n  LineChartUnit,\n} from \"./history\";\nimport { HomeAssistant } from \"../types\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\ninterface CacheConfig {\n  refresh: number;\n  cacheKey: string;\n  hoursToShow: number;\n}\n\ninterface CachedResults {\n  prom: Promise<HistoryResult>;\n  startTime: Date;\n  endTime: Date;\n  language: string;\n  data: HistoryResult;\n}\n\n// This is a different interface, a different cache :(\ninterface RecentCacheResults {\n  created: number;\n  language: string;\n  data: Promise<HistoryResult>;\n}\n\nconst RECENT_THRESHOLD = 60000; // 1 minute\nconst RECENT_CACHE: { [cacheKey: string]: RecentCacheResults } = {};\nconst stateHistoryCache: { [cacheKey: string]: CachedResults } = {};\n\n// Cached type 1 unction. Without cache config.\nexport const getRecent = (\n  hass: HomeAssistant,\n  entityId: string,\n  startTime: Date,\n  endTime: Date,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = entityId;\n  const cache = RECENT_CACHE[cacheKey];\n\n  if (\n    cache &&\n    Date.now() - cache.created < RECENT_THRESHOLD &&\n    cache.language === language\n  ) {\n    return cache.data;\n  }\n\n  const prom = fetchRecent(hass, entityId, startTime, endTime).then(\n    (stateHistory) => computeHistory(hass, stateHistory, localize, language),\n    (err) => {\n      delete RECENT_CACHE[entityId];\n      throw err;\n    }\n  );\n\n  RECENT_CACHE[cacheKey] = {\n    created: Date.now(),\n    language,\n    data: prom,\n  };\n  return prom;\n};\n\n// Cache type 2 functionality\nfunction getEmptyCache(\n  language: string,\n  startTime: Date,\n  endTime: Date\n): CachedResults {\n  return {\n    prom: Promise.resolve({ line: [], timeline: [] }),\n    language,\n    startTime,\n    endTime,\n    data: { line: [], timeline: [] },\n  };\n}\n\nexport const getRecentWithCache = (\n  hass: HomeAssistant,\n  entityId: string,\n  cacheConfig: CacheConfig,\n  localize: LocalizeFunc,\n  language: string\n) => {\n  const cacheKey = cacheConfig.cacheKey;\n  const endTime = new Date();\n  const startTime = new Date(endTime);\n  startTime.setHours(startTime.getHours() - cacheConfig.hoursToShow);\n  let toFetchStartTime = startTime;\n  let appendingToCache = false;\n\n  let cache = stateHistoryCache[cacheKey];\n  if (\n    cache &&\n    toFetchStartTime >= cache.startTime &&\n    toFetchStartTime <= cache.endTime &&\n    cache.language === language\n  ) {\n    toFetchStartTime = cache.endTime;\n    appendingToCache = true;\n    // This pretty much never happens as endTime is usually set to now\n    if (endTime <= cache.endTime) {\n      return cache.prom;\n    }\n  } else {\n    cache = stateHistoryCache[cacheKey] = getEmptyCache(\n      language,\n      startTime,\n      endTime\n    );\n  }\n\n  const curCacheProm = cache.prom;\n\n  const genProm = async () => {\n    let fetchedHistory: HassEntity[][];\n\n    try {\n      const results = await Promise.all([\n        curCacheProm,\n        fetchRecent(\n          hass,\n          entityId,\n          toFetchStartTime,\n          endTime,\n          appendingToCache\n        ),\n      ]);\n      fetchedHistory = results[1];\n    } catch (err) {\n      delete stateHistoryCache[cacheKey];\n      throw err;\n    }\n    const stateHistory = computeHistory(\n      hass,\n      fetchedHistory,\n      localize,\n      language\n    );\n    if (appendingToCache) {\n      mergeLine(stateHistory.line, cache.data.line);\n      mergeTimeline(stateHistory.timeline, cache.data.timeline);\n      pruneStartTime(startTime, cache.data);\n    } else {\n      cache.data = stateHistory;\n    }\n    return cache.data;\n  };\n\n  cache.prom = genProm();\n  cache.startTime = startTime;\n  cache.endTime = endTime;\n  return cache.prom;\n};\n\nconst mergeLine = (\n  historyLines: LineChartUnit[],\n  cacheLines: LineChartUnit[]\n) => {\n  historyLines.forEach((line) => {\n    const unit = line.unit;\n    const oldLine = cacheLines.find((cacheLine) => cacheLine.unit === unit);\n    if (oldLine) {\n      line.data.forEach((entity) => {\n        const oldEntity = oldLine.data.find(\n          (cacheEntity) => entity.entity_id === cacheEntity.entity_id\n        );\n        if (oldEntity) {\n          oldEntity.states = oldEntity.states.concat(entity.states);\n        } else {\n          oldLine.data.push(entity);\n        }\n      });\n    } else {\n      cacheLines.push(line);\n    }\n  });\n};\n\nconst mergeTimeline = (\n  historyTimelines: TimelineEntity[],\n  cacheTimelines: TimelineEntity[]\n) => {\n  historyTimelines.forEach((timeline) => {\n    const oldTimeline = cacheTimelines.find(\n      (cacheTimeline) => cacheTimeline.entity_id === timeline.entity_id\n    );\n    if (oldTimeline) {\n      oldTimeline.data = oldTimeline.data.concat(timeline.data);\n    } else {\n      cacheTimelines.push(timeline);\n    }\n  });\n};\n\nconst pruneArray = (originalStartTime: Date, arr) => {\n  if (arr.length === 0) {\n    return arr;\n  }\n  const changedAfterStartTime = arr.findIndex(\n    (state) => new Date(state.last_changed) > originalStartTime\n  );\n  if (changedAfterStartTime === 0) {\n    // If all changes happened after originalStartTime then we are done.\n    return arr;\n  }\n\n  // If all changes happened at or before originalStartTime. Use last index.\n  const updateIndex =\n    changedAfterStartTime === -1 ? arr.length - 1 : changedAfterStartTime - 1;\n  arr[updateIndex].last_changed = originalStartTime;\n  return arr.slice(updateIndex);\n};\n\nconst pruneStartTime = (originalStartTime: Date, cacheData: HistoryResult) => {\n  cacheData.line.forEach((line) => {\n    line.data.forEach((entity) => {\n      entity.states = pruneArray(originalStartTime, entity.states);\n    });\n  });\n\n  cacheData.timeline.forEach((timeline) => {\n    timeline.data = pruneArray(originalStartTime, timeline.data);\n  });\n};\n","import { HomeAssistant, CameraEntity } from \"../types\";\nimport { timeCachePromiseFunc } from \"../common/util/time-cache-function-promise\";\nimport { getSignedPath } from \"./auth\";\n\nexport const CAMERA_SUPPORT_ON_OFF = 1;\nexport const CAMERA_SUPPORT_STREAM = 2;\n\nexport interface CameraPreferences {\n  preload_stream: boolean;\n}\n\nexport interface CameraThumbnail {\n  content_type: string;\n  content: string;\n}\n\nexport interface Stream {\n  url: string;\n}\n\nexport const computeMJPEGStreamUrl = (entity: CameraEntity) =>\n  `/api/camera_proxy_stream/${entity.entity_id}?token=${\n    entity.attributes.access_token\n  }`;\n\nexport const fetchThumbnailUrlWithCache = (\n  hass: HomeAssistant,\n  entityId: string\n) =>\n  timeCachePromiseFunc(\n    \"_cameraTmbUrl\",\n    9000,\n    fetchThumbnailUrl,\n    hass,\n    entityId\n  );\n\nexport const fetchThumbnailUrl = (hass: HomeAssistant, entityId: string) =>\n  getSignedPath(hass, `/api/camera_proxy/${entityId}`).then(({ path }) => path);\n\nexport const fetchThumbnail = (hass: HomeAssistant, entityId: string) => {\n  // tslint:disable-next-line: no-console\n  console.warn(\"This method has been deprecated.\");\n  return hass.callWS<CameraThumbnail>({\n    type: \"camera_thumbnail\",\n    entity_id: entityId,\n  });\n};\n\nexport const fetchStreamUrl = (\n  hass: HomeAssistant,\n  entityId: string,\n  format?: \"hls\"\n) => {\n  const data = {\n    type: \"camera/stream\",\n    entity_id: entityId,\n  };\n  if (format) {\n    // @ts-ignore\n    data.format = format;\n  }\n  return hass.callWS<Stream>(data);\n};\n\nexport const fetchCameraPrefs = (hass: HomeAssistant, entityId: string) =>\n  hass.callWS<CameraPreferences>({\n    type: \"camera/get_prefs\",\n    entity_id: entityId,\n  });\n\nexport const updateCameraPrefs = (\n  hass: HomeAssistant,\n  entityId: string,\n  prefs: {\n    preload_stream?: boolean;\n  }\n) =>\n  hass.callWS<CameraPreferences>({\n    type: \"camera/update_prefs\",\n    entity_id: entityId,\n    ...prefs,\n  });\n","import { createCollection, Connection } from \"home-assistant-js-websocket\";\nimport { HomeAssistant } from \"../types\";\nimport computeStateName from \"../common/entity/compute_state_name\";\nimport { debounce } from \"../common/util/debounce\";\n\nexport interface EntityRegistryEntry {\n  entity_id: string;\n  name: string;\n  platform: string;\n  config_entry_id?: string;\n  device_id?: string;\n  disabled_by?: string;\n}\n\nexport interface EntityRegistryEntryUpdateParams {\n  name: string | null;\n  new_entity_id: string;\n}\n\nexport const computeEntityRegistryName = (\n  hass: HomeAssistant,\n  entry: EntityRegistryEntry\n): string | null => {\n  if (entry.name) {\n    return entry.name;\n  }\n  const state = hass.states[entry.entity_id];\n  return state ? computeStateName(state) : null;\n};\n\nexport const updateEntityRegistryEntry = (\n  hass: HomeAssistant,\n  entityId: string,\n  updates: Partial<EntityRegistryEntryUpdateParams>\n): Promise<EntityRegistryEntry> =>\n  hass.callWS<EntityRegistryEntry>({\n    type: \"config/entity_registry/update\",\n    entity_id: entityId,\n    ...updates,\n  });\n\nexport const removeEntityRegistryEntry = (\n  hass: HomeAssistant,\n  entityId: string\n): Promise<void> =>\n  hass.callWS({\n    type: \"config/entity_registry/remove\",\n    entity_id: entityId,\n  });\n\nconst fetchEntityRegistry = (conn) =>\n  conn.sendMessagePromise({\n    type: \"config/entity_registry/list\",\n  });\n\nconst subscribeEntityRegistryUpdates = (conn, store) =>\n  conn.subscribeEvents(\n    debounce(\n      () =>\n        fetchEntityRegistry(conn).then((entities) =>\n          store.setState(entities, true)\n        ),\n      500,\n      true\n    ),\n    \"entity_registry_updated\"\n  );\n\nexport const subscribeEntityRegistry = (\n  conn: Connection,\n  onChange: (entities: EntityRegistryEntry[]) => void\n) =>\n  createCollection<EntityRegistryEntry[]>(\n    \"_entityRegistry\",\n    fetchEntityRegistry,\n    subscribeEntityRegistryUpdates,\n    conn,\n    onChange\n  );\n","import { timeOut } from \"@polymer/polymer/lib/utils/async\";\nimport { Debouncer } from \"@polymer/polymer/lib/utils/debounce\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport LocalizeMixin from \"../mixins/localize-mixin\";\n\nimport { computeHistory, fetchDate } from \"./history\";\nimport { getRecent, getRecentWithCache } from \"./cached-history\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaStateHistoryData extends LocalizeMixin(PolymerElement) {\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"hassChanged\",\n      },\n\n      filterType: String,\n\n      cacheConfig: Object,\n\n      startTime: Date,\n      endTime: Date,\n\n      entityId: String,\n\n      isLoading: {\n        type: Boolean,\n        value: true,\n        readOnly: true,\n        notify: true,\n      },\n\n      data: {\n        type: Object,\n        value: null,\n        readOnly: true,\n        notify: true,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\n      \"filterChangedDebouncer(filterType, entityId, startTime, endTime, cacheConfig, localize)\",\n    ];\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.filterChangedDebouncer(\n      this.filterType,\n      this.entityId,\n      this.startTime,\n      this.endTime,\n      this.cacheConfig,\n      this.localize\n    );\n  }\n\n  disconnectedCallback() {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    super.disconnectedCallback();\n  }\n\n  hassChanged(newHass, oldHass) {\n    if (!oldHass && !this._madeFirstCall) {\n      this.filterChangedDebouncer(\n        this.filterType,\n        this.entityId,\n        this.startTime,\n        this.endTime,\n        this.cacheConfig,\n        this.localize\n      );\n    }\n  }\n\n  filterChangedDebouncer(...args) {\n    this._debounceFilterChanged = Debouncer.debounce(\n      this._debounceFilterChanged,\n      timeOut.after(0),\n      () => {\n        this.filterChanged(...args);\n      }\n    );\n  }\n\n  filterChanged(\n    filterType,\n    entityId,\n    startTime,\n    endTime,\n    cacheConfig,\n    localize\n  ) {\n    if (!this.hass) {\n      return;\n    }\n    if (cacheConfig && !cacheConfig.cacheKey) {\n      return;\n    }\n    if (!localize) {\n      return;\n    }\n    this._madeFirstCall = true;\n    const language = this.hass.language;\n    let data;\n\n    if (filterType === \"date\") {\n      if (!startTime || !endTime) return;\n\n      data = fetchDate(this.hass, startTime, endTime).then((dateHistory) =>\n        computeHistory(this.hass, dateHistory, localize, language)\n      );\n    } else if (filterType === \"recent-entity\") {\n      if (!entityId) return;\n      if (cacheConfig) {\n        data = this.getRecentWithCacheRefresh(\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        );\n      } else {\n        data = getRecent(\n          this.hass,\n          entityId,\n          startTime,\n          endTime,\n          localize,\n          language\n        );\n      }\n    } else {\n      return;\n    }\n    this._setIsLoading(true);\n\n    data.then((stateHistory) => {\n      this._setData(stateHistory);\n      this._setIsLoading(false);\n    });\n  }\n\n  getRecentWithCacheRefresh(entityId, cacheConfig, localize, language) {\n    if (this._refreshTimeoutId) {\n      window.clearInterval(this._refreshTimeoutId);\n      this._refreshTimeoutId = null;\n    }\n    if (cacheConfig.refresh) {\n      this._refreshTimeoutId = window.setInterval(() => {\n        getRecentWithCache(\n          this.hass,\n          entityId,\n          cacheConfig,\n          localize,\n          language\n        ).then((stateHistory) => {\n          this._setData(Object.assign({}, stateHistory));\n        });\n      }, cacheConfig.refresh * 1000);\n    }\n    return getRecentWithCache(\n      this.hass,\n      entityId,\n      cacheConfig,\n      localize,\n      language\n    );\n  }\n}\ncustomElements.define(\"ha-state-history-data\", HaStateHistoryData);\n","import computeStateName from \"../common/entity/compute_state_name\";\nimport computeStateDomain from \"../common/entity/compute_state_domain\";\nimport computeStateDisplay from \"../common/entity/compute_state_display\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { HomeAssistant } from \"../types\";\nimport { LocalizeFunc } from \"../common/translations/localize\";\n\nconst DOMAINS_USE_LAST_UPDATED = [\"climate\", \"water_heater\"];\nconst LINE_ATTRIBUTES_TO_KEEP = [\n  \"temperature\",\n  \"current_temperature\",\n  \"target_temp_low\",\n  \"target_temp_high\",\n];\n\nexport interface LineChartState {\n  state: string;\n  last_changed: string;\n  attributes?: { [key: string]: any };\n}\n\nexport interface LineChartEntity {\n  domain: string;\n  name: string;\n  entity_id: string;\n  states: LineChartState[];\n}\n\nexport interface LineChartUnit {\n  unit: string;\n  identifier: string;\n  data: LineChartEntity[];\n}\n\nexport interface TimelineState {\n  state_localize: string;\n  state: string;\n  last_changed: string;\n}\n\nexport interface TimelineEntity {\n  name: string;\n  entity_id: string;\n  data: TimelineState[];\n}\n\nexport interface HistoryResult {\n  line: LineChartUnit[];\n  timeline: TimelineEntity[];\n}\n\nexport const fetchRecent = (\n  hass,\n  entityId,\n  startTime,\n  endTime,\n  skipInitialState = false\n): Promise<HassEntity[][]> => {\n  let url = \"history/period\";\n  if (startTime) {\n    url += \"/\" + startTime.toISOString();\n  }\n  url += \"?filter_entity_id=\" + entityId;\n  if (endTime) {\n    url += \"&end_time=\" + endTime.toISOString();\n  }\n  if (skipInitialState) {\n    url += \"&skip_initial_state\";\n  }\n\n  return hass.callApi(\"GET\", url);\n};\n\nexport const fetchDate = (\n  hass: HomeAssistant,\n  startTime: Date,\n  endTime: Date\n): Promise<HassEntity[][]> => {\n  return hass.callApi(\n    \"GET\",\n    `history/period/${startTime.toISOString()}?end_time=${endTime.toISOString()}`\n  );\n};\n\nconst equalState = (obj1: LineChartState, obj2: LineChartState) =>\n  obj1.state === obj2.state &&\n  // They either both have an attributes object or not\n  (!obj1.attributes ||\n    LINE_ATTRIBUTES_TO_KEEP.every(\n      (attr) => obj1.attributes![attr] === obj2.attributes![attr]\n    ));\n\nconst processTimelineEntity = (\n  localize: LocalizeFunc,\n  language: string,\n  states: HassEntity[]\n): TimelineEntity => {\n  const data: TimelineState[] = [];\n\n  for (const state of states) {\n    if (data.length > 0 && state.state === data[data.length - 1].state) {\n      continue;\n    }\n\n    data.push({\n      state_localize: computeStateDisplay(localize, state, language),\n      state: state.state,\n      last_changed: state.last_changed,\n    });\n  }\n\n  return {\n    name: computeStateName(states[0]),\n    entity_id: states[0].entity_id,\n    data,\n  };\n};\n\nconst processLineChartEntities = (\n  unit,\n  entities: HassEntity[][]\n): LineChartUnit => {\n  const data: LineChartEntity[] = [];\n\n  for (const states of entities) {\n    const last: HassEntity = states[states.length - 1];\n    const domain = computeStateDomain(last);\n    const processedStates: LineChartState[] = [];\n\n    for (const state of states) {\n      let processedState: LineChartState;\n\n      if (DOMAINS_USE_LAST_UPDATED.includes(domain)) {\n        processedState = {\n          state: state.state,\n          last_changed: state.last_updated,\n          attributes: {},\n        };\n\n        for (const attr of LINE_ATTRIBUTES_TO_KEEP) {\n          if (attr in state.attributes) {\n            processedState.attributes![attr] = state.attributes[attr];\n          }\n        }\n      } else {\n        processedState = state;\n      }\n\n      if (\n        processedStates.length > 1 &&\n        equalState(\n          processedState,\n          processedStates[processedStates.length - 1]\n        ) &&\n        equalState(processedState, processedStates[processedStates.length - 2])\n      ) {\n        continue;\n      }\n\n      processedStates.push(processedState);\n    }\n\n    data.push({\n      domain,\n      name: computeStateName(last),\n      entity_id: last.entity_id,\n      states: processedStates,\n    });\n  }\n\n  return {\n    unit,\n    identifier: entities.map((states) => states[0].entity_id).join(\"\"),\n    data,\n  };\n};\n\nexport const computeHistory = (\n  hass: HomeAssistant,\n  stateHistory: HassEntity[][],\n  localize: LocalizeFunc,\n  language: string\n): HistoryResult => {\n  const lineChartDevices: { [unit: string]: HassEntity[][] } = {};\n  const timelineDevices: TimelineEntity[] = [];\n  if (!stateHistory) {\n    return { line: [], timeline: [] };\n  }\n\n  stateHistory.forEach((stateInfo) => {\n    if (stateInfo.length === 0) {\n      return;\n    }\n\n    const stateWithUnit = stateInfo.find(\n      (state) => \"unit_of_measurement\" in state.attributes\n    );\n\n    let unit: string | undefined;\n\n    if (stateWithUnit) {\n      unit = stateWithUnit.attributes.unit_of_measurement;\n    } else if (computeStateDomain(stateInfo[0]) === \"climate\") {\n      unit = hass.config.unit_system.temperature;\n    } else if (computeStateDomain(stateInfo[0]) === \"water_heater\") {\n      unit = hass.config.unit_system.temperature;\n    }\n\n    if (!unit) {\n      timelineDevices.push(\n        processTimelineEntity(localize, language, stateInfo)\n      );\n    } else if (unit in lineChartDevices) {\n      lineChartDevices[unit].push(stateInfo);\n    } else {\n      lineChartDevices[unit] = [stateInfo];\n    }\n  });\n\n  const unitStates = Object.keys(lineChartDevices).map((unit) =>\n    processLineChartEntities(unit, lineChartDevices[unit])\n  );\n\n  return { line: unitStates, timeline: timelineDevices };\n};\n","import { HomeAssistant } from \"../types\";\n\nexport const setInputSelectOption = (\n  hass: HomeAssistant,\n  entity: string,\n  option: string\n) =>\n  hass.callService(\"input_select\", \"select_option\", {\n    option,\n    entity_id: entity,\n  });\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import { supportsFeature } from \"../common/entity/supports-feature\";\n\n/* eslint-enable no-bitwise */\nexport default class CoverEntity {\n  constructor(hass, stateObj) {\n    this.hass = hass;\n    this.stateObj = stateObj;\n    this._attr = stateObj.attributes;\n    this._feat = this._attr.supported_features;\n  }\n\n  get isFullyOpen() {\n    if (this._attr.current_position !== undefined) {\n      return this._attr.current_position === 100;\n    }\n    return this.stateObj.state === \"open\";\n  }\n\n  get isFullyClosed() {\n    if (this._attr.current_position !== undefined) {\n      return this._attr.current_position === 0;\n    }\n    return this.stateObj.state === \"closed\";\n  }\n\n  get isFullyOpenTilt() {\n    return this._attr.current_tilt_position === 100;\n  }\n\n  get isFullyClosedTilt() {\n    return this._attr.current_tilt_position === 0;\n  }\n\n  get isOpening() {\n    return this.stateObj.state === \"opening\";\n  }\n\n  get isClosing() {\n    return this.stateObj.state === \"closing\";\n  }\n\n  get supportsOpen() {\n    return supportsFeature(this.stateObj, 1);\n  }\n\n  get supportsClose() {\n    return supportsFeature(this.stateObj, 2);\n  }\n\n  get supportsSetPosition() {\n    return supportsFeature(this.stateObj, 4);\n  }\n\n  get supportsStop() {\n    return supportsFeature(this.stateObj, 8);\n  }\n\n  get supportsOpenTilt() {\n    return supportsFeature(this.stateObj, 16);\n  }\n\n  get supportsCloseTilt() {\n    return supportsFeature(this.stateObj, 32);\n  }\n\n  get supportsStopTilt() {\n    return supportsFeature(this.stateObj, 64);\n  }\n\n  get supportsSetTiltPosition() {\n    return supportsFeature(this.stateObj, 128);\n  }\n\n  get isTiltOnly() {\n    const supportsCover =\n      this.supportsOpen || this.supportsClose || this.supportsStop;\n    const supportsTilt =\n      this.supportsOpenTilt || this.supportsCloseTilt || this.supportsStopTilt;\n    return supportsTilt && !supportsCover;\n  }\n\n  openCover() {\n    this.callService(\"open_cover\");\n  }\n\n  closeCover() {\n    this.callService(\"close_cover\");\n  }\n\n  stopCover() {\n    this.callService(\"stop_cover\");\n  }\n\n  openCoverTilt() {\n    this.callService(\"open_cover_tilt\");\n  }\n\n  closeCoverTilt() {\n    this.callService(\"close_cover_tilt\");\n  }\n\n  stopCoverTilt() {\n    this.callService(\"stop_cover_tilt\");\n  }\n\n  setCoverPosition(position) {\n    this.callService(\"set_cover_position\", { position });\n  }\n\n  setCoverTiltPosition(tiltPosition) {\n    this.callService(\"set_cover_tilt_position\", {\n      tilt_position: tiltPosition,\n    });\n  }\n\n  // helper method\n\n  callService(service, data = {}) {\n    data.entity_id = this.stateObj.entity_id;\n    this.hass.callService(\"cover\", service, data);\n  }\n}\n\nexport const supportsOpen = (stateObj) => supportsFeature(stateObj, 1);\n\nexport const supportsClose = (stateObj) => supportsFeature(stateObj, 2);\n\nexport const supportsSetPosition = (stateObj) => supportsFeature(stateObj, 4);\n\nexport const supportsStop = (stateObj) => supportsFeature(stateObj, 8);\n\nexport const supportsOpenTilt = (stateObj) => supportsFeature(stateObj, 16);\n\nexport const supportsCloseTilt = (stateObj) => supportsFeature(stateObj, 32);\n\nexport const supportsStopTilt = (stateObj) => supportsFeature(stateObj, 64);\n\nexport const supportsSetTiltPosition = (stateObj) =>\n  supportsFeature(stateObj, 128);\n\nexport function isTiltOnly(stateObj) {\n  const supportsCover =\n    supportsOpen(stateObj) || supportsClose(stateObj) || supportsStop(stateObj);\n  const supportsTilt =\n    supportsOpenTilt(stateObj) ||\n    supportsCloseTilt(stateObj) ||\n    supportsStopTilt(stateObj);\n  return supportsTilt && !supportsCover;\n}\n","import { supportsFeature } from \"../common/entity/supports-feature\";\n\nexport default class MediaPlayerEntity {\n  constructor(hass, stateObj) {\n    this.hass = hass;\n    this.stateObj = stateObj;\n    this._attr = stateObj.attributes;\n    this._feat = this._attr.supported_features;\n  }\n\n  get isOff() {\n    return this.stateObj.state === \"off\";\n  }\n\n  get isIdle() {\n    return this.stateObj.state === \"idle\";\n  }\n\n  get isMuted() {\n    return this._attr.is_volume_muted;\n  }\n\n  get isPaused() {\n    return this.stateObj.state === \"paused\";\n  }\n\n  get isPlaying() {\n    return this.stateObj.state === \"playing\";\n  }\n\n  get isMusic() {\n    return this._attr.media_content_type === \"music\";\n  }\n\n  get isTVShow() {\n    return this._attr.media_content_type === \"tvshow\";\n  }\n\n  get hasMediaControl() {\n    return (\n      [\"playing\", \"paused\", \"unknown\", \"on\"].indexOf(this.stateObj.state) !== -1\n    );\n  }\n\n  get volumeSliderValue() {\n    return this._attr.volume_level * 100;\n  }\n\n  get showProgress() {\n    return (\n      (this.isPlaying || this.isPaused) &&\n      \"media_duration\" in this.stateObj.attributes &&\n      \"media_position\" in this.stateObj.attributes &&\n      \"media_position_updated_at\" in this.stateObj.attributes\n    );\n  }\n\n  get currentProgress() {\n    var progress = this._attr.media_position;\n    if (this.isPlaying) {\n      progress +=\n        (Date.now() -\n          new Date(this._attr.media_position_updated_at).getTime()) /\n        1000.0;\n    }\n    return progress;\n  }\n\n  get supportsPause() {\n    return supportsFeature(this.stateObj, 1);\n  }\n\n  get supportsVolumeSet() {\n    return supportsFeature(this.stateObj, 4);\n  }\n\n  get supportsVolumeMute() {\n    return supportsFeature(this.stateObj, 8);\n  }\n\n  get supportsPreviousTrack() {\n    return supportsFeature(this.stateObj, 16);\n  }\n\n  get supportsNextTrack() {\n    return supportsFeature(this.stateObj, 32);\n  }\n\n  get supportsTurnOn() {\n    return supportsFeature(this.stateObj, 128);\n  }\n\n  get supportsTurnOff() {\n    return supportsFeature(this.stateObj, 256);\n  }\n\n  get supportsPlayMedia() {\n    return supportsFeature(this.stateObj, 512);\n  }\n\n  get supportsVolumeButtons() {\n    return supportsFeature(this.stateObj, 1024);\n  }\n\n  get supportsSelectSource() {\n    return supportsFeature(this.stateObj, 2048);\n  }\n\n  get supportsSelectSoundMode() {\n    return supportsFeature(this.stateObj, 65536);\n  }\n\n  get supportsPlay() {\n    return supportsFeature(this.stateObj, 16384);\n  }\n\n  get primaryTitle() {\n    return this._attr.media_title;\n  }\n\n  get secondaryTitle() {\n    if (this.isMusic) {\n      return this._attr.media_artist;\n    }\n    if (this.isTVShow) {\n      var text = this._attr.media_series_title;\n\n      if (this._attr.media_season) {\n        text += \" S\" + this._attr.media_season;\n\n        if (this._attr.media_episode) {\n          text += \"E\" + this._attr.media_episode;\n        }\n      }\n\n      return text;\n    }\n    if (this._attr.app_name) {\n      return this._attr.app_name;\n    }\n    return \"\";\n  }\n\n  get source() {\n    return this._attr.source;\n  }\n\n  get sourceList() {\n    return this._attr.source_list;\n  }\n\n  get soundMode() {\n    return this._attr.sound_mode;\n  }\n\n  get soundModeList() {\n    return this._attr.sound_mode_list;\n  }\n\n  mediaPlayPause() {\n    this.callService(\"media_play_pause\");\n  }\n\n  nextTrack() {\n    this.callService(\"media_next_track\");\n  }\n\n  playbackControl() {\n    this.callService(\"media_play_pause\");\n  }\n\n  previousTrack() {\n    this.callService(\"media_previous_track\");\n  }\n\n  setVolume(volume) {\n    this.callService(\"volume_set\", { volume_level: volume });\n  }\n\n  togglePower() {\n    if (this.isOff) {\n      this.turnOn();\n    } else {\n      this.turnOff();\n    }\n  }\n\n  turnOff() {\n    this.callService(\"turn_off\");\n  }\n\n  turnOn() {\n    this.callService(\"turn_on\");\n  }\n\n  volumeDown() {\n    this.callService(\"volume_down\");\n  }\n\n  volumeMute(mute) {\n    if (!this.supportsVolumeMute) {\n      throw new Error(\"Muting volume not supported\");\n    }\n    this.callService(\"volume_mute\", { is_volume_muted: mute });\n  }\n\n  volumeUp() {\n    this.callService(\"volume_up\");\n  }\n\n  selectSource(source) {\n    this.callService(\"select_source\", { source });\n  }\n\n  selectSoundMode(soundMode) {\n    this.callService(\"select_sound_mode\", { sound_mode: soundMode });\n  }\n\n  // helper method\n\n  callService(service, data = {}) {\n    data.entity_id = this.stateObj.entity_id;\n    this.hass.callService(\"media_player\", service, data);\n  }\n}\n"],"sourceRoot":""}